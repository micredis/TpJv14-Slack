Grigory Kislin [12:41 AM]
joined #hw0.

Grigory Kislin [12:41 AM]
set the channel purpose: https://github.com/JavaOPs/topjava

Grigory Kislin [12:41 AM]
set the channel topic: https://github.com/JavaOPs/topjava

LeoJames [6:47 PM]
joined #hw0 along with 18 others.

Daria [8:02 PM]
всем привет, подскажите плиз, что за "+5 бонусов" в описании задания Optional?

LeoJames [8:14 PM]
К карме

Daria [8:26 PM]
где эта карма считается и на что она влияет?

Vitaly [8:31 PM]
@Daria влияет на ЧСВ :slightly_smiling_face:

LeoJames [8:33 PM]
На личностный рост и внешние условия следующего воплощения:thinking_face:

Vitaly [8:33 PM]
ну тогда скорее на профессиональный, не личностный

LeoJames [8:34 PM]
Профессиональная карма качается "проверкой заданий", а выполнение опциональных задач - только личностных
Мне еще 15 очков до фаербола

Daria [8:35 PM]
т.е. никакого рейтинга лучших по окончанию стажировки, никаких доп. скидок при наборе на следующие проекты?)

Vitaly [8:36 PM]
твои знания - твоя награда

LeoJames [8:36 PM]
Рейтингами мерятся не приучены

Vitaly [8:37 PM]
имхо - в optional - не менее половины всего времени уходит на задачи, так что там немало полезного

LeoJames [8:37 PM]
Рейтинг участников определяется зарплатой и количеством ассистенток

Daria [8:38 PM]
разумно) только ассистентов тоже можно считать)

vch [8:38 PM]
@Daria бонусы - это скидки на следующие курсы

LeoJames [8:38 PM]
:thinking_face:Только миленьких

Daria [8:39 PM]
@vch ага, значит все-таки что-то есть? считается только при купленной проверке ДЗ, как понимаю?

LeoJames [8:40 PM]
Такие бонусы вроде только за приглашения

vch [8:41 PM]
@Daria Нет. Конкретно в данном случае - интересные решения принимаются от всех.

Daria [8:42 PM]
@vch, понятно, спасибо :slightly_smiling_face:

LeoJames [9:06 PM]
Почему бы просто не взять и не создать ударную группу для участия в хакатонах во время стажировки. :face_with_rolling_eyes:  Чисто от javaops и от Григория лично
Народу полно, а на мероприятия ходят пара человек в Питере и МСК. Стыдно, товарищи
:woman-lifting-weights:

MaximusWork [9:13 PM]
Что за мероприятия?

LeoJames [9:15 PM]
:confused:Эм...хакатоны
Так. Я все понял:expressionless:

MaximusWork [9:19 PM]
ААА
слышал, но не учавствовал
не до того совсем было
читал с конца, поэтому не понял про что речь


sergentum [9:23 AM]
@LeoJames удивлю наверное тебя - не все русскоязычные живут в москве и в часовом поясе москвы. может даже большинство на проекте

LeoJames [9:36 AM]
:thinking_face:А я то думал, что за мкадом нет разумной жизни ай-ай-ай.
:face_with_rolling_eyes:В онлайн мероприятиях тоже желающих раз-два и все

Большинство и не знало, что так можно


sergentum [7:44 PM]
большинство этих мероприятий проходит вероятно мимо  от полной неизвестности. некоторые про которые я слышал мне не были интересны потому что уровень был сильно выше моего. те которые прям в онлайне, и проходят в мск вечером, следовательно у меня в 00 часов - тоже не особо интересно

LeoJames [8:15 PM]
Эм. Хорошо. Платочек дать? Зачем ты мне это рассказываешь? Не хочешь, не можешь, не заинтересован и тд - мне то до этого какое дело? Я предлагаю желающим и "могущим" поучаствовать в парочке мероприятий, которые можно будет добавить в резюме или упомянуть на собеседовании, особенно в тех фирмах, которые их проводят, а до остальных мне мягко говоря...похеру. Вот доказывает мне что то

Grigory Kislin [12:29 AM]
друзья, привет!
@Daria подтвержу, что бонусы- это скидки в % на оплату других проектов (если в своем профиле javaops наведете на них, то есть подсказка)
даются за активное участие, вклад в проект а также приглашение коллег- в профиле javaops есть красная кнопка "порекомендовать коллеге"
@LeoJames по поводу хакатонов- я счас загружен поуши
но можете самоорганизоваться:) в javaops группе например создать канал и велком (edited)

alexv [9:31 PM]
Кто уже проходит есть?

Vitaly [9:56 PM]
@alexv есть
а в чем вопрос?

alexv [9:58 AM]
ищу есть ли те кто начал идти заранее по 13 группе

alexv [10:06 AM]
вместе проще

Artem [11:05 AM]
Всем привет!
Кто-то уже смог сделать первую домашку в один проход? У меня в один проход ну никак не получается. Невозможно это, по-моему)))

Valery.Shkerdin [11:20 AM]
@Artem возможно )

Artem [11:24 AM]
Но как??? В один проход? Нет, я еще понял бы в одну строку, но в один проход?
Ведь там нужно сначала объекты сгруппировать, потом преобразовать (и преобразовывать в зависимости от первой группировки), а потом отфильтровать и опять сгруппировать. Так или иначе, ту как минимум два прохода получаются...
@Valery.Shkerdin первый проход для понимая в какой день сколько каллорий, второй для преобразования из объекта UserMeal в объект UserMealWithExceed с передачей значения "превышения". (edited)

shtramak [11:28 AM]
В стримах нет проходов. Это декларативное прогр-е. Ты написал, что нужно сделать, джава сама разберется как лучше сделать
Если ты ей ты написал понятно и незамудрено, то она сделает в один проход

Artem [11:31 AM]
@shtramak Не совсем понял.. Т.е. если я пишу Stream.of(бла-бла) потом .map потом .filter потом .collect - то это считается один проход?

shtramak [11:32 AM]
Пока ты коллект не сделаешь, дажва ничего делать не будет. Может создаст какие-то объекты, но итерироваться она не будет ни по чему
Если делаешь коллект, она сделает это максимально эффективным способом.
Чтобы она это сделала это эффективно, нужно ей давать понятную ей задачу, т.е следовать общим практикам, как обычно это используют и для чего это задумывалось

realcorwin [11:35 AM]
на самом деле старые "for" производительнее, чем стримы, если они не параллельные. впрочем, и в последнем случае необходимо, чтобы отдельные итерации были затратными по времени, иначе и тут старые способы итерирования выигрывают

shtramak [11:38 AM]
То что в форах делается за два фора, стрим может сделать за один проход, объединив условия
Так что не согласен. Но там все условно, где-то выигрывает, где-то нет.

Artem [11:44 AM]
так я не и понял)))
Если в стриме идут по порядку .map .filter  .collect - то это считается одним проходом? Как по мне так это два...

Merkulov [11:44 AM]
@shtramak А вы разбирались с документацией, знаете как работает внутри стримы?

shtramak [11:45 AM]
внутрь не лез

realcorwin [11:45 AM]
посмотри видео Куксенко. он на Оракле эти стримы писал. там по производительности всё подробно разбирается (edited)

shtramak [11:46 AM]
Я так же видел бенчмарки гуавы и стримов, где стримы в 2 раза производительней

realcorwin [11:47 AM]
плюс стримов не в производительности, а в том что это иная парадигма. ты говоришь не "как делать", а "что делать". ява делает за тебя. за удобство надо платить
было бы странно, если бы оракл сделал хуже старой гуавы


Grigory Kislin [12:30 AM]
+ большие задачи можно распараллелисть одним словом parallel


Alexander Pilipenko [1:49 PM]
Нашел интересный материал
https://programmingideaswithjake.wordpress.com/2015/12/19/313/
Programming Ideas With JakeJacob Zimmerman
How Java 8 Streams Work
When I first laid eyes on Java 8's Stream API and found out that it worked lazily, I was blown away and utterly baffled. It didn't seem possible. Eventually, I was able to wrap my head around it. In this post, I'm going to go through and write up a simplified implementation, creating filter(), map(), and reduce().
В виде вывода в нем написано следующее
Starting at the base Stream of some collection, we call filter(), then map(), then reduce() on it. This results in calling reduce() from a MapStream wrapped around a FilterStream, wrapped around a basic Stream. For each iteration done inside of reduce(), it calls hasNext() on the MapStream (since the Stream is also the Iterator), which simply delegates to its wrapped Iterator, which is a FilterStream in this instance. The FilterStream loops through until it finds an object that passes the filter’s test or the end of the collection. During that looping, it uses the hasNext() and next() methods of its wrapped Iterator, which is just the base Stream in this case. It returns its calculated hasNext() value, passing it back up the chain, where it is used by reduce().

Then reduce() needs the next() value. It goes through the same chain, delegating down the wrapper hierarchy until it gets a definitive answer that gets passed back up to it.
Т.е. если верить этому сайту, то в случае .map .filter  .collect все будет сделано за 1 проход

shtramak [2:12 PM]
Все промежуточные операции, которые выполняются до терминальной - проходят за один проход по стриму... в принципе по стриму можно пройтись только один раз

Artem [2:48 PM]
@Alexander Pilipenko Большое спасибо!

Но за один проход задача HW0 все равно не решается. Ну никак. Это противоречит логике. Мы в любом случае должны сначала пройти по ВСЕМУ списку чтобы сделать группировки и узнать количество калорий за ЦЕЛЫЙ ДЕНЬ за каждый день. - и это уже будет первый проход. И уже только потом фильтровать и из каждого объекта UserMeal делать объекты UserMealWithExceed. - и это второй проход.

Да, можно сделать вложенный стрим, но в задании сказано, что нужно без вложенных.

Да, можно придумать еще хитрые способы... Можно внутри класса UserMealWithExceed хранить статический список всех UserMealWithExceed (нам же не запрещали UserMealWithExceed изменять?!) и добавить конструктор, который будет принимать еще и значение дневной нормы калорий, в этом конструкторе будем перебирать весь список объектов UserMealWithExceed, отбирать по дате, если есть избыток по дневной норме калорий, то у всех объектов меняем exceed на значение true! Жесть, извращение и говнокод))) Но зато притянутое за уши решение в один проход в методе getFilteredWithExceeded будет работать. И да, все равно получается вложенный стрим/цикл, просто мы маскируем его внутрь UserMealWithExceed. (edited)

Alexander Pilipenko [2:50 PM]
Может меня и побьют, но в комментариях был намек на то, что код можно менять
Т.е. читать как Нужно
Ну и еще 1 намек. При указании сложности более большая поглощает более маленькие
Более точно сказать не могу. Может я неправильно понимаю и все сделал неправильно. И вообще выгонят из группы

Artem [2:54 PM]
И "уволят" со стажировки еще до её начала)))))
Да не, про изменение класса я и сам ранее написал :point_up_2:

Про сложность не понял.. Что значит более большая поглощает более маленькую?)

Alexander Pilipenko [2:55 PM]
O(n) теоретически выполняется дольше чем O(log(n))
Поэтому даже если сначала выполнилась операция O(log(n)), а за ней O(n), то общая сложность будет O(n) (edited)
Это для последовательных операций
Если Одна операция выполняет другую в цикле, то они перемножатся
И будет O(n*log(n))
Если операция O(1) - то она не повлияет ни на первый ни на второй случай. И при последовательной обработке и при обработке в цикле останется O(n) (edited)
Может я и не прав, но нам так объясняли

Stanislav [3:09 PM]
uploaded this image: 20180611_180806.png 


Stanislav [3:10 PM]
O(n+n), O(n) ни как не получится

Alexander Pilipenko [3:10 PM]
Вот. А так как n - это просто какая-то величина, то O(A+B) = O(n)

Stanislav [3:10 PM]
да

Alexander Pilipenko [3:11 PM]
Индексы опускают

Stanislav [3:11 PM]
+

Alexander Pilipenko [3:11 PM]
O(n+n) = O(2n) = O(n)
В натации
Но не в реальной работе
А откуда картинка?

Artem [3:12 PM]
Хм))) В общем я понял. Все сделали примерно одинаково. Сначала собрали Мапу, потом с её помощью преобразовали элементы.

Stanislav [3:13 PM]
Карьера Программиста Г.Лакман Макдауэлл

Alexander Pilipenko [3:13 PM]
Спасибо
Спойлер :slightly_smiling_face:

Artem [3:14 PM]
@Alexander Pilipenko Спойлер - это мне?))) Думаешь, удалить лучше?)

Alexander Pilipenko [3:14 PM]
Нет
Я бы не удалял, а админ ветки потом сам решит

Artem [3:17 PM]
Ок, оставлю.
И все равно это два прохода, а не один... в моем понимании. Вот такой я зануда..:upside_down_face: (edited)

Alexander Pilipenko [3:18 PM]
Можно за 1

Artem [3:31 PM]
Вторую неделю думаю и не понимаю как.. Похоже, что узнаю на первом занятии, где будет разбираться HW0.

Tim [6:04 PM]
два прохода - это тоже O(n)
я не понял только одно - сделали hw0 и ждем теперь типа 28е число?

Vitaly [6:06 PM]
да
на проверку только отправь

Merkulov [7:26 PM]
на проверку 21 нужно отправлять

Avaaron [8:22 PM]
цикл в цикле это 2 прохода? и сортировка компоратором считается за проход?

shtramak [8:32 PM]
Два цикла по отдельности это два прохода и O(n), а цикл в цикле это O(n2), сортировка по условию не требуется

Avaaron [8:41 PM]
ну, она мне была нужна (сортировка) , для исполнения задуманного

Tanya [10:25 PM]
те, у кого оплачена топджава с проверкой, могут на проверку сейчас отправлять
если есть решение за один проход, но топджава без проверки ДЗ - то скидывайте ссылку на гитхаб мне в ЛС (edited)


Vadim [1:42 PM]
Всем привет. Как думаете, должен ли метод getFilteredWithExceeded возвращать объекты UserMealWithExceed, у которых поле exceed == false? Мне кажется, что сама возможность наличия объекта, который называется WithExceed, но на самом деле exceed == false, не логична. Только мне так кажется?

Vladimir Gorbatenko [2:02 PM]
имеется в виду с полем, которое показывает "есть ли превышение"
Vadim
Всем привет. Как думаете, должен ли метод getFilteredWithExceeded возвращать объекты UserMealWithExceed, у которых поле exceed == false? Мне кажется, что сама возможность наличия объекта, который называется WithExceed, но на самом деле exceed == false, не логична. Только мне так кажется?
Posted in #hw0Jun 12th

Vadim [2:32 PM]
Если объект называется приёмПищиСпривышением, то странно, что этот объект может существовать, когда превышения нет

Vadim [2:57 PM]
это, как минимум, не очевидно
Vladimir Gorbatenko
имеется в виду с полем, которое показывает "есть ли превышение"
https://topjava14.slack.com/archives/CAJL007L3/p1528800127000066
Posted in #hw0Jun 12th

Vadim [3:11 PM]
Мне кажется, что UserMealWithExceed не должен содержать поля exceed, т.к. оно уже исходя из названия должно быть true, и вообще зачем нам объекты UserMealWithExceed, у которых exceed == false. Как мы их используем?

Vladimir Gorbatenko [3:14 PM]
Exceeded  - это флаг. Сам класс - как адаптер.

Stanislav [3:21 PM]
UserMeal - это энтити, UserMealWithExceed - это ДТО. метод "getFilteredWithExceeded" - это мапер, удачное ли название метода, хз, можно было бы и по другому.

AlxB [3:24 PM]
@Vadim по простому. Есть флажек, который показывает переел ли пользователь. Хранить его бесмыслено, так как он вычисляем.

Stanislav [3:25 PM]
Я так понимаю что ему не нравится название метода. Исходя из названия, метод делает не то что в названии.

Vadim [3:26 PM]
аллилуйя
Stanislav
Я так понимаю что ему не нравится название метода. Исходя из названия, метод делает не то что в названии.
Posted in #hw0Jun 12th

Stanislav [3:27 PM]
Переименуй в HW :wink: + в карму тебе будет...тут много к чему можно придраться, суть не в этом.

Vadim [3:28 PM]
Пусть будет ДТО, объясните, зачем объекты с exceed == false?
Stanislav
UserMeal - это энтити, UserMealWithExceed - это ДТО. метод "getFilteredWithExceeded" - это мапер, удачное ли название метода, хз, можно было бы и по другому.
Posted in #hw0Jun 12th
я не пытаюсь придираться, просто хочу разобраться, вполне допускаю, что я не прав или что-то не до конца понимаю

Stanislav [3:30 PM]
А ты смотрел готовое приложение? этот флаг определяет раскраску строки
переел или нет и подкрашывается

shtramak [3:32 PM]
А еще у UserMealWithExceed все поля приватные и нет геттеров... )


Stanislav [Jun 12th at 3:33 PM]
in #hw0
А еще много там чего нету) В реальной работе будете писать когда еще ни чего нету, одни заглушки...


2 replies
shtramak [3 days ago]
в реальной работе по началу, как правило, колупаются в куче уже написанного легаси говнокода) А так, конечно понятно, что все будем дописывать... Просто DTO без доступа к полям совсем на него не похож)


Stanislav [3 days ago]
:slightly_smiling_face:


Vadim [3:34 PM]
Если бы все объекты UserMealWithExceed были бы с превышением, это было бы логично, а уж подкрасить их вряд ли сложно. Ну или назвать UserMealWithExceedField or UserMealWithExceedFlag

Stanislav [3:35 PM]
Как назвать корабль так он и поплывет :wink:

Artem [4:46 PM]
Про проверку домашек не совсем понял. Получается, что даже если подписка без проверки - все равн оотправлять на проверку надо?) Просто ревью не будет.. или как?)

vch [4:57 PM]
@Artem думаю, это касается только решения `Optional 2` в данном уроке... Впрочем, Григорий упоминал ещё `вклад в проект` - если ты сможешь придумать решение лучше чем его эталонное в каком-нибудь уроке или найдёшь ошибку в эталонном решении - вряд ли он откажется посмотреть. (edited)

Artem [5:14 PM]
@vch Спасибо

e.pekhterev [2:23 PM]
Всем привет)! Реализовал в цикле за 2 прохода (не понимаю, как можно сделать за один, ведь предварите @льно нужно подсчитать сколько калорий за день получается). Если у кото-то есть идеи, не отказался бы от подсказки.
Да, я так понял, что раз у меня подписка без проверки и не лучшее решение, то и отправлять не нужно на проверку? (edited)

Artem [2:26 PM]
Да, если в два прохода, то можно пока и не отправлять. Говорят можно как-то в один. Вторую неделю думаю... чем больше думаю - тем больше понимаю, что нельзя в один проход сделать..) (edited)

Stanislav [2:28 PM]
Скорее всего не правильно сформулирована задача. Скорее всего имеется ввиду сложность O(n), а не сколько циклов. Уже выше обсуждалось, 2 цикла и 1 цикл в котором вложенный цикл это разные вещи.

Artem [2:33 PM]
Да не, мы уже 14-я группа, судя по url, не могли же задачу до 14-ой группы довести и до сих пор не доформулировать корректно.

Stanislav [2:34 PM]
Тогда есть еще мысль.Что это нормально т.к. на собеседовании-на реальной работе такое будет часто, скажут какую то *** сделать, а ты встанешь ступором и не будешь знать что ответить-написать.
Я уже задачу на проверку сдавал, обсуждал с девушками (кто проверяет). Ни чего не сказали про 1 цикл (у меня решения О(n) что циклами, что стримами). Так что, не совсем корректно описана задача, хотя как выше написал, такое будет часто.

Artem [2:39 PM]
Т.е. несколькими стримами приняли как правильно решенную?)

Stanislav [2:40 PM]
На собеседовании вообще могут дичь какую нибудь спросить :slightly_smiling_face: и надо будет как то обьяснить-доказать что они спрашивают не правильно, что так не возможно, по таким то, таким причинам.
Да, 1 стрим группирует по дате и каллориям, второй делает что уже надо (смотря на результат 1).
это О(n)
вернее О(n+n) но индексы опускаются, по этому О(n)

Artem [2:42 PM]
эээээ, но мне сказали, что это классическое решение в два прохода, а должно быть (если решать "optional 2") решение в один проход.)

Stanislav [2:43 PM]
тогда хз, мне не сказали что есть другое решение, но так же сказали классическое решение...лано, видно будет что они там напридумали в начальном уроке)

Join_Selectovich [4:23 PM]
Мне тоже сразу показалось что в 1 цикл нельзя решить, но через пару недель появилась идея как это можно попробовать сделать. буду пробовать )

Artem [4:45 PM]
@Join_Selectovich Ты вот зачем сейчас это написал?))) Ты либо делись, либо не сыпь соль на рану :smiley:

Join_Selectovich [4:49 PM]
Я уже засомневался .. что все-таки это можно сделать. но может как-то динамически рассчитывать значения и сразу в этом же цикле делать маркировку строк. (edited)

Avaaron [6:59 PM]
в итоге цикл в цикле будет
я так решил


Tanya [Jun 13th at 8:50 PM]
in #hw0
ДЗ принимается
base - через циклы со сложностью O(N)
optional - стримы  со сложностью O(N)
optional 2 - один проход по mealList и сложность O(N) это уже чтобы поиграться, если есть время и желание + бонус, если получится



1 reply
Tim [23 hours ago]
потом расскажете как можно за один проход? по мне это противоречит логике: 1 проход группировка по дням с подсчет калорий, второй проход - расставление true/false каждому приему пищи


Vitaly [11:59 PM]
кому интересно - сравните время выполнения своих методов getFilteredWithExceeded через циклы, и через стримы

Tanya [12:24 AM]
только сравнивать над не в лоб, а желательно с помощью подходящих инструментов, например JMH


Grigory Kislin [1:15 PM]
в лоб- это с потолка. нужно спец. инструменты на прогретой jvm

Avaaron [1:32 PM]
я возможно ошибаюсь, но в идее вроде бы есть пердустановленный мавен

Alexander Pilipenko [2:16 PM]
На моем варианте с 2 циклами или 2 стримами (реализуют похожую логику) в JMH получил такие результаты:
# Run complete. Total time: 00:08:49

Benchmark                                       (iterations)   Mode  Cnt       Score       Error  Units
BenchMark.benchGetFilteredWithExceededByLoop               5  thrpt   20  862593.239 ± 29883.843  ops/s
BenchMark.benchGetFilteredWithExceededByLoop              10  thrpt   20  469197.070 ± 12271.461  ops/s
BenchMark.benchGetFilteredWithExceededByLoop              15  thrpt   20  294510.912 ± 13768.790  ops/s
BenchMark.benchGetFilteredWithExceededByLoop              20  thrpt   20  226841.896 ±  4487.993  ops/s
BenchMark.benchGetFilteredWithExceededByLoop              30  thrpt   20  150431.766 ±  3710.687  ops/s
BenchMark.benchGetFilteredWithExceededByStream             5  thrpt   20  718339.870 ± 18108.173  ops/s
BenchMark.benchGetFilteredWithExceededByStream            10  thrpt   20  408348.499 ± 16130.764  ops/s
BenchMark.benchGetFilteredWithExceededByStream            15  thrpt   20  288469.300 ±  7000.323  ops/s
BenchMark.benchGetFilteredWithExceededByStream            20  thrpt   20  252440.735 ±  3888.902  ops/s
BenchMark.benchGetFilteredWithExceededByStream            30  thrpt   20  150050.116 ±  5572.242  ops/s
iterations - количество заполненных дней в массиве (1 день = 3 приема пищи)

Alexander Pilipenko [2:37 PM]
# Run complete. Total time: 00:03:32

Benchmark                                       (iterations)   Mode  Cnt     Score     Error  Units
BenchMark.benchGetFilteredWithExceededByLoop             500  thrpt   20  5103.401 ±  56.740  ops/s
BenchMark.benchGetFilteredWithExceededByLoop            1000  thrpt   20  2364.176 ±  13.455  ops/s
BenchMark.benchGetFilteredWithExceededByStream           500  thrpt   20  6515.109 ± 163.518  ops/s
BenchMark.benchGetFilteredWithExceededByStream          1000  thrpt   20  2717.628 ±  28.614  ops/s

Vitaly [23 hours ago]
как-то странно, у тебя ops/s почти равны у стримов и циклов


Alexander Pilipenko [23 hours ago]
На больших количествах стримы даже выиграли


Vitaly [23 hours ago]
просто у меня больше разница вышла между обычным циклом и стримом


Alexander Pilipenko [23 hours ago]
После первого урока могу скинуть код задания


Alexander Pilipenko [23 hours ago]
Или сейчас код запуска бенчмарка


Alexander Pilipenko [23 hours ago]
А на коком количестве записей ты тестировал?


Vitaly [23 hours ago]
мне код самих методов не нужен, скинь бенчмарк просто


Vitaly [23 hours ago]
сейчас мой бедный ноут дожжужит, скину


Vitaly [23 hours ago]
я вот по поводу Fork - не очень понял смысл


Alexander Pilipenko [2:47 PM]
added this Java snippet: BenchMark.java 
package ru.javawebinar.topjava;
​
​
​
import com.google.common.hash.HashFunction;
import com.google.common.hash.Hasher;
import com.google.common.hash.Hashing;
import org.openjdk.jmh.annotations.*;
import ru.javawebinar.topjava.model.UserMeal;
import ru.javawebinar.topjava.model.UserMealWithExceed;
import ru.javawebinar.topjava.util.UserMealsUtil;
​
import java.nio.charset.Charset;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.Month;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Random;
​
public class BenchMark {
​
  @State(Scope.Benchmark)
  public static class ExecutionPlan {
​
    List<UserMeal> mealList;
​
    @Param({ "5", "10", "15", "20", "30" })
    public int iterations;
​
    @Setup(Level.Invocation)
    public void setUp() {
​
​
      Random random = new Random();
​
      mealList = new ArrayList<>();
      for (int i=1; i<iterations; i++) {
        mealList.add(new UserMeal(LocalDateTime.of(2015, Month.MAY, i, 10, 0), "Завтрак", 300+i*14));
        mealList.add(new UserMeal(LocalDateTime.of(2015, Month.MAY, i, 13, 0), "Обед", 500+i*10));
        mealList.add(new UserMeal(LocalDateTime.of(2015, Month.MAY, i, 20, 0), "Ужин", 200+i*13));
      }
    }
  }
​
  @Fork(value = 1, warmups = 1)
  @Benchmark
  @BenchmarkMode(Mode.Throughput)
  @Warmup(iterations = 5)
  public void benchGetFilteredWithExceededByStream(ExecutionPlan plan) {
​
    UserMealsUtil.getFilteredWithExceededByStream(plan.mealList, LocalTime.of(7, 0), LocalTime.of(12, 0), 2000);
​
  }
​
  @Fork(value = 1, warmups = 1)
  @Benchmark
  @BenchmarkMode(Mode.Throughput)
  @Warmup(iterations = 5)
  public void benchGetFilteredWithExceededByLoop(ExecutionPlan plan) {
​
    UserMealsUtil.getFilteredWithExceededByLoop(plan.mealList, LocalTime.of(7, 0), LocalTime.of(12, 0), 2000);
​
  }
​
}


Alexander Pilipenko [2:47 PM]
added this Java snippet: BenchmarkRunner.java 
package ru.javawebinar.topjava;
​
public class BenchmarkRunner {
​
  public static void main(String[] args) throws Exception {
    org.openjdk.jmh.Main.main(args);
  }
​
}
Collapse 

Alexander Pilipenko [2:47 PM]
added this XML snippet: pom.xml 
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"
     xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
​
  <groupId>ru.javawebinar</groupId>
  <artifactId>topjava</artifactId>
  <packaging>jar</packaging>
​
  <version>1.0-SNAPSHOT</version>
​
  <name>Calories Management</name>
  <url>http://topjava.herokuapp.com/</url>
​
  <properties>
    <java.version>1.8</java.version>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
  </properties>
​
  <build>
    <finalName>topjava</finalName>
    <defaultGoal>install</defaultGoal>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.7.0</version>
        <configuration>
          <source>${java.version}</source>
          <target>${java.version}</target>
        </configuration>
      </plugin>
    </plugins>
  </build>
​
  <dependencies>
    <dependency>
      <groupId>org.openjdk.jmh</groupId>
      <artifactId>jmh-core</artifactId>
      <version>1.19</version>
    </dependency>
    <dependency>
      <groupId>org.openjdk.jmh</groupId>
      <artifactId>jmh-generator-annprocess</artifactId>
      <version>1.19</version>
    </dependency>
    <dependency>
      <groupId>com.google.guava</groupId>
      <artifactId>guava</artifactId>
      <version>18.0</version>
    </dependency>
​
  </dependencies>
​
  <profiles>
  </profiles>
​
  <dependencyManagement>
  </dependencyManagement>
</project>
Collapse 

Vitaly [2:56 PM]
uploaded this image: image.png 


Alexander Pilipenko [3:06 PM]
Это на каком количестве записей?

Vitaly [3:06 PM]
5
iteration
2 дня, 6 записей

Alexander Pilipenko [3:19 PM]
Странно, что у тебя стримы на малом количестве быстрее
# Run complete. Total time: 00:02:39

Benchmark                                       (iterations)   Mode  Cnt        Score       Error  Units
BenchMark.benchGetFilteredWithExceededByLoop               2  thrpt   40  1962076.081 ± 44780.327  ops/s
BenchMark.benchGetFilteredWithExceededByStream             2  thrpt   40  1311009.308 ± 16205.788  ops/s

Process finished with exit code 0
Или это по среднему времени?

Vitaly [3:20 PM]
среднее
Fork - value - это что? какой физический смысл?

Alexander Pilipenko [3:22 PM]
http://www.baeldung.com/java-microbenchmark-harness
Baeldung
Microbenchmarking with Java | Baeldung
Learn about JMH, the Java Microbenchmark Harness.
Jul 24th, 2017
By using the @Fork annotation, we can set up how benchmark execution happens: the value parameter controls how many times the benchmark will be executed, and the warmup parameter controls how many times a benchmark will dry run before results are collected, for example:
По среднему времени у меня не сработало :slightly_smiling_face:
# Run complete. Total time: 00:02:38

Benchmark                                       (iterations)  Mode  Cnt   Score    Error  Units
BenchMark.benchGetFilteredWithExceededByLoop               2  avgt   40  ≈ 10⁻⁶            s/op
BenchMark.benchGetFilteredWithExceededByStream             2  avgt   40  ≈ 10⁻⁶            s/op

Vitaly [3:25 PM]
поставь наносекунды, интересно ж
он округлил просто сильно

Alexander Pilipenko [3:30 PM]
# Run complete. Total time: 00:02:39

Benchmark                                       (iterations)  Mode  Cnt    Score    Error  Units
BenchMark.benchGetFilteredWithExceededByLoop               2  avgt   40  523.923 ± 18.749  ns/op
BenchMark.benchGetFilteredWithExceededByStream             2  avgt   40  749.729 ± 17.808  ns/op

Vitaly [3:34 PM]
ну да, примерно то же соотношение, что у меня


Stanislav [Yesterday at 4:14 PM]
in #hw0
Я надеюсь решение в 1 проход (Option 2) не из разряда "не правильного программирования", типа, создать статическую мапу класса UserMeal и ложить туда суммированные калории по дням :slightly_smiling_face: А то такого г** можно много придумать.


4 replies
Tim [20 hours ago]
это 2 прохода все равно, сначала надо заполнить мапу


Stanislav [19 hours ago]
В конструкторе...


Grigory Kislin [19 hours ago]
1. а почему  статическую мапу в  UserMeal? ее где угодно можно сделать
2. и как она поможет?


Stanislav [18 hours ago]
Вообще мысль была, на этапе создания UserMeal как то суммировать калории (хэш, или вот статик мапу<Date, калории> на класс и в конструкторе заполнять). Но это ерунда 1. Нет уникальности, если объект был бы persist, но то же не то 2. Очищать мапу....в общем ерунда...
Тут скорее всего или не правильно мы понимаем "Option 2" или не правильно сформулировано. 1 проход по листу UserMeal, O(n)...Можно при проходе запоминать калории и создавать DTO, как только привысил максимум калорий перебирать созданые DTO и изменить флаг. Но то же мне это не нравится, хотя и 1 проход пл листу с UserMeal, а вот сложность О я затрудняюсь измерить.


Crazz [6:05 PM]
как вариант можно складывать отфильтрованное в 2 захардкоженных списка - один exceed true, другой false

Stanislav [6:39 PM]
Тут не сам алгоритм, а структуру менять надо. 1 цикл, на первом проходе уже надо знать exceed или нет. Тот же exceed финальный, то есть потом не поменяешь (да и смысл, все равно если менять тот же цикл в цикле будет). Хэшировать на момент создания энтити тоже маразм....

Andy Fleer [8:26 PM]
Подскажите где есть внятное объяснение как прицепить JMH к проекту

Alexander Pilipenko [9:13 PM]
Выше был туториал

Andy Fleer [9:59 PM]
Уточню вопрос


Andy Fleer [Yesterday at 9:59 PM]
in #hw0
import org.openjdk.jmh.annotations.Benchmark;
идея не видит


59 replies
Vitaly [16 hours ago]
зависимости в pom.xml поставил?


Andy Fleer [15 hours ago]
Да. Но вот сейчас доходит до меня, что OpenJDK это не то же что JDK от Oracle


Andy Fleer [15 hours ago]
похоже в этом дело


Andy Fleer [15 hours ago]
Так?


Alexander Pilipenko [15 hours ago]
Нет

Alexander Pilipenko [15 hours ago]
Когда пропишешь в pom.xml должны, потом нужно сделать maven -> reimport


Alexander Pilipenko [15 hours ago]
Будут скачаны необходимые jar файлы


Alexander Pilipenko [15 hours ago]
После этого все должно нормально быть

Andy Fleer [15 hours ago]
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
   <modelVersion>4.0.0</modelVersion>

   <groupId>jmh-test</groupId>
   <artifactId>jmh-test</artifactId>
   <version>1.0-SNAPSHOT</version>

   <dependencies>
       <dependency>
           <groupId>org.openjdk.jmh</groupId>
           <artifactId>jmh-core</artifactId>
           <version>1.19</version>
           <scope>system</scope>
           <systemPath>${project.basedir}/src/main/resources/jmh-core-1.19.jar</systemPath>
       </dependency>
       <dependency>
           <groupId>org.openjdk.jmh</groupId>
           <artifactId>jmh-generator-annprocess</artifactId>
           <version>1.19</version>
           <scope>system</scope>
           <systemPath>${project.basedir}/src/main/resources/jmh-generator-annprocess-1.19.jar</systemPath>
       </dependency>
   </dependencies>

</project>


Andy Fleer [15 hours ago]
Всё так?


Andy Fleer [15 hours ago]
От реимпорта легче не становится


Andy Fleer [15 hours ago]
О!


Andy Fleer [15 hours ago]
Есть контакт


Andy Fleer [14 hours ago]
Я не реипортом jarы качал, а руками закинул в директорию resources и прописал к ним путь


Andy Fleer [14 hours ago]
Это был не лучший путь


Andy Fleer [14 hours ago]
А вообще какая общая стратегия? Добавляю JMH в рабочий проект или делаю тестовый проект, куда пересаживаю части для тестирования? Как опыт подсказывает? Как добрее и разумней?


Alexander Pilipenko [14 hours ago]
Разработчики рекомендуют отдельный MAVEN/GRADEL проект в который копируются jar c тестируемой частью (edited)


Alexander Pilipenko [14 hours ago]
А в pom.xml меня очень смущают строки  <systemPath>${project.basedir}/src/main/resources/jmh-core-1.19.jar</systemPath>


Alexander Pilipenko [14 hours ago]
Скорее всего не туда копировалось



Vitaly [14 hours ago]
я отходил, но вижу все решилось :grin:

Vitaly [14 hours ago]
@Andy Fleer искренне советую посмотреть/почитать про мавен, мне кажется здесь у вас пробел, это оч важный аспект


Andy Fleer [14 hours ago]
Однозначно пробел

Vitaly [14 hours ago]
можно сказать - бросьте все и займитесь, дальше будут везде зависимости, плагины, сборка проекта, и т.д., это правда просто, но будет отвлекать


Andy Fleer [14 hours ago]
Есть мысли о вменяемом ресурсе или учебном курсе на тему


Andy Fleer [14 hours ago]
Английский подходит

Vitaly [14 hours ago]
Ща

Andy Fleer [14 hours ago]
На Юдеми были курсы с Maven но кажется вместе с Nod-ом

Vitaly [14 hours ago]
https://proselyte.net/tutorials/maven/
PROSELYTE
Руководство по Maven (полная версия).
Руководство по Maven (полная версия). Введение. Файл POM. Жизненный цикл сборки проектов. Профили сборки. Репозитории. Плагины. Создание проекта. Сборка и тестирование проекта. Внешние зависимости.… (16 kB)
Mar 26th, 2016 at 10:24 PM


Vitaly [14 hours ago]
на ютубе море, на офиц сайте тоже есть достаточно много

Andy Fleer [14 hours ago]
Отлично

Andy Fleer [14 hours ago]
Изучу

Vitaly [14 hours ago]
на проселайт - основа есть в принципе

Vitaly [14 hours ago]
если мало будет: 
https://www.tutorialspoint.com/maven/maven_overview.htm
www.tutorialspoint.com
Maven Overview
Maven Overview - Learn Maven in simple and easy steps starting from basic to advanced concepts with examples including Overview, Environment Setup, POM, Build Life Cycle, Build profiles, Repositories, Plug-ins, Creating Project, Build & Test Project, External Dependencies, Project Documents, Project Templates, Snapshot, Build Automation, Dependency Management, Deployment Automation, Web Application, Eclipse IDE, Netbeans IDE, IntelliJ IDEA.


Andy Fleer [14 hours ago]
Как сконфигурировать проект чтобы запускался с Main в BenchMarkRunner


Vitaly [14 hours ago]
это отдельный учебник на 120 стр, с примерами, но на англ., но большая часть все равно стразу не нужна будет, все равно вылетит, лучше вернуться осознанно, когда что-нибудь не взлетит


Andy Fleer [14 hours ago]
Edit Configurations здесь другие (в Ultimate)


Vitaly [14 hours ago]
я в смятении..

Vitaly [14 hours ago]
вы про мавен архетип?


Andy Fleer [14 hours ago]
)))

Andy Fleer [14 hours ago]
Прости, дорогой))))


Andy Fleer [14 hours ago]
Я же мануал еще не прочитал))


Andy Fleer [14 hours ago]
Когда я создаю проект Maven


Andy Fleer [14 hours ago]
Накидываю туда несколько классов


Andy Fleer [14 hours ago]
В одном из них Main


Andy Fleer [14 hours ago]
как я говорю Maven где тот класс в котором нужный для запуска main


Andy Fleer [14 hours ago]
?

Vitaly [14 hours ago]
src/main/java ->> а дальше делай что хочешь, главное структура каталогов. мавен сам разберется


Vitaly [14 hours ago]
мавен не запускает класс


Vitaly [14 hours ago]
в данном случае, он просто обеспечивает библиотеки


Vitaly [14 hours ago]
1. сделать проект мавен


Vitaly [14 hours ago]
2. добавить в dependencies нужные библиотки, посмотреть чтобы подтянулись


Vitaly [14 hours ago]
3. все, делаешь классы

Vitaly [14 hours ago]
вот неплохое видео
https://www.youtube.com/watch?v=gv60974ebDY
YouTube Java Beginners Supplimentary Videos
Maven: создание простейшего проекта
 


Andy Fleer [14 hours ago]
Заработало!!


Andy Fleer [14 hours ago]
Надо было в конфигурации поставить чекбокс  Resolve Workspace Artifacts


Andy Fleer [14 hours ago]
И жизнь наладилась


Andy Fleer [14 hours ago]
На примере работает


Andy Fleer [14 hours ago]
Спасибо большое


Andy Fleer [14 hours ago]
Завтра двинусь дальше


Join_Selectovich [11:25 AM]
Кто-нибудь правильно решил HW0 задачу за один проход по массиву? (edited)


Grigory Kislin [1:56 PM]
Коллеги, привет!
@Join_Selectovich 1. да, решения есть. но до 28 не публикуем.
2. разбор всех решений будет 28.06- на первом занятии