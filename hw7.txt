Grigory Kislin [12:12 AM]
joined #hw7.

Grigory Kislin [12:13 AM]
Добро пожаловать: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson07.md
JUnit5, REST контроллеры и их тестирование
Успехов! (edited)

Егорро [12:16 AM]
joined #hw7 along with 18 others.


realcorwin [Yesterday at 10:37 AM]
@Grigory Kislin про JUnit5 смотреть только ролик 7_4, или про него есть и в других видео, если да, в каких?


4 replies
Stanislav [15 hours ago]
Лень весь урок посмотреть и увидеть? Если нужно больше инфы о J5 то https://www.youtube.com/results?search_query=junit+5
youtube.com
junit 5 - YouTube
Enjoy the videos and music you love, upload original content, and share it all with friends, family, and the world on YouTube.


realcorwin [14 hours ago]
Не лень, а времени нет по второму разу все видео пересматривать в поиске конкретной темы.


Grigory Kislin [13 hours ago]
только 7_4 + патч  7_08 (edited)


realcorwin [11 hours ago]
спасибо


e.pekhterev [Yesterday at 4:54 PM]
у кого-нибудь  есть проблема с @Autowired после патча Apply 7_08_JUnit5.patch?
Pasted image at 2018-08-16, 4:54 PM



17 replies
Ignat [8 hours ago]
Я ещё не накатывал патчи, но я думаю проблема не с @Autowired а с конфигурацией бинов.


e.pekhterev [8 hours ago]
вот эта штука похоже не отрабатывает
@SpringJUnitConfig(locations = {
       "classpath:spring/spring-app.xml",
       "classpath:spring/spring-db.xml"
})


e.pekhterev [8 hours ago]
Плиз хелп, всё перерыл


Stanislav [8 hours ago]
Все работает, просто идея тупит.


e.pekhterev [8 hours ago]
@Stanislav у тебя также подчеркивает?
Просто у Григория видео вродь свежее и у него всё в порядке (edited)


Stanislav [8 hours ago]
Тоже подчеркивает, но все тесты и контролеры работают норм.


e.pekhterev [8 hours ago]
мда, спасибо)


e.pekhterev [7 hours ago]
как вот не очень хотелось бы на это забивать, может можно всё же починить?
Pasted image at 2018-08-16, 5:55 PM



Stanislav [7 hours ago]
Как выше ты написал из-за SpringJUnitConfig....а дальше гугл


e.pekhterev [7 hours ago]
искал, не нашел пока ничего в качестве рабочего решения
(инвалидаця кеша после удаления iml не помогает, с facets тоже всё  в порядке) (edited)


Stanislav [7 hours ago]
https://jira.spring.io/plugins/servlet/mobile#issue/SPR-17101


Stanislav [7 hours ago]
Может там что то прольет свет

e.pekhterev [7 hours ago]
прочитал, ничего не пролило)))


e.pekhterev [7 hours ago]
в общем похоже, что просто Идея не понимает и всё, у нас было:
*@ContextConfiguration({*
       *"classpath:spring/spring-app.xml",*
       *"classpath:spring/spring-db.xml"*
*})*
*@ExtendWith(SpringExtension.class)*

заменили на:
*@SpringJUnitConfig(locations = {*
       *"classpath:spring/spring-app.xml",*
       *"classpath:spring/spring-db.xml"*
*})*
*//@ExtendWith(SpringExtension.class)*

При этом:
*@SpringJUnitConfig is a composed annotation that combines @ExtendWith(SpringExtension.class) from JUnit Jupiter with @ContextConfiguration from the Spring TestContext Framework.*

Короче Идея мудила)))


e.pekhterev [7 hours ago]
@Stanislav так что ты был прав изначально, а зря потратил пару часов

e.pekhterev [6 hours ago]
а такой вариант вполне себе Идее понятен:
*@ContextConfiguration({*
      *"classpath:spring/spring-app.xml",*
      *"classpath:spring/spring-db.xml"*
*})*
*@ExtendWith(SpringExtension.class)* (edited)


e.pekhterev [6 hours ago]
ахах)))
Pasted image at 2018-08-16, 7:11 PM


alexey [9:56 AM]
Всем привет. Подскажите а что нужно тестировать в css файле?

Ant [9:58 AM]
проверить status и ContentType

alexey [11:16 AM]
спасибо


alexey [Aug 17th at 1:08 PM]
А у всех крокозябры после накатки патчей?
112.jpg



2 replies
Kirilo [2 days ago]
В Idea везде нужно utf8 выставить. (edited)


Kirilo [2 days ago]
encoding.jpg


Alexander Pilipenko [Aug 17th at 1:13 PM]
Проверь кодировку в файле с сообщениями app_ru.properties


1 reply
alexey [2 days ago]
Она, спасибо


Prodigy [Aug 17th at 2:16 PM]
че-то я потерялся в этих уровнях абстракций и количестве контроллеров... рябит в глазах уже от этих абстрактных классов)



21 replies
Kirilo [2 days ago]
ты можешь делать и по другому - это просто для обучения ООП сделано и реально не факт, что на таком маленьком проекте - удобно.


Kirilo [2 days ago]
Нам вообще достаточно только двух контроллеров для приложения: рэст и обычный.


Prodigy [2 days ago]
понятно что это проект учебный, но с абстракциями усложняет понимание что и зачем делается, даже на таком маленьком проекте


Kirilo [2 days ago]
Ну, да. Зато тренируешь глаз и мозги :slightly_smiling_face:


Prodigy [2 days ago]
Понятно что Григорий масштабней мыслит и он жонглирует этими абстракциями), но у меня реально мозг рвется)) (edited)


Kirilo [2 days ago]
Прыгаешь по всему коду, что откуда берется. Привыкаешь к проектам, там где этих файлов тьма


Prodigy [2 days ago]
хотя я делал поболее приложение, но там всё было проще)


Prodigy [2 days ago]
да, мозги точно тренируешь)


Kirilo [2 days ago]
здесь рассматривается много всяких проблем, а реально использовать придется не все, но зато запомнишь, что уже такое видел, может пригодится когда-то (edited)

Prodigy [2 days ago]
реально может быть всё гораздо хуже))


Kirilo [2 days ago]
наверное, там, где старые проекты (edited)


Kirilo [2 days ago]
Я после наших настраиваний контекста спринга и т.д. решился в винде видеодрайверы(файлы) и блютуз гарнитуры с диска C:\ на D:\ попереносить, пол дня реестр перебирал, менял пути, но в итоге все работает и SSD диск свободнее. :slightly_smiling_face: (edited)


Prodigy [2 days ago]
ну тоже доп. экспириенс)


e.pekhterev [2 days ago]
на бумаге набросай схему наследования классов, возможно будет полегче

Stanislav [2 days ago]
Так идея сама может строить график красивый, через пкм посмотрите


e.pekhterev [2 days ago]
можно и так)


Prodigy [2 days ago]
можно поподробнее что такое "пкм"?


e.pekhterev [2 days ago]
1. наводишь указатель мыши на интересующий тебя класс
2. вызываешь контекстное меню (пкм - жмёшь на правую клавишу мыши)
3. Diagrams -> Show Diagram -> Java Class Diagram


e.pekhterev [2 days ago]
ну либо спринговые диаграммы - там ещё показано и что автоваярится


Prodigy [2 days ago]
так я вижу только родителей класса который я выбираю, а как посмотреть диаграмму всего приложения?


e.pekhterev [2 days ago]
тут не подскажу


Макс Куркудюк [3:59 PM]
Підкажіть, чому дані посилання виділені червоним.
Не знаходить дані файли.
Але при запуску tomcat, у браузері сторінка відображається так, як потрібно...
Виправляється, коли перейменовую файл mealForm.jsp, але коли змінюю назад на mealForm - шлях знову стає червоним... (edited)
Снимwrwerwerweок.PNG 


zippospb [Aug 18th at 1:37 AM]
Можете мне объяснить, зачем в Optional надо делать собственный форматтер/конвертер для getBetween, если в аннотации DateTimeFormat можно воспользоваться полем "pattern"? (edited)


13 replies
Merkulov [1 day ago]
Вроде как у нас есть уже конверторы для времени и дат в классах утилитах, почему бы их не заюзать?


Merkulov [1 day ago]
тоже непонятен этот момент


zippospb [1 day ago]
Если ты про DateTimeUtil, то он как раз для этого слабо подходит - мы с ним сможем работать только непосредственно в контроллере и дальше, а мы ведь хотим, чтобы в контроллер дата и время уже приходили в виде LocalDate и LocalTime.


Merkulov [1 day ago]
я так понял, что нужно делать конвертацию в контроллере
Переделать MealRestController.getBetween на параметры LocalDate/LocalTime c раздельной фильтрацией по времени/дате, работающий при null значениях (см. демо и JspMealController.getBetween). Заменить @DateTimeFormat на свои LocalDate/LocalTime конверторы или форматтеры.


Merkulov [1 day ago]
в запросе у тебя приходят строки и эти строки ты конвертируешь, как в контроллер может приходить сразу LocalDate/LocalTime ?


Merkulov [1 day ago]
@DateTimeFormat тоже делает конвертациию приходящих параметров.

zippospb [1 day ago]
ну так если ты перед аргументом помимо @RequestParam еще и @DateTimeFormat указываешь, то в контроллер может приходить уже распарсенная дата/время/датавремя (edited)


zippospb [1 day ago]
тебе их конвертировать и не приходится - за тебя это делает спринг.


Nikolay [15 hours ago]
ну а так мы учим спринг парсить строчку без всяких аннотаций


Merkulov [12 hours ago]
ммм...ты ведь тоже можешь сделать конвертацию с помощью аннотации, так вопрос, приходит ли в контроллер уже распарсенное значение или спринг с помощью аннотации или конвертеров просто инкапсулирует конвертацию уже пришедших параметров в контроллер ???


Nikolay [11 hours ago]
если бы приходило уже распарсеное значение, зачем нам тогда аннотации нужны были бы


Merkulov [11 hours ago]
вот вот и я про это, я уже сделал через CoversionServise и все работает как надо, Spring очень умен) он просто все инкапсулирует, получается в контроллер приходит значение в виде строки и он его парсит и отдает нам то что нужно


Merkulov [11 hours ago]
кончено согласно тому как мы настроили конвертацию


zippospb [1:37 AM]
Или это для собственного экспириенса?


tim [Aug 18th at 11:29 AM]
Всем привет! Может что пропустил, но нигде не нашел пояснения...Не подскажите, что делает патч 7 05 fix hint graph?


1 reply
Alexander Pilipenko [1 day ago]
Apply 7_05_fix_hint_graph.patch
В JpaUserRepositoryImpl.getByEmail DISTINCT попадает в запрос, хотя он там не нужен. Это просто указание Hibernate не дублировать данные. Для оптимизации можно указать Hibernate делать запрос без distinct: 15.16.2. Using DISTINCT with entity queries
Тест DataJpaUserServiceTest.testGetWithMeals() не работает для admin (у админа 2 роли и еда при JOIN дублируется). DISTINCT при несколький JOIN не помогает. Оставил в графе только meals. Корректно поставить тип LOAD, чтобы остальные ассоциации доставались по стратегии модели. Однако с типом по умолчанию FETCH роли также достаются (похоже что бага).


sky [Yesterday at 10:08 AM]
в 7_08 патче про JUnit5 добавляется message "JPA not supported" в assume. Вот так: Assumptions.assumeTrue(isJpaBased(), "JPA not supported").
А разве не должно быть "JDBC not supported"? (edited)


12 replies
e.pekhterev [14 hours ago]
Validate the given assumption.
the message to be included in the TestAbortedException
if the assumption is invalid throws TestAbortedException

я тоже сначала засомневался)


sky [14 hours ago]
Вот отсюда - https://junit.org/junit5/docs/5.0.0/api/org/junit/jupiter/api/Assumptions.html: message это - the message to be included in the TestAbortedException if the assumption is invalid. Т.е. сообщение которое прикрепляется к эксепшену, если предположение НЕ верно. А мы предполагаем JPA


e.pekhterev [14 hours ago]
ещё раз, если у нас пойдут тесты для jdbc, то эссампшин будет indavalid, и тогда мы получим исключение с этим сообщением


e.pekhterev [14 hours ago]
так что всё норм


sky [14 hours ago]
Ну вот что выдает, когда запускаешь JdbcMealServiceTest -  org.opentest4j.TestAbortedException: Assumption failed: JPA not supported
При чем тут JPA в этом случае? Я бы предпочел увидеть здесь сообщение типа "this test does not support JDBC realisation"


sky [14 hours ago]
или "validation only for JPA"

e.pekhterev [14 hours ago]
ну напиши Григорию, если тебе это не нравится)))


sky [14 hours ago]
Ты по прежнему считаешь что все норм?


e.pekhterev [13 hours ago]
да, на тестах для jdbc на этом тесте мы получаем сообщение, что нет поддержки JPA, соответственно тесты валидации пропускаются, не вижу никаких проблем.
у меня был трабл вначале понять, когда это сообщение выдается.


e.pekhterev [13 hours ago]
основной смысл - jpa not supported - окей, значит пропускаем этот тест

sky [13 hours ago]
Можно и так трактовать в принципе.


e.pekhterev [13 hours ago]
так и нужно)


sky [Yesterday at 10:08 AM]
в 7_08 патче про JUnit5 добавляется message "JPA not supported" в assume. Вот так: Assumptions.assumeTrue(isJpaBased(), "JPA not supported").
А разве не должно быть "JDBC not supported"? (edited)


12 replies
e.pekhterev [14 hours ago]
Validate the given assumption.
the message to be included in the TestAbortedException
if the assumption is invalid throws TestAbortedException

я тоже сначала засомневался)


sky [14 hours ago]
Вот отсюда - https://junit.org/junit5/docs/5.0.0/api/org/junit/jupiter/api/Assumptions.html: message это - the message to be included in the TestAbortedException if the assumption is invalid. Т.е. сообщение которое прикрепляется к эксепшену, если предположение НЕ верно. А мы предполагаем JPA


e.pekhterev [14 hours ago]
ещё раз, если у нас пойдут тесты для jdbc, то эссампшин будет indavalid, и тогда мы получим исключение с этим сообщением


e.pekhterev [14 hours ago]
так что всё норм


sky [14 hours ago]
Ну вот что выдает, когда запускаешь JdbcMealServiceTest -  org.opentest4j.TestAbortedException: Assumption failed: JPA not supported
При чем тут JPA в этом случае? Я бы предпочел увидеть здесь сообщение типа "this test does not support JDBC realisation"


sky [14 hours ago]
или "validation only for JPA"

e.pekhterev [14 hours ago]
ну напиши Григорию, если тебе это не нравится)))


sky [14 hours ago]
Ты по прежнему считаешь что все норм?


e.pekhterev [13 hours ago]
да, на тестах для jdbc на этом тесте мы получаем сообщение, что нет поддержки JPA, соответственно тесты валидации пропускаются, не вижу никаких проблем.
у меня был трабл вначале понять, когда это сообщение выдается.


e.pekhterev [13 hours ago]
основной смысл - jpa not supported - окей, значит пропускаем этот тест

sky [13 hours ago]
Можно и так трактовать в принципе.


e.pekhterev [13 hours ago]
так и нужно)


Avaaron [5:22 PM]
В опшионал последний пункт,  не могу въехать, что требуется.., просто все URL  для теста MealRestController  перечислить?

Merkulov [5:23 PM]
да все протестировать и записать все url запросы с методами
я так понимаю

Avaaron [5:25 PM]
что-то как-то простенько... наверняка есть подвох


Prodigy [Yesterday at 6:01 PM]
    ```@Override
    @PutMapping(value = "/{id}", consumes = MediaType.APPLICATION_JSON_VALUE)
    public void update(@RequestBody User user, @PathVariable("id") int id) {
        super.update(user, id);
    }```
Мы здесь передаем юзера и его id, вопрос зачем?..... если мы передаем юзера то точно знаем его id, зачем еще доп параметром передавать id и потом проверять на соостветствие?
Если можно кейс, где в этом есть смысл. Спасибо.


29 replies
Stanislav [6 hours ago]
Мы здесь передаем юзера и его id, вопрос зачем? - ты имеешь ввиду @RequestBody User user, @PathVariable("id") int id ?


Merkulov [6 hours ago]
а если ты изменил id ?


Stanislav [6 hours ago]
Если да, то с чего ты взял что в User есть id?


Merkulov [6 hours ago]
имею ввиду у пользователя

Stanislav [6 hours ago]
Скопируй json который ты передаешь по урлу "/{id}"

Stanislav [6 hours ago]
У меня нет в user id, он и не нужен там, он в path-е


Prodigy [6 hours ago]
ну если мы передаем юзера в метод update значит id юзера уже есть.... тем более что он проверяется в методе update на соответствие


Prodigy [6 hours ago]
```public static void assureIdConsistent(AbstractBaseEntity entity, int id) {
//      http://stackoverflow.com/a/32728226/548473
        if (entity.isNew()) {
            entity.setId(id);
        } else if (entity.getId() != id) {
            throw new IllegalArgumentException(entity + " must be with id=" + id);
        }
    }```


Prodigy [6 hours ago]
вот тут проверка происходит


Stanislav [6 hours ago]
И? Я не понимаю вопроса :slightly_smiling_face: В плане того, что все нормально, нет дублирования

Stanislav [6 hours ago]
В рест летит json без id, на конроллере он User (без id), id берется из path-а (@PathVariable("id") int id), передается в апдейт, там сетится

Prodigy [6 hours ago]
т.е. Я, как админ, дергаю метод update по ресту, где передаю зачем-то id пользователя и самого пользователя с уже существующим id..... зачем мне туда и юзера передавать и его id?) (edited)


Stanislav [6 hours ago]
```где передаю зачем-то id пользователя и самого пользователя с уже существующим id```
покажи место где ты передаешь самого пользователя с уже существующим id


Prodigy [6 hours ago]
я делаю вывод из вот этого метода
```public static void assureIdConsistent(AbstractBaseEntity entity, int id)```
в котором проверяются id-шники


Merkulov [6 hours ago]
я думаю это делается ради безопасности, чтобы нельзя было подменить данные, возможно

Prodigy [6 hours ago]
если по твоей теории id не будет, то в результате проверки кинется эксепшен

Stanislav [6 hours ago]
Убери проверку-сеттер id assureIdConsistent и передай json для апдейта с id другого польщователя

Stanislav [6 hours ago]
         ```if (entity.isNew()) {
            entity.setId(id);
        } else if (entity.getId() != id) {
            throw new IllegalArgumentException(entity + " must be with id=" + id);
        }```
 
В контроллере будет user с id (с json-а) если не будет этой проверке
 ```else if (entity.getId() != id)``` 
что будет


Stanislav [6 hours ago]
Там же и ссылка есть http://stackoverflow.com/a/32728226/548473
Stack Overflow
REST - put IDs in body or not?
Let's say I want to have a RESTful resource for people, where the client is able to assign ID. A person looks like this: {"id": <UUID>, "name": "Jimmy"} Now, how should the client save (or ...
 


Stanislav [6 hours ago]
Без этой проверки я могу как пользователь апдейтить любого пользователя просто передав в json для апдейта id пользователя кого хочу заапдейтить

Prodigy [6 hours ago]
но я как админ вроде как могу любого пользователя апдейтить


Avaaron [6 hours ago]
что бы обновить что-то, надо что бы это что-то было


Stanislav [6 hours ago]
1. Как админ да, но админ человек и может допускать ошибки (передавать в json id не того) 2. Как пользователь ты можешь изменять свой профиль (апдейтить), но тебе ни чего не мешает в json передать id другого пользователя, хотя мешает, "наша" проверка.

Prodigy [6 hours ago]
а вот в `ProfileRestController` эта проверка действительно имеет смысл

Stanislav [6 hours ago]
Помимо безопасности, не маловажную роль играет "проверка на дурака"


Stanislav [6 hours ago]
Или копипаст, может он пакетно будет обновлять пользователей и не правильно сформирует скрипт с json-ом

Stanislav [6 hours ago]
это рест, а не вид

Prodigy [6 hours ago]
ну если смотреть с точки зрения безопасности, то я как юзер могу подменить id как в самом json-е так и id передать любой

Prodigy [6 hours ago]
не, наверное не смогу, там проверка на id авторизованного юзера


hav [Yesterday at 9:02 PM]
Объясните пожалуйста смысл этой проверки:
```.andExpect(model().attribute("users", hasItem(
                        allOf(
                                hasProperty("id", is(START_SEQ)),
                                hasProperty("name", is(USER.getName()))
                        )```


15 replies
Stanislav [3 hours ago]
Берет из модели атрибут, проверяет есть ли хоть один элемент со свойством-и.


Stanislav [3 hours ago]
allOf возвращает матчер, по которому будет проверять (имя свойства -> сравнение)


hav [3 hours ago]
Если я правильно понял, то проверяется что в коллекции users есть элемент с определенными полями. То есть проверяется только один элемент?


Stanislav [3 hours ago]
Проверяется есть ли хоть один элемент


Stanislav [3 hours ago]
есть разные hasItem, есть например hasItems


hav [3 hours ago]
Тест пройдет если есть один элемент, у которого `id=START_SEQ` и `name=USER.getName()`, а остальные элементы (ADMIN) не проверяются?


hav [3 hours ago]
В meals также можно проверить один элемент?


Stanislav [3 hours ago]
да, ты же можешь сам проверить, на примере meals, там как раз задание есть, попробуй тупо скопировать весь код для user и заменить на meals и поиграться

Stanislav [3 hours ago]
и лучше не верить, а самому поиграться :wink:


hav [3 hours ago]
Понял, спасибо. Я уже хотел проверять так все элементы из meals...


Stanislav [3 hours ago]
Ну в MealRestControllerTest не получится, там только в одном месте, где есть model


Stanislav [3 hours ago]
Только в RootControllerTest  testMeals()

hav [3 hours ago]
Я пока RootControllerTest делаю


Stanislav [2 hours ago]
http://www.vogella.com/tutorials/Hamcrest/article.html

e.pekhterev [18 minutes ago]
смотри 8-ой пункт подсказок - нужно сравнить всю еду пользователя если чего, не одну какую то, ну и нужно подумать какая это вообще должна быть еда (см. сам контроллер чего отдает):
*8: Попробуйте в RootControllerTest.testMeals сделать сравнение через model().attribute("meals", expectedValue). Учтите, что вывод результатов через toString к сравнению отношения не имеет*


Jury Mironov [Aug 20th at 10:37 AM]
У меня уже при первом патче HW6 конфликты


8 replies
Jury Mironov [5 days ago]
ActiveProfiles(DATAJPA)
   public class DataJpaUserServiceTest extends AbstractJpaUserServiceTest {
       @Test
       public void testGetWithMeals() throws Exception {
           User user = service.getWithMeals(USER_ID);


Stanislav [5 days ago]
А где у тебя патч 6_06_HW5_optional_fetch_join.patch, в твоем репозитории его нету


Jury Mironov [5 days ago]
Да, в коммитах не вижу его, пропустил, видать... Как в таком случае лучше сделать? Revert на 6_05 и оттуда снова патчить?


Stanislav [5 days ago]
если не мучится, то наверно так лучше будет..иначе надо смотреть что в нем исправлено, что в других исправлено, не затрет ли 6_05 изменения которые внесли патчи > 6_05...


Jury Mironov [5 days ago]
спасибо


Jury Mironov [5 days ago]
Блин,  сбросил ветку, применил патчи,  а запушить нак и не смог.  Меня бесит гит.  Я не понимаю че ему мешает заменить все,  что было,  на то что есть сейчас. Pull с Rebese не прокатывал.  Удалил и запушил в новый репозиторий,  только вилка пропала


Stanislav [5 days ago]
https://www.ibm.com/developerworks/ru/library/l-git_3/index.html
ibm.com
Часть 3. Философия Git
Продолжая разговор о философии Git, её архитектуре и идеологии, мы рассмотрим ряд важных команд и закрепим изученный материал на конкретных примерах.
 


Stanislav [5 days ago]
```Система управления версиями Git отталкивается в своем поведении от двух постулатов:

"Ни один момент истории отменить нельзя, однако в будущем можно сделать такое изменение, которое исправит необходимые данные"........```


Mihail Kedel [Aug 20th at 1:43 PM]
"Реализовать MealRestController и протестировать его через MealRestControllerTest". У меня одного в проекте нет класса MealRestControllerTest,или его надо самому создать?


2 replies
Victor_D [5 days ago]
да


e.pekhterev [5 days ago]
ctrl+shift+T


turhanow [Aug 20th at 3:26 PM]
всем привет, не могу разобраться с тестированием ресурсов. Допустим я передаю в perform через get "/meals", у меня по идее должны были подгрузиться css стили. не могу догнать как проверить это в andExpect... и в интеренете не могу найти пример тестирования css((


10 replies
Stanislav [5 days ago]
Тебе нужно проверить доступность ресурса (в данном случае доступность css /resources/css/style.css). Статус ок и тип контента txt/css


Stanislav [5 days ago]
Можешь еще распечатать его (do print)


turhanow [5 days ago]
статус проверил и распечатал, а вот с доступностью проблемы((


turhanow [5 days ago]
вот сейчас здесь нашел пример https://stackoverflow.com/questions/32276750/how-to-unit-test-static-resources-served-by-spring-resourcehandlerregistry
и я так же делал, но не делал форвард, а делал content().contentType
Stack Overflow
How to Unit Test static resources served by Spring ResourceHandlerRegistry
I'm trying to unit test a new Spring MVC project. I have a passing test for the home controller serving index.jsp. I'm trying to test serving static resources served by the ResourceHandlerRegistry ...
 


Stanislav [5 days ago]
Скопируй ссылку из perform(get(

turhanow [5 days ago]
кажется разобрался,
get("/resources/css/style.css")
а потом
content().contentType("text/css")

вот только сомнения насчет правильности решения..что скажешь?)


Stanislav [5 days ago]
Практически, только контенттайп MediaType.valueOf("text/css")



turhanow [5 days ago]
спасибо дружище)) 2 часа сидел из за двух строчек))


alexey [5 days ago]
и это не предел(  я вот уже пол дня сижу с curl командами. post хоть убей не проходит( хотя на тестах все норм


Stanislav [5 days ago]
Скорее всего не правильно body json-ом заполняешь


This message was deleted.


1 reply
Nikolay [5 days ago]
скопируй все параметры из тестов


Ivan Potapov [Aug 20th at 5:13 PM]
Подскажите пожалуйста как отправить и получить LocalDateTime в теле http запроса, никак не могу разобраться. Если отправлять параметр по url проблем не возникает.


6 replies
Grigory Kislin [5 days ago]
с post тоже нее должно тогда быть
а delete и put сервлеты не поддерживают (edited)


Ivan Potapov [5 days ago]
@Grigory Kislin на данный момент есть такая реализация getBetween в rest контроллере. Но, допустим, я не хочу передавать параметры дат по url. Учитывая, что RequestBody в параметрах метода может быть только 1, правильно ли я понимаю, что для того, чтобы это реализовать нужно создать класс, который будет содержать в себе эти даты и время, чтобы можно было получить его как объект и передать нужные поля дальше в метод родителя или есть какая-нибудь другая реализация?
Screenshot_1.png



Stanislav [5 days ago]
Это делается через конвертер (твоя реализация, которая реализует интерфейс спринга), в xml спец. образом настраивается конвертер, создается бин в котором прописываешь свою реализацию конвертера. И тогда спринг автоматом конвертирует твои даты и время которые передаются парметрами. -> смотри ссылки, в задании их 2-3 шт.



Stanislav [5 days ago]
Или гугл по ключевым словам "спринг, конвертер локалдат, конвертер локалдат параметры в запросе и т.д."


Grigory Kislin [5 days ago]
@Ivan Potapov поставь просто вместо @GetMapping -> @PostMapping
и в форме поставь method=post. параметры будут передаваться в теле
RequestBody - это для json


Ivan Potapov [4 days ago]
@Grigory Kislin спасибо, в итоге оказалось, что я просто неправильно пользовался Postman


Gulnaz [Aug 20th at 6:49 PM]
Привет, подскажите, почему не проходит
`.andExpect(model().attribute("meals", MealsUtil.getWithExceeded(MEALS, USER.getCaloriesPerDay())));`
в RootControllerTest.testMeals()?
testMeals.JPG



2 replies
sky [5 days ago]
https://topjava14.slack.com/archives/CCALMAKRC/p1534666950000100
Daniel
Я прошу прощения, у меня у одного в RootController testUsers() в методе perform отваливается по NullPointerException? Что-то я туплю...
Thread in #hw7Aug 19th at 11:22 AM
 


Gulnaz [5 days ago]
Спасибо


hav [Aug 21st at 10:11 AM]
Не могу разобраться со своими конвертерами. Как их правильно зарегистрировать? Я делаю так:
```<bean id="conversionService" class="org.springframework.context.support.ConversionServiceFactoryBean">
        <property name="converters">
            <set>
                <bean class="ru.javawebinar.topjava.util.converter.StringToLocalDateConverter"/>
                <bean class="ru.javawebinar.topjava.util.converter.StringToLocalTimeConverter"/>
            </set>
        </property>
    </bean>```
Но тест не проходит, конверторы не подцепляются. Что я делаю не так?


12 replies
sky [4 days ago]
Я еще вот это сделал <mvc:annotation-driven conversion-service="conversionService">, А еще использовал FormattingConversionServiceFactoryBean вместо твоего. Как понял форматтеры больше подходят в нашем случае (edited)


hav [4 days ago]
Спасибо, заработало, этой строчки и не хватало. Откуда инфо, есть ссылка?

e.pekhterev [4 days ago]
я бы ещё вот это поменял:
<bean id="conversionService"
           class="org.springframework.format.support.*FormattingConversionServiceFactoryBean* ">


sky [4 days ago]
с гугла/гитхаба вроде пример. Сейчас уже потерялся


e.pekhterev [4 days ago]
вот тут пример конфигурирования конвертеров и форматтеров для спринг в документации:
https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion



e.pekhterev [4 days ago]
в принципе копипаста работает)))


hav [4 days ago]
Надо внимательнее читать документацию...

e.pekhterev [4 days ago]
ну ссылку давали в задании по форматтерам как их делать, и там ниже в разделе конфигурирования дана ссылку и на конфигурирование в спринг, конечно же лучше читать - и ссылки все есть в уроке, и по этим ссылкам всё доступно показано и рассказано, всё делается без проблем


e.pekhterev [4 days ago]
Я кстати делал именно форматтеры, а не конвертеры


Ma3stro [4 days ago]
Можно же просто @DateTimeFormat(iso = TIME / DATE)


e.pekhterev [4 days ago]
если разговор про основную часть задания, то там применяется @DateTimeFormat


e.pekhterev [4 days ago]
а вот в опшинал всё должно работать автоматом без @DateTimeFormat


This message was deleted.


2 replies
sky [4 days ago]
чуть выше ветку эту глянь
и подсказка № 8 (edited)


matrocob [4 days ago]
спасибо!)


Join_Selectovich [Aug 21st at 2:06 PM]
Поясните пожалуйста по видео 7_5_rest_controller.mp4. Почему в UserControrller использовалась Model, а в AdminUserRestController модели уже нет?


17 replies
e.pekhterev [4 days ago]
насколько я понимаю в ресте модели и не может быть, мы не работаем с мордой напрямую


e.pekhterev [4 days ago]
насколько я понимаю в ресте модели и не может быть, мы не работаем с мордой напрямую (в смысле с jsp через SpringMVC)


Join_Selectovich [4 days ago]
Но "морда" это же View, а данные это Model, и вроде бы с чем бы мы не работали модель всегда должна же быть ?!


e.pekhterev [4 days ago]
именно в том виде как для Spring MVC - это нам не нужно, мы сразу данные, полученные с сервиса перегоняем/сериализуем в JSON и отдаём в запрос, да и получаем аналогичным образом (edited)


Join_Selectovich [4 days ago]
млин, так а что данные полученные от сервиса это не модель? я что-то плыву в этих MVC абстракциях.. (( (edited)

e.pekhterev [4 days ago]
тут другое mvc)))


Join_Selectovich [4 days ago]
мля, так они еще и разные бывают .... матка боска!


e.pekhterev [4 days ago]
ну как бы да, наверно ты прав, тоже модель, только другая)))


e.pekhterev [4 days ago]
в ресте мы гоняем туда-сюда трансфер объжект, сериализованный в JSON и дессериализованный из JSON,

e.pekhterev [4 days ago]
а в спринMVC мы закидываем наш трасфер обжект в объект Model через её атрибуты, и уже эту модель отправляем на морду/вьюху с контроллера.
я так понимаю) (edited)



e.pekhterev [4 days ago]
про Model:
Java-5-specific interface that defines a holder for model attributes. Primarily designed for adding attributes to the model. Allows for accessing the overall model as a java.util.Map


e.pekhterev [4 days ago]
в ресте у нас собственно вместо этого юзается JSON, который тоже по сути карта - набор ключей/значений

e.pekhterev [4 days ago]
ну либо XML, в зависимости от реализации

Join_Selectovich [4 days ago]
@e.pekhterev благодарю за пояснения

e.pekhterev [4 days ago]
да, кстати в нашем проекте мы для сохранения/обновления с jsp принимаем данные из формы через параметры рексвеста. На самом деле не самое хорошее решение (на мой взгляд).
В тестовом задании сюда на topJava я использовал спринговую форму в jsp и в контроллере принимал уже готовый можно сказать трансфер обжект через аннотацию  @ModelAttribute (напрямую с формы).
Вот тут можно посмотреть (метод, замапленный на урл "/books/saveOrUpdate")
https://github.com/rootrock13/JavaRushTestTaskApplications/blob/master/src/main/java/com/rootrock13/testtask/controller/BookController.java
src/main/java/com/rootrock13/testtask/controller/BookController.java
```
package com.rootrock13.testtask.controller;


import com.rootrock13.testtask.model.Book; Show more…
rootrock13/JavaRushTestTaskApplicationsAdded by GitHub
(edited)


e.pekhterev [4 days ago]
а вот как форма выглядит (только там ещё бутстрап вставлен)
https://github.com/rootrock13/JavaRushTestTaskApplications/blob/master/src/main/webapp/WEB-INF/pages/books/books_list.jsp
src/main/webapp/WEB-INF/pages/books/books_list.jsp
```
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %> Show more…
rootrock13/JavaRushTestTaskApplicationsAdded by GitHub


e.pekhterev [4 days ago]
я поэтому сначала написал, что в спрингMVC мы гоняем туда сюда модель между мордой и контроллером


tim [Aug 21st at 2:55 PM]
Привет! Подскажите пожалуйста, в MealRestController должна передаваться информация о пользователе или она должна вычисляться на основе авторизации в случае с томкатом? по типу  public void delete(@PathVariable("id") int id, @PathVariable("userId") int userId)


12 replies
e.pekhterev [4 days ago]
из авторизации, при этом не нужен тебе никакой  @PathVariable("userId") int userId



Stanislav [4 days ago]
Не должна. В настоящий момент у нас "заглушка" по авторизации (пользователь по умолчанию + по выбору), скоро прикрутим Spring Security (там уже будет как и должно быть).


Stanislav [4 days ago]
+ (не в обиду) если такой вопрос возникает, то нет понимания rest и что такое авторизация, стоит почитать.


e.pekhterev [4 days ago]
@Stanislav про +(не в обиду) добавлю, что как бы мы ж не первый день проектом занимаемся и к этому моменту можно уже было и запомнить про заглушку авторизации


Also sent to the channel
tim [4 days ago]
Про заглушку я знаю.... У ментя нет понимания как этот рестконтроллер функционально будут использоваться...

e.pekhterev [4 days ago]
да всё тоже самое как и в предыдущих версиях


e.pekhterev [4 days ago]
просто работает с реквестами http вместо свой собственной морды в проекте


e.pekhterev [4 days ago]
ну и плюс нюансы реста (его основные принцыпы за стейтлес и прочее)

tim [4 days ago]
Как делать рестконтроллер я примерно понял, но для каких целей он будет использоваться непонятно.. Ну вот примеру у меня есть андроид приложение я могу использовать его как простого клиента и  общаться по РЕСТ, а могу сделать второй сервер и переложить часть функционала на него

Stanislav [4 days ago]
Я так понимаю html+css+js ты не знаешь (хотя бы на базовом уровне), по этому у тебя нет понимания. В 8 уроке (следующий) как раз увидишь каа будет использоваться rest с Ajax-ом. А вообще, что тут понимать, это сервис, который по урлу позволяет тебе что то сделать (круд).


Stanislav [4 days ago]
Как ты будешь использовать? Да как угодно, в меру своих фантазий. У тебя есть инструмент, который позволяет делать то и то. Я даже не могу сформулировать, для меня это звучит так "есть молоток, я примерно понял как его делать, но для каких целей он будет использоваться непонятно". Ну молотком можно закалачивать гвозди, а можно череп разбить, а можно отбивную сделать и еще 1000+1 применение.


Stanislav [4 days ago]
П.с. и да, ты можешь
```Ну вот примеру у меня есть андроид приложение я могу использовать его как простого клиента и  общаться по РЕСТ, а могу сделать второй сервер и переложить часть функционала на него```


tim [3:54 PM]
replied to a thread:
Про заглушку я знаю.... У ментя нет понимания как этот рестконтроллер функционально будут использоваться...


alexey [Aug 21st at 4:27 PM]
Всем привет.Решил я тут по ресту вытянуть пользователя с его едой, хоть по заданию этого и не требовалось (исключительно ради интереса)! И получил в итоге "StackOverflowError". Бесконечный цикл вложенных в друг друга пользователей и еды( Кто нибудь знает как это побороть?


14 replies
Nikolay [4 days ago]
Мне кажется, это было в лекциях.



alexey [4 days ago]
@JsonIgnore работает при сериализации. Я думал может есть что нибудь поизящнее, на уровне класса!?


Nikolay [4 days ago]
Можно DTO использовать


alexey [4 days ago]
Просто не понятно почему такой цикл получается если юзер LAZY и еда LAZY


Prodigy [4 days ago]
в уроке была тема что когда стоит Transactional над тестом то он зацикливается пытаясь друг у друга брать еду и юзера


alexey [4 days ago]
Так это не в тестах, а в самом приложении


Prodigy [4 days ago]
значит у тебя сериализация происходит в транзакции.... нужно исключать эти поля


alexey [4 days ago]
После  обращения в базу у нас уже такой цикл в экземпляре юзера который возвращается  при вызове " DataJpaUserRepositoryImpl.getWithMeals(int id)" . Посмотри в дебаге

Prodigy [4 days ago]
я еще не все патчи даже накатил, так что посмотреть наверное не смогу

Prodigy [4 days ago]
посмотри еще раз видео где эта проблема описывалась

shtramak [4 days ago]
А чем jsonIgnoreProperties не угодили?


alexey [4 days ago]
тем что работают при сериализации, а интересно как избавиться от этого на уровне ниже (т.е. еще до сериализации)


alexey [3 days ago]
Получилось избавиться от бесконечного вложения)


alexey [3 days ago]
Вытягиваем юзера, а потом отдельно еду


Jury Mironov [Aug 21st at 6:22 PM]
Exception in thread "main" java.lang.NoClassDefFoundError: junit/textui/ResultPrinter
    at java.lang.Class.forName0(Native Method)
    at java.lang.Class.forName(Class.java:264)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:123)
Caused by: java.lang.ClassNotFoundException: junit.textui.ResultPrinter
    at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
    ... 3 more

Process finished with exit code 1


2 replies
Jury Mironov [4 days ago]
При запуске теста


Jury Mironov [3 days ago]
У меня версия идеи 2016 года,на новой все норм


Jury Mironov [Aug 22nd at 10:39 AM]
А как у нас админ попадает в контроллер админа, а обычный юзер в обычный контроллер?


2 replies
e.pekhterev [3 days ago]
пока видимо доступ для всех, а потом, как добавится нормальная авторизация, то и будет разный доступ к контроллерам (предположение) (edited)



zippospb [3 days ago]
Так у тебя же url-ы у profileRestController и adminRestController разные


Prodigy [Aug 22nd at 3:01 PM]
для чего мы генерим эти две строки?

        ```URI uriOfNewResource = ServletUriComponentsBuilder.fromCurrentContextPath()
                .path(REST_URL + "/{id}")
                .buildAndExpand(created.getId()).toUri();

        return ResponseEntity.created(uriOfNewResource).body(created);```



13 replies
e.pekhterev [3 days ago]
при сохранении мы возвращаем сохраненный объект обратно, а эти строчки как раз и формируют наш возвращаемый объект (edited)

Prodigy [3 days ago]
почему просто не вернуть `User user` ?

Prodigy [3 days ago]
как это мы делаем в методе `get`

e.pekhterev [3 days ago]
мы возвращаем ResponseEntity


e.pekhterev [3 days ago]
мы работаем с http

e.pekhterev [3 days ago]
как http поймём твоего User-a? (edited)

Prodigy [3 days ago]
ну погоди... мы е в методе get возвращаем юзера
```@Override
    @GetMapping(value = "/{id}", produces = MediaType.APPLICATION_JSON_VALUE)
    public User get(@PathVariable("id") int id) {
        return super.get(id);
    }```


Prodigy [3 days ago]
здесь значит понимает

Stanislav [3 days ago]
Тут формируется заголовок http (что является не обязательной, но хорошей практикой). Как уроки-видео смотрите?



e.pekhterev [3 days ago]
точняк, заголовок


Prodigy [3 days ago]
конечно смотрим, только не всегда всё понятно там


alexey [3 days ago]
так это просто для того что бы красиво в headers инфа отображалась?


Prodigy [3 days ago]
это тайна покрытая мраком))


Prodigy [Aug 22nd at 6:40 PM]
я правильно понял задание, что в `getBetween` мы передаем 2 параметра `LocalDateTime` ? (не optional) (edited)


1 reply
Grigory Kislin [3 days ago]
да. и в Optional рефакторим


Crazz [1:46 PM]
А вот скажите, это-
     ```@PostMapping(value = "/filter", consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public List<MealWithExceed> getBetween(@RequestBody BetweenDates betweenDates) {
        LocalDate startDate = betweenDates.startDateTime.toLocalDate();
        LocalDate endDate = betweenDates.stopDateTime.toLocalDate();
        LocalTime startTime = betweenDates.startDateTime.toLocalTime();
        LocalTime endTime = betweenDates.stopDateTime.toLocalTime();
        return super.getBetween(startDate, startTime, endDate, endTime);
    }

    private static class BetweenDates {
        private LocalDateTime stopDateTime, startDateTime;

        public BetweenDates() {
        }

        public BetweenDates(LocalDateTime stopDateTime, LocalDateTime startDateTime) {
            this.stopDateTime = stopDateTime;
            this.startDateTime = startDateTime;
        }
    }```
очень плохой велосипед и так делать не надо? (edited)

Ma3stro [2:19 PM]
ооой, а как тебе просто LocalDateTime передавать без объекта?


Ma3stro [Yesterday at 2:19 PM]
И в качестве параметра запроса через "?"


4 replies
Crazz [23 hours ago]
а если я хочу через Post


Crazz [23 hours ago]
где то я читал в типа Best Practices что мол get обычно кешируется и по идее должен всегда отдавать однозначный ответ, а у нас ответы зависят от БД


Ma3stro [23 hours ago]
Если post, попробуй поиграться с передаваемыми параметрами, объект излишен


Crazz [19 hours ago]
Ну да, можно в requestBody ловить мапу


Grigory Kislin [5 days ago]
1. почему мапу?? делай нормальный пост и бери из тела боди параметры, как из get. тогда тебе не надо будет мудрить с формой и прикручивать к ней js


Grigory Kislin [5 days ago]
2. кэшируются только запросы, у которых стоит header кэширование. обычно на статический контент ставят


Grigory Kislin [5 days ago]
собственно проверяется лекго- вкладка Network в браузере


fbochkarev [Yesterday at 5:26 PM]
Ребят подскажите пожалуйста, пытаюсь создать еду через soupui пишет "HTTP Status 400  Bad Request", остальное (удаление, вывод, редактирование) делается нормально, не могу понять, почему не видит post запрос.


9 replies
Stanislav [20 hours ago]
скопируй сюда запрос 'url'


fbochkarev [20 hours ago]
Pasted image at 2018-08-30, 4:42 PM



sky [20 hours ago]
с английским  текстом прокатывает?


fbochkarev [20 hours ago]
В закладке JSON просто: "The content you are trying to view cannot be viewed as JSON"


Stanislav [20 hours ago]
Попробуй во времени поставить еще :00  
 ```2018-08-19T17:17:00```


fbochkarev [20 hours ago]
Хм, с английским прокатило.


sky [20 hours ago]
тогда encoding надо выставить utf8. Request properties в окне снизу слева (edited)


fbochkarev [20 hours ago]
это в soupui?


sky [20 hours ago]
Pasted image at 2018-08-30, 5:52 PM