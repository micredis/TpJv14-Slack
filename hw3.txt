Tanya [1:37 AM]
joined #hw3.

Tanya [1:37 AM]
set the channel purpose: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md

Tanya [1:37 AM]
set the channel topic: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md

Daniel [1:39 AM]
joined #hw3 along with 18 others.


Merkulov [Jul 12th at 12:56 PM]
in #hw3
Error:(5, 24) java: package org.slf4j.bridge does not exist, такую ошибку выкидывает, кому встречалась?


3 replies
Merkulov [1 day ago]
я так понимаю нужно добавить зависимость в pom


Merkulov [1 day ago]
хотя в поме есть такие зависимости


Merkulov [1 day ago]
все решил проблему, больше не актуально


Alexey_P [1:08 PM]
joined #hw3 by invitation from Join_Selectovich.

Artem [3:45 PM]
А письмо всем пришло? У меня так и нету.
Я понимаю, что ссылка уже дана... Но а как же напутствующие слова? :slightly_smiling_face:

Janna [3:45 PM]
мне тоже не приходят письма :disappointed:

Artem [3:49 PM]
предыдущие должны быть!
Посмотри в спаме.
Только вот нового не было.

Janna [3:50 PM]
да!! нашла
и 3-го нет
так тихо
наверно все все написали и сдали уже :)))

Artem [3:52 PM]
на работах сидят!) Как и я :sob:

Yevhen Maksymovych [4:02 PM]
давай я с прошлого сезона перешлю, если дело только за этим :slightly_smiling_face:

e.pekhterev [4:10 PM]
Григорий похоже занят, судя по тому, что Таня постила ссылку на новое занятие! Как освободиться, сразу же пришлет все пропущенные письма на занятия с 3-го по ...)))


Gagarina6794 [Jul 12th at 4:58 PM]
in #hw3
Я и второе не получила))


2 replies
e.pekhterev [1 day ago]
до меня нормально всё доходит, 3-ье пока ещё не отправляли. До junit пока не доехал


Gagarina6794 [1 day ago]
Доедешь - скажешь))


Gagarina6794 [Jul 12th at 5:00 PM]
in #hw3
кто понял что значит фраза в разделе  JUNIT - save() не больше работает для отсутствующих id?


4 replies
e.pekhterev [1 day ago]
вапще не понятно, что там имелось ввиду.
если id == null, создается новый id, присваивается юзеру, далее юзер сохраняется;
в противном случае - если юзер есть в репозитории - обновялем


e.pekhterev [1 day ago]
больше интересует как инит запускается или это стандартный вызов метода сприногом для бина @Repository после создания спринг-контекста


Gagarina6794 [1 day ago]
Там дальше вопрос есть интересный - Вопрос: почему проект упадет при попытке открыть страничку еды (в логе смотреть самый верх самого нижнего исключения)?


Gagarina6794 [1 day ago]
Думаю здесь есть связь


Gagarina6794 [5:02 PM]
типа из-за init наш save() не работает для id с null?


e.pekhterev [Jul 12th at 5:28 PM]
in #hw3
Приехало письмо с 3-им занятием, кому там не хватало)? проверяте почту



1 reply
Gagarina6794 [1 day ago]
получила!))


e.pekhterev [Jul 12th at 5:56 PM]
in #hw3
у всех после патча 3_07_add_junit.patch InMemoryAdminRestControllerTest лег в пакет ru.javawebinar.topjava.web, но не в тесты?


6 replies
hav [1 day ago]
ВНИМАНИЕ!! Перед накаткой патча создайте каталог test (из корня проекта путь \src\test), иначе часть файлов попадет в src\main.


e.pekhterev [1 day ago]
))))) спасибо, трудно быть деревянным по пояс))


e.pekhterev [1 day ago]
фух)) всё починилось)


e.pekhterev [1 day ago]
а в патче нельзя реализовать добавление директорий (я про тот же test), ну и удаление пакета (перенесены моки в тесты, а пакет mock остался и по идее больше не нужен будет)


e.pekhterev [1 day ago]
нашел


glebus [14 hours ago]
А я сижу и репу чешу, какого этот класс находится в main, спасибо


e.pekhterev [Jul 12th at 7:31 PM]
in #hw3
какую версию PostgreSQL ставить?


5 replies
Stanislav [1 day ago]
Посмотри в помник в патче


Stanislav [1 day ago]
9


e.pekhterev [1 day ago]
патч ещё не накатывал))) спасибо)


e.pekhterev [1 day ago]
эммм))
<postgresql.version>42.2.2</postgresql.version>


Victor [11 hours ago]
ВНИМАНИЕ! с postgres 9.6 возможны проблемы. (скачал, а потом прочитал)


Yevhen Maksymovych [Jul 12th at 8:19 PM]
in #hw3
котаны, такое дело, тут у Григория ссылка на стэковерфлоу про вопрос о необходимости оптимизации анонимных классов, и там в ответе интересную телегу задвинули: jvm размещает объекты, которые не покидают треда, в котором их создали, в стеке, а не в хипе


6 replies
Vitaly [6 hours ago]
обращал внимание - мне кажется какая-то подмена понятий произошла в этом диалоге, нет нигде в спецификации JVM про то, что объект может размещаться в стеке


Yevhen Maksymovych [6 hours ago]
ну вот это-то и зацепило (edited)


Yevhen Maksymovych [6 hours ago]
везде пишут про четкое разделение стека, хипа и меты. а тут как-то так уверенно пишут про объекты в стеке, что начинают охватывать сомнения, может это я всё время неправильно думал, а все кругом уже давно объекты хранят в стеке


Vitaly [6 hours ago]
и тут приступ панической атаки :grin:


Vitaly [6 hours ago]
я последнее время люблю эту картинку


Vitaly [6 hours ago]
https://habrastorage.org/webt/no/h_/y8/noh_y8nma7lfqpotxy_ipc2amgc.png (266 kB)


e.pekhterev [Jul 12th at 8:30 PM]
in #hw3
к хероку кто-нибудь пробовал подключиться как показанов в видео 3_07_Set_db_in_IDEA.mp4, или там не актуальный логин? (edited)


1 reply
e.pekhterev [1 day ago]
фух, подключился (все данные скопипастил из postres.properties)


Victor [12:33 AM]
@Grigory Kislin В видео заметил, что поменялась реализация выбрасывания ошибок. Интересно было бы узнать в кратце почему?  
           вместо такой реализации:
           в классе:
           LoggerWrapper LOG = LoggerWrapper.get(ExceptionUtil.class);
           в методе:
           throw LOG.getNotFoundException(msg);
           теперь простая:
           throw new NotFoundException("Not found entity with " + msg); (edited)


Kirilo [Yesterday at 3:25 PM]
in #hw3
Смотрел видео по разбору домашнего задания и возник вопрос. Моки используются для тестирования. Разве принято использовать его без аннотации @Test? И в чем отличие между моком и фейком? Спасибо. (edited)


4 replies
e.pekhterev [8 hours ago]
мы тестируем вроде как контроллер и сервис, там все тестируемые методы помечены @Test, но для тестирования требуюется реализация интерерфейса репозитория, т.е. наши реализации как заглушки реальной базы и они только в тестах


Stanislav [8 hours ago]
Не понравилась вся эта идея. Моки и заглушки совсем иное понятие, чем показывают тут. Это не моки и не заглушки, а конкретные реализации на конкретных структурах данных.


Stanislav [8 hours ago]
Да и тестирование это интеграционное, а не юнит тесты. Сервисы с контролерами с моками тестируют (Мокита или Спринг может создавать моки и заглушки). Постоянно обновляем (чистим) базу, а если база уже в "работе"? Где профили, где база именно для тестов (и как правило h2)...Мне не очень понятны эти уроки, как делать не надо?


Kirilo [7 hours ago]
я тоже думаю, что с моками именно здесь тема не расскрыта и скорее вводит в заблуждение.


Victor [Yesterday at 4:57 PM]
in #hw3
К удаленной базе на Herocu коннектились?


3 replies
Yevhen Maksymovych [7 hours ago]
а она ещё живая разве?


e.pekhterev [7 hours ago]
жива, я установил коннект успешно, но не дергал там ничего


e.pekhterev [7 hours ago]
хотя нет, так всё есть - и еда,  и юзеры, и их роли


alexey [Yesterday at 9:11 PM]
in #hw3
Народ, вот сделал для тестов отельный spring-test.xml, в нем скан моковского пакета и два скана  как в spring-app.xml(web , service). Так вот вопрос - как можно оптимизировать  тестовский .xml что бы не повторять сканы из основного .xml ??


6 replies
e.pekhterev [3 hours ago]
что ж ты людям идею подсказываешь, лишил их возможности самим почерепить. я тут долго втыкал как моки заставить опять работать. 
Если основной разбить на сканы web+service и отдельно репозиторий, то в тестах можно заменить только второй контекст. (edited)


alexey [3 hours ago]
То есть в основном пакете добавить еще один .xml  и туда репозиторий, а от первого сделать import в тестовский или как?


e.pekhterev [3 hours ago]
я так не пробовал, но думаю так должно работать.


alexey [3 hours ago]
минус в том, что в servlet придется объявлять eще один контекст. так что оптимизация сомнительная!( еще идеи есть?


e.pekhterev [2 hours ago]
у меня нет)


e.pekhterev [2 hours ago]
ну как бы и нет. в сервлете у нас объявляется только один контекст (нам там 2 спринг-контекста нафиг не нужны), он собирается уже сейчас из 2-х файлов, так что никакой проблемы не вижу, если он будет собираться из 3-х файлов. зато в тестах можно подменять без проблем (edited)


e.pekhterev [10:00 PM]
Вах-вах, и моки поднял, и JdbcMealRepositoryImpl реализовал, ни черта не понял, но счастью нет предела))) буду разбираться подробнее сразу как дз сдам))) (edited)


Gagarina6794 [Yesterday at 10:03 PM]
in #hw3
Народ, у меня мавен не подтягивает зависимости, патчи нормально прошли,  в мавене эти библиотеки есть и красным подчеркнуты, мавен обновляла, и чистила, и переподтягивала наново и никак , вот эту библиотеку jul-to-slf4j jar не подтягивает никак  
           <artifactId>slf4j-api</artifactId>
           <artifactId>jul-to-slf4j</artifactId>


15 replies
e.pekhterev [2 hours ago]
у тебя возможно что то лишнее или идея не подтянула, зайди в настройки проекта и посмотри что там есть
File -> Project Structure -> Project Settings -> Libraries


e.pekhterev [2 hours ago]
ну и не знаю пробовала или нет - clean в мавене, хотя это по идее не поможет (edited)


Gagarina6794 [2 hours ago]
делала


e.pekhterev [2 hours ago]
в библиотеки в настройках проекта посмотри, может там лишние версии

Vitaly [2 hours ago]
так а ты покажи pom.xml


Kirilo [2 hours ago]
https://screenshots.firefox.com/32jgq8cBbUGkrFO6/null
screenshots.firefox.com
image.png (Зображення PNG, 1920 х 1080 пікселів) - Масштабоване (85%)
From null (100 kB)


Gagarina6794 [2 hours ago]
jul-to-slf4j вот именно на это ругается, может в ручную загрузить библиотеку?


Gagarina6794 [2 hours ago]
этого в самой библиотеке нету


Merkulov [2 hours ago]
поставь compile  зависимости

Merkulov [2 hours ago]
<dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>jul-to-slf4j</artifactId>
           <version>${slf4j.version}</version>
           <scope>compile</scope>
       </dependency>


Kirilo [2 hours ago]
попробуй откатиться назад до того места, где все работало и заново накатить патчи

Gagarina6794 [2 hours ago]
эта зависимость для работы import org.slf4j.bridge.SLF4JBridgeHandler;


Kirilo [2 hours ago]
и используй кнопку Reimport All Maven Projects (edited)


Gagarina6794 [2 hours ago]
сбросьте кто нибудь кто накатил уже Apply 3_12_test_logging.patch как у вас pom выглядит


Merkulov [1 hour ago]
пробовала ставить compile вместо runtime ?


Gagarina6794 [10:19 PM]
uploaded this image: мавен логи.jpg 

Yevhen Maksymovych [10:24 PM]
Помогает обычно руками удалить версию из пом, реимпортнуть проект, и заново указать версию


Gagarina6794 [Yesterday at 10:25 PM]
in #hw3
реимпортнуть это как?


1 reply
e.pekhterev [23 minutes ago]
тебе уже скидывали - вот кнопочке реимпорта 
https://screenshotscdn.firefoxusercontent.com/images/967d29ba-05a1-40c9-a41f-e20ff89abcd4.png (edited)

Gagarina6794 [3 days ago]
Сто раз делала)) у меня память как оказалось в /home кончилась, мавену не было куда сохраниться, называется ставь убунту по рекомендациям с популярных страничек)))  Ubuntu умер в неравном бою с gparted)) (edited)


matrocob [Yesterday at 10:32 PM]
in #hw3
ребят, вот такой вопрос, Григорий говорит в 8 видео, что JdbcTemplate и namedParameterJdbcTemplate отличаются так:
JdbcTemplate - параметры по номерам
namedParameterJdbcTemplate - параметры по имени
я вот лично не понял, как они отличаются вообще


1 reply
Vitaly [1 hour ago]
http://qaru.site/questions/187572/namedparameterjdbctemplate-vs-jdbctemplate
qaru.site
java - NamedParameterJdbcTemplate vs JdbcTemplate - Qaru
Я новичок в Spring3.x, я изучаю поддержку DAO Spring. Я хочу знать разницу между NamedParameterJdbcTemplate и JdbcTemplate. Какой из них является лучшим с точки зрения производительности. И когда пойти на NamedParameterJdbcTemplate и когда нужно пере

matrocob [3 days ago]
Спасибо!


SergeyA [Jul 14th at 11:09 AM]
in #hw3
Смотрю решение ДЗ второго урока и не понимаю: в уроке @Grigory Kislin говорит 
о реализации в InMemoryMealRepositoryImpl двойной мапы:
    private *Map<Integer, Map<Integer, Meal>>* repository = new ConcurrentHashMap<>();
Но ведь он сам давал в заготовке одиночную:  
   private *Map<Integer, Meal>* repository = new ConcurrentHashMap<>();
почему так? (edited)


2 replies
Yevhen Maksymovych [3 days ago]
Двойную сделали, когда ввели разграничение по пользователям


e.pekhterev [3 days ago]
и ещё с вводного занятия Григорий говорит, что можно менять код, если требуется.
с другой стороны, можно было решить HW02 используя карту репозитория *Map<Integer, Meal>* и Meal с полем userId, но это если и не глупо, то уж всяко неоправданно и некрасиво) (edited)


Mihail Kedel [Jul 14th at 1:58 PM]
in #hw3
В таблице meals userId должен быть,а в классе Meal нет?


2 replies
e.pekhterev [3 days ago]
всё правильно, в данной реализации в поле userId для класса Meal нет никого смысла.


Victor [3 days ago]
а я понял так: раз userId в класс Meal вставлять НЕ надо, значит и в таблицу вставлять нельзя )))


Andy Fleer [Jul 14th at 1:58 PM]
in #hw3
Друзья, подскажите. У меня начальное состояние проекта (до патчей) на этой неделе такое же как на прошлой (ну или какие-то незаметные отличия). У вас так же? Или я какую-то не ту версияю качнул?


1 reply
Victor [3 days ago]
ну да Одинаковое, все ж изменения в branch HW* делаются верно?


Gagarina6794 [Jul 14th at 2:01 PM]
in #hw3
Привет- привет) Перенесла проект на Виндовс и не уверенна что все там гуд) Такой эксепшн исправить надо? Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'javax.sql.DataSource' available:


15 replies
Yevhen Maksymovych [3 days ago]
Датасорс не синитился


Yevhen Maksymovych [3 days ago]
Проверь креденшелы к бд


Gagarina6794 [3 days ago]
бд работает


Gagarina6794 [3 days ago]
UserServiceTest проходит


Yevhen Maksymovych [3 days ago]
А где эксепшн тогда падает?


Gagarina6794 [3 days ago]
когда mainSpring запускаю, там в задании сказано починить его


Gagarina6794 [3 days ago]
1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest


Gagarina6794 [3 days ago]
вот и спрашиваю какой ексепшн у мейна


Gagarina6794 [3 days ago]
наверное правильный, так как другие два теста тоже не рабочие)

e.pekhterev [3 days ago]
всё правильно вылетает эксепшин) нужно починить код, чтоб для InMemory...Тестов и SpringMain в спринг-контексте шла подмена бинов репозиториев на моки (вместо jdbc-реализаций). (edited)


Gagarina6794 [3 days ago]
спасибо, хоть уже знаю что проект рабочий))


e.pekhterev [3 days ago]
наивная)) там ещё делать и делать))


Gagarina6794 [3 days ago]
так хоть знаю что стартую правильно и проект настроен как надо


Gagarina6794 [3 days ago]
а работать там ОГО-ГО


e.pekhterev [3 days ago]
надеюсь сегодня закончу


Victor [Jul 14th at 4:47 PM]
in #hw3
Правильно ли я понимаю: нужно делать дополнительную linked_table для того чтобы связать user с meals. Иначе: для того чтобы проверять какому user какие meals соответствуют.:sunglasses: (edited)


14 replies
e.pekhterev [3 days ago]
ты про тесты сейчас говоришь?


Victor [3 days ago]
не, про JdbcMealRepositoryImpl реализацию...


Alexander Pilipenko [3 days ago]
Зачем еще 1 таблица?


Alexander Pilipenko [3 days ago]
Здесь простая связка 1 ко многим

Victor [3 days ago]
@Alexander Pilipenko так тогда лучше добавить Set с mealId в User? Что-то я туплю...


Victor [3 days ago]
Но тогда для поля Set <Meal> meals нужно будет тоже доп таблицу рисовать, верно?

Alexander Pilipenko [3 days ago]
Чаще всего так и делают

Alexander Pilipenko [3 days ago]
Таблица для еды


Alexander Pilipenko [3 days ago]
Форинг на таблицу пользователей


Alexander Pilipenko [3 days ago]
Делать ли set или list для еды в user - отдельный вопрос. Пока по нашей архитектуре - не нужно

Alexander Pilipenko [3 days ago]
Имхо

e.pekhterev [3 days ago]
честно говоря не понял зачем тебе там сет или линкедТейбл понадобился, смотри JdbcUserRepositoryImpl и делай также.
у нас там и так есть user_id (приходит от контроллера), так что просто юзаешь его при работе с базой и всё. (edited)



Victor [3 days ago]
я понял условие так: нельзя вставлять столбик с userId в таблицу meals.
оказалось только поле в классе Meal не стоит делать, и все :slightly_smiling_face:


Victor [3 days ago]
в этом собственно и был мой вопрос


matrocob [7:48 PM]
added this Java snippet: ребят, подскажите пожалуйста, вот если в MealRepo мы сделаем так, то почему фильтрация работает через MealUtils, разве не должна быть реализация фильтра в самом MealRepo?  Или может я что-то неправильно делаю 
 public List<Meal> getBetween(LocalDateTime startDate, LocalDateTime endDate, int userId) {
    return jdbcTemplate.query("SELECT * FROM meals where user_id=?", ROW_MAPPER, userId);
  }
Victor [7:52 PM]
я в query делают фильтр сразу по датам
e.pekhterev [7:59 PM]
в запросе у тебя уже должна быть и фильтрация, и соратировка


Andy Fleer [Jul 14th at 9:18 PM]
in #hw3
После установки патчей и настройки бд вылетает Ошибка 500 Type Exception Report

Description The server encountered an unexpected condition that prevented it from fulfilling the request.

Exception

java.lang.NullPointerException
    ru.javawebinar.topjava.util.MealsUtil.getFilteredWithExceeded(MealsUtil.java:37)
    ru.javawebinar.topjava.util.MealsUtil.getWithExceeded(MealsUtil.java:29)
    ru.javawebinar.topjava.web.meal.MealRestController.getAll(MealRestController.java:47)
    ru.javawebinar.topjava.web.MealServlet.doGet(MealServlet.java:88)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:635)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:742)
    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)


5 replies
sky [3 days ago]
NullPointer на getFilteredWithExceeded - брейкпоинт туда. Но лучше сначала создать свою ветку и повыполнять задания, глядишь уйдет


Victor [3 days ago]
там по уроку написано что приложение работать не будет  после последнего патча. ДЗ - исправить.


Andy Fleer [3 days ago]
ага)


Andy Fleer [3 days ago]
ВСе понял


Andy Fleer [3 days ago]
спасибо


Victor [Jul 14th at 9:38 PM]
in #hw3
@Grigory Kislin
>3: ЕЩЕ РАЗ: InMemory тесты должны идти на InMemory репозитории
и тогда без скриптов, и репозитарий будет меняться во время тестов.
Выход: в каждом тесте менять репозитарий и в нем же откатывать изменения. - думаю что это плохо, а других вариантов придумать не могу.


2 replies
sky [3 days ago]
@Before    public void setUp уже все делает


Victor [3 days ago]
понял, спасибо :slightly_smiling_face: In memory используем для высших слоев, а скрипты используем когда тестируем методы dao.


sky [9:39 PM]
У апача в commons-lang есть equals и хэшкод, которые вроде как могут дружить с хибернейтом, или нет? кто-нибудь вкурсе? (edited)


Victor [Jul 14th at 9:43 PM]
in #hw3
@Grigory Kislin
>8: Еще раз: в тестах проверять через JUnit Assert или использовать assertThat().isEqualTo нельзя
но в реализации master
`assertThat(actual).usingElementComparatorIgnoringFields("registered", "roles").isEqualTo(expected);`
так можно, или нельзя? :slightly_smiling_face:


4 replies
sky [3 days ago]
после using element comporator уже вызывается нормальный assertJ equals fieldByField, или что-то вроде


Victor [3 days ago]
то есть реализовывать так как сделано в master плохо, но зачем тогда так реализовано?


Victor [3 days ago]
прочитал вот это (нашел в слэке по ссылке от Григория):
https://web.archive.org/web/20170524072455/http://www.onjava.com:80/pub/a/onjava/2006/09/13/dont-let-hibernate-steal-your-identity.html?page=1


Victor [3 days ago]
как ни крути id в базе это плохо:
нужно переопределять equals, потому что иначе объект из базы и новый объект всегда будут не равны, потому что у них разные ссылки.
если только сравнивать по id, тогда два новых объекта, у которых id = null будут равны не смотря на другие варианты == плохо (нельзя сохранить в один Set например)
если сравнивать по id, но когда id==null, всегда возвращать false == плохо(если такой объект сохранить в Set, а потом его id изменить, то объект будет потерян)
использовать natural key, который будет основан на immutable полях (кроме поля с ID) объекта == плохо (у объекта таких полей может не быть, или такие поля в редких случаях могут меняться. Тогда приложение сломается)
Итог: нужно id генерировать в приложении, а не в базе.
в model добавлять version, и если это поле равно null, значит объект новый.
и тогда можно спокойно использовать equals и hashcode. (edited)


Andy Fleer [Jul 14th at 10:16 PM]
in #hw3
Правильно ли я понимаю задание основное? : 1) Разобраться откуда ошибка 500 NullPointerException 2) Сделать скрипт SQL создания таблицы MEAL ( по сути те же поля, что и в классе) 3) Создать эту таблицу скрирптом и другим скриптом заполнить ее чтобы все теперь кранилось не в репозитории, а в БД 4)  Переделать MealRepository чтобы записывал  и вытаскивал данные из БД .   Я на той планете?


3 replies
sky [3 days ago]
Во первых: просто выполняй заданий строго по порядку.
Во вторых:
1. Ошибка 500 это ошибка томката. А в первом пункте там мэйн и Junit sort of тесты
2. Ну да, но прочитай внимательно задания и вопросы. Т.е. все  кроме последнего пункта (проверка по HW03)
3. +
4. -. Переделывать надо реализацию, а не интерфейс (Jdbc..)
Смотря на какой ты планете.. (edited)



sky [3 days ago]
Да и плюс в основном задании, надо задеплоить апу в томкат, так чтоб все работало, как в предыдущем  уроке, кроме разве что того, что данные сохраняются между рестартами (edited)


Andy Fleer [3 days ago]
Там в первом пункте написано "понять почему не работают". Исправлять не надо?


e.pekhterev [Jul 14th at 11:49 PM]
in #hw3
У каго какие мысли по поводу подмены контекста для тестов?


11 replies
Victor [3 days ago]
у меня отдельный xml spring-app-test.xml и в нем     <context:component-scan base-package="ru.javawebinar.**.repository.mock"/>


e.pekhterev [3 days ago]
в нём только эта запись или всё три? т.е. в нём повторяется всё, что было и в spring-app.xml, и просто меняешь путь скана для репозитория? (edited)


Victor [3 days ago]
да


Victor [3 days ago]
это ж тесты, оптимизация здесь не нужна.

e.pekhterev [3 days ago]
я тоже так делал и в общем так не хорошо))))

Victor [1 day ago]
```@Autowired
WebApplicationContext context;
WebClient webClient;
@Before
public void setup() {
    webClient = MockMvcWebClientBuilder
            .webAppContextSetup(context)
            .build();
}```
вот такая конструкция в spring.doc
Получается объекты mock не нужно в конфиг добавлять и автосвязывать. А нужно отдельно инициализировать. (edited)


Victor [1 day ago]
но у меня такой подход не получается использовать


e.pekhterev [1 day ago]
дз сдал, сделал всё же отдельно, но другое решение. ждём четверга, Григорий рассудит что и как нудно было делать (edited)


Alexey_P [1 day ago]
у меня почему-то такой путь "ru.javawebinar.**.repository.mock" не проходит - mock выделен красным, по этому пути только jdbc, почему?


Victor [1 day ago]
та же беда была, его нужно поместить в test/resources


Alexey_P [1 day ago]
не догадался, спасибо


Merkulov [Jul 15th at 2:40 PM]
in #hw3
всем привет, вылетает такая ошибка : Error:(5, 24) java: package org.slf4j.bridge does not exist   , хотя библиотека подтягивается и физически лежит в репозитории


6 replies
Merkulov [1 day ago]
<dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>jul-to-slf4j</artifactId>
           <version>${slf4j.version}</version>
           <scope>runtime</scope>
       </dependency>


Merkulov [1 day ago]
если тут поменять скойп на compile то все ок, кто встречался с такой проблемой?


Gagarina6794 [1 day ago]
зависимость указана правильно, если все присутствует в ExternalLibraris и подтянуто в maven Dependencies, и мавен почищен перепакован... тогда не знаю...


Merkulov [1 day ago]
все указано правильно, я решил проблему


Merkulov [1 day ago]
убрал галочку в настройках мавена в идеи, напротив import maven projects automatically и заново все реимпортнул и все ок, и еще на всякий добавил памяти мавену


svis [1 day ago]
та же самая история. Убрал галочку и помогло. Спасибо!


Victor [5:34 PM]
```3: ЕЩЕ РАЗ: InMemory тесты должны идти на InMemory репозитории```
Зачем эта подсказка, если по заданию InMemory тестов вообще нет??? Запутался, пытался сделать ServiceMealTest через InMemoryMealRepository. Потратил целый день на то, что не требовалось сделать в результате... :unamused:


matrocob [Jul 15th at 7:32 PM]
in #hw3
подскажите пожалуйста...
в тестах InMemoryAdminRestControllerSpringTest 
У всех repositopryi подчеркивается красным?
@Autowired
   private InMemoryUserRepositoryImpl repository;


6 replies
tkorky [1 day ago]
привет, если ты только приступил к задаче то да, собственно тебе и надо понять что там не так :slightly_smiling_face:


matrocob [1 day ago]
ага, приступил как 2 часа)) голову сижу ломаю... надо в спринг-апп добавить     <context:component-scan base-package="ru.javawebinar.topjava.**.repository.mock"/>
так понимаю?))


tkorky [1 day ago]
лучше всего сделать отдельный файлик для тестов


tkorky [1 day ago]
в чатике кстати уже были спойлеры


tkorky [1 day ago]
https://topjava14.slack.com/archives/CBQ8X3WBY/p1531505493000330
Alexey Berdnikov
Народ, вот сделал для тестов отельный spring-test.xml, в нем скан моковского пакета и два скана  как в spring-app.xml(web , service). Так вот вопрос - как можно оптимизировать  тестовский .xml что бы не повторять сканы из основного .xml ??
Thread in #hw3Jul 13th at 9:11 PM


matrocob [1 day ago]
о спасибо тебе большое


Gagarina6794 [Jul 15th at 8:07 PM]
in #hw3
Подскажите что делать с dateTime в Meals? там получается надо полю выставить дефолтное значение что бы null не ловить?


54 replies
e.pekhterev [1 day ago]
ты про что сейчас, про Jdbc-репозиторий или чего?


Gagarina6794 [1 day ago]
класс MEAL extends AbstractBaseEntity


e.pekhterev [1 day ago]
у тебя вопрос про конструктор по умолчанию?


Gagarina6794 [1 day ago]
@e.pekhterev ставлю LocaleDateTime.now() и везде вставляет текущую дату, зависла здесь и не догоняю..))


Gagarina6794 [1 day ago]
да

e.pekhterev [1 day ago]
в конструкторе по умолчанию не нужно ничего писать.

Gagarina6794 [1 day ago]
так там и пусто

e.pekhterev [1 day ago]
ну и отлично


e.pekhterev [1 day ago]
или ты про то, что у тебя поля Meal все final? (edited)


Gagarina6794 [1 day ago]
вот для calories по умолчанию там само 0 ставит и в сервер тянет нужные данные, для dateTime = null, и там уже лезут иксепшены))


Gagarina6794 [1 day ago]
гетеры/сеттеры есть

e.pekhterev [1 day ago]
ещё раз, у тебя сейчас поля в Meal final или нет?

Gagarina6794 [1 day ago]
нет

e.pekhterev [1 day ago]
отлично

Gagarina6794 [1 day ago]
public LocalTime getTime() {
       return dateTime.toLocalTime();
   }


Gagarina6794 [1 day ago]
вот здесь с нуля хочет преобразование сделать

Gagarina6794 [1 day ago]
туплю здесь конкретно.. (edited)

e.pekhterev [1 day ago]
ничего там не нужно менять, делай как в задании написано - конструктор по умолчанию, сеттеры/геттеры, и конструктор копирования - смотри как User реализован, ну и поля без файнал (edited)

sky [1 day ago]
Это уже после того как запрос с БД вернулся и пытается смапить в лист? или когда это происходит?


e.pekhterev [1 day ago]
нам там негде null ловить

Gagarina6794 [1 day ago]
private LocalDateTime dateTime; ну поле так должно выглядеть?

sky [1 day ago]
я вот после selecta по недосмотру забыл * поставить, и ловил null, зато разобрался немного  crowMapper и resultSet

Gagarina6794 [1 day ago]
да null там уже негде ловить..


e.pekhterev [1 day ago]
поля теже, просто без final, ведь у нас конструктор по умолчанию  есть пустой, значит не могу быть поля файнал

Gagarina6794 [1 day ago]
это я знаю)

e.pekhterev [1 day ago]
и естественно private, всё как обычно

Gagarina6794 [1 day ago]
так значит еще конструктор добавить

e.pekhterev [1 day ago]
Ира, ну кто ж задание читать то будет)? 
_3.3. JbdcTemplate работает через сеттеры. Вместе с конструктором по умолчанию их нужно добавить в Meal_


Gagarina6794 [1 day ago]
есть сеттеры) гетеры тоже

e.pekhterev [1 day ago]
у нас есть для примера всё по работе с User, сплить по вертикали, слева всё что по юзеру, справа - всё по Meal, и копипасти с небольшими правками, задание просто изи

sky [1 day ago]
Ты скажи что запускаешь, когда null ловишь, скинь стактрейс


Gagarina6794 [1 day ago]
может я там где-то дальше чего-то накрутила...

e.pekhterev [1 day ago]
ты где null получаешь, что делаешь, или на гитхаб залей - посмотрю

sky [1 day ago]
если при попытке открыть страницу meals в томкате, то скорее всего не мапится правильно rowMapper ом


sky [1 day ago]
Тогда либо столбцы таблицы неправильно названы, либо запрос не верный

Gagarina6794 [1 day ago]
запускаю томкат, захожу в юзера или админа - и java.lang.NullPointerException
    ru.javawebinar.topjava.model.Meal.getDate(Meal.java:53)

Gagarina6794 [1 day ago]
пишу private LocalDateTime dateTime = LocalDateTime.now();   ну и везде естественно текущая дата..

Gagarina6794 [1 day ago]
в табличке на сервере


sky [1 day ago]
в табличке? т.е. в populateDB.sql или где?

Gagarina6794 [1 day ago]
табличке что в базе которая отображается на сервере

sky [1 day ago]
Я так это понимаю. В базе есть таблица meals и в ней содержатся записи, туда их можно засунуть изначально либо sql скриптом populateDB.sql либо ручками через окно идеи (edited)

Gagarina6794 [1 day ago]
ну и через томкат запущеный


sky [1 day ago]
Т.е. страница добавить Meal с формой у тебя открывается?

sky [1 day ago]
А страница с таблицей всех meal -нет?
Ведь ты пишешь, что NPE у тебя сразу при попытке   зайти в админа/юзера с индекса (edited)

Gagarina6794 [1 day ago]
нет, страницы не открываются

Gagarina6794 [1 day ago]
вместо них NPE

sky [1 day ago]
вот, а как ты тогда добавляешь записи? пока никак?


Gagarina6794 [1 day ago]
все работает, кроме даты, ставлю текущую в MEAL и все работает

sky [1 day ago]
как у тебя в initDB поле с dateTime называется, кинь строчку целиком

Gagarina6794 [1 day ago]
date TIMESTAMP NOT NULL,

sky [1 day ago]
datetime или date_time попробуй

Gagarina6794 [1 day ago]
да, здесь ошибка, спасибо


Joanna [1 day ago]
такая же фигня была, у меня заработало когда в скрипте и в классе JdbcTemplate datetime написала маленькими, а не большими (dateTime), потому-что в базу POSTRGREE оно все равно запишется маленькими, case-insensitive, у григория это в подсказках

e.pekhterev [1 day ago]
ахах)) даже Григория пишешь теперь в case-insensitive))


Avaaron [8:54 PM]
странное дело, может кто сталкивался, если запускаю тест на весь класс, getBetweenDates(), getBetweenDateTimes() тесты не проходят, а по отдельности всё ок..
что с этим делать

Tanya [8:54 PM]
где-то портишь тестовые данные

Avaaron [8:55 PM]
они вообще final

Tanya [8:57 PM]
т.е. например в апдейте ты никакие отд поля не меняешь?

Avaaron [9:02 PM]
меняю, но не время и изменения касаются элемента у которого id больше чем у тех, которые участвуют в этих методах.


Avaaron [Jul 15th at 9:08 PM]
in #hw3
и к тому же скрипт заполнения бд перезапускается для каждого метода


8 replies
Tanya [1 day ago]
проверь меняешь ли ты каким либо образом константу, которую потом используешь в getBetweenDates(), getBetweenDateTimes()


Avaaron [1 day ago]
нет, нигде не меняю


Avaaron [1 day ago]
я проверил


Avaaron [1 day ago]
есть место, ге я другому объекту присваиваю ее значение


Tanya [1 day ago]
если тесты проходят по одному, но не проходят при запуске всех, по причине не equals объектов в массиве, значит в др. тестах данные были изменены


Tanya [1 day ago]
подебажь, посмотри что конкретно не совпадает и проверь где могло поменяться (edited)

e.pekhterev [1 day ago]
да там и без дебага по идее в консоли всё показывает

Victor [1 day ago]
Ну как, получилось разобраться?


Victor [Jul 15th at 11:35 PM]
in #hw3
хм.. Я помнил, что у нас время каждого Meal уникально, верно? Но ведь у нас много юзеров и одна таблица. Тогда есть вероятность, что блюда будут в одно время созданы?


3 replies
sky [1 day ago]
"запретить создавать у одного и того-же юзера еду с одинаковой dateTime"



Victor [1 day ago]
и это надо через sql делать?



zippospb [1 day ago]
Именно. Там в условии сразу дана и подсказка, как именно это надо делать


Avaaron [Yesterday at 12:09 AM]
in #hw3
вот вопрос...создаю индекс, после этого его как то нужно в запрос подставлять или он будет автоматом использоваться, когда выборка будет по соответствующему полю таблицы?


24 replies
Merkulov [1 day ago]
автоматом


Merkulov [1 day ago]
лучше почитай про индексы, хоть будет общее представление


Avaaron [1 day ago]
я прочёл, про них много, просто нигде не сказано что создал , а используй автоматом

Avaaron [1 day ago]
часа три уже изучаю))

Merkulov [1 day ago]
значит не понял основы


Avaaron [1 day ago]
ну хорошо, не понял значит..


Avaaron [1 day ago]
спасибо

Merkulov [1 day ago]
знаешь что такое индексация файлов на жестком диске


Avaaron [1 day ago]
я понимаю, что такое индекс и для чего он нужен


Avaaron [1 day ago]
очень похоже на equals и hashcode

Merkulov [1 day ago]
ну а зачем вопрос такой задаешь, если бы понимал то не задавал бы

sky [1 day ago]
вот видос можешь глянуть, если посмотришь, и появится понимание, отпишись https://vimeo.com/105424016 (edited)

Avaaron [1 day ago]
вот ты про индексацию спросил на hdd, но ты знаешь только общие принципы его работы, что там в контролере и какая логика ты не знаешь


Avaaron [1 day ago]
так и я , я понял для чего, не понял как

Merkulov [1 day ago]
сначала нужно понять общую парадигму

Avaaron [1 day ago]
ты ответил на мой вопрос, спасибо

Merkulov [1 day ago]
а потом уже тонкости

Merkulov [1 day ago]
в логике работы можно разобраться, понимая общую концепцию, а если не понимаешь то и не разберешься хоть бейся об стену


Avaaron [1 day ago]
разобраться можно во всём


Avaaron [1 day ago]
главное правильно найти начало клубка

Avaaron [1 day ago]
лучше всего спросить у того, кто уже прошёл по этому пути


Avaaron [1 day ago]
так выборка нужных знаний будет быстрее


Avaaron [1 day ago]
это и есть индекс)


Avaaron [1 day ago]
Доброй ночи)


hav [Yesterday at 10:57 AM]
in #hw3
Помогите починить. Не видит spring-app.xml, выдает FileNotFoundException. Файл на месте, в проекте добавлен. В target копируется только spring-db.xml.


23 replies
Merkulov [1 day ago]
была такая проблема, долго мучался, то один фал не попадал в класспас то другой, вылечил удалением папки .idea .iml и заново импортнул проект


Stanislav [1 day ago]
Попробуй clear в мавене и сразу File->Invalidate cashes / Restart


hav [1 day ago]
Не помогло


Stanislav [1 day ago]
Тогда скопируй всю строку пути, @ContextConfiguration


hav [1 day ago]
Ошибка в MealServlet init


Stanislav [1 day ago]
ClassPathXmlApplicationContex покажи

hav [1 day ago]
в строке springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml", "spring/spring-db.xml");


Stanislav [1 day ago]
classpath:  забыл

Stanislav [1 day ago]
"classpath:spring/spring-app.xml"


hav [1 day ago]
то же самое


hav [1 day ago]
java.io.FileNotFoundException: class path resource [spring/spring-app.xml] cannot be opened because it does not exist

Stanislav [1 day ago]
вот теперь сделай clear в мавене и сразу File->Invalidate cashes / Restart


hav [1 day ago]
Уже делал, не помогает

Stanislav [1 day ago]
тогда скрины 1. скрин иерархии где лежат xml 2. скрин MealServlet init


Stanislav [1 day ago]
3. скрин фасетов в насройках проекта


Merkulov [1 day ago]
там не обязательно писать classpath, он сам понимает что нужно брать из класс паса


e.pekhterev [1 day ago]
не надо там classpath; должно отпрабатывать все  и так:
springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml", "spring/spring-db.xml"); (edited)

Merkulov [1 day ago]
класс ведь называется класспасс

Merkulov [1 day ago]
попробуй мой вариант)

Merkulov [1 day ago]
выше писал


hav [1 day ago]
Заработало, хотя и не очень понял как. Удалил папку .idea, файл topjava.iml. Импортировал проект заново. Потом папку вернул обратно и все заработало.

Merkulov [1 day ago]
)))

Merkulov [1 day ago]
аналогично, походу идея тупила, какой-то баг


Maxim Gusev [10:58 AM]
ctrl alt shift s -> facets -> spring app у тебя там должно быть 2 файла

hav [10:59 AM]
два и есть. Я их уже удалял и заново добавлял - не помогает.

Maxim Gusev [10:59 AM]
когда на карандашик нажимаешь, то у тебя у обоих файлов галочки?

hav [11:00 AM]
да

Maxim Gusev [11:00 AM]
Тогда на этом мои полномочия все:face_with_rolling_eyes:


Maxim Gusev [Yesterday at 11:07 AM]
in #hw3
У меня вот другая проблема. Не знаю как побороть неподключенные бины. Не могу добавить тестовые пакеты в файл контекста, так как идея предлагает только путь  ru.javawebinar.topjava.repository.jdbc, который находится в проекте (не в тестах). Помогите, не знаю как починить


7 replies
e.pekhterev [1 day ago]
гугель в помощь - что-нить вроде подмена контекста спринг при тестах
пол дня в общем этот вопрос у меня занял))))
(там ещё нужно чтоб и дублирования кода нигде не было) (edited)


Stanislav [1 day ago]
тестовые пакеты в xml можно добавить только если xml лежит в пакетах тестов

Maxim Gusev [1 day ago]
@e.pekhterev, вчера искал, но не нашел. Сейчас продолжу

@Stanislav я создал в тестах xml с контекстом и туда подключил нужные пакеты, но не смог подключить его к проекту


sky [1 day ago]
у меня spring-test.xml лежит там же где и 2 предыдущих (в ресурсах, а не в пакетах тестов), оба теста и SpringMain работают (edited)

Maxim Gusev [1 day ago]
@sky, такое решение пока пойдет, но в продакшене не должно быть этого файла

sky [1 day ago]
Думаю там вообще должен быть springMock или mockito, соответственно никаких inmemory хранилищ тем более.

Alexander Pilipenko [21 hours ago]
Даже если будут моки, все равно мы тестируем controller, а инжектим - репозиторий. Решать придется такую же проблему


Maksim K [Yesterday at 12:06 PM]
in #hw3
кто знает, когда установил все патчи, пробую применить скрипты для создания таблиц в базе данных. и выдает такую ошибку `[2018-07-16 12:04:15] [42P01] ОШИБКА: отношение "global_seq" не существует` (edited)


5 replies
Merkulov [1 day ago]
попробуй построчно выполнить скрипт



Maksim K [1 day ago]
Офигеть. Все прошло. Спасибо. А в чем прикол был?


Merkulov [1 day ago]
была такая проблема когда выделяешь вес код и запускаешь, почему-то не все строчки выполняются, потом попробовал построчно и все прошло, а лучше нажать правой кнопкой мыши на файле скрипта и запустить его


Maksim K [1 day ago]
нда.мистика какая-то


Victor [1 day ago]
у меня похоже, такая же беда была. Я через консолько базы данных скрипты полностью запускал.


Victor [Yesterday at 1:34 PM]
in #hw3
 ```@Test
    public void create() {
        service.create(NEW_MEAL, USER_ID);
        NEW_MEAL.setId(null);
        assertMatch(service.getAll(USER_ID), NEW_MEAL_WITH_ID, MEAL_6, MEAL_5, MEAL_4, MEAL_3, MEAL_2, MEAL_1);
    }```
Вот у меня есть тест. Чтобы он работал мне нужно менять обратно Id на null, потому что тестируемый метод меняет входные данные. Как делать так, чтобы тесты не могли менять данные. Неужели нужно обновлять тестовые данные через @Before полностью?


3 replies
Merkulov [1 day ago]
просто для создания создай отдельную еду, и не парься

Merkulov [1 day ago]
с нуловым значением Id


Victor [1 day ago]
точно, thanks, а я с этими константами запарился :grin:


Alexey_P [Yesterday at 4:49 PM]
in #hw3
Простой SQL запрос нормально отрабатывает в pgAdmin, а в getAllJdbcMealRep (в дебаггере) возвращает верные id meal, но все остальные поля - null. Не подскажите в чем может быть дело?


15 replies
Yevhen Maksymovych [21 hours ago]
внимательно читаем урок


Yevhen Maksymovych [21 hours ago]
```10: Напомню: BeanPropertyRowMapper работает через отражение. Ему нужны геттеры/сеттеры и имена полей должны "совпадать" с колонками ResultSet (Column values are mapped based on matching the column name as obtained from result set metadata to public setters for the corresponding properties. The names are matched either directly or by transforming a name separating the parts with underscores to the same name using "camel" case).```



Alexey_P [21 hours ago]
Это я читал и сделал соответственно. А другие причины могут быть ?


Yevhen Maksymovych [21 hours ago]
покажи гит

Alexey_P [21 hours ago]
не коммитил. Может чтоя не понял.Ты этот кусок имеешь ввиду?
.addValue("id", meal.getId())
               .addValue("datetime", meal.getDateTime())
               .addValue("description", meal.getDescription())
               .addValue("calories", meal.getCalories())
               .addValue("user_id", userId);


Yevhen Maksymovych [21 hours ago]
нет, гляди на сам класс Meal

Alexey_P [21 hours ago]
там без верблюда сделал

Yevhen Maksymovych [21 hours ago]
так, давай подробнее, у тебя проблема в том, что поля не пишутся БД, или в том, что пишутся, но достаются оттуда нулями?

Yevhen Maksymovych [21 hours ago]
save() отрабатывает корректно?


Alexander Pilipenko [21 hours ago]
Сделай еще 1 ветку в git. Выложи код. Без кода очень сложно что-то сказать

Alexey_P [21 hours ago]
попробовал еще раз сам и врде все проверил, но нет)Буду признателен
Нули в дебаге в  getAll query
https://github.com/AlexeyPavlov2/topjava/tree/HW03

Yevhen Maksymovych [21 hours ago]
но ведь в миле нет сеттеров...


Alexey_P [21 hours ago]
не может быть. Донажимался на revert. Блин. Спасибо, добрый человек)

Alexey_P [21 hours ago]
поехало

Yevhen Maksymovych [21 hours ago]
:+1:


Kirilo [Yesterday at 6:00 PM]
in #hw3
Пропустил момент, каким образом Spring находит папку помеченную, как ресурсы? Ведь в плейсхолдере ему достаточно указать только такой параметр к файлу: location="classpath:db/postgres.properties". А в корне у нас может быть любая папка помеченная Idea как ресурсная. (edited)



6 replies
turhanow [19 hours ago]
в SpringMain конфигурационный файл у нас указывается при создании контекста ClassPathXmlApplicationContext("spring/spring-app.xml"))

в тестах используем анотацию @ContextConfiguration


Kirilo [19 hours ago]
В каком месте? Я спрашивал конкретно про папку "resources". Каким образом Spring понимает, что здесь ресурсные файлы лежат? Папка может быть любая. Проверте сами. Нигде это не отмечается и не конфигурится! Достаточно в Idea обозначить, что она ресурсная.


Yevhen Maksymovych [19 hours ago]
гхм, ну, собственно, когда мы включаем папку в ресурсы, идея добавляет ее в classpath. спринг по дефолту ищет указанную папку в класспасе



Yevhen Maksymovych [19 hours ago]
и не только спринг

Yevhen Maksymovych [18 hours ago]
тот же логбэк, хибернейт и тп. все свои конфиги первым делом ищут в класспасе

Kirilo [18 hours ago]
Да, уж, не хватает какой-то визуализации процессов, что делает та же Idea порой. Оно то проще становится работать, если ты знаешь все детали, как все завязано между собой. И наоборот, вот, как в этом случае.


Yevhen Maksymovych [Yesterday at 8:02 PM]
in #hw3
ребят, а на каком этапе у нас в поме возник maven-surefire-plugin? и зачем он нам там понадобился? мы же тесты запускаем из идеи, а при попытке запустить surefire:test у меня вот такой вот эррор падает
```[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.22.0:test (default-cli) on project topjava: Unable to generate classpath: org.apache.maven.artifact.resolver.ArtifactResolutionException: Unable to get dependency information for org.apache.maven.surefire:surefire-junit4:jar:2.22.0: Failed to retrieve POM for org.apache.maven.surefire:surefire-junit4:jar:2.22.0: Could not transfer artifact org.apache.maven.surefire:surefire-junit4:pom:2.22.0 from/to central (https://repo.maven.apache.org/maven2): java.lang.RuntimeException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty```


5 replies
Alexander Pilipenko [18 hours ago]
В патче 3_07. Ошибка похожа на проблемы с протоколом

e.pekhterev [18 hours ago]
не знаю зачем он, тоже интересно, проверил запуск, всё работает, отрабатывает тест без ошибок. поглядел всю консоль. он похоже сам запускает вообще все наши тесты.
[INFO] Results:
[INFO] Tests run: 28, Failures: 0, Errors: 0, Skipped: 0
[INFO] BUILD SUCCESS (edited)


e.pekhterev [18 hours ago]
Как приятно, когда всё работает, хотя и не понимаешь зачем оно и почему)))


e.pekhterev [18 hours ago]
в общем понятно, он запускает все тесты, когда мы билдим проект, согласно пом <build>
_Плагин maven-surefire-plugin предназначен для запуска тестов и генерации отчетов по результатам их выполнения. По умолчанию на тестирование запускаются все java-файлы, наименование которых начинается с «Test» и заканчивается «Test» или «TestCase»_ (edited)

Yevhen Maksymovych [18 hours ago]
все, разобрался. поменялись сертификаты какие-то у оракла, и для линукса в архиве они лежат старые, надо вручную качать более свежий ждк, и оттуда вручную доставать сертификаты


Alexey_P [Yesterday at 10:58 PM]
in #hw3
Забавная штука получается.
При добавлении новой еды и если ты хочешь в теч. минуты съесть и записать кучу вкусных ништяков, 
у тебя ничего не получится - секунды отбрасываются и ты получаешь 
PreparedStatementCallback; ]; ОШИБКА: повторяющееся значение ключа нарушает ограничение уникальности "meals_datetime_user_id_idx"
Для решения проблемы я изменил mealForm.jsp - поставил у инпута datetime атрибут step = "1" - теперь секунды видны и в MealServlet при записи нового meal вместо LocalDateTime.parse(request.getParameter("dateTime") поставил 
LocalDateTime.parse(request.getParameter("dateTime"),
     DateTimeFormatter.ISO_LOCAL_DATE_TIME);
Все, теперь в теч минуты можно есть и записывать разную еду:)
Но показываем в табличке одинаковые минуты.
Кто столкнулся с такой проблемой?


10 replies
Alexander Pilipenko [15 hours ago]
При выводе используется пользовательский тег в котором используется ф-ия toString (edited)

Alexander Pilipenko [15 hours ago]
private static final DateTimeFormatter DATE_TIME_FORMATTER = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm");

   public static <T extends Comparable<? super T>> boolean isBetween(T value, T start, T end) {
       return value.compareTo(start) >= 0 && value.compareTo(end) <= 0;
   }

   public static String toString(LocalDateTime ldt) {
       return ldt == null ? "" : ldt.format(DATE_TIME_FORMATTER);
   }


Alexander Pilipenko [15 hours ago]
Ну и в ней форматтер yyyy-MM-dd HH:mm


Alexander Pilipenko [15 hours ago]
Поэтому в таблице показывается до минут (edited)


Alexey_P [15 hours ago]
про таблицу не вопрос был.
да, и форматтер не нужен, итак сек записываются.
посыл был такой - в течение одной минуты еду записать нельзя

Alexey_P [15 hours ago]
не нужен, в смысле в моем тексте


Alexander Pilipenko [15 hours ago]
Но показываем в табличке одинаковые минуты.
Кто столкнулся с такой проблемой? :slightly_smiling_face:


Alexey_P [15 hours ago]
)

svis [2 hours ago]
При добавлении новой еды и если ты хочешь в теч. минуты съесть и записать кучу вкусных ништяков...


svis [2 hours ago]
Я  конечно поесть люблю но это уже перебор :smiley:


Jury Mironov [12:01 AM]
uploaded and commented on this image: Snap 2018-07-16 at 23.53.52.png 

Подскажите, пожалуйста, как пофиксить


turhanow [Today at 1:55 AM]
in #hw3
> без дублирования в spring-app-memory.xml и spring-app.xml


привет, подскажите куда копать?)) не получается в гугле накопать что то рабочее и дельное(


4 replies
Yevhen Maksymovych [5 hours ago]
вспомни о принципе декомпозиции. если код дублируется в двух классах, имеет смысл вынести его в отдельный класс :slightly_smiling_face:


Yevhen Maksymovych [5 hours ago]
или использовать наследование...


sky [4 hours ago]
А наследование, это для случая если в java конфигурацию контекста делать? Или с xml-ями можно сделать что-то кроме импорта  в этом случае?


Yevhen Maksymovych [4 hours ago]
да и с xml никто не мешает посмотреть на какие-то общие вещи, и вынести часть их в другой xml


Jury Mironov [10:31 AM]
commented on Snap 2018-07-16 at 23.53.52.png
Пришлось ручками удалить плагин и сделать реимпорт. Зависимости как-то подтянулись с десятого раза.

Jury Mironov [10:59 AM]
У меня конфликты при накатывании патчей


Jury Mironov [Today at 11:00 AM]
in #hw3
почему-то есть класс, который лежит в mock.mock и его пакет неправильно указан


1 reply
Jury Mironov [3 hours ago]
еще почему-то нет класса UserTestData


Jury Mironov [11:00 AM]
uploaded this image: Snap 2018-07-17 at 10.55.47.png 


Jury Mironov [11:13 AM]
uploaded and commented on this image: Snap 2018-07-17 at 11.12.28.png 

Создал класс, говорит дубликат,  а я оригинала не вижу. Сплошная магия
Jury Mironov [11:14 AM]
Я так понимаю, что конфликт с тем, что в папке тест
e.pekhterev [11:15 AM]
Зачем ты закинул UserTestDate в сорсы? должен быть только в тестах

Jury Mironov [11:16 AM]
uploaded this image: Snap 2018-07-17 at 11.16.27.png 


Yevhen Maksymovych [Today at 11:43 AM]
in #hw3
проверь, что  аналогичного класса нет в папке тест. для идеи - обе эти папки - сорцы в класспасе, для нее нет разницы, что один физически лежит в test\ru.topjava.webinar, а другой - в src\ru.topjava.webinar, это один и тот же пекедж, в нём не может быть двух одинаковых классов


1 reply
Jury Mironov [2 hours ago]
в тесте есть как раз


Jury Mironov [Yesterday at 3:20 PM]
in #hw3
После всех патчей открывает страницу с выбором meal админа или юзера,  а дальше прсле select выдает ошибку.  Такого не должно быть? Не находит класс MockUserRepositoryImpl.


2 replies
sky [9 hours ago]
Так и должно быть, мы же в одном из патчей измени компонент скан на более конкретный, на repository.jdbc, теперь repository.mock не виден контексту. Теперь вам нужно просто выполнять задания по пунктам. Внимательнее посмотрите, какие конкретно изменения были произведены в принятых патчах, перед этим.


Jury Mironov [9 hours ago]
у меня в spring-app красным горит бин MockUserRepositoryImpl, типа так и должно быть и это надо пофиксить?


Prodigy [4:12 PM]
накатываю патчи третьего урока и обнаруживаю что не все классы резолвятся, т.е. подсвечиваются красным цветом.... в импортах тоже самое, проверяю, везде классы есть.... что это?


Yevhen Maksymovych [Yesterday at 4:46 PM]
in #hw3
а почему мы в UserService.update() не задекларировали что он тоже может бросить NotFoundException()? там ведь есть проверка, которая его бросит при обновлении несуществующего юзера


16 replies
Vitaly [7 hours ago]
update через save реализован, если не найдет - просто сохранит, главное чтобы он не null был


Yevhen Maksymovych [7 hours ago]
да ну?


Vitaly [7 hours ago]
я тебе говорю)


Yevhen Maksymovych [7 hours ago]
    ```@Test
    public void updateNonExistingUser() throws Exception {
        User updated = new User(12, "Luke Skywalker", "luke@imyour.daddy", "starwars", ROLE_USER);
        service.update(updated);
    }```


Yevhen Maksymovych [7 hours ago]
```ru.javawebinar.topjava.util.exception.NotFoundException: Not found entity with id=12```


Vitaly [7 hours ago]
это через какую реализацию - jdbc?

Yevhen Maksymovych [7 hours ago]
да и через моковую те же яйца будут

Vitaly [7 hours ago]
5 сек


Alexander Pilipenko [7 hours ago]
if (user.isNew()) {
           Number newKey = insertUser.executeAndReturnKey(map);
           user.setId(newKey.intValue());
       } else if (namedParameterJdbcTemplate.update(
               "UPDATE users SET name=:name, email=:email, password=:password, " +
                       "registered=:registered, enabled=:enabled, calories_per_day=:caloriesPerDay WHERE id=:id", map) == 0) {
           return null;
       }
       return user;


Alexander Pilipenko [7 hours ago]
Это в JDBC


Yevhen Maksymovych [7 hours ago]
ну оно в любом случае бросится на текущих двух реализациях - в моке мы делаем компутифабсент, а в ждбс вызываем апдейт вместо инсерта при существующем ид



Yevhen Maksymovych [7 hours ago]
вопрос только почему мы это не указали в интерфейсе, ну, т.е. понятно, что сейчас мы это все равно никак не обрабатываем, в спринг мвс будем эти эксепшены ловить просто строгости ради, надо было указать


Vitaly [7 hours ago]
а я не могу увидеть, кто пробросил notfound


Yevhen Maksymovych [7 hours ago]
сервис и пробросил, мы возвращаем не напрямую результат из репозитория, а через наш рукотворный ассерт "checkNotFoundWithId()"


Vitaly [7 hours ago]
а да, он мне и раньше не нравился :grin:

e.pekhterev [4 hours ago]
а то что мы не ловим/не обрабатываем сейчас обновление или сохранение дубликатов - это тебя не заботит? просто валимся в эксепшин в рабочем коде (edited)


SergeyA [Yesterday at 5:36 PM]
in #hw3
В решении HW2 про class MealRestController, Григорий говорит: *"Если класс хранит состояние, то он не ThreadSave"* , но ведь это только к синглетонам и статическим относится, так?  Обычный класс будет инстансом и переменные потоков не перезатрутся. Верно?
UPDATE - ой туплю! Это же Spring, там все Bean'ы  - синглетоны! - Это имелось ввиду? (edited)


1 reply
Yevhen Maksymovych [6 hours ago]
ага. и сервлеты туда же.


zippospb [Yesterday at 7:30 PM]
in #hw3
Может кто подскажет: в MealServiceTest при запуске теста создания meal с неуникальным индексом отдельно, service.create выкидывает exception,  а при запуске всех тестов подряд, он же возвращает null. (edited)


4 replies
Yevhen Maksymovych [5 hours ago]
а бд заново популится между тестами?


zippospb [5 hours ago]
Перед классом аннотация sql с указанием скриптов на инициализацию и наполнение базы


Yevhen Maksymovych [5 hours ago]
покажи гит. вообще, если результат теста разнится от порядка запуска - я бы копал в сторону корректности популирования. так-то тесты должны быть изолированы друг от друга.


e.pekhterev [4 hours ago]
исходные данные им MealTestData возможно портятся


stea1th [9:21 PM]
кто поможет и скажет что это за ошибка такая??


stea1th [Yesterday at 9:21 PM]
in #hw3
Message PreparedStatementCallback; SQL [SELECT m.id, m.datetime, m.description, m.calories FROM meals m JOIN users u ON m.user_id= u.id WHERE u.id=:userId Индекс колонки вне диапазона: 1. Допустимые значения: 1..0; nested exception is org.postgresql.util.PSQLException: Индекс колонки вне диапазона: 1. Допустимые значения: 1..0


20 replies
Yevhen Maksymovych [3 hours ago]
А зачем ты джойнишь? В таком контексте ты userId можешь напрямую в миле сравнивать


stea1th [3 hours ago]
ну там написано, что не надо в мил добавлять userId


stea1th [3 hours ago]
оно не зависит, джойню я или нет


vch [3 hours ago]
`:userId` - подозрительно. Каким образом вызывается sql-запрос может влиять - там есть случаи, когда именованные параметры не поддерживаются, только через `?` задавать можно.


stea1th [3 hours ago]
return jdbcTemplate.query("SELECT m.id, m.datetime, m.description, m.calories FROM meals m JOIN users u " +
               "ON m.user_id= u.id " +
               "WHERE u.id=:userId ", ROW_MAPPER, userId);


vch [3 hours ago]
знак вопроса вместо `:userId` попробуй


stea1th [3 hours ago]
изначально было так: "SELECT * FROM meals m " +
               "WHERE m.user_id=:userId " +
               "ORDER BY 2 DESC "


Yevhen Maksymovych [3 hours ago]
это же не неймедкьерри

Yevhen Maksymovych [3 hours ago]
он не поддерживает именованные параметры

stea1th [3 hours ago]
сейчас попробую


Yevhen Maksymovych [3 hours ago]
хочешь именованные, используй namedParameterJdbcTemplate


stea1th [3 hours ago]
супер... вот я чайник

Victor_D [3 hours ago]
userId тянется из SqlMap-тра-та-та

stea1th [3 hours ago]
сейчас все попробую.. спасибо большое


Yevhen Maksymovych [3 hours ago]
и не джойни зря, вот это же
```SELECT m.id, m.datetime, m.description, m.calories FROM meals m JOIN users u ON m.user_id= u.id WHERE u.id=:userId```
полностью аналогично
```SELECT m.id, m.datetime, m.description, m.calories FROM meals m WHERE m.user_id=:userId```
(edited)


Yevhen Maksymovych [3 hours ago]
и даже больше, ты вытаскиваешь все поля, так что
```SELECT * FROM meals WHERE user_id = :userId```


Victor_D [3 hours ago]
таблица из 5 столбцов, а тянет 4

Yevhen Maksymovych [3 hours ago]
ну, такой себе оверхед )

Yevhen Maksymovych [3 hours ago]
сколько там? четыре байта на запись?

stea1th [3 hours ago]
я же написал, что не знал в чем прикол и изначально я тянул звездочку


stea1th [9:47 PM]
а кто что может подсказать по первому заданию? что там надо чинить?

stea1th [9:53 PM]
1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest


stea1th [Yesterday at 9:54 PM]
in #hw3
это потому что мы из "spring/spring-app.xml" добавили конкретную папку .jdbc?


5 replies
Victor_D [2 hours ago]
угу, там, кстати, решение проблем расписано )


stea1th [2 hours ago]
а где, если не секрет... я просто не такой продвинутый :slightly_smiling_face:


stea1th [2 hours ago]
насколько  я понимаю надо appCtx убрать и все бины заменить на обычные классы?


sky [2 hours ago]
Надо контекстЫ поправить так, чтоб они удовлетворяли классам из repository.jdbc и из repository.mock


Victor_D [2 hours ago]
в одном из видео к уроку ( не помню в каком) Григорий говорил, что иногда под тесты пишутся отдельные конфиги


KaryNaiKo [10:18 PM]
Объясните плс как все это работает?
Почему при выборе админа или юзера разные данные выводятся?


KaryNaiKo [Yesterday at 10:25 PM]
in #hw3
Точнее, как SecurityUtil узнает какой пользователь залогинился?


3 replies
Maksim K [2 hours ago]
Мы же на начальной странице выбираем в селекте либо User, либо Admin. И вот когда ты кликаешь либо того, либо другого его id через форму передается в UserServlet. Там в doPost он парсится и устанавливается в SecurityUtil через сеттер `SecurityUtil.setAuthUserId(userId);`. А дальше через геттер мы его берем и с ним работаем.


vch [2 hours ago]
```public class SecurityUtil { 
  private static int id = AbstractBaseEntity.START_SEQ;```
Понятно, что это временный костыль, но тем не менее - разве такую конструкцию можно использовать в многопоточной среде? Без синхронизации, AtomicInteger и т.п.?.. (edited)


Stanislav [1 hour ago]
:man-facepalming: у всех есть исходники, видео где обьяснется, куча текста (внешние ссылки)


Maksim K [Yesterday at 10:39 PM]
in #hw3
Коллеги, нужна помощь. У всех нормально мавен собирает проект?
У меня, когда нажимаю package вылазит такая ошибка
`[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project topjava: Fatal error compiling: invalid target release: 9.0.1 -> [Help 1]`
То есть я так понимаю maven-compiler-plugin тупит. Не может скомпилировать файлы. Уже вроде все перепробовал, не знаю че ему еще надо. У меня везде где только можно стоит 9.0.1 версия Джавы. Может у кого тоже была такая проблема или кто-то знает как ее можно решить


8 replies
sky [2 hours ago]
а 1.8 java работала?


Maksim K [2 hours ago]
ну вообще у меня уже давно 9 версия. я стажировку начинал уже на ней. но я вроде пробовал переходить на восьмую и тоже не работало. ща еще раз на всякий случай попробую


sky [1 hour ago]
ну вот еще ссылка, вдруг что то из этого не пробовали http://roufid.com/invalid-target-release-in-maven-build/ (edited)

Maksim K [1 hour ago]
попробовал 8 версию. все что изменилось 
`[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project topjava: Fatal error compiling: invalid target release: 1.8.0_144 -> [Help 1]`


Maksim K [1 hour ago]
@sky эту ссылку читал. джава хоум у меня стоит 9 версии. вот ща только еще попробовал добавить `<verbose>true</verbose>
        <fork>true</fork>
    <executable>C:\Program Files\Java\jdk1.7.0_79\bin\javac</executable>`
все равно ошибка только немного по-другому пишет: 
`[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project topjava: Compilation failure
[ERROR] javac: invalid target release: 9.0.1
[ERROR] Usage: javac <options> <source files>
[ERROR] use --help for a list of possible options`


Maksim K [24 minutes ago]
И что никто не поможет моему горю???
Я уже и `maven-compiler-plugin` попробовал 3.6.2 версии, все равно такая же ошибка. И самое интересное, что при запуске SpringMain или когда через Tomcat запускаю приложение, то все нормально компилируется и приложение работает. Что этому плагину не нравится ума не приложу...

Victor_D [16 minutes ago]
реимпорт пробовал?


Maksim K [4 minutes ago]
раз 30-40 наверное) и clean тоже столько же. а может и больше. ниче не помогает. уже  даже надоело гуглить. ниче не помогает. может кто что дельное подскажет


Yevhen Maksymovych [4 days ago]
В смысле, у тебя в таргет так и указано 9.0.1? Покажи секцию build пома


Андрей [4 days ago]
Может уже тогда 10ку пробуй. "Java SE 9 has reached end of support. Users of Java SE 9 should switch to Java SE 10." (Oracle)


sky [4 days ago]
<fork>true</fork>
   <executable>C:\Program Files\Java\jdk1.7.0_79\bin\javac</executable>
разве здесь не на 9.0.1 javac нужно указывать? Да и выложи сюда помник свой, вдруг поможет


Maksim K [3 days ago]
@sky у меня в <executable> моя версия естественно указана. это я просто скопировал с того сайта по ссылке и сюда выкинул.


sky [3 days ago]
тогда печаль


Maksim K [3 days ago]
@Yevhen Maksymovych вот мой помник:
<build>
       <finalName>topjava</finalName>
       <defaultGoal>package</defaultGoal>
       <plugins>
           <plugin>
               <groupId>org.apache.maven.plugins</groupId>
               <artifactId>maven-compiler-plugin</artifactId>
               <version>3.7.0</version>
               <configuration>
                   <source>9.0.1</source>
                   <target>9.0.1</target>
                   <!--<verbose>true</verbose>-->
                   <!--<fork>true</fork>-->
                   <!--<executable>D:\Program Files\Java\jdk-9.0.1\bin\javac</executable>-->
               </configuration>
           </plugin>
           <plugin>
               <groupId>org.apache.maven.plugins</groupId>
               <artifactId>maven-surefire-plugin</artifactId>
               <version>2.22.0</version>
               <configuration>
                   <argLine>-Dfile.encoding=UTF-8</argLine>
               </configuration>
           </plugin>
       </plugins>
   </build>


Maksim K [3 days ago]
<verbose></verbose>
<fork></fork>
 <executable>
пока временно закомментил. все равно это не помогает. ошибка остается


Yevhen Maksymovych [3 days ago]
гхм, а если указать соурс и таргет 1.9?


Yevhen Maksymovych [3 days ago]
а не 9.0.1

Yevhen Maksymovych [3 days ago]
и в настройках проекта в идее какой по факту jdk?


Maksim K [3 days ago]
ну у меня везде и в найстройках так указано

Maksim K [3 days ago]
я так понимаю здесь в треде нельзя фото скинуть


Maksim K [3 days ago]
в общем везде у меня стоит 9.0.1. и в settings и в project structure

sky [3 days ago]
settings -> maven -> runner -> куда указывает jre, все там ок?

Maksim K [3 days ago]
Use Project Jdk (java version "9.0.1", path:D:/Program Files/Java/jdk-9.0.1


Maksim K [3 days ago]
но я там пробовал менял и на Use Internal Jre восьмой версии. Ну типа идеевской. Все равно ошибка

sky [3 days ago]
settings -> compiler -> java compiler? 
хотя я думаю уже будет проще переставить идею..  и винду.. даже если у тебя мак..

Maksim K [3 days ago]
@sky В общем произошло чудо)))
Заработало!!!

sky [3 days ago]
как починил то?

Maksim K [3 days ago]
меня @Yevhen Maksymovych натолкнул на мысль. Он сказал попробовать в помнике прописать версию  1.9. Но я правда решил не 1.9, а просто 9 поставить вместо 9.0.1. И о чудо. Заработало. Я х.з. почему мавену именно так надо было


Maksim K [3 days ago]
Но может у кого тоже будет похожая проблема и кому-то поможет)

Grigory Kislin [3 days ago]
нуда. ему надо стршую цифру

Grigory Kislin [3 days ago]
вообще у тебя с 9 еще будут проблемы

Maksim K [3 days ago]
типа пора на десятку переходить?))

Yevhen Maksymovych [3 days ago]
@Maksim K девятая же уже снята с поддержки, её даже с сайта не скачать


Yevhen Maksymovych [3 days ago]
если ты не корпорат с расширенной поддержкой

sky [3 days ago]
а не 11 следующая стецбл будет?

sky [3 days ago]
стейбл

Grigory Kislin [3 days ago]
11- да. 9 и 10- примерно одинаково. просто xml api надо будет подключить (edited)


Maksim K [3 days ago]
и кстати, насчет settings -> compiler -> java compiler?. Меня  это тоже натолкнуло в принципе на мысль. Там когда я вручную выбирал версию то высвечивалась просто 9. Потом когда делал в мавене реимпорт и заходил туда в настройки то там уже было 9.0.1. Ну наверно потому что у меня так было в помнике прописано и идея меняла автоматом при реимпорте. И вот тогда я и решил поставить просто 9. и заработало


Maksim K [3 days ago]
@Yevhen Maksymovych


Maksim K [3 days ago]
@Yevhen Maksymovych я наверно немного не в теме. в смысле снята с поддержки и с сайта не скачать. тут как я понял еще на восьмой люди сидят. да и вообще в действующих проектах тоже я так понимаю еще есть ниже 9 версии


Yevhen Maksymovych [3 days ago]
там начиная с девятой джавы оракл перешли на версию sts-lts

sky [3 days ago]
8 вместо 1.8 в помнике кстати прекрасно работает.

Yevhen Maksymovych [3 days ago]
т.е. есть версии long-time-support (это на текущий момент восьмая) и промежуточные short-time-support

Yevhen Maksymovych [3 days ago]
которые поддерживаются что-то около полугода


Maksim K [3 days ago]
ах вот оно что. и чем это чревато?


Yevhen Maksymovych [3 days ago]
поддержка девятой джавы уже прекращена, десятая до сентября будет обновляться. потом выйдет одиннадцатая, которую будут поддерживать минимум три года

Yevhen Maksymovych [3 days ago]
ну, т.е. версии с коротким саппортом - это по сути такие превью для разработчиков, которые хотят пощупать что-то новое

Maksim K [3 days ago]
и что вообще значит поддерживаются? может глупый вопрос)) зачем поддерживать? типа баги какие-то править?


Yevhen Maksymovych [3 days ago]
ну да, чего-то фиксится в самой jvm и в библиотеках. вот восьмой джавы на текущий момент уже 181-й билд вышел

Yevhen Maksymovych [3 days ago]
а девятой всего четыре было или что-то типа того

Yevhen Maksymovych [3 days ago]
т.е. прекращение поддержки означает, что если в ветке девятой джавы обнаружатся какие-то критические ошибки, с большой долей вероятности они уже исправляться не будут


Maksim K [3 days ago]
о блин. Спасибо за инфу. а я и не в курсе был). я на девятую зимой перешел. Ну думаю ща вроде говорят каждые полгода будет новая версия выходить. Думаю уже 9 вышла, скоро 10. а я еще как лох на 8-ой)) Думаю, надо в ногу со временем идти)) и скачал)


Maksim K [3 days ago]
я так понял надо сразу будет на 11 переходить)


Maksim K [3 days ago]
а ты на какой джаве?


Yevhen Maksymovych [3 days ago]
на 8-й, меня вполне устраивает :slightly_smiling_face:

sky [3 days ago]
а пользовался чем из 9ки?

Maksim K [3 days ago]
это типа ты меня так подколоть решил)))
я ж говорю просто решил идти в ногу со временем))

Maksim K [3 days ago]
я просто не в курсе ваще этой темы был. думаю 8 то уже давно вышла. типа устарела))

Maksim K [3 days ago]
ну вот теперь буду немного в курсе) это как не все йогурты одинаково полезны, так и не все новые джавы лучше старых, да?))


sky [3 days ago]
ну например Map.of() выглядет интересным

Maksim K [3 days ago]
и, кстати, вот еще вопрос. если  эти новые версии не собираются долго поддерживать, то зачем тогда их так часто выпускать. ну выпускали бы раз там в год или в два. и нормально поддерживали. А то я вот зимой только скачал 9 версию, а через полгода узнаю, что ее уже не поддерживают и вообще она проблемная


sky [3 days ago]
Здесь надо сначала понять, как оракл вообще зарабатывает на джаве


Maksim K [3 days ago]
то есть все оказалось гораздо прозаичнее. деньги и все?...и больше никакого смысла?


Maksim K [3 days ago]
а как он зарабатывает, кстати. типа всякие сертификаты? или это капля в море. я просто тоже не в курсе)


Yevhen Maksymovych [3 days ago]
вообще, вот эта модель на которую ораклы перешли - как по мне довольно спорна. я так понимаю, java начала терять в популярности как платформа, они решили несколько приоткрыть завесу над планами ее развития


Yevhen Maksymovych [3 days ago]
так-то java8 четыре года назад релизнулась


Prodigy [Jul 18th at 1:06 PM]
in #hw3
решил вместо мускуля использовать хваленый постгрес, и с некоторым разочарованием обнаружил что нету такого типа как DATETIME в постгресе, который например в мускуле хорошо работает с LocalDateTime... я так понимаю, что мне придется пользоваться TIMESTAMP и конвертить его? кто что думает об этом..



12 replies
e.pekhterev [3 days ago]
его и используем

Stanislav [3 days ago]
spring-jdbc За тебя все делает

Stanislav [3 days ago]
да и конвертация, 2 строчки кода (туда и обратно)...сложно....


realcorwin [3 days ago]
всё, что не знаешь - сложно :slightly_smiling_face:. просто - то, что знаешь :slightly_smiling_face:


Prodigy [3 days ago]
минус постгресу за многословность

Stanislav [3 days ago]
Timestamp.valueOf().toLocalDateTime()



Stanislav [3 days ago]
тоже не знал, 1 минуту назад, ctrl+лкм


Prodigy [3 days ago]
@Stanislav Благодарю):+1:


Merkulov [3 days ago]
я вообще ничего не конвертировал все и так работает


Stanislav [3 days ago]
я выше об этом написал: spring-jdbc За тебя все делает


Stanislav [3 days ago]
Просто показал как не сложно найти то что не знаешь


Prodigy [3 days ago]
да, я уже увидел, что есть методы конвертации из одного в другое... подумал сперва, что придется самому что-то писать для конвертации


Prodigy [Jul 18th at 5:55 PM]
in #hw3
Нужно исправлять неработающие тесты InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest ? или достаточно просто понять почему они не работают? (edited)


6 replies
tkorky [3 days ago]
для optional части надо будет исправить


Prodigy [3 days ago]
там вроде проблема в переносе моковской реализации


sky [3 days ago]
По сути wildcard **  в пути компонет скана, позволит просканить папку repository и в пакедже main и в пакедже test. Но если вернуть все как было будет проблема с ambiguity (edited)


Prodigy [3 days ago]
пути что в main что в test одинаковые, но тем не менее перенесенная моковская реализация в тест не видна... при запуске тестов он четко ссылается на отсутствующую реализацию в main ветке


sky [3 days ago]
дык в контексте теперь компонент скан указывает не на repository  а на repository.jdbc или вы не про это?


Prodigy [3 days ago]
пардон, всё верно... мы ж изменили пакет.... значит он должен видеть в обоих ветках реализации


Kirilo [Jul 18th at 6:27 PM]
in #hw3
Столкнулся с проблемой. Не выгружаются ресурсы при дебаге jdbc или при запуске. Если я разрываю принудительно соединение(красный квадрат), порт не освобождается и при следующем запуске пишет такое: "Error running 'topjava': Unable to open debugger port (127.0.0.1:49569): java.net.SocketException "socket closed"" (edited)


25 replies
Prodigy [3 days ago]
надо скинуть зависшие джава процессы


Kirilo [3 days ago]
2 java процесса с диспетчера не удалялись. Почистил path, перегрузил windows и заменил Tomcat(возможно в нем причина и была, тем более, что в переменных окружениях конкретная версия была указана ), пока работает


Prodigy [3 days ago]
обычно сообщение (Address localhost:1099 is already in use) означает, что висит процесс который держит порт 1099... можно или порт поменять или скинуть процесс.. лучше процесс скинуть)

Kirilo [3 days ago]
Порт менял, а потом снова такая же балалайка возникла. Причем уже не помогала замена порта


Kirilo [3 days ago]
Кстати, Idea на своей копии java работает?


Kirilo [3 days ago]
JetBrains\IntelliJ IDEA 2018.1.6\jre64\bin

Prodigy [3 days ago]
это ты в своем проекте сам выбираешь какой jdk использовать, или встроенный в идею или свой


Kirilo [3 days ago]
Настраивал, но заметил, что две работают

Prodigy [3 days ago]
ну одно дело ты в системе установил JRE, а другое дело когда ты в проекте указываешь с каким jdk работать


Kirilo [3 days ago]
подключил коннект к локальной базе и сразу появилась Java от Idea


Kirilo [3 days ago]
может так и должно быть? (edited)


Prodigy [3 days ago]
где джава появилась?... это вроде как две несвязанные вещи.. или я что-то не понимаю?

Prodigy [3 days ago]
какую джаву использоавть ты указываешь в настройках проекта


Kirilo [3 days ago]
то есть еще один процесс java.exe но уже от Idea (edited)


Kirilo [3 days ago]
JetBrains\IntelliJ IDEA 2018.1.6\jre64\bin

Kirilo [3 days ago]
с этой папки запускает исполняемый java.exe (edited)

Prodigy [3 days ago]
аа.... я думаю что это наверное процесс который обслуживает саму идею... всё таки идея написана на джаве)

Prodigy [3 days ago]
но это не точно)


Kirilo [3 days ago]
Но как-то странно, что она для запуска драйвера jdbc использует свою копию, а не ту, что я указал в проекте (edited)


Prodigy [3 days ago]
ну, вероятно разработчикам идеи лучше знать как правильно запускать твой драйвер))


Kirilo [3 days ago]
ага, это не костыль, а фича :slightly_smiling_face:

Prodigy [3 days ago]
на самом деле запуск твоего драйвера это задача всё-таки веб-сервера, а не твоего приложения

Kirilo [3 days ago]
Проблема осталась и заметил, что такой баг происходит, если нажимаю на верхней панеле. Когда внизу(панель Debug), то все ОК.


Grigory Kislin [3 days ago]
я обычно убиваю все java прцессы и все (edited)

Kirilo [3 days ago]
невозможно "убить" java процесс даже специальной програмкой от Microsoft. Проверил - это висит Tomcat 8.5.32 (edited)


Макс Куркудюк [9:21 PM]
Доброго вечора)


Макс Куркудюк [Jul 18th at 9:25 PM]
in #hw3
Дещо запізнився з виконанням завдання, тож лиш почав HW3...
Підкажіть, як у populateDB.sql в скрипті створення Meel ввести LocalDateTime? Тобто, як перевести її у Timestamp в запиті...


5 replies
Kirilo [3 days ago]
'2015-05-30 10:00:00'


Макс Куркудюк [3 days ago]
Дякую)


Макс Куркудюк [3 days ago]
Якраз, ще й щойно знайшов https://www.postgresql.org/docs/9.1/static/functions-datetime.html



Alexander Pilipenko [3 days ago]
Лучше не полагаться на то, что угадаешь формат и использовать ф-ию TO_TIMESTAMP (edited)


Kirilo [3 days ago]
мы же популируем всего один раз и то для теста


Tanya [9:28 PM]
віддаєш дату у відповідному форматі

stea1th [9:57 PM]
люди, у меня вопрос
чтобы нельзя было поменять чужую еду надо сделать так:


stea1th [Jul 18th at 9:57 PM]
in #hw3
"UPDATE meals SET datetime=:datetime," +
                       " description=:description, calories=:calories" +
                       " WHERE id=:id AND user_id=:userId "


31 replies
vch [3 days ago]
Походит на правильный запрос. А в чём проблема?


Maksim K [3 days ago]
ну там вроде как во всех методах надо учитывать user_id.


stea1th [3 days ago]
ну у меня изначально не было ющер айди

stea1th [3 days ago]
был просто id


stea1th [3 days ago]
а может кто знает почему важен порядок столбцов в индексах?


Maksim K [3 days ago]
ну тут как бы логично. ведь в методы во все приходи user_id. значит его надо учитывать) а то вдруг кто мою еду съест)


vch [3 days ago]
Вспомни эталонное решение в HW2 - вложенные Map. Тот же индекс по сути - userId, mealId.
Если тебе надо сначала фильтровать по mealId, то этот вложенный Map бесполезен и ускорения не даст


stea1th [3 days ago]
я сделал индекс по user-id и datetime

stea1th [3 days ago]
наверное неправильно?


stea1th [3 days ago]
CREATE UNIQUE INDEX meals_unique_datetime_user_idx ON meals (user_id, datetime);


vch [3 days ago]
если во всех запросах есть фильтр по userId - то индекс такой и надо - он будет использоваться в запросах.


stea1th [3 days ago]
все понятно теперь :slightly_smiling_face: спасибо огромное

Kirilo [3 days ago]
это все очевидно и понятно, я вот, долго тупил с индексом, оказывается он должен одинаково называться, как в юзерах, так и у еды, иначе получал null вместо индекса


stea1th [3 days ago]
это как?



stea1th [3 days ago]
я просто во многих вещах не шарю, поэтому громко не смейтесь :slightly_smiling_face:


Kirilo [3 days ago]
я назвал у еды mel_id вместо id и не мог понять, почему получаю null. А так, как у нас глобальный сиквенс и мы в еде ссылаемся на юзера, то получается, что ключи должны быть с одинаковыми названиями


Kirilo [3 days ago]
и вообще все запросы можно проверять в консоле


vch [3 days ago]
Ну то есть речь всё же не про названия индексов. Подозреваю, что 2 индекса с одинаковыми названиями не удастся создать.


Kirilo [3 days ago]
у нас еда и юзеры пересекаются индексами (edited)

Kirilo [3 days ago]
то есть по сути индексы у них из одного пула

stea1th [3 days ago]
наверно надо alias использовать?


Alexander Pilipenko [3 days ago]
Именно про это и говорилось в подсказках


Kirilo [3 days ago]
http://www.postgresqltutorial.com/
postgresqltutorial.com
PostgreSQL Tutorial - Learn PostgreSQL from Scratch
Learn PostgreSQL quickly through a practical PostgreSQL tutorial designed for database administrators and application developers.


stea1th [3 days ago]
аааа, проблема видимо у тебя в том была , что у нас есть супер класс AbstractBaseEntity

Kirilo [3 days ago]
не знаю. Я после того и сеттер поставил в мил


stea1th [3 days ago]
и если ты мил айди иначе назовешь, то ничего не получится


Kirilo [3 days ago]
ну, вот, это мне как-то не особо понятно было

stea1th [3 days ago]
это не в базе данных дело

stea1th [3 days ago]
а в нашей реализации

Alexander Pilipenko [3 days ago]
10: Напомню: BeanPropertyRowMapper работает через отражение. Ему нужны геттеры/сеттеры и имена полей должны "совпадать" с колонками ResultSet (Column values are mapped based on matching the column name as obtained from result set metadata to public setters for the corresponding properties. The names are matched either directly or by transforming a name separating the parts with underscores to the same name using "camel" case).



Kirilo [3 days ago]
теперь уже понятно стало, после проб и мучений, что поля и там, и там должны совпадать (edited)


stea1th [9:57 PM]
_
?


stea1th [Jul 18th at 10:22 PM]
in #hw3
товарищи, а кто нибудь понимает в тестах и может доступно обьяснить как ими пользоваться??


33 replies
Kirilo [3 days ago]
а что понимать?


Yevhen Maksymovych [3 days ago]
а в чем собсна проблема?


Kirilo [3 days ago]
сравниваешь два значения


Kirilo [3 days ago]
с одной тороны то, что должен получить, с другой стороны то, что реально получилось


Yevhen Maksymovych [3 days ago]
ты пишешь класс, в котором есть методы, которые в общем виде что-то делают, и возвращают значение. тесты нужны для того, чтобы убедиться, что возвращаемые значение соответствуют твоим ожиданиям

Yevhen Maksymovych [3 days ago]
по-хорошему метод может выполниться двумя способами - отработать корректно на корректные входные данные, и бросить эксепшн на некорректные. тебе надо проверять оба кейса :slightly_smiling_face:


Yevhen Maksymovych [3 days ago]
ну, это если на пальцах


stea1th [3 days ago]
а вот бы один примерчик

stea1th [3 days ago]
хотя погодите, может соображу сейчас сам

Yevhen Maksymovych [3 days ago]
там же в HW3 юзерсервис практически полностью покрыт тестами. я так понимаю, у тебя проблема с тем, что непонятно, на что должны быть тесты, а на что нет?

Kirilo [3 days ago]
там же в видео и в утильном классе юзера даже статические методы Григорий сделал, чтобы легче было понимать. (edited)


stea1th [3 days ago]
я наверное просто глупый... сейчас посижу, погляжу, попробую понять


Yevhen Maksymovych [3 days ago]
ну, в целом гляди, наверняка у тебя было такое, что ты пишешь какой-то кусок кода в классе, а потом, чтобы по-быстрому его проверить - в этом же классе городишь main, чтобы его запустить и протестить

stea1th [3 days ago]
да, было дело

stea1th [3 days ago]
вопрос


stea1th [3 days ago]
assertMatch(service.getAll(), ADMIN, newUser, USER);


stea1th [3 days ago]
зачем здесь передается вся эта команда юзеров?


Yevhen Maksymovych [3 days ago]
service.getAll() вернёт лист из всех юзеров в бд


Yevhen Maksymovych [3 days ago]
ADMIN, newUser, User склеятся в такой же лист, и этот ассёрт сравнит два этих листа

Yevhen Maksymovych [3 days ago]
погляди в классе юзер, там есть пара перегруженных методов, один сравнивает два листа, а второй лист и последовательность объектов


Yevhen Maksymovych [3 days ago]
точнее две итерабли


stea1th [3 days ago]
а USER и ADMIN у нас разве в базе?


stea1th [3 days ago]
public static final User USER = new User(USER_ID, "User", "user@yandex.ru", "password", Role.ROLE_USER);
   public static final User ADMIN = new User(ADMIN_ID, "Admin", "admin@gmail.com", "admin", Role.ROLE_ADMIN);


Yevhen Maksymovych [3 days ago]
да, там перед тестами запускается скрипт популирования, который заносит в бд пользователей

stea1th [3 days ago]
хорошо, а получается с едой мне надо тоже будет всю еду, что у нас уже есть заносить через MealTestData?


Yevhen Maksymovych [3 days ago]
эти два пользователя (юзер и админ) создаются эксплицитно, но с данными, аналогичными пользователям из бд, по логике тестов они должны быть полностью идентичны пользователям из бд


Yevhen Maksymovych [3 days ago]
не обязательно всю. ты сам решай сколько будет достаточно для тестов

stea1th [3 days ago]
ну а если мы сравниваем getAll() и в базе у меня допустим 6 meals?

stea1th [3 days ago]
из базы временно удалить некоторые?

Yevhen Maksymovych [3 days ago]
да, норм, можно и три оставить, чтобы проверить на листах, можешь все запулить


stea1th [3 days ago]
или на них на всех сделать обьекты?


Yevhen Maksymovych [3 days ago]
в целом, чисто логически минимально достаточное количество еды, чтобы проверить все кейсы - две единицы: одна корректного пользователя, и одна некорректного :slightly_smiling_face:


stea1th [3 days ago]
а можно увидеть ваших пользователей для более глубокого понимания?


Join_Selectovich [11:02 PM]
Подскажите пожалуйста :sos: может кто сталкивался 
при попытке вставить новое значение получаю Exception :


Join_Selectovich [Jul 18th at 11:02 PM]
in #hw3
SQL [INSERT INTO meals (id, localdatetime, description, calories, user_id) VALUES(?, ?, ?, ?, ?)ОШИБКА: нулевое значение в столбце "id" нарушает ограничение NOT NULL
 Detail: Ошибочная строка содержит (null, 2018-07-18 00:00:00, Завтрак, 1000, 100000).; nested exception is org.postgresql.util.PSQLException: ОШИБКА: нулевое значение в столбце "id" нарушает ограничение NOT NULL


32 replies
Join_Selectovich [3 days ago]
почему когда идет вставка с нулевой id не срабатывает sequnece (edited)


Yevhen Maksymovych [3 days ago]
на id в бд забыл повесить генератор


Yevhen Maksymovych [3 days ago]
покажи скрипт генерации таблицы


Join_Selectovich [3 days ago]
вешал (edited)

Join_Selectovich [3 days ago]
CREATE TABLE meals
(
 id            INTEGER PRIMARY KEY DEFAULT nextval('global_seq'),


Yevhen Maksymovych [3 days ago]
а вставляешь через SimpleJdbcInsert или руками?

Join_Selectovich [3 days ago]
через  insertMeal.execute(map)


Kirilo [3 days ago]
лучше сделать по аналогии с юзером

Join_Selectovich [3 days ago]
хм... попробую


Vitaly [3 days ago]
а если просто убрать поле id


Vitaly [3 days ago]
ты же повесил на него ограничение notnull, и тут же сохраняешь null в него

Vitaly [3 days ago]
мне кажется просто убрать его (edited)


Vitaly [3 days ago]
SQL [INSERT INTO meals (localdatetime, description, calories, user_id) VALUES(?, ?, ?, ?)

Join_Selectovich [3 days ago]
not null я не вешал на него

Join_Selectovich [3 days ago]
и убирать пробовал


Alexander Pilipenko [3 days ago]
Это первичный ключ


Join_Selectovich [3 days ago]
да

Alexander Pilipenko [3 days ago]
Он всегда нот нул

Join_Selectovich [3 days ago]
ну да

Alexander Pilipenko [3 days ago]
В коде указал usingGeneratedKeyColumns ?

Join_Selectovich [3 days ago]
так, что-то этот момент упустил (edited)

Join_Selectovich [3 days ago]
это где примерно? (edited)


Alexander Pilipenko [3 days ago]
this.insertMeal = new SimpleJdbcInsert(dataSource)
               .withTableName("meals")
               .usingGeneratedKeyColumns("id");



Join_Selectovich [3 days ago]
матка боска....



Join_Selectovich [3 days ago]
млин, я его специально убрал, думал когда в БД будет вставка с пустой айди триггернет sequence, так нет же :face_vomiting: (edited)

Yevhen Maksymovych [3 days ago]
не. дефолтное значение сработает, если ты просто не укажешь, что ты вставляешь это поле. а если ты принудительно указываешь что-то бд понимает, что у тебя, как у человека, больше прав чем у машины



Join_Selectovich [3 days ago]
там уже спринг вставлял с id


Join_Selectovich [3 days ago]
и пустой чтобы он не был как раз и нужно добавлять *.usingGeneratedKeyColumns("id");*

Join_Selectovich [3 days ago]
я так понял


Yevhen Maksymovych [3 days ago]
ну, в данном случае ты как раз декларативно указываешь, что ид будет заполняться генератором, а не тобой


Join_Selectovich [3 days ago]
спасибо всем кто откликнулся :+1:

Kirilo [3 days ago]
поля ты можешь помечать как ненулевые или/и с дефолтным значение, если не подаешь ничего (edited)


Join_Selectovich [Jul 18th at 11:40 PM]
in #hw3
и еще нэвэлички вопрос
при попытке прочитать еду получаю
java.lang.NullPointerException
    ru.javawebinar.topjava.model.Meal.getDate(Meal.java:40)


9 replies
Yevhen Maksymovych [3 days ago]
сэттеры сделал на поля мила?


Join_Selectovich [3 days ago]
я так понимаю что-то c rowMapper


Join_Selectovich [3 days ago]
делал


Join_Selectovich [3 days ago]
public void setDateTime(LocalDateTime dateTime) {
       this.dateTime = dateTime;
   }

   public void setDescription(String description) {
       this.description = description;
   }

   public void setCalories(int calories) {
       this.calories = calories;
   }


Yevhen Maksymovych [3 days ago]
тогда откуда getDate()? у тебя есть поле Meal.date?


Alexander Pilipenko [3 days ago]
Названия полей в таблице и классе одинаковые?
 


Join_Selectovich [3 days ago]
матка боска... ёмаё (edited)


Join_Selectovich [3 days ago]
@Alexander Pilipenko двойное спасибо тебе добрый человек (edited)


Alexander Pilipenko [3 days ago]
Пожалуйста :)


Grigory Kislin [1:17 AM]
----------------------------------------------------
*Welcome на 4е занятие: #hw4*
----------------------------------------------------


Jury Mironov [Jul 19th at 10:05 AM]
in #hw3
Такая ошибка вылезает. Не знаю как исправить - org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jbdcUserRepository' defined in class path resource [spring/spring-app.xml]: Instantiation of bean failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [ru.javawebinar.topjava.repository.jdbc.JdbcUserRepositoryImpl]: No default constructor found; nested exception is java.lang.NoSuchMethodException: ru.javawebinar.topjava.repository.jdbc.JdbcUserRepositoryImpl.<init>()


14 replies
Yevhen Maksymovych [2 days ago]
вообще, покажи гит. первым дело глаз цепляется за "j_BD_dcUserRepository"


Yevhen Maksymovych [2 days ago]
судя по всему не может его инстанцировать, просит дефолтный конструктор, но по идее это ему мешать не должно, если есть недефолтный, помеченный @Autowired (а он помечен?)


Jury Mironov [2 days ago]
https://github.com/mironoff2007/topjava14/blob/master/src/main/java/ru/javawebinar/topjava/repository/jdbc/JdbcUserRepositoryImpl.java
src/main/java/ru/javawebinar/topjava/repository/jdbc/JdbcUserRepositoryImpl.java
```package ru.javawebinar.topjava.repository.jdbc;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.support.DataAccessUtils;```
Show more…
mironoff2007/topjava14Added by GitHub


Yevhen Maksymovych [2 days ago]
гляди, ты инстанцируешь бины вручную в spring-app.xml


Yevhen Maksymovych [2 days ago]
соответственно, тебе надо указать всего его параметры конструктора

Yevhen Maksymovych [2 days ago]
либо указать, что бины должен инстанцировать спринг сам на основании аннотаций


Jury Mironov [2 days ago]
Ок, понял куда копать, спасибо. Я думал, если  @Autowired есть, он сам разберется. Вроде, компонент скан нужен чтобы сам, если я не ошибаюсь


Yevhen Maksymovych [2 days ago]
да, когда ты указываешь в xml component-scan, спринг загружает в свой контекст beanpostprocessor'ы, которые после предварительной загрузки инфы о бине, сами разбираются, как его собрать на основании аннотаций


Yevhen Maksymovych [2 days ago]
если не указал компонент-скан, спринг вообще не смотрит на аннотации. для него ты просто вызываешь дефолтный конструктор, который он пытается вызвать через отражение, и не находит


Yevhen Maksymovych [2 days ago]
надо что-то типа такого:

Yevhen Maksymovych [2 days ago]
    ```<bean class="ru.javawebinar.topjava.repository.jdbc.JdbcUserRepositoryImpl" id="jbdcUserRepository">
        <constructor-arg index="0" ref="dataSource" />
        <constructor-arg index="1" ref="jdbcTemplate" />
        <constructor-arg index="2" ref="namedJdbcTemplate" />
    </bean>```


Yevhen Maksymovych [2 days ago]
ну либо вернуть на место обработку аннотаций

Jury Mironov [2 days ago]
спасибо)

Yevhen Maksymovych [2 days ago]
:+1:


Prodigy [12:24 PM]
uploaded and commented on this image: test.jpg 

в тестах результат запроса возвращает null во всех полях, при этом сам запрос правильно отрабатывает.... непонятно в чем проблема.
Yevhen Maksymovych [12:25 PM]
сеттеры есть Meals?
Prodigy [12:29 PM]
в самой базе данные лежат правильные, не null
Prodigy [12:30 PM]
кстати да, сеттеров нету
Yevhen Maksymovych [12:31 PM]
:+1:
Prodigy [12:31 PM]
ты гений!)
Prodigy [12:32 PM]
в чем секрет?

Merkulov [12:32 PM]
тз нужно читать внимательнее)

Stanislav [12:32 PM]
Секрет во вдумчивом чтении и просмотре материалов которые тебе дают по курсу.

Yevhen Maksymovych [12:33 PM]
в пункте 3.3 домашки :slightly_smiling_face: >>>3.3. JbdcTemplate работает через сеттеры. Вместе с конструктором по умолчанию их нужно добавить в Meal
кстати, вот это реально тупая фигня

Stanislav [12:34 PM]
Или просто смотреть что в патчах меняется и смотреть примеры с тех же сорсов (в даНном случае *User*)

Yevhen Maksymovych [12:34 PM]
почему нет стандарта? кто-то работает через отражение и маппинг полей напрямую, кто-то через сеттеры
добавлять в класс кучу лишнего стандартного кода чисто для совместимости с другими фреймворками/либами - вообще не тру
все должно работать через AOP ))

Ignat [12:38 PM]
Потому что это Java, возраст сказывается. И обилие бойлерплейта по тойже причине.
Хочется красиво, это в котлин.

Prodigy [12:39 PM]
читал задание по диагонали... я даже не мог подумать что не будет сеттеров

Андрей [1:52 PM]
Можно свой RowMapper<Meal> заимплементить, тогда пустой конструктор и сеттеры не нужны.
    ```private final RowMapper<Meal> mapper = (rs, rowNum) -> new Meal(
            rs.getInt("id"),
            rs.getObject("date_time", LocalDateTime.class),
            rs.getString("description"),
            rs.getInt("calories"));```
Другое дело, что они все равно понадобятся для JPA.

Nikolay [4:42 PM]
jpa и через рефлекшн может работать, вроде


Yevhen Maksymovych [Jul 19th at 4:53 PM]
in #hw3
я больше скажу, у нас он через рефлекшн и работает. мы же указали AccessType.FIELD, он у нас и не будет сеттеры дёргать


4 replies
e.pekhterev [2 days ago]
чёт не понял, а где это мы указали?


Yevhen Maksymovych [2 days ago]
в четвертом уроке


Yevhen Maksymovych [2 days ago]
а, это же третьего тема


e.pekhterev [2 days ago]
то то я удивился, как раз сейчас ставлю патч 4_6_add_jpa.patch и увидел эту запись))


Victor [Jul 19th at 8:05 PM]
in #hw3
`public void get() throws Exception {`
почему мы в тестах объявляем, что метод бросает Exception , хотя он не бросает. И Idea отмечает их серым....


5 replies
shtramak [2 days ago]
Потому что идея так сама по умолчанию тесты генерит


shtramak [2 days ago]
В тестах ловить исключения не принято и неправильно, посему идея за нас сама об этом побеспокоилась прилепив этот  throw


Victor [2 days ago]
понятно, если есть Exception, но здесь тест не бросает, зачем пробрасывать? Идея потом сама отмечает warning.


shtramak [2 days ago]
Канешн можешь убрать... На скорость не повлияет


shtramak [2 days ago]
Тем более что у нас нигде чекеды не проскакивают


KaryNaiKo [Jul 19th at 9:08 PM]
in #hw3
как подключиться к серверу PostgreSQL? Выдает ошибку, что роль "PostgreSQL" не существует


3 replies
shtramak [2 days ago]
Зайди в pgAdmin и глянь там какие роли определены... Определи ту, которая нужна тебе с нужными креденшлами и все должно завестись (edited)


Grigory Kislin [2 days ago]
в уроке есть картинки


SergeyA [2 days ago]
Или создай нового юзера с паролем. у меня почему то из интерфейса не было кнопки задать пароль ((  
Пришлось использовать команду 
Alter USER "user" WITH password 'password'


stea1th [9:49 PM]
а кто мне подскажет, почему когда я делаю тест, то мне выкидывает ошибку java.lang.AssertionError: ?

stea1th [9:53 PM]
uploaded this image: Screenshot_2.png 


Yevhen Maksymovych [9:54 PM]
калории перепутаны в 100_006 и 100_005 (edited)

stea1th [9:54 PM]
эм..
а у нас же нету поля юзерайди?
точно блин

Grigory Kislin [9:55 PM]
если нет- то да, 100006 нетот:) (edited)

stea1th [9:56 PM]
а так прошло

Stanislav [9:57 PM]
Та же ошибка была, 2 часа лазил по сайту (AsserJ) в итоге внимательно посмотрел что каллории не правильные (т.к. с утилс скопипастил). Но за то, за эти 2 часа много узнал про AssertJ :)

stea1th [9:58 PM]
те же яйца


SergeyA [10:03 PM]
added this Plain Text snippet: Как правильно обращаться к папке "test"  из основных классов? 
Не могу разобраться: после патча у нас класс "UserTestData.java" перенесен в каталог тест:
/src/test/java/ru/javawebinar/topjava/UserTestData.java
тоже самое с классом InMemoryUserRepositoryImpl
и в итоге не видно эти классы из кода:
import ru.javawebinar.topjava.repository.mock.InMemoryUserRepositoryImpl;
а полный путь не работает : 
import src.test.java.ru.javawebinar.topjava.repository.mock.InMemoryUserRepositoryImpl;
как к ним обращаться?
Пробовал изменить пометку директории исходников в Идее: папку ".ru." сделать "unmarc as sources Root"
Но сразу исчезает папка test (( почему?
Collapse 

stea1th [10:29 PM]
вопрос
а в тестах можно использовать статические методы из проекта, которые не обозначены в MealTestData?
или не можно?


stea1th [Jul 19th at 10:56 PM]
in #hw3
а почему когда я тестирую методы по отдельности, то все в порядке, а когда запускаю все вместе, то у меня там некоторые методы желтым загораются?


3 replies
Victor [1 day ago]
а еще если запустишь все тесты сразу, через мавен, могут не пройти. Хотя отдельно по классам проходят.


stea1th [1 day ago]
а вопрос, как исправить инмеморитесты? куда смотреть?


Victor [1 day ago]
на конфиги спринга


stea1th [11:01 PM]
как сегодня здесь многолюдно однако


e.pekhterev [Jul 19th at 11:03 PM]
in #hw3
ты портишь тестовые данные из MealTestData, 99.999999%
подебаж по всем тестам, посмотри что происходит (edited)


1 reply
realcorwin [1 day ago]
слово "подебаж" замечательное. кажется, ему не хватает "ъ" в середине :slightly_smiling_face:
 

stea1th [11:04 PM]
похоже понял, что ты имел ввиду


stea1th [Jul 19th at 11:38 PM]
in #hw3
как исправить инмеморитесты? куда смотреть?


1 reply
Ma3stro [1 day ago]
Смотри эксепшн. Они не попадают в контекст спринга, поправь


Jury Mironov [10:41 AM]
uploaded this image: после патча add_junit  такая шняга, как это понимать? 


Jury Mironov [10:41 AM]
uploaded this image: Snap 2018-07-20 at 10.39.27.png 


Jury Mironov [10:42 AM]
Ты видишь пакеты?
нет
А они есть
:grin:


Jury Mironov [Yesterday at 10:58 AM]
in #hw3
Обновление maven не помогало. Потыркался, почистил, прошло. Странно, что не начинает что-то работать, пока не спросишь)


1 reply
SergeyA [11 hours ago]
а как прошло? у меня получилось только когда я классы из теста перенес обратно....


SergeyA [Yesterday at 5:53 PM]
in #hw3
@Grigory Kislin Я все еще пытаюсь понять материал 3го занятия. И не понимаю по использованию спринга: 
*Мы фактически его еще не используем?*  - мы сделали autowired и собрали контекст - но все что делаем - достаем контроллер оттуда, т.е. можно было просто занести в переменную синглтон класса "mealController" и без спринга?:
   @Override
   public void init(ServletConfig config) throws ServletException {
       super.init(config);
       springContext = new ClassPathXmlApplicationContext("spring/spring-app.xml");
      *mealController = springContext.getBean(MealRestController.class);*
   } (edited)


12 replies
Victor [18 hours ago]
это еще не конец, потом MVC подключается и security вроде... Учимся по шагам



Stanislav [18 hours ago]
Нельзя было просто занести в переменную синглтон. Перечитай что такое IoC и DI.


Stanislav [18 hours ago]
IoC и DI это уже много что.


SergeyA [18 hours ago]
Так много умного про injection of control написано, но к нашему проекту это не относится. никакой IoC не нужен. Просто заносим в переменную синглтон класса и далее юзаем из него все остальное )


Stanislav [18 hours ago]
:man-facepalming:


SergeyA [18 hours ago]
Спринг тут не нужен!  Я хочу получить подтверждение Григория этому (мол он дальше будет юзаться), иначе я просто не понимаю зачем его прикрутили? (edited)


SergeyA [18 hours ago]
Мне просто лень переписывать классы чтобы доказать это :slightly_smiling_face:


Alexander Pilipenko [18 hours ago]
попробуй написать так чтобы репозиторий подключался в runtime


SergeyA [17 hours ago]
Не понимаю в чем проблема при вызове сервлета - ленивая инициализация синглтонов по цепочке (так же как мы автопривязывались для спринг контекста - только  без спринга, созданием инстансов классов).
Разве не будет работать?
- или спрошу по другому - вы хотите сказать что без спринга сделать на яве 3 странички нашей программы невозможно?


Alexander Pilipenko [17 hours ago]
Мы хотим сказать, чьто ты пытаешься переписать Spring :slightly_smiling_face:



Grigory Kislin [16 hours ago]
@SergeyA материалы 3го занятия- начинаем изучать Spring и смотреть, как его применять.  В данном контексте он необходим:) а new можно сделать без Spring, это точно. (edited)


SergeyA [16 hours ago]
@Grigory Kislin Спасибо за пояснение!


Stanislav [6:05 PM]
uploaded this image: SpringCore.png 


SergeyA [8:05 PM]
uploaded and commented on this image: Скриншот 2018-07-22 21.55.12.png 

@Grigory Kislin еще вопрос:  пересматриваю видео про тестирование (3_04_Junit.mp4) - и непонятно совсем!  на скриншоте приложил что структура каталогов и класса не сходится совсем ((
Grigory Kislin [8:13 PM]
спасибо, добавил в урок: переименовал тестовые классы
вообще в проекте есть изменения (об этом есть в первом уроке). Некоторые совсем очевидные
SergeyA [8:29 PM]
Ок. Только не подумай что я  придираюсь - просто когда смотрю урок и пытаюсь параллельно смотреть на код проекта - ничего не могу понять местами :slightly_smiling_face:

Grigory Kislin [8:44 PM]
надо смотреть на суть, а не форму.. ведь от переименования класса она не изменилась


SergeyA [21 hours ago]
@Grigory Kislin - в идеале предлагаю писать по каждому устаревшему видео: класс ххх переименован в ууу. Коротко и ясно куда смотреть. Иначе все неочевидно, тратится много времени на поиски нужно класса по его содержимому... в общем хочу чистого кода  от описания уроков! ) (edited)


Grigory Kislin [21 hours ago]
те переименовал классы тестов недостаточно?


Mihail Kedel [Yesterday at 1:16 PM]
забыл написать в sql запросе звёздочку = 2 дня мучений)) (edited)



1 reply
SergeyA [21 hours ago]
select * - тут?
