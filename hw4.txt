Grigory Kislin [1:03 AM]
joined #hw4.

Grigory Kislin [1:07 AM]
Добро пожаловать на знятие https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson04.md
Популирование данных через Spring, JPA/Hibernate, HSQLDB. 
Материалов по JPA огромное количество. Чтобы не утонуть - не надо пытаться освоить все сразу. Пока достаточно того, что нужно для выполнения HW4
После выполнения этого достаточно несложного HW4 можно *приступать к выполнению выпускного  проекта* (внизу занятия)
канал для общения #graduation (edited)

Prodigy [1:13 AM]
joined #hw4.

Grigory Kislin [1:18 AM]
Миграцию на JUnit 5 будем делать после освоения JUnit 4 (он сейчас самый распространенный) на 7м занятии

Daniel [1:19 AM]
joined #hw4 along with 17 others.


Stanislav [Jul 19th at 12:43 PM]
in #hw4
По цикломатической сложности, не очень понял. Получается что для *codacy.com* в *MealRestController* метод *getBetween*, 4 if-ов много? Если без формул, принцип, мало кода = мало ветвлений (if), много кода = можно чуть больше ветвлений? (edited)


1 reply
Grigory Kislin [2 days ago]
Посмотри по ссылке, что такое цикломатическая сложности. 4 if означает 16 вариантов прохождения по коду


realcorwin [1:21 PM]
по большому счёту, всем пофиг. пиши просто и понятно. и не трать время на муть :slightly_smiling_face:

Merkulov [1:27 PM]
не всем)
кстати, очень хороший инструмент для объективного анализа своего кода


stea1th [Jul 19th at 3:11 PM]
in #hw4
а чего на почту урок4 не пришел?


5 replies
e.pekhterev [2 days ago]
ахах) давай еще попросим письмо с анонсом прихода письма для каждого урока за неделю до и за день до))) (edited)


Егорро [2 days ago]
@e.pekhterev ох-ох. На дальнейший бессвязный набор слов отвечать не стану, уж извини - не владею языком. По теме - что такого якобы развеселого в том, что многим удобно получать уведомления именно на почту, как это и *было* со всеми предыдущими уроками? (edited)


Grigory Kislin [2 days ago]
Письмо будет вечером (свет отключили)



e.pekhterev [2 days ago]
@Grigory Kislin удобно, так удобно, воздержусь в следующий раз от бессвязных наборов)
просто была четкая договоренность - уроки появляются каждый четверг, собсвтенно идём утром в слак и подключаем новый канал. (edited)


Grigory Kislin [2 days ago]
> воздержусь в следующий раз от бессвязных наборов)


tim [5:39 PM]
Со всеми этими упрощалками по типу Хибернет, превращаешься из писателя кода в читателя доков...


realcorwin [Jul 19th at 5:56 PM]
in #hw4
понаделали, понимаешь, мерседесов... то ли дело на ишаке :slightly_smiling_face:... но по сути я согласен. хотя так было всегда: я ещё лет 25 назад называл себя алгоритмистом, а не программистом, потому что написать программу на условном языке мне было легко, а разбираться, какие конкретно команды и как делают то, что нужно, меня всегда выбешивало :slightly_smiling_face: (edited)


2 replies
SergeyA [2 days ago]
Так у тебя талант аналитика значит :slightly_smiling_face:
У меня вот наоборот - всегда нравилось на ассемблере zx-spectrum сделать что то удивительное, то что считается невозможным выполнить на таком компьютере. Т.е.как то хитро и нестандартно использовать команды, а учить паттерны сейчас прямо так не хочется...


realcorwin [1 day ago]
верно, аналитик я хороший :slightly_smiling_face:... а патерны, зачем их учить? бросай это гиблое дело :slightly_smiling_face:


realcorwin [5:58 PM]
я в 90-х апплеты писал. почти 20 лет потом меня от Явы воротило :slightly_smiling_face:
майкрософтовская ява ещё худо бедно работала, а в сановской не работало почти вообще ничего, из того чт одекларировалось в документации :slightly_smiling_face:


e.pekhterev [Jul 19th at 6:11 PM]
in #hw4
@Tanya @Katherine @Grigory Kislin почему связь тамблиц users и user_roles - один к многим, а не многие к многим?
у юзера может быть несколько ролей - Окей;
одна и та же роль может быть у многих юзеров


13 replies
Yevhen Maksymovych [2 days ago]
Роль не энтитя


e.pekhterev [2 days ago]
я сейчас не с точки зрения нашего приложения смотрю, а когда мы смотрим таблички в базу. 
а в базе user_roles - это сущность


Yevhen Maksymovych [2 days ago]
В базе это тоже не сущность


e.pekhterev [2 days ago]
или тут смысл в том, что у конкретной роли нет id?


Yevhen Maksymovych [2 days ago]
Роль в нашем воплощении - простое значение, точнее, набор простых значений, который хранится в связанной таблице. Хочешь иметь возможность манипулировать ролью как сущностью - ок, ты сам себе архитектор, делай из неё энтитю, сторь в отдельную таблицу и делай связь ManyToMany


e.pekhterev [2 days ago]
спасибо, будем копать

sky [2 days ago]
а ManyToMany разве не моветон требующий нормализации?


Alexander Pilipenko [2 days ago]
Нет. Не маветон. Часто встречается

Alexander Pilipenko [2 days ago]
Но не в этом случае.


Alexander Pilipenko [2 days ago]
По сути у  пользователя есть роли. Но у роли не может быть пользователей.


e.pekhterev [2 days ago]
ну вот похоже меня больше интересовало, почему мы не сделали все же энтити для ролей и связь многие к многим


Alexander Pilipenko [2 days ago]
Все написанное мной не совсем верно. Точнее совсем не верно.

Grigory Kislin [2 days ago]
можно хранить роли не как значения enum а как ordinal (0 и 1)- есть свои + и -.
попробуй сделать табличку многие ко многим (просто на уровне базы, маппинг не нужен) и сравни что будет лучше (edited)


e.pekhterev [Jul 19th at 7:04 PM]
in #hw4
в *JpaUserRepositoryImpl* до патча Apply 4_7_add_named_query_and_transaction.patch
public boolean delete(int id) {
      Query query = em.createQuery(" *DELETE FROM User u WHERE u.id=:id* ");
      return query.setParameter("id", id).executeUpdate() != 0;
  }

Всё ли тут правильно? (я про запрос *DELETE FROM User...*) (edited)


2 replies
sky [2 days ago]
дык hql запрос вроде как, в чем проблем (edited)


e.pekhterev [2 days ago]
)))) шоб я знал, что это, будем посмотреть)


Jury Mironov [Jul 19th at 8:44 PM]
in #hw4
Писец,  я заколебался.  Третий раз проект с 0 собираю,  накатываю все патчи,  вечно что-то ломается и не деплоится.


22 replies
Stanislav [2 days ago]
С 0 задания как создал, ни разу ни одной проблемы не было, при том, что я постоянно эксперементирую (с гитом, патчами). Что я делаю не так?


Stanislav [2 days ago]
И у меня 4 idea-и открыто одновремено (разные проекты).


Stanislav [2 days ago]
Это к тому, не в проекте дело. Стоит пересмотреть свои действия-подход.


Jury Mironov [2 days ago]
Ну а какие тут действия?  Apply patch по порядку?  Ну и мавен реимпорт.  Буду дома на ноуте или компе пробовать, на планшете задрало это делать


Stanislav [2 days ago]
Не совсем, перед тем как аплай патч, прочитать, может перед принятием надо что-то сделать (бывает что папку какую нибудь создать).


Stanislav [2 days ago]
Многие "запарывали" (хотя откат сделать не сложно и лучше сейчас потренироваться, чем потом на реальной работе) комитами hw в мастер.


Stanislav [2 days ago]
Кстати, мавен реимпорт делал всего 1 раз


Stanislav [2 days ago]
Иногда чистил кэш и перезагрузка


Stanislav [2 days ago]
Лучше 1 раз разобраться в чем причина и устранить, чем постояно с 0 собирать.


Stanislav [2 days ago]
+к обучению, а с 0 собирать ни чему не научишься.


Victor [2 days ago]
у меня тоже накатывается. Ну иногда запорю, ветку master комментами испорчу. Но ведь hard reset работает. Григорий все по сути объясняет. Думаю стоит видео его пересмотреть тебе :slightly_smiling_face:


e.pekhterev [2 days ago]
мавен реимпорт не делал ни разу, всё патчится с нуля до сего задания без каких либо проблем


e.pekhterev [2 days ago]
после патча до коммита желательно всё проверить и всегда если чего не так можно спокойно ctrl+Z понажимать и патч уйдет (ну если вдруг порядок патчей неправильный или папка не была создана)


Grigory Kislin [2 days ago]
@Jury Mironov а в реальном проекте еще и последствия немалые за поломку будут


Stanislav [2 days ago]
Аха, типа такого :)  https://habr.com/company/flant/blog/330750/ (edited)



Jury Mironov [2 days ago]
Оно само ломается,  ахах).  Не знаю,  хрень какая-то.  Накатил патчи до HW2, проверил - meals таблицу вывел,  накатил до HW3, сломалось, достал ревмзию HW2 - ошибка 404 при выборе списка meal


Yevhen Maksymovych [2 days ago]
ну так-то оно и должно ломаться, там суть домашек - чинить то, что сломалось, и доделывать то, что не доделали в уроке


Jury Mironov [2 days ago]
Так раньше не ломалось,  буду разбираться.  Причем каждый раз новые проблемы). Статью прочитал,  жалко парня.  Но имхо должно быть сделано так,  чтобы при желании нельзя было накосячить.  Я в сфере авиации работаю,  у нас близко могут не поставить разные  болты,  даже если по расчету проходят,  чтобы тупо не перепутали при сборке. А увлекаюсь я вертолетами ралиоуправляемыми.  Вот если у тебя разъемы сделаны так,  что можно что-то перепутать,  то 100% рано или поздно замкнешь аккумулятор или спалишь еще что-то.  А аккумуляторы там машину завести могут, так что фейерверк и кучка кирпичей обеспечены)


e.pekhterev [2 days ago]
всё откладываю, а надо бы давно уже с гитом по серьезнее разобраться


Kirilo [1 day ago]
Это называется нужно правильно работь с инструментом контроля версий и искать причину. То есть у нас обучение многостороннее и это его элемент. (edited)


Михаил [1 day ago]
А не бывает сообщения "Maven projects need to be imported" в правом нижнем углу? (edited)


Михаил [1 day ago]
Ну и перед каждым коммитом можно просто делать архив папки проекта на всякий случай, чтобы с самого начала не начинать, git-овский репозиторий же внутри этой же папки хранится, проект Идеи тоже. (edited)


matrocob [Jul 19th at 10:35 PM]
in #hw4
Подскажите пожалуйста в методе save класса JpaMealRepositoryImpl надо проверять юзера если еда не новая или можно сразу else em.merge? (edited)


33 replies
matrocob [1 day ago]
И еще вопрос, почему нельзя сразу сделать метод
  public Meal save(Meal meal, User user) ?
Из-за того, что другие классы поплывут?


Prodigy [1 day ago]
желательно для новых сущностей использовать persist


matrocob [1 day ago]
не, это не тот ответ, как сохранить я уже понял, это легко, а вопрос в том, как правильно обновить?


matrocob [1 day ago]
все, до меня дошло, как четко обновить пользоватея!))


Prodigy [1 day ago]
и как?)


e.pekhterev [1 day ago]
ещё пока не дошел, но судя по предыдущим реализациям нужно проверять, ничего не должно изменяться, если еда не принадлежит авторизованному пользователю (edited)


matrocob [1 day ago]
блин, пипец с товарищем спорим, как думаете, вот такой вариант? 
else if (meal.getUser().getId() == userId) {
           return em.merge(meal);
       }
Просто он пишет - нельзя сравнивать входящие данные с входящими


Prodigy [1 day ago]
ну там вроде все проще: сначала проверяем новый мил или нет, если нет, то мержим

Prodigy [1 day ago]
я имею ввиду что так не очень красиво проверять юзера

Prodigy [1 day ago]
можно в try-catch засунуть мерж... тогда проверку можно не делать


Prodigy [1 day ago]
но я бы так не делал)


matrocob [1 day ago]
ты получается не проверяешь залогиненного юзера? а просто даешь на откуп метод udpate всем пользователям?))


matrocob [1 day ago]
типо "та вроде должен норм сработать метод merge" без всяких проверок))

Prodigy [1 day ago]
если мил не новый, значит ты его вытянул ранее, значит ты уже знаешь юзера.... и просто делаешь мердж уже существующей сущности


Prodigy [1 day ago]
зачем проверки еще


Prodigy [1 day ago]
в примере выше ты проверяешь по сути одного и того же юзера


Prodigy [1 day ago]
ты вытянул мил из базы по залогиненому юзеру, а потом ты эти два одинаковый айди юзера сравниваешь (edited)


matrocob [1 day ago]
если еда пришла - не новая, значит ее кто-то добавил, а этот кто-то User... а userId - это залогиненный наш пользователь. Теперь мы должны сравнить, Юзера, который добавил саму эту еду и Залогиненного юзера.. если id у этих пользователей разный то хренушки чувак тебе а не апдейт еды.
если с id злоумышленник может попасть в какую-то еду то это норм?
Как думаешь в если проект был связан с банковской системой, ты бы все равно не стал проверять id залогиненного пользователя? 
Извини может я конечно заморачиваюсь, я не хочу доказать тебе или другому что надо именно проверять, наоборот меня неплохо было бы убедить =D


Prodigy [1 day ago]
т.е. ты полагаешь, что какойто юзер смог получить чужую еду, изменить ее и попытаться сохранить в базу?)

Prodigy [1 day ago]
тут вопрос открытый: КАК он может получить чужую еду)

Stanislav [1 day ago]
Легко

Prodigy [1 day ago]
чтобы получить чужую еду, ему нужно иметь id другого юзера


Stanislav [1 day ago]
если ты задаешь такие вопросы, то тебе надо почитать что такое Rest сервисы (мы это с 1 урока изучаем)


Stanislav [1 day ago]
http://localhost:8080/topjava/meals?action=update&id=100006 (ставь любой id)

Stanislav [1 day ago]
то же и с постом

Prodigy [1 day ago]
это у нас сейчас id юзера шестизначное число, а когда будет спринг-секурити например, там будут хеши, если я не ошибаюсь....


Prodigy [1 day ago]
так просто уже не поставишь любой айди


Prodigy [1 day ago]
ну хотя это зависит от реализации, не буду спорить, не уверен

Stanislav [1 day ago]
То что будет потом, будет потом. Сейчас обсуждаем то что сейчас.


Prodigy [1 day ago]
ну тогда вероятно нужно делать доп проверку на соответсвие юзера

Grigory Kislin [1 day ago]
@Prodigy да, проверку делать. об этом в ДЗ сказано много раз (в том числе и как очень просто отправить запрос на обновление чужой еды). при авторизации будут теже самые id еды


Prodigy [7 hours ago]
так на какой реализации остановился при проверке user_id?


Prodigy [7 hours ago]
рассматриваю такой вариант в начале метода save:
if(meal.getUser().getId() != userId){
           return null;
       }


Joanna [Yesterday at 12:16 AM]
in #hw4
скажите пожалуйста, после наката 4_1_HW3_Optional.patch в тестовом классе InMemoryAdminRestControllerSpringTest "repository" ище не внедрен в контекст. У Вас так тоже? (типа задумано переключаться между repository.jdbc в spring-app.xml) ?


8 replies
Victor [1 day ago]
у меня `@ContextConfiguration("classpath:spring/spring-app.xml")` в InMemoryAdminRestControllerSpringTest на этом патче (edited)


Victor [1 day ago]
в spring-app.xml у меня `<context:component-scan base-package="ru.javawebinar.**.repository.jdbc"/>`


Victor [1 day ago]
то есть внедрен jdbc пакет репозитария

Joanna [1 day ago]
да, тоже так, но тогда repository подчеркнут красным, а чтоб не был и тесты отработали надо  просто закоментить .jdbc. А чтоб MealServiceTest отработал - обратно ".jdbc" в xml. Я просто когда домашку делала, в test/reporitory создавала отдельный xml для in-memory тестов


Victor [1 day ago]
все так :slightly_smiling_face:


Joanna [1 day ago]
ну лан, если у тя так, тогда я поехала дальше, спс


Victor [1 day ago]
я даже не задумался )))


Joanna [1 day ago]
Спкйнч :sleeping_accommodation:


Yevhen Maksymovych [9:44 AM]
Ребят, кто-нибудь может пояснить по зависимости org.glassfish:javax-el? (edited)
я вижу ссылку, что у hibernate-validator'а нет встроенной реализации проверки, он опирается только на апи, но диаграмма зависимостей этого не подтверждает

Yevhen Maksymovych [9:45 AM]
uploaded this image: image.png 


Yevhen Maksymovych [9:45 AM]
в ней hibernate-validator чихать хотел на javax.el


Yevhen Maksymovych [Yesterday at 9:46 AM]
in #hw4
validation-api отдельно, javax.el отдельно. или там validation-api сам каким-то хитрым образом находит в класспасе свои реализации? (edited)


1 reply
Grigory Kislin [1 day ago]
в уроке есть ссылка, что хибернейту он нужен
http://hibernate.org/validator/documentation/getting-started/#unified-expression-language-el
как он инстанцииируется- не в курсе, можешь подебажить. например в конструктор брекпойнт поставь


e.pekhterev [Yesterday at 10:55 AM]
in #hw4
как прицепиться к базе HSQLDB ? в выборе при создании подключения к базе нет embedded, только local и remote?


11 replies
Stanislav [1 day ago]
Из другого моего проекта
     ```<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="#{dbH2Props['driverClassName']}"/>
        <property name="url" value="#{dbH2Props['url']}"/>
        <property name="username" value="#{dbH2Props['username']}"/>
        <property name="password" value="#{dbH2Props['password']}"/>
    </bean>```


Stanislav [1 day ago]
Проперти
 ```driverClassName           = org.h2.Driver
url                       = jdbc:h2:file:./db_logs
username                  =
password                  =
hibernate.dialect         = org.hibernate.dialect.H2Dialect
hibernate.hbm2ddl.auto    = update
hibernate.show_sql        = true
hibernate.max_fetch_depth = 3
hibernate.jdbc.fetch_size = 50
hibernate.jdbc.batch_size = 10``` 


Stanislav [1 day ago]
     ```<bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="packagesToScan" value="kz.shop.model"/>
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter" />
        </property>
        <property name="jpaProperties" ref="dbH2Props"/>```


Stanislav [1 day ago]
1. Драйвер 2. Диалект 3. Проперти ну и для встроенной базы пул конектов (например через с3по) нет смысла указывать


e.pekhterev [1 day ago]
спасибо, попробую разобраться


sky [1 day ago]
А чем local не устраивает?


e.pekhterev [1 day ago]
всё устраивает, только в видео другая версия идеи и немного всё по другому выглядит, сейчас уже разобрался


e.pekhterev [1 day ago]
и думал, что всё же должна быть база инМемори, а не в файле, немного запутался в инструкциях в видео


Stanislav [1 day ago]
Не правильно тебе написал. Не так понял вопрос :slightly_smiling_face: Я так понял ты хотел ЕнтитиМенеджер настроить на эмбэдед базу...


Stanislav [1 day ago]
А ты про выбор в idea что бы в запросах он энтити красным не подчеркивал


e.pekhterev [1 day ago]
я про инструкции в видео *_6. Добавляем поддержку HSQLDB_* о подключении к базе данных HSQLDB embedded после запуска тестов сервиса юзеров. 
Со всем разобрался (в видео просто старая версия Идеи и было не совсем понятно, что делать в новой, плюс упустил момент переключения базы на файловый режим, думал, что она должно быть в мемори)


Jury Mironov [Yesterday at 11:25 AM]
in #hw4
на Prepare_to_HW4 после всех патчей проект должен деплоиться без ошибок?


10 replies
Stanislav [1 day ago]
на 4_5 будет собираться


Stanislav [1 day ago]
4_5_create_mock_test_ctx.patch


Jury Mironov [1 day ago]
а у меня не хочет


Stanislav [1 day ago]
на каком патче


Stanislav [1 day ago]
Version Control -> Log сфотай


Jury Mironov [1 day ago]
я достал ревизию 4_5


Jury Mironov [1 day ago]
помогло maven clean install


Daniel [1 day ago]
@Jury Mironov так у тебя деплоится после всех патчей? у меня такую штуку выбрасывает *javax/xml/bind/JAXBException* (edited)


Jury Mironov [1 day ago]
деплоится , но при выборе user  или meal nullpointerException


Daniel [1 day ago]
Все, я одну dependency добавил, и тоже задеплоилось.


Jury Mironov [11:40 AM]
uploaded this image: Как это поправить кто-нибудь знает? 

Prodigy [11:46 AM]
а как объявлен entityManagerFactory ?
Jury Mironov [11:48 AM]
а где он объявляется?

Yevhen Maksymovych [11:48 AM]
там же, в spring-db.xml

Prodigy [11:49 AM]
commented on Jury Mironov’s file Как это поправить кто-нибудь знает?
выше,  том же файле
Jury Mironov [11:49 AM]
<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"
         p:dataSource-ref="dataSource"
         p:packagesToScan="ru.javawebinar.**.model">
       <!--p:persistenceUnitName="persistenceUnit">-->
Prodigy [11:51 AM]
вроде всё верно
Prodigy [11:52 AM]
после накатки патчей такое?

Jury Mironov [11:53 AM]
ага

Prodigy [11:54 AM]
похоже на глюк идеи... у меня тоже такие проблемы бывают, после накатки патчей

Yevhen Maksymovych [11:55 AM]
commented on Jury Mironov’s file Как это поправить кто-нибудь знает?
попробуй сделать мавен клин и реимпорт. и проверь, что у тебя указана версия спринга, ну, мало ли, вдруг подтянулась какая-то старая реализация этого менеджерфакторибина, который не имплементирует нужный интерфейс


Prodigy [Yesterday at 11:58 AM]
in #hw4
В видео к этому уроку вижу NamedQuery, а по факту мы не будем использовать уже такую реализацию?


2 replies
Yevhen Maksymovych [1 day ago]
почему? будем


Prodigy [1 day ago]
аа.. сорри... еще не дошел до этого патча


Jury Mironov [12:00 PM]
commented on Как это поправить кто-нибудь знает?
перезапустил идею, прошло)

realcorwin [12:39 PM]
семь бед - один reset :slightly_smiling_face:

Prodigy [12:41 PM]
@Grigory Kislin Посмотрел видео данного урока и возник вопрос: почему в проекте транзакционность вынесена на слой репозитория, почему не на слой сервиса? по своему скромному опыту могу сказать, что удобнее транзакциями пользоваться на слое сервисов, потому как бизнес логика реализуется обычно на слое сервисов, и бывает что нужно делать несколько операций в транзакции, что неудобно, когда транзакционность на слое репозитория. Интересны мысли по этому поводу.


Grigory Kislin [Yesterday at 2:02 PM]
in #hw4
@Prodigy когда будем использовать в логике сервиса несколько запросов, то будем объявлять транзакции на сервисе. они по умолчанию Propagation.REQUIRED- поддерживают существующую
а в репозитории удобно, тк не надо об этом думать в сервисах- так сделано в spring-data-jpa (edited)


2 replies
Prodigy [1 day ago]
т.е. у нас и в слое сервисов и в слое репозитория будут транзакции? нет ли тут избыточности?


Prodigy [1 day ago]
или это нормально?


Gagarina6794 [Yesterday at 2:08 PM]
in #hw4
@Entity
@Table(name = "users", uniqueConstraints = {@UniqueConstraint(columnNames = "email", name = "users_unique_email_idx")})   у кого была проблема, поле нейм красным и не понимает его идея, так все нормально, вот это поле в юзер и еще в JpaUserRepositoryImpl  em.createNamedQuery(User.BY_EMAIL, User.class) тоже красное (edited)


13 replies
Stanislav [1 day ago]
У всех была, необходимо в настройках проекта в фасете добавить JPA (в видео есть).


Gagarina6794 [1 day ago]
добавила и передовавила, все есть, бины есть и персистент тоже


Gagarina6794 [1 day ago]
только эти поля а так по всему проэкту норм

Yevhen Maksymovych [1 day ago]
а какой именно нейм не канает? из @Table или из @UniqueConstraint?


e.pekhterev [1 day ago]
@Gagarina6794 наведи на строку em.createNamedQuery(User.BY_EMAIL, User.class)и напиши сюда, что он там пишет (что не может создать энититиМенеджера)


e.pekhterev [1 day ago]
@Yevhen Maksymovych в юзере пишет, что не может резолвить этот name, а в репозитории - не может создать энтити менеджер)


e.pekhterev [1 day ago]
чёт там Хибернейту похоже совсем не хорошо

Yevhen Maksymovych [1 day ago]
не, я к тому, что там два нейма - возможно просто аннотация не из нужной либы импортнулась

Gagarina6794 [1 day ago]
createNamedQuery
(String)
in EntityManager cannot be applied
to
(String,
java.lang.Class<ru.javawebinar.topjava.model.User>)


Gagarina6794 [1 day ago]
@Override
   public User getByEmail(String email) {
       List<User> users = em.createNamedQuery(User.BY_EMAIL, User.class)
               .setParameter(1, email)
               .getResultList();
       return DataAccessUtils.singleResult(users);
   }


Yevhen Maksymovych [1 day ago]
покажи гит, короче


Gagarina6794 [1 day ago]
ну пока потробую перезапустить патчи, а то после гита вообще все полохо станет


Gagarina6794 [1 day ago]
решила, там по невнимательности добавила автоматом jpaee.jar, надо было через мавен


e.pekhterev [Yesterday at 2:48 PM]
in #hw4
в Meal.java  должна остаться ленивая инициализация по итогу?
@ManyToOne(fetch = FetchType.LAZY)
private User user;


39 replies
Prodigy [1 day ago]
думаю это будет зависеть от того нужен будет тебе юзер или нет... вроде в видео Григорий говорил что не нужен будет


e.pekhterev [1 day ago]
ну нам же нужно user_id брать


Prodigy [1 day ago]
если на вэбе нужно брать user_id, то LAZY не подойдет


Prodigy [1 day ago]
внутри транзакции достаточно LAZY

e.pekhterev [1 day ago]
сервис тест потом ругается, что не может создать прокси

e.pekhterev [1 day ago]
org.hibernate.LazyInitializationException: could not initialize proxy [ru.javawebinar.topjava.model.User#100000] - no Session


Prodigy [1 day ago]
потому что он обращается к юзеру когда сессия уже завершена


Prodigy [1 day ago]
соответствнно прокси уже нету


Prodigy [1 day ago]
ну поставь EAGER

e.pekhterev [1 day ago]
ахах)) так кто-нибудь сделал так, чтобы была LAZY инициалиация и тесты сервиса при этом работали нормально? (edited)

Prodigy [1 day ago]
можно, если обернуть твои тесты транзакциями))

alexey [1 day ago]
я исключил user из тестирования:wink:


Yevhen Maksymovych [1 day ago]
>>если на вэбе нужно брать user_id, то LAZY не подойдет


Yevhen Maksymovych [1 day ago]
почему не подойдёт?

Prodigy [1 day ago]
потому что LAZY сущность будет доступна только внутри транзакции... а следовательно на веб улетит null

Yevhen Maksymovych [1 day ago]
если нам айдишник только нужен, обёртки с головой хватит-то

Prodigy [1 day ago]
под оберткой ты подразумеваешь прокси ?


Yevhen Maksymovych [1 day ago]
ага

Prodigy [1 day ago]
прокси будет недоступен

Yevhen Maksymovych [1 day ago]
почему? инстанцированный объект будет доступен, в нём будет сидеть живой праймари кей. другое дело, что остальные поля не сможет вытянуть, потому что транзакция закрыта, но нам только id и нужен


Prodigy [1 day ago]
org.hibernate.LazyInitializationException: could not initialize proxy [ru.javawebinar.topjava.model.User#100000] - no Session
видишь какая у него была ошибка, что говорит о том что прокси недоступен после закрытия сессии


Yevhen Maksymovych [1 day ago]
ну так он хотел небось по полям что-то сравнивать


Yevhen Maksymovych [1 day ago]
я говорю только об id

Prodigy [1 day ago]
не важно, тут суть в том, что прокси недоступен, ни его id в том числе


Yevhen Maksymovych [1 day ago]
суть в том, что прокси недоступен, а id доступен :slightly_smiling_face:


Yevhen Maksymovych [1 day ago]
проверь сам


Yevhen Maksymovych [1 day ago]
        ```Meal actual = service.get(ADMIN_MEAL_ID, ADMIN_ID);
//        System.out.println(actual.getUser());
        System.out.println(actual.getUser().getId());```


Yevhen Maksymovych [1 day ago]
закоментированная строчка упадёт с эксепшеном, незакоментированная - выдаст тебе id



Prodigy [1 day ago]
это ты тестируешь в контроллере?

Alexander Pilipenko [1 day ago]
В тесте


Yevhen Maksymovych [1 day ago]
да без разницы в чем тестировать. хибернейт при создании референса на объект праймари кей вытягивает "насовсем", он будет доступен после закрытия транзакии

Prodigy [1 day ago]
вообще "на вэб" я имел ввиду передачу объекта например в jsp...


Prodigy [1 day ago]
по поводу id я не знал что он доступен

Prodigy [1 day ago]
т.е. после закрытия сессии, прокси продолжает висеть, чтобы предоставить доступ к id сущности? (edited)


Yevhen Maksymovych [1 day ago]
да, но кому он мешает? ты не парься, там нет каких-то накладных расходов на поддержание сессии или ещё чего: в хипе памяти просто висит инстанцированный наследник твоего юзера с одним заполненным атрибутом и отсылкой на какую-то хибернейт-магию, которая в свою очередь инстанцируется при открытии транзакции


Yevhen Maksymovych [1 day ago]
вот, тут небольшое объяснение

Yevhen Maksymovych [1 day ago]
http://blog.xebia.com/advanced-hibernate-proxy-pitfalls/
Xebia Blog
Advanced Hibernate: Proxy Pitfalls
Shares 1


Prodigy [1 day ago]
ну понятно, прокси объекта существует пока существует сам объект, соответственно его id доступен даже вне сессии (хотя мне это непонятно, почему он существует вне сессии)


Prodigy [1 day ago]
статья этого не раскрывает


Sergey [Yesterday at 3:28 PM]
in #hw4
Подскажите на каком уровне подвязывается переменная ${database.init} в xml спринга <jdbc:initialize-database enabled="${database.init}">. Интересует сама механика. Откуда XML знает, что у нас есть проперти и почему ссылка на него через "database".


4 replies
alexey [1 day ago]
<context:property-placeholder location="classpath:db/postgres.properties" system-properties-mode="OVERRIDE"/> тут говорим сканировать файл пропертей


Sergey [1 day ago]
да, это я понял) но после сканирования куда попадают переменные из файла и откуда они вытаскиваются ${} этой конструкцией?


Sergey [1 day ago]
Контекст спринга?


Prodigy [1 day ago]
всё варится в контексте спринга


Jury Mironov [3:30 PM]
uploaded this image: Snap 2018-07-20 at 15.28.53.png 


Jury Mironov [3:31 PM]
uploaded this image: can't resolve method 

Jury Mironov [3:39 PM]
package org.springframework.cglib.core;
Jury Mironov [3:40 PM]
public class CollectionUtils isEmpty  - метода такого нет

Jury Mironov [3:43 PM]
commented on Snap 2018-07-20 at 15.28.53.png
так и должно быть,  как я понял?
Johann [3:44 PM]
package org.springframework.util;
Jury Mironov [3:48 PM]
хз,  почему у меня другой импорт
Jury Mironov [3:48 PM]
спасибо
Jury Mironov [3:57 PM]
Я jpa добавил,  а User все равно красным подчеркивает
Johann [4:15 PM]
похожая проблема, решена - https://topjava14.slack.com/archives/CBUBTP0TG/p1532084912000298
Jury Mironov [4:24 PM]
перезагрузил идею,  помогло

Jury Mironov [4:55 PM]
Не проходят тесты - Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]

e.pekhterev [5:13 PM]
uploaded and commented on this image: LocalDateTime mismatch.png 

У кого то была такая штука? и как бороться?
Бился целый час, уже всё что можно перерыл/перечитал. 
Потом проверил, а оно работает и всё хорошо, но Идея подсвечивает как ошибку.
Join_Selectovich [5:27 PM]
Странно что после where идет and
e.pekhterev [5:27 PM]
ничего странного, там подтер код))) не хочу просто решение светить
Join_Selectovich [5:27 PM]
))
e.pekhterev [5:28 PM]
и так свечу слишком много
Join_Selectovich [5:31 PM]
Select m from Meal m - тоже странно
Join_Selectovich [5:31 PM]
ты там тоже поддтер
e.pekhterev [5:31 PM]
это есть правильно
Join_Selectovich [5:31 PM]
m.*
Join_Selectovich [5:32 PM]
или название столбца вроде должно быть обычно
e.pekhterev [5:32 PM]
это HQL
Yevhen Maksymovych [5:32 PM]
это нормально. идея не успевает угнаться за синтаксисом hql
Join_Selectovich [5:32 PM]
ааа
e.pekhterev [5:33 PM]
вот блин, ну реально обидно)))) чассссссссссс, целый час пытался это исправить, а оно уже работало, и правильно работало)))) вот ёлы

Join_Selectovich [5:34 PM]
типичный разработческий процесс


Prodigy [Yesterday at 6:04 PM]
in #hw4
посмотрел сколько участников в канале и в предыдущих уроках.... тенденция к уменьшению... интересно, народ не успевает или забивает


6 replies
Jury Mironov [1 day ago]
Я офигеваю от происходящего).  У меня до дз не всегда доходит,  сижу поправляю ошибки,  а потом новый урок и куча непонятной фигни...


Prodigy [1 day ago]
ты первый раз на курсе? (edited)


Jury Mironov [1 day ago]
второй, первый раз бросил после HW2,  ахах


Prodigy [1 day ago]
А че? Тяжело было?


Oleg K [1 day ago]
так лето же в самом разгаре, не до стажировки:stuck_out_tongue_winking_eye:


Maksim K [13 hours ago]
Вот насчет лета согласен. Вроде и хочется обучению как можно больше времени уделять, но и лето про....пустить не хочется. Вот и приходится метаться как белка в колесе. И по поводу новой инфы: ее тут реально много. Я обычно дз начинаю делать уже за дня два-три до следующего дз) Поначалу хотелось все почитать, посмотреть по ссылкам, а только потом делать дз. Но сейчас понимаю, что это не реально. Поэтому знакомлюсь чисто поверхностно с материалом и дальше. Иначе нифига не успеешь. А еще надо еще один проект делать. Как все успеть, хз)


Yevhen Maksymovych [6:05 PM]
Второгодников количество уменьшается

Prodigy [6:10 PM]
в канале general 356 человек, в hw4 87


Prodigy [Yesterday at 6:11 PM]
in #hw4
я чего то не понимаю наверное)


18 replies
e.pekhterev [1 day ago]
часть народа присоединилось гораздо позже, и они ещё просто не дошли до 4-го ДЗ


Prodigy [1 day ago]
я понял, раскидало народ по каналам


Join_Selectovich [1 day ago]
Ещё 2ух дней не прошло даже , наверное ещё на выходные народ подойдёт, возможно не все по будням могут заниматься


Join_Selectovich [1 day ago]
И вообще на этот курс нужно заходить уже с небольшим background - ом.


Join_Selectovich [1 day ago]
А может и с большим. Возможно кто-то на base java перешёл (edited)

vch [1 day ago]
На javaops.ru указано, что в topjava всего было 1505 участников.
Сейчас 14 поток, т.е. 1505/14 = 107 новых участников.
Григорий говорил, что до финиша доходит 25%.
Вот и считайте, сколько останется к HW10


Join_Selectovich [1 day ago]
25% !?! :flushed:


realcorwin [1 day ago]
не лучшая реклама для курса :slightly_smiling_face:


realcorwin [1 day ago]
в предыдущем потоке было интересно наблюдать, как с каждой неделей кол-во участников падает

vch [1 day ago]
Почему? А может наоборот - люди успешно находят работу уже в процессе учёбы? Тогда наоборот - реклама - нескольких занятий хватает для получения высокого уровня. Тут ведь как интерпретировать...


Prodigy [1 day ago]
А как было видно: по кол-ву участников в новых группах или по кол-ву обсуждений?

realcorwin [1 day ago]
интерпретировать нужно не отрываясь от реальности :slightly_smiling_face: ...по всему было видно. кстати, этот поток гораздо активнее

Prodigy [1 day ago]
Довольно большой обьем информации нужно пропустить через себя, не каждый готов к этому


e.pekhterev [24 hours ago]
@realcorwin я так понимаю на этом потоке активнее ребята с предыдущего потока.


realcorwin [23 hours ago]
в этой шутке есть доля шутки :slightly_smiling_face:

Макс Куркудюк [6 hours ago]
Як на мене, сюди приходило багатенько людей, які працюють на роботі і паралельно проходять даний курс. Як на мене, якщо робота - не в IT, то залишається мало часу для розуміння, д/з.. Тому такі люди відстають, або відкладають на потім.
До того ж, ті, хто проходив курс навчання, наприклад на javarush (і т.п.), де у тебе необмежена к-сть часу (хто встигав ще ходити на роботу) - даний курс - дещо добре важкий.
А коли, приділяєш навчанню майже кожен день, то все нор і результат також)


Kirilo [3 hours ago]
Я уже третий раз иду. Первый раз просто не успевал где-то с этого места и не так сильно вникал. Второй раз уже дошел до деплоя на Хироку, но в голове осталась каша по технологиям. Работа, семья. Все это отвлекает от нормального обучения. Сейчас уже в каждую строчку всматриваюсь, делаю все Д/З без исключения(опциональные обязательно). Для этого уволился с работы, предварительно побеспокоился, чтобы на несколько месяцев было за что жить, жену с детьми отправил в село к родителям - лето все-таки. Теперь от учебы полный восторг и понимание что, куда и зачем. :slightly_smiling_face: (edited)



Макс Куркудюк [2 hours ago]
З таким підходом - успіх не за горами:+1:


Merkulov [Yesterday at 8:29 PM]
in #hw4
как можно в тестах проверять не всего пользователя, а только его Id ?


7 replies
Yevhen Maksymovych [1 day ago]
просто проверяй сначала еду без пользователя, а потом отдельно ид пользователя


Yevhen Maksymovych [1 day ago]
или просто забей, и проверяй без пользователя


Merkulov [1 day ago]
Если нашему приложению Meal.user не требуется, не следует включать его в тесты. В следующем уроке мы потренируемся разными способами доставать зависимости Meal.user и User.meals


Merkulov [1 day ago]
еще уточнил у менторов исключить ли мне из тестов пользователя сказали, что да


Prodigy [7 hours ago]
т.е. не нужно делать проверку на соответствие залогиненного юзера и юзера в еде?


Prodigy [7 hours ago]
или о каких проверках id пользователя идет речь?


dimlo [3 hours ago]
@Merkulov "Исключить пользователя" - то есть метод getAll(int userId) в JpaMealRepository возвращает у Вас всю еду всех пользователей?


Merkulov [Today at 11:31 AM]
in #hw4
Caused by: java.io.FileNotFoundException: class path resource [spring/spring-db.xml] cannot be opened because it does not exist
снова такая трабла, я уже устал удалять папку .idea в чем может быть проблема ?


5 replies
Merkulov [11 hours ago]
иногда помогает clean в мавене и compile

Merkulov [11 hours ago]
но не всегда


Victor [11 hours ago]
было у меня - незаметный пробел вписался. Проверь имя и path файла


Merkulov [10 hours ago]
имена это первое, что я проверил)


Merkulov [10 hours ago]
проблема решилась clean and compile


Prodigy [Today at 2:49 PM]
in #hw4
`@Column(nullable = false)` если я не ошибаюсь это нужно только для генерации таблички? если мы сами сгенерили таблички скриптом, необязательно это указывать? (edited)


3 replies
Yevhen Maksymovych [8 hours ago]
Вообще да, необязательно. Но лучше указать, а в настройках хибернейта для hbm2ddl указать validate. А то мало ли, вдруг кто-то альтернул какую-то таблицу, а мы этого не знаем


Yevhen Maksymovych [8 hours ago]
А так мы удостоверимся при запуске, что наши энтити смогут персистироваться в бд (edited)


Prodigy [8 hours ago]
ок, спасибо!


matrocob [2:58 PM]
Всем ссылочка к оптионал на доп материал для optional)
мне понравилось)
http://qaru.site/questions/799389/record-time-it-takes-junit-tests-to-run (edited)
qaru.site
java - Записывать время, которое требуется для запуска тестов JUnit - Qaru
Я хотел бы записать, как долго мой тест JUnit запускается программно. У меня есть большое количество тестов в различных тестовых классах, и я хотел бы узнать, как долго проходит каждый отдельный метод тестирования. Я могу изменить структуру наследов


Kirilo [Today at 5:40 PM]
in #hw4
Очень длинные видео порой - утомляет.  Нормально было бы делить длинные видео ролики на фрагменты не более 10 мин, информация усваивалась бы намного лучше.



3 replies
Макс Куркудюк [4 hours ago]
Ніхто не заважає натиснути на паузу)


Kirilo [4 hours ago]
Можна і Машку за ляшку. Так і роблю. Подивись, для прикладу, як на степіку зроблено. Продукт комерційний і це додасть йому більшої привабливості. 
"Можно и Машку за Ляшко. Так и делаю. Посмотри, например, как на Степике сделано. Продукт коммерческий и это придаст ему большей привлекательности".


Victor [1 hour ago]
80 минут можно на 3 подтемы разбить, и пользоваться удобнее. Если нужно пересмотреть, по названию видео удобно искать.


Андрей [6:34 PM]
помощниц привлекать к съёмкам обучающих видео


Prodigy [Today at 7:10 PM]
in #hw4
В тесте есть метод `updateNotFound` который ожидает `NotFoundException`, метод `merge` никак не возвращает такой эксепшн. Вопрос: в методе `save`  нужно самому кидать такой эксепшн в случае если айди еды и юзера не совпадают? (какая то муть с этим юзером и с тестовыми данными без юзеров)


2 replies
Yevhen Maksymovych [3 hours ago]
сервис бросает этот эксепшн, если репозиторий возвращает null. сделай дополнительную проверку на уровне репозитория, чтобы он вернул нулл при обновлении чужой еды


Prodigy [3 hours ago]
ты прав, как то я упустил из виду имплементацию в сервисе


Prodigy [Today at 1:07 AM]
in #hw4
в видео поднималась тема с конвертером дат... но вроде и так всё работает... не?
Была какая-то проблема в методе  `getBetween`, ругался на несоответствие типов дат, но она как то сама собой исчезла... че это было непонятно :face_with_rolling_eyes: (edited)


15 replies
Victor [14 hours ago]
>hibernate-core 5.2.x включает hibernate-entitymanager >и hibernate-java8, Time API конверторы уже не нужны.
ведь сразу под видео в уроке написано...


Prodigy [14 hours ago]
меня 2 ссылки чуть ниже сбили с толку(


Prodigy [14 hours ago]
ты прав!


Prodigy [14 hours ago]
идея почему то подчеркивает мою дату в запросе и жалуется на несоответствие типов


Prodigy [14 hours ago]
но при этом всё работает


Victor [14 hours ago]
да..., когда перечитаешь Hibernate and JPA, можно голову на полку положить на недельный отдых... )))


Victor [13 hours ago]
посмотри в чате выше, там кто-то писал про подчеркивания HQL


Prodigy [13 hours ago]
ага, нашел... похоже глюк идеи)


Kirilo [13 hours ago]
видео старые остались, а проект каждый раз меняется с появлением новых версий по каждой из технологий, плюс улучшения, доработки :slightly_smiling_face:


Prodigy [13 hours ago]
у меня такое впечатление что некоторые делают домашку в тот же день когда появляется урок))


Kirilo [13 hours ago]
я так не могу. Я за каждой фразой и движением слежу, чтобы ничего важного не пропустить


Victor [13 hours ago]
есть и такие... Все зависит от багажа знаний


Kirilo [13 hours ago]
а потом за два дня делаю


Kirilo [13 hours ago]
Здесь могут быть и сеньоры..., так, что... (edited)


Prodigy [13 hours ago]
не все обсуждения сразу понятны, пока не дойдешь сам до этой темы


Kirilo [Today at 2:23 AM]
in #hw4
@NotBlank
   @Size(min = 2, max = 100)
   @Column(name = "name", nullable = false)
В первой и последней строчке указано, что элемент должен быть не нулевым. Таким образом мы не дублируем условия?


42 replies
Prodigy [13 hours ago]
этой что ли строчкой дублируем `nullable = false` ?


Kirilo [13 hours ago]
ну в верхней - это валидация. А там, да, так же указано, что не нулевая


Kirilo [13 hours ago]
Возможно оно в разных местах проверяется?

Prodigy [13 hours ago]
не, вторая строчка нужна если мы генерируем таблицу из энтити


Prodigy [13 hours ago]
по сути нам от нее толка нет


Prodigy [13 hours ago]
а первая строчка это чисто валидатор, который и делает проверку


Kirilo [13 hours ago]
по первой то я понял


Kirilo [12 hours ago]
Но в доке над nullable пишет такое: Whether the database column is nullable.

Kirilo [12 hours ago]
является ли нулевым...

Prodigy [12 hours ago]
мы чуть выше сегодня уже поднимали этот вопрос...


Prodigy [12 hours ago]
вроде это дело относится именно к генерации таблицы из энтити

Prodigy [12 hours ago]
You should additionally use the JPA annotation like @Column(nullable = false) to give the jpa provider hints to generate the right DDL for creating table columns with the database constraints you want.


Kirilo [12 hours ago]
то есть включать, или не включать столбец?


Prodigy [12 hours ago]
я не приписывал nullable за неимением смысла

Kirilo [12 hours ago]
надо будет потестировать различия, если они есть

Kirilo [12 hours ago]
с тру и фолс


Kirilo [12 hours ago]
И вообще, что-то мне с jdbc более понятно, нежели с хибернейтом и вообще с jpa


Prodigy [12 hours ago]
с хибернейтом как раз всё гораздо проще) ну ты поймешь это чуть позже)


Kirilo [12 hours ago]
в теории да, но если разбирать что и как работает, то не сказал бы (edited)

Kirilo [12 hours ago]
На таком небольшом примере, наоборот тяжелее

Kirilo [12 hours ago]
Это разве там, где много таблиц, то есть, как говорится в видео доменная модель большая (edited)


Prodigy [12 hours ago]
ну да, как говорит Григорий, где есть богатая доменная модель....


Prodigy [12 hours ago]
на самом деле мне jdbc кажется диким по сравнению с хибернейтом

Kirilo [12 hours ago]
все равно мы его не в чистом виде использовали, а через примочки спринга (edited)


Kirilo [12 hours ago]
там не было всяких экзекуторов и т.п. (edited)


Prodigy [12 hours ago]
ну хибернейт в чистом виде тоже не так прекрасен как со спрингом)


Prodigy [12 hours ago]
хотя нет, всё же прекрасен))

Kirilo [12 hours ago]
Это если по быстрому бабло срубить :slightly_smiling_face:

Prodigy [12 hours ago]
я использовал хибернейт и с jpa и чистый, он гораздо лучше jdbc


Prodigy [12 hours ago]
он удобен это факт!


Kirilo [12 hours ago]
так понятно, он же типа для того и создан, чтобы облегчить работу

Prodigy [12 hours ago]
ну да


Kirilo [12 hours ago]
но как оказывается, на серьезную нагрузку не расчитан


Prodigy [12 hours ago]
ну всё относительно

Prodigy [12 hours ago]
раз он такой популярный значит на нем много чего реализуют


Kirilo [12 hours ago]
Я смотрел видео, где для того, чтобы ускорить работу вообще коды возврата получают, вместо экзепшинов. То есть костыли самые настоящие делают


Prodigy [12 hours ago]
ну да, обработка исключительных ситуаций это затратная операция

Prodigy [12 hours ago]
на что только не идут ради оптимизации приложения)

Kirilo [12 hours ago]
сначала делаем быстро со всем набором технолоний, а затем, если нужно, все выбрасываем и пилим костыли :slightly_smiling_face:


Prodigy [12 hours ago]
да, таковы реалии)

Kirilo [11 hours ago]
Вот. Дошло. Это равнозначно тому, что мы делали в скрипте инициализации.
name             VARCHAR                 NOT NULL,


Kirilo [11 hours ago]
А валидация @NotBlank - это предпроверка условия корректности данных, то что мы делали используя свой утильный класс.


Prodigy [2:37 AM]
uploaded and commented on this image: test cases.png 

Обратите внимание на время прогона тестов подсчитанное идеей(слева) и моими подсчетами(справа)... интересная хренотень получается :slightly_smiling_face:
Kirilo [2:40 AM]
возможно там еще учитывается время на вызов каких-то оберток

Prodigy [2:48 AM]
интересно какие результаты у коллег по цеху

Alexander Pilipenko [10:01 AM]
https://clip2net.com/s/3VAJyAj
clip2net.com
8afc0-clip-73kb.png
Clip2net — most popular image sharing tool
http://clip2net.com/clip/m568095/thumb800/8afc0-clip-73kb.png

Johann [10:18 AM]
uploaded this image: 1.png 


Crazz [10:40 AM]
Подскажите плиз где почитать про Criteria чтоб сделать getBetween по датам, ну или как правильнее это реализовать, не в запросе же писать

stea1th [10:43 AM]
почему нет?

shtramak [10:45 AM]
Запрос хорош для простых запросов, Criteria для сложных фильтров

Crazz [10:53 AM]
ооок, просто такое ощущение что правильнее использовать JPA

stea1th [11:26 AM]
Can't apply 3 of 4 hunks... что делать в этом случае?

Prodigy [11:30 AM]
c JPA будет много кода

stea1th [11:30 AM]
что делать с hunks, которые нельзя apply?

Prodigy [11:31 AM]
commented on Johann’s file 1.png
я смотрю у всех плюс/минус совпадает с идеей... интересно почему у меня такие результаты

stea1th [11:37 AM]
uploaded this image: Screenshot_3.png 


stea1th [11:37 AM]
как сделать так, чтоб красное тоже перенималось?

Prodigy [11:39 AM]
commented on test cases.png
у меня сомнения вкрадываются уже правильно ли я посчитал.... хотя там же и считать то нечего, всё банально

Crazz [12:32 PM]
а как прикрутить тест? у меня ругается MealServiceTest - `org.hibernate.LazyInitializationException: could not initialize proxy [ru.javawebinar.topjava.model.User#100000] - no Session`


Crazz [Today at 12:33 PM]
in #hw4
JpaMealRepositoryImpl реализован, работает


7 replies
sky [2 hours ago]
5: Если нашему приложению Meal.user не требуется, не следует включать его в тесты.


dimlo [2 hours ago]
Мой вариант: в MealTestData подправил assertMatch на isEqualToIgnoringGivenFields(expected, "user"); в первом и на .usingElementComparatorIgnoringFields("user") в третьем


dimlo [2 hours ago]
ошибка уйдет, если в Meal у поля user сделать FetchType.EAGER, но сравнения по user все равно не проходят



Crazz [2 hours ago]
да, так лучше, спасибо


dimlo [2 hours ago]
:+1:


Prodigy [2 hours ago]
как по мне проще обернуть транзакцией тест, чем каждый раз менять LAZY на EAGER


Prodigy [2 hours ago]
в реальном проекте тоже будете менять аннотации чтоб тесты проходили?))


Merkulov [Today at 12:37 PM]
in #hw4
3.3: вывод сводки в конце класса: имя теста - время выполнения с помощью чего реализовать? Вывод в лог файл реализовал после каждого теста, а вот с выводом общей статистики ... может есть какой Rule куда копать подскажите


5 replies
sky [2 hours ago]
https://topjava14.slack.com/archives/CBUBTP0TG/p1532174313000038
matrocob
Всем ссылочка к оптионал на доп материал для optional)
мне понравилось)
http://qaru.site/questions/799389/record-time-it-takes-junit-tests-to-run
Thread in #hw4Yesterday at 2:58 PM


Merkulov [2 hours ago]
ок спс


Merkulov [2 hours ago]
это я реализовал вывод в лог файл, теперь нужно сделать общий вывод в конце класса, получается если делать вывод в консоль, между тестами попадают инфа от хибернейта


sky [2 hours ago]
Я просто @AfterClass использовал (edited)


Merkulov [1 hour ago]
ага я тоже его использовал, только сделал


dimlo [Today at 1:15 PM]
in #hw4
А было ли у кого следующее:
при создании @NamedQuery GET_BETWEEN в Meal строку поиска по базе WHERE m.dateTime Idea подчеркивает красным с комментарием "expected Number, Date or String". После m.dateTime идут условия BETWEEN, в которые передаются localDateTime. При этом код работает, тесты проходят. Строкой выше m.dateTime используется в ORDER BY, там она не подчеркнута. Полагаю, что связано это с внедрением поддержки localDateTime в Hibernate, в pom указаны версии (из патча)
<hibernate.version>5.3.2.Final</hibernate.version>
<hibernate-validator.version>6.0.10.Final</hibernate-validator.version>


2 replies
sky [2 hours ago]
mentioned e.pekhterev’s image: LocalDateTime mismatch.png
14 Comments



dimlo [1 hour ago]
@sky спасибо тебе, добрый человек!:slightly_smiling_face:


stea1th [17 hours ago]
так почему она его подчеркивает?


dimlo [13 hours ago]
@stea1th глюк идеи


stea1th [Yesterday at 5:56 PM]
in #hw4
Вопрос, у нас же datetime в meal не является уникальным?


15 replies
vch [18 hours ago]
нет. Уникальна только комбинация user+datetime


stea1th [18 hours ago]
а это как то нужно отмечать , кроме как @Table(name = "meals", uniqueConstraints = {@UniqueConstraint(name = "meals_unique_user_datetime_idx", columnNames = {"user_id", "date_time"})})?


vch [18 hours ago]
А как ты ещё хочешь отметить? У нас же в скрипте создания базы есть создание констраинта, т.е. в базу физически невозможно сохранить дубликат.


stea1th [18 hours ago]
а фиг его знает.. может там какие подводные камни есть


vch [18 hours ago]
В нашем случае даже если не указывать `{@UniqueConstraint(name =` - поведение не изменится. Мы же базу вручную создаём.



stea1th [18 hours ago]
а нужно ли dateTime помечать как @DateTimeFormat?


stea1th [18 hours ago]
то есть этот индекс не облизательно вписывать?


vch [18 hours ago]
А что тебе даст этот `@DateTimeFormat`?
Индекс вписывать необязательно, т.е. в данном случае он скорее для программиста указывается.
Но лично я (в отличие от многих других) создаю БД не скриптами, а через все эти аннотации. Поэтому в моём варианте указывать индексы в Entity - обязательно.


stea1th [18 hours ago]
по большому счету получается, что так как база у нас через скрипт, то нам все эти проверки и все остальное просто не нужно?


stea1th [18 hours ago]
и даже в тех местах, где имя переменной совпадает с именем в базе не нужно @Column?


vch [17 hours ago]
Не совсем `не нужно`. Есть ещё валидация. Т.е. часть проверок (типа `@NotBlank` )делается хибернейтом при сохранении.
А если просто переменная типа Boolean, без всяких `nullable = false` - то да, можно оставить вообще без аннотаций, поле попадёт в базу.
Наоборот - чтобы не попало, надо помечать поле класса как `@Transient`


stea1th [17 hours ago]
не получается ли тут двойных проверок? и в базе мы пишем not null  и здесь _

vch [17 hours ago]
А тебе они мешают?
Зато следующему программисту будет всё понятно.

stea1th [17 hours ago]
да в принципе не мешают, но нужно все это ручками прописывать ведь...


vch [17 hours ago]
И ещё будет тема "валидация" позже. Там для аннотированных проверок сообщения об ошибках приличные можно выдрать из хибернейта. А вот с теми, что только в базе (типа ограничения юзер+datetime) - придётся помучиться, чтобы выдать пользователю красивое сообщение об ошибке. (edited)


Grigory Kislin [7:32 PM]
commented on e.pekhterev’s file LocalDateTime mismatch.png
в новой idea все хорошо

stea1th [7:35 PM]
uploaded this image: Screenshot_4.png 


stea1th [7:35 PM]
а как такое может быть?

Joanna [7:44 PM]
такая же фигня...(

stea1th [7:46 PM]
есть тут кто, кто может помочь разобраться?

Yevhen Maksymovych [7:48 PM]
юзер исключен из проверки? здесь для мила выводится тустринг
в тустринге юзера нет, вот и вывод одинаковый

Grigory Kislin [7:49 PM]
@stea1th @Joanna вывод делается через toString, в котором поля могут не совпадать с теми, по которым идет сравнение

stea1th [7:49 PM]
надо тесты править?


Grigory Kislin [Yesterday at 7:50 PM]
in #hw4
надо найти в чем причина и подумать, что с этим делать (edited)


5 replies
stea1th [16 hours ago]
а подсказочку можно? а то я тут сейчас голову сломаю


sky [16 hours ago]
добавь юзера в тустринг мила


sky [16 hours ago]
эт не решение



Grigory Kislin [16 hours ago]
можно еще подсказки к занятию почитать:)


stea1th [16 hours ago]
сообразил


Макс Куркудюк [Yesterday at 8:10 PM]
in #hw4
UserServiceTest не працює після патчів, це норм?


3 replies
sky [16 hours ago]
должно все работать, причем на обеих субд (edited)


sky [16 hours ago]
какие не проходят тесты, что пишет?


Макс Куркудюк [6 minutes ago]
Всі не проходять.
12:05:55.695 INFO  o.s.jdbc.datasource.DriverManagerDataSource.setDriverClassName:133 - Loaded JDBC driver: org.postgresql.Driver
12:05:56.095 WARN  o.s.context.support.AbstractApplicationContext.refresh:558 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
12:05:56.102 ERROR o.springframework.test.context.TestContextManager.prepareTestInstance:250 - Caught exception while allowing TestExecutionListener [org.springframework.test.context.support.DependencyInjectionTestExecutionListener@3e521715] to prepare test instance [ru.javawebinar.topjava.service.UserServiceTest@26a529dc]
java.lang.IllegalStateException: Failed to load ApplicationContext
    at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:125)


Crazz [8:13 PM]
игнорьте при проверке юзера:https://topjava14.slack.com/archives/CBUBTP0TG/p1532252227000018?thread_ts=1532252027.000042&cid=CBUBTP0TG
dimlo
Мой вариант: в MealTestData подправил assertMatch на isEqualToIgnoringGivenFields(expected, "user"); в первом и на .usingElementComparatorIgnoringFields("user") в третьем
From a thread in #hw4Yesterday at 12:37 PM

Grigory Kislin [8:16 PM]
добавил в урок 2 подсказки (по AssertionError  и BETWEEN в IDEA)  и 2 ваших вопроса:

> em.merge - при отсутствии старой записи (несуществующее id) создает новую. Те в JpaUserRepositoryImpl нарушается логика

В Hibernate есть такая бага: https://hibernate.atlassian.net/browse/HHH-1661

Hibernate unexpectedly issues INSERT instead of throwing the javax.persistence.OptimisticLockException, when a nonexistent entity is passed to merge()
Should Hibernate Session#merge do an insert when receiving an entity with an ID?
Если это действительно наш критичный бизнес кейс (например с многопоточным удалением entity) нужно искать варианты обходного решения. Если же это результат неверного запроса, то, мое мнение, можно это оставить как есть.

> Почему в проекте транзакционность сделана в слое репозитория, а не сервиса? Транзакциями удобнее пользоваться на слое сервисов, так как здесь реализуется бизнес логика и бывает нужно делать несколько операций в одной транзакции.

С классической точки зрения все транзакции действительно объявляются на уровне сервиса. Мы будем использовать в логике сервиса несколько запросов и тогда сделаем дополнительную транзакцию на методе сервисе. Новая транзакция при этом не создается (по умолчанию используется Propagation.REQUIRED, который поддерживают существующую), поэтому несколько @Transactional аннотаций ведут себя как одна. Я использую подход spring-data-jpa (будет на следующем занятии): в репозитории транзакции объявлять удобно, тк не надо думать о них в сервисах.


Alexey_P [Yesterday at 8:27 PM]
in #hw4
Может кто-то знает:
в spring-db после накатывания патчей в строке 
<jdbc:script location="classpath:db/initDB.sql"/> iniDB не резольвится , красное. Почему?


2 replies
sky [16 hours ago]
video 6. Добавляем поддержку HSQLDB
Apply 4_8_add_hsqldb.patch
ВНИМАНИЕ: патч меняет postgres.properties
IDEA может ${jdbc.initLocation} подчеркивать красным - тупит...


Alexey_P [16 hours ago]
да уж, не прочел эти 2 строки) спасибо


Victor [10:27 PM]
вместо
```"UPDATE Meal m SET m.description=:description, m.calories=:calories, m.dateTime=:date_time WHERE m.id=:id"```
можно просто сделать:
```"UPDATE Meal SET description=:description, calories=:calories, dateTime=:date_time WHERE id=:id"```

Yevhen Maksymovych [10:27 PM]
как же так, запрос, и без альяса...

e.pekhterev [10:28 PM]
я так понимаю тут объединения или запроса из 2-х таблиц нет, поэтому можно наверно опускать


KaryNaiKo [Yesterday at 10:56 PM]
in #hw4
Подскажите, что за файл добавился при накатке патча 4.3?


3 replies
Kirilo [13 hours ago]
С помощью специально инструмента, ссылку на который мы добавили в шапку readme.md файла (edited)


Kirilo [13 hours ago]
https://github.com/JavaWebinar/topjava
JavaWebinar/topjava
Stars
----------------
7

Language
----------------
Java

JavaWebinar/topjavaFeb 15th at 11:52 AM Added by GitHub


dimlo [13 hours ago]
Travis - некий инструмент, проверяющий сборку и оказывающий последующие сервисы. Дает бейджик travis-build, который можно прилепить к readme.md. Подробнее в видео про улучшение качества кода


KaryNaiKo [10:56 PM]
.travis.yml что это?


Kirilo [Yesterday at 11:06 PM]
in #hw4
Интересно, каким образом marge возвращает entity, при использовании em.merge(...? По средствам создания запроса namedParameterJdbcTemplate.update("UPDATE...?


8 replies
Prodigy [12 hours ago]
интересна внутренняя кухня хибернейта?)


Kirilo [12 hours ago]
ну, да. Как примерно он это делает. Тем более, что он построен над jdbc.


Kirilo [12 hours ago]
Понятно, почему при создании нового entity ничего не возвращается - база вроде как только колличество индексов возвращает. А здесь по идее он должен обновлять.


Prodigy [12 hours ago]
я так глубоко не копал


Kirilo [12 hours ago]
Все равно рано или поздно это нужно будет знать


Prodigy [12 hours ago]
я особого смысла не вижу влазить в кишки хибернейта, ну если только сильно интересно)


Kirilo [12 hours ago]
Смотрю, что идея не сильно хорошо и подсказывает, если по полям таблицы видит, то с индексами плохо (edited)


Kirilo [12 hours ago]
Это когда я определяю @UniqueConstraint


Victor [Today at 3:08 AM]
in #hw4
Need help !
Я сделал чтобы в лог время выводилось после каждого теста через @Rule TestWatcher. Но как собрать все названия тестов + время тестов и  в конце вывести в лог одним сообщением никак не придумаю. Подскажите кто, куда смотреть? Спасибо. (edited)


1 reply
Victor [9 hours ago]
Один ответ сам нашел: через TestName + TestWatcher. Ниже скрин выложил. (edited)


Victor [3:43 AM]
uploaded this image: Вывод времени тестов через Рулы 


Victor [3:43 AM]
Не так красиво как у других, но работает )))


Kirilo [Today at 9:52 AM]
in #hw4
Да, уж. По сравнению с jdbc на прошлом уроке, hibernate в этом уроке выглядит как "танцы с бубном". Да еще и все минусы "на лицо": вытягиваем с базы все поля объекта, а затем только проверяем юзера... (edited)


1 reply
dimlo [41 minutes ago]
в лекции была волшебная строчка:
User ref = em.getReference(User.class, userId);
вот если этот ref передать в SELECT Meal ..... WHERE user=:user все работает


Victor [2 days ago]
>2: В JPQL запросах можно писать: >m.user.id=:userId
и ничего вытаскивать не нужно перед проверкой



Kirilo [1 day ago]
Лично для меня - этот материал намного тяжелее. И в нашем примере я вообще преимуществ использования Hibernate не вижу. Особенно, что касается Lazy юзера. (edited)


Victor [1 day ago]
нет, конечно можно рассуждать о преимуществах не умея толком пользоваться, но я лучше помолчу



Kirilo [1 day ago]
Я сужу о конкретном случае. Пока я не вижу преимуществ на этом уроке.


Victor [1 day ago]
Задача - изучить Hibernate. Берем проект и прикручиваем. При чем здесь преимущества?


Stanislav [1 day ago]
Процетирую знаменитый фильм "Тренеруйся лучше на кошках"


Victor [Jul 23rd at 1:37 PM]
По поводу аннотаций Hibernate над полями:
Ставить аннотации из практических соображений лучше над геттерами (хотя сам предпочитаю XML). Причины:
- Если аннотации стоят на полях, вызов любого метода приводит к загрузки сущности/прокси. Это может повлиять на производительность. Нужно на последних версиях, но думаю ничего не поменялось.
- Ставя аннотации на поля мы заставляем Hibernate работать с private class member'ами. Бывает что приложение разворачивается на чужих окружениях с restricted Security Manager'ом - это не позволит приложению взлететь. Такая необходимость, однако, - редкость.
- BeanValidation аннотации (которые мы обычно ставим туда же, куда и ORM аннотации) не всегда будут работать на полях. Например, в случае если попадется не объект, а прокси. Обращение будет к полю прокси напрямую. А у него, как известно, все Entity поля - null. А если бы использовался метод, то прокси бы обратилось к proxy holder'y и получило бы настоящее значение.
с форума javatalks.ru скопировал цитату.
Помнил, что в доках Hibernate они на геттерах ставят, а тут все на полях. Вот и возник вопрос, как лучше?


2 replies
Grigory Kislin [22 hours ago]
@Victor ссылку ниже дали. кроме того она над AbstractBaseEntity стоит. рекомендую ресурс stackoverflow отстальным.
> Security Manager - ни разу не сталкивался. чтото совсем редкое


> Если аннотации стоят на полях, вызов любого метода приводит к загрузки сущности/прокси
> BeanValidation  с прокси- да, вижу такую багу: https://hibernate.atlassian.net/browse/HVAL-13


вообще на мой взгляд это совсем неверно - пытаться доставать поля или их валидировать, если ты не вытащил объекта из базы в той же транзакции.  open-in-view паттерн, который позволяет тебе это не делать и открывает новую транзакцию- это зло, которое замазывает твой плохой код, нагружает лишний раз базу и который надо выключать сразу. (edited)


Victor [22 hours ago]
сейчас читаю Spring 4 для профессионалов, они тоже ставят над геттерами аннотации ORM. :slightly_smiling_face:
может все из-за этой баги HVAL-13?
последний абзац понял так: нужно доставать из бд сразу все что нужно за один раз.


Yevhen Maksymovych [1:41 PM]
вообще, смысл есть, но вот эти геттеры и сеттеры сами по себе boilerplate, делать их чисто для того, чтобы поставить на них аннотацию, которая в теоретических условиях может сработать отлично от такой же, но установленной на поле - ну, такое...
про бинвалидейшн не очень понял. прокси мы получаем при обращении в бд. если объект персистировался, он уже априори валидный, и на эти аннотации нам как бы уже всё равно

dimlo [2:04 PM]
в лекции про это было:
https://stackoverflow.com/questions/594597/hibernate-annotations-which-is-better-field-or-property-access/6084701#6084701
Stack Overflow
Hibernate Annotations - Which is better, field or property access?
This question is somewhat related to Hibernate Annotation Placement Question. But I want to know which is better? Access via properties or access via fields? What are the advantages and disadvanta...


Victor [Jul 23rd at 4:27 PM]
как в нашем приложении пофиксить
```org.hibernate.LazyInitializationException: could not initialize proxy [ru.javawebinar.topjava.model.User#100001] - no Session```
появляется когда я тестирую метод get. Получается я обращаюсь к полям объекта, но не могу получить их, потому что нет сессии. Как я понимаю.


1 reply
Grigory Kislin [22 hours ago]
да, см мой ответ  выше:)


Yevhen Maksymovych [Jul 23rd at 4:27 PM]
несколько вариантов:



4 replies
stea1th [1 day ago]
а 4 пункт действительный?


stea1th [1 day ago]
я допустим сделал так, что ожидается Exception


vch [1 day ago]
если будет LazyException - то наверно функционал не будет работать?..


stea1th [1 day ago]
вообще не знаю что и делать


Yevhen Maksymovych [4:28 PM]
1. открывать транзакцию при работе с прокси
2. вытаскивать не референс, а полновесный объект
3. не использовать lazy-loading
4. не обращать внимания :slightly_smiling_face:


e.pekhterev [Jul 23rd at 4:37 PM]
0. Прочитать подсказки к HW04: *_7: Если нашему приложению Meal.user не требуется, не следует включать его в тесты. В следующем уроке мы потренируемся разными способами доставать зависимости Meal.user и User.meals_*
-1. Пошукать по этой ветки в предыдущих сообщениях - уже раза 3 это обсуждалось.
-2. Фетчтип для User c LAZY на EAGER тут не стоит менять - завернут на ревью.
-3. Не обращать внимание тоже не прокатит - завернут на ревью



25 replies
Victor [1 day ago]
я за ветками слежу по большей части.
Эту подсказу я не понял как нужно.
Спасибо :slightly_smiling_face: Но начать понимать Hibernate за неделю для меня не возможно. Как оказалось, кроме того, что нужно не добавлять поле user, его еще и из асертов нужно исключить. Но я сам не додумался.


Victor [1 day ago]
просто когда я читал ветки, по факту, не понимал про что они.

e.pekhterev [1 day ago]
@Victor ну у меня затык тут же случился, потому как типа надо ж сначала постараться сделать ДЗ не читая подсказок.
А про освоить за неделю - даааа, я вот сейчас читаю ссылку за ссылкой (что даны в задании) и мозк начинает плыть. ДЗ не очень большое, я сказал бы маленькое, но очень много нюансови, и очень уж много теории. Ну да, ещё ж надо теперь get - методы для JPA-репозитория с помощью Критерии сделать))) там тоже нужно залипнуть надолго))


Victor [1 day ago]
@e.pekhterev я вообще на попробовать решить без подсказок забил. Рад, если с подсказами получается. И это я уже месяц на  Hibernate потратил до стажи. Хуже всего, что я не понимаю как этим ОГРОМНЫМ объемом теории пользоваться.


e.pekhterev [1 day ago]
@Victor ну тут изи - нужно практиковаться))) вот как раз выпускной проект для этого

Victor [1 day ago]
времени нужно вагон, которого нет.


e.pekhterev [1 day ago]
завтра времени будет меньше или вообще не будет, завтра будет новая порция теории, так что только сегодня)))



stea1th [1 day ago]
может 4 ый раз обсудим?

e.pekhterev [1 day ago]
выше почитай, там длинющая ветка, даже Григорий пару-тройку комментов оформил, у нас лучшее не получится


stea1th [1 day ago]
уже решил, спасибо... дело было в том, что забыл сортировку

Victor [1 day ago]
@e.pekhterev спасибо, уже нашел и почитал.

Tanya [1 day ago]
>  Ну да, ещё ж надо теперь get - методы для JPA-репозитория с помощью Критерии сделать))) там тоже нужно залипнуть надолго))


не надо, а можно попробовать, это ж в #flooding

e.pekhterev [1 day ago]
@Tanya если Таня чего то сказала - надо идти и делать)))



Stanislav [1 day ago]
Мое мнение, что не правильно воспринимают этот "курс". Этот курс не учит с нуля Spring, Hibernate и т.д но и многих ньюансов этот "курс" не затрагивает. Этот курс фрагментирует-убирает кашу с головы по средством практики, а так же дает возможность консультироваться-обсуждать и получать фидбэки по ДЗ. По тому же Хибернейту книги на 600+ страниц и это только по одному инструменту. Какие 3 месяца, года бы хватила что бы во всем разобраться досконально (на практике). К этому "курсу" приходят по другим соображениям, а не научиться с нуля. - имхо (edited)


Grigory Kislin [22 hours ago]
добавлю еще раз: не надо пытаться охватить все то по jpa-hibernate написано. я не смог:) точнее- и не пытался.. все по шагам делается.. пока достаточно ДЗ. мы JPA еще до 8го занятия будем ковырять потихоньку



Victor [22 hours ago]
Спасибо, а то как-то посмотришь на объем и оптимизм гаснет. Еще б совет: как то, что изучил и разобрал, запомнить. И сделать так чтобы быстро поднять теорию и использовать. (edited)


Grigory Kislin [21 hours ago]
совет - делать ДЗ и выпускной
 


Victor [14 hours ago]
Это однозначно. Но теорией сложно пользоваться. Каждый раз долго пересматривать 15 ссылок чтобы найти решение. Реализации разбросаны по бранчам, тоже тяжело систематизировать. Master комментировать нельзя...


Victor [14 hours ago]
Я лично просто в яндекс.диске веду какой-то конспект, где стараюсь сохранить все решения и теорию. Пока работает, но объем наработок растет, и уже даже поиск уже долго идет. И сам забываю что где лежит... И времени на конспектирование порядком уходит....


Stanislav [14 hours ago]
Прокачивай поиск в гугле. По своему опыту, не помогут эти конспекты.


Stanislav [14 hours ago]
Я уже как то раз скидывал интересную статью, сейчас еще раз скину.


Stanislav [14 hours ago]
https://vk.com/id189553434?w=wall189553434_251%2Fall



Victor [14 hours ago]
чем сложнее вопросы, тем тяжелее найти ответ. Последнее время все больше в книги лезу, а поиском пользуюсь когда exception вылетает. 
Минусы поиска ответов в  гугл:
- нужно найти подходящий ответ
- нужно вникнуть и понять (ход мышления автора тяжело понять)
у меня так. Интересно очень, как работающие программисты работают)))


Victor [14 hours ago]
Кроме всего гугл нужно уговорить показать тебе то что нужно, раньше было легче. Мне уже 30 и я 13 сознательных лет живу в поиске))) А цена всему - время.


Stanislav [14 hours ago]
Не спорю что гугл не все знает (или по крайне мере очень сложно найти), но это исключение чем правило.


stea1th [Jul 23rd at 5:38 PM]
Ребятки, кто поможет с этим getBetween?


38 replies
Kirilo [1 day ago]
Такой как и getall,  только  BETWEEN AND добавляешь


stea1th [1 day ago]
я имел ввиду тест с ним


stea1th [1 day ago]
LazyInitializationException кидает

Alexander Pilipenko [1 day ago]
usingElementComparatorIgnoringFields


Kirilo [1 day ago]
так это MealTestData нужно править



stea1th [1 day ago]
assertThat(actual).usingElementComparatorIgnoringFields("user").isEqualTo(expected);


stea1th [1 day ago]
так стоит такое


Alexander Pilipenko [1 day ago]
Странно


stea1th [1 day ago]
вот и я дума, что за фигня


Alexander Pilipenko [1 day ago]
Поделись ссылкой на git

stea1th [1 day ago]
https://github.com/stea1th/topjava/tree/HW04

stea1th [1 day ago]
какие будут мысли?


Alexander Pilipenko [1 day ago]
У меня в твоем проекте тесты по mealservice идут без ошибок


stea1th [1 day ago]
потому что там я ожидаю ошибку

stea1th [1 day ago]
exception.expect(LazyInitializationException.class);


Kirilo [1 day ago]
в общем метод у тебя правильно сделан. Причина в чем-то другом


stea1th [1 day ago]
тогда сдам на проверку

Kirilo [1 day ago]
а...

Kirilo [1 day ago]
ты не сортируешь

stea1th [1 day ago]
в запросе

stea1th [1 day ago]
аааа


Kirilo [1 day ago]
ORDER BY


stea1th [1 day ago]
да, забыл


stea1th [1 day ago]
попробую сейчас


stea1th [1 day ago]
теперь все проходит


stea1th [1 day ago]
спасибо


stea1th [1 day ago]
это ж надо так

Kirilo [1 day ago]
у меня по другому было. В консоли работает, а в методе - нет (edited)


Kirilo [1 day ago]
И чудесным образом заработало через .setParameter


Kirilo [1 day ago]
А в строке - фига


stea1th [1 day ago]
странно


Alexander Pilipenko [1 day ago]
Убери user из  meal.toString

stea1th [1 day ago]
все заработало

Alexander Pilipenko [1 day ago]
Не томи. Что сделал?

stea1th [1 day ago]
сортировку в запросе забыл


stea1th [1 day ago]
в get сделал, а в getBetween забыл


Alexander Pilipenko [1 day ago]
Интересная ошибка: из-за того что в тесте ты сравниваешь неотсортированный список с отсортированным, тест должен упасть на failrue. При этом данные о сравниваемых объектах должны выводиться через toString. У тебя toString:
@Override
   public String toString() {
       return "Meal{" +
               "dateTime=" + dateTime +
               ", description='" + description + '\'' +
               ", calories=" + calories +
               ", user=" + user +
               ", id=" + id +
               '}';
   }

Мы обращаемся к user proxy, и получаем ошибку LazyInitializationException (edited)


Alexander Pilipenko [1 day ago]
Поменяй meal.toString


stea1th [Jul 23rd at 6:16 PM]
а кто мне объяснит, зачем все эти танцы с бубнами типа  CMR, HQL, Criteria, если есть старый добрый JPQL?


6 replies
e.pekhterev [1 day ago]
вот тут почитай http://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#criteria


e.pekhterev [1 day ago]
я только начал, но переключился на чтение теории по хибернейт по ссылкам из занятия, а ты вот прочитаешь и нам потом всё объяснишь))) (edited)


Kirilo [1 day ago]
Я, вот, тоже пока не понял преимущества createNamedQuery перед createQuery (edited)


Grigory Kislin [22 hours ago]
@Kirilo createNamedQuery  создается на старте и кэшируется, объявляется декларативно и падает тоже на старте, если неверный (edited)


e.pekhterev [22 hours ago]
Criteria typeSafe, запрос проверяется на этапе компиляции, а не в рантайме как для HQL или JPQL (в которых все данные просто строки)


Kirilo [21 hours ago]
Будем знать.


e.pekhterev [1 day ago]
ща, погоди, я почитаю всю теорию по ссылкам, что Григорий в задании дал, может и найдется такая аннотация.
но согласитесь, до коле мы будем писать эти геттеры и сеттеры (конечно в идее это делается одним махом через alt+enter, но код из-за них перегружен нереально). А тут просто 2 аннотации над классом и вся любовь))) (edited)

Макс Куркудюк [1 day ago]
Дякую)


Vitaly [1 day ago]
на эту тему есть очень хорошее обзорное видео


Vitaly [1 day ago]
https://www.youtube.com/watch?v=QmsMWCIf3nc
YouTube letsCode
Java Tools: Project Lombok - пишем меньше кода
 


e.pekhterev [1 day ago]
спасибо, обязательно посмотрю


Vitaly [1 day ago]
там бегло - почти по всем возможностям, особо меня порадовали Builder и Cleanup


Kirilo [1 day ago]
А разве он не делает то же самое, только у себя внутри?


Vitaly [1 day ago]
Делает, но ты этот код не пишешь


Vitaly [1 day ago]
лень - двигатель прогресса



Vitaly [1 day ago]
он в момент компиляции генерит все


Kirilo [1 day ago]
Просто, лично для меня - это только запутывает. Я привык допустим видеть такой код и это никогда не было проблемой


Vitaly [1 day ago]
а он будет доступен из других методов

Kirilo [1 day ago]
Мне кажется - это только замедляет программу


Kirilo [1 day ago]
как и все технологии обертки


Vitaly [1 day ago]
т.е. если ты поставишь над классом NoArgsContructor, и в другом методе начнешь набирать имя конструктора - идея покажет, что он есть


Vitaly [1 day ago]
личное дело каждого, когда просто в классе - с десяток полей, и для них нужны геттеры/сеттеры, конструкторы, а может еще и синхронизированный метод - это будет простыня на 3 листа


Vitaly [1 day ago]
а так - 3 аннотации

Kirilo [1 day ago]
Опять же, чтобы всем этим пользоваться, ты должен знать то, что описал


Vitaly [1 day ago]
логично, это вообще ко всему относится :grin: в жизни


Kirilo [1 day ago]
И когда будет человек без практики это все применять - получится как всегда (edited)

e.pekhterev [1 day ago]
как он может замедлить программу??? компилятор всё это соберет по аннотациям и либе и вставит всё теже геттеры и сеттеры, но нам, программистам/недопрограммистам, будет легче, когда кода будет в цать раз меньше - гораздо читабельней всё (edited)


e.pekhterev [1 day ago]
тоже самое можно сказать и про стримы, и про лямбды, да и вообще про те же аннотации, но ничего - народ хавает и не икает (edited)


e.pekhterev [1 day ago]
не понятно другое - почему это до сих пор не включили в jdk

stea1th [1 day ago]
Интересно, а этот Ломбок уже можно использовать в нашем проекте?


Kirilo [1 day ago]
нет, у тебя патчи не станут

stea1th [1 day ago]
Ну а если их в домашнем задании использовать?


vch [1 day ago]
@stea1th а разве где-то есть запрет? В своих HW никто не мешает поиграться с ним. Но вообще - его изучают в masterjava


Kirilo [1 day ago]
там ты можешь все, что угодно (edited)

stea1th [1 day ago]
А кто нибудь уже ходил на мастерджаву?


vch [1 day ago]
@stea1th А что конкретно интересует?


Kirilo [1 day ago]
Были бы лишние деньги, я бы и на отус пошел бы :slightly_smiling_face:


stea1th [1 day ago]
Что такое отус?

Kirilo [1 day ago]
конкуренты, но там дороже

stea1th [1 day ago]
А вы все после JavaRush?

Kirilo [1 day ago]
я - да

stea1th [1 day ago]
И как тебе курс?


Kirilo [1 day ago]
норм, там хорошо заряжают новичков на усидчивость, но долго растягивается в перспективе. Здесь уже ближе к боевым условиям, так сказать продолжение.


Kirilo [1 day ago]
Этого курса должно вполне хватить, если все делать


stea1th [1 day ago]
Мне тоже понравилось... Хотя есть ненужные вещи, типа Rmi


stea1th [1 day ago]
Как по мне

Kirilo [1 day ago]
У меня сразу был шок, от нагрузки и темпа

Kirilo [1 day ago]
Сейчас, как-бы понимаю, что так и нужно


stea1th [1 day ago]
Да вроде полегче стало?


stea1th [1 day ago]
Самое сложное в курсе - это понять что от тебя хотят

Kirilo [1 day ago]
Конечно, подозреваю, что на Отусе много еще интересного есть, но, может, потом как-нить


stea1th [1 day ago]
И самый жирный плюс что здесь всегда тебе помогут, ты не остаёшься 1 на 1 с проблемой


Kirilo [1 day ago]
Ну, да, Григорий один из пионеров нового онлайн обучения :slightly_smiling_face:

stea1th [1 day ago]
Есть конечно к чему стремиться, но остальное оч интересно :grinning:


e.pekhterev [1 day ago]
ёлы палы, там и @ToString есть)))) и его не надо переписывать, при каждом добавлении или изменении имени полей. (edited)


stea1th [1 day ago]
Сейчас попробую домашку с этой штукой переделать


e.pekhterev [1 day ago]
а я уже прошел все ревью, не получится блеснуть))))

e.pekhterev [1 day ago]
@stea1th давай, мож быть Григорию понравится и включат код в проект - бонусы получишь


stea1th [1 day ago]
потыркаю сейчас


stea1th [1 day ago]
эту ерунду еще фиг подключишь

stea1th [1 day ago]
у кого получилось подключить ломбок?

e.pekhterev [1 day ago]
всё подключается без проблем, только что проверил, и всё работает

stea1th [1 day ago]
как ты сделал?


stea1th [1 day ago]
я уже и плагин установил и мавен зависимость подключил... и все равно, идея не видит


e.pekhterev [1 day ago]
добавляешь в pom дипенденси - я дал ссылку в шапке и вперед, ну ты чего такой то)))) ?


e.pekhterev [1 day ago]
не знаю, что ты там устанавливал - нужно просто добавить депенденси в пом

e.pekhterev [1 day ago]
отдельно плагин устанавливать не надо, возможны конфликты


stea1th [1 day ago]
не ту зависимость поставил

stea1th [1 day ago]
там была lombok-maven


Prodigy [1 day ago]
это всё хорошо конечно, а если у сеттеров нужно предусловия проверять на входе на валидность данных, а если нужно из геттеров получать не в тупую поля, а какие-то немодифицированные данные? ломбок тут вряд ли поможет вам


Prodigy [1 day ago]
а в продашине сомневаюсь что всё так просто как у нас, нагенерил сеттеров геттеров и вперед)

stea1th [1 day ago]
на ноль он может проверить

stea1th [1 day ago]
все, остальное можно ручками сделать

e.pekhterev [1 day ago]
@Prodigy слишком много "а если", а по жизни 99% времени alt+enter и потом идешь сворачивать все сеттеры и геттеры


Prodigy [1 day ago]
@e.pekhterev а ты как программист с опытом это заявляешь?))


e.pekhterev [1 day ago]
заявляю, что мне, как недопрограммисту, это очень удобно)))


e.pekhterev [1 day ago]
а дальше жизнь покажет

Prodigy [1 day ago]
у Блоха в Эффективной джаве ситуации с сеттерами и геттерами описаны на предмет валидности передаваемых и получаемых данных... советую почитать, открывает мозги)


e.pekhterev [1 day ago]
давно хочу почитать, всё руки не дойдут


e.pekhterev [1 day ago]
да и опять же, вот наш проект на топДжаве, где у нас валидность будет? судя по эксепшинам - предположу, что на сервисе она и будет, или я не прав?

e.pekhterev [1 day ago]
я к тому, что геттер должне быть геттером, и про сеттер также, если он будет делать что то ещё, то возможно не стоит называть его геттером/сеттером, может я не прав. Опять же, ребята из ДжетБрейн явно читали и не раз Эффективную джаву, так почему же по альт+энтер мы не получаем сразу сеттер с проверкой хотя бы на null для ссылочных типов или хотя бы возможность выбора такого варианта? (edited)


Prodigy [1 day ago]
ну ситуации разные бывают, где то нужно защищать данные, потому как очень легко делать разные атаки и менять состояние объектов. В нашем случае наверное не стоит городить огород.


e.pekhterev [1 day ago]
так я ж не настаиваю, что нужно везде городить, мы можем это использовать, а можем и не использовать. вот взять к примеру наш нынешний класс Meal с полем User user с фетч типом Lazy и пишем сверху класса аннотация lombok-а @toString - что он сделает, я не пробовал, но думаю не то, что нам нужно. Везде есть свои ограничения, но не повод не использовать классную тулзу, там где это приемлемо и обоснованно. опять же всё там вполне настраиваемо, теже сеттеры с геттерами


Prodigy [1 day ago]
согласен, в каких то ситуациях это может быть удобно

e.pekhterev [1 day ago]
как я уже писал выше, из того, что я за 2 года накодил эта тулза легла бы в 99% как минимум (edited)


Stanislav [1 day ago]
Ломбок интересен для своих проектов, но не стоит к нему привыкать (потом будет боль).


e.pekhterev [1 day ago]
возможно


stea1th [1 day ago]
Отчего же?

Stanislav [1 day ago]
В реальной работе его мало где применяют.

Stanislav [1 day ago]
Хотите Ломбок изучайте Котлин


stea1th [1 day ago]
Но очень же удобно


e.pekhterev [1 day ago]
а вот кстати и аргументы правильные, что нечего логику вставлять в сеттеры и геттеры для модели - https://stackoverflow.com/questions/594597/hibernate-annotations-which-is-better-field-or-property-access/6084701#6084701
Stack Overflow
Hibernate Annotations - Which is better, field or property access?
This question is somewhat related to Hibernate Annotation Placement Question. But I want to know which is better? Access via properties or access via fields? What are the advantages and disadvanta...
 
(edited)


Stanislav [1 day ago]
Не хочу лазать по ссылкам (можно в нете много найти или на том же хабре), он нарушает некоторые правила, вроде как с javadoc-ом не работает, существуют долгосрочные риски обслуживания.  и т.д.


Prodigy [1 day ago]
статья хорошая и по делу, но это касается только сущностей базы данных, в остальном же логику реализовывать в сеттерах или геттерах или нет зависит от ситуации


e.pekhterev [1 day ago]
@Prodigy ну я сейчас именно за Model говорю, а так да, всякое может быть


Prodigy [1 day ago]
инетересно всё таки мнение кураторов проекта, с позиции своего опыта и их взгляд на такие проекты как ломбок

vch [1 day ago]
@Prodigy Lombok-у учат в курсе masterjava. Мне кажется, данный факт говорит сам за себя.


e.pekhterev [1 day ago]
спросил только что у знакомого мидла из Епам (помимо основной работы ведет в Епаме и курс двакор и стажировки типа нашей, только покруче):
_- Привет, на продакшине используют библиотеку Lombok? вообще её пользуют или не рекомендуется?_
_- Привет. Используют_
_- Почему не всегда?_
_- Сторонняя библиотека._

Короче спорно, гуава и апачи комонс -  тоже сторонние библиотеки. (edited)


Prodigy [1 day ago]
@vch ну это не показатель... мы ж на данном курсе проходим темы сервлетов, jdbc, которые не факт что массово используются


Stanislav [1 day ago]
Эти вещи мы изучаем не для того что бы использовать, а что бы понимать что под капотом того же Spring MVC



vch [1 day ago]
Эээ... А как без сервлетов? Даже в Spring-контроллере есть прямой доступ к HttpServletRequest. Все эти JPA - тоже по сути обёртка над нативными запросами и JDBC. Одно другое вовсе не отрицает.


stea1th [1 day ago]
Как интересно вас почитать:grinning:

Prodigy [1 day ago]
конечно же мы это всё проходим чтобы понимать что "под капотом" современных технологий.... думаю ломбок из той же области, чтоб мы понимали что такое есть, а пользоваться или нет это уже на наше усмотрение)


e.pekhterev [1 day ago]
Ещё товарищ написал (почему не всегда используется Lombok) - *_Потому что они убогие. Ты начни юзать. Ставь анотации и компилируй_*


e.pekhterev [1 day ago]
видимо много лишнего залетает в байткод

Grigory Kislin [22 hours ago]
огось понаписали:) извините, если повторюсь- 
1. я его люблю и юзаю
2. используем в masterjava
3. будет в след. курсе spring-boot


turhanow [8:46 PM]
ребят, привет) помогите разобраться) в тестах исключение)

`Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init` 

`Caused by: java.lang.NullPointerException
    at org.hibernate.hql.internal.ast.HqlSqlWalker.createFromJoinElement(HqlSqlWalker.java:429)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.joinElement(HqlSqlBaseWalker.java:3920)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromElement(HqlSqlBaseWalker.java:3706)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromElementList(HqlSqlBaseWalker.java:3584)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromClause(HqlSqlBaseWalker.java:720)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.query(HqlSqlBaseWalker.java:576)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.selectStatement(HqlSqlBaseWalker.java:313)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.statement(HqlSqlBaseWalker.java:261)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.analyze(QueryTranslatorImpl.java:271)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.doCompile(QueryTranslatorImpl.java:191)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.compile(QueryTranslatorImpl.java:143)
    at org.hibernate.engine.query.spi.HQLQueryPlan.<init>(HQLQueryPlan.java:119)
    at org.hibernate.engine.query.spi.HQLQueryPlan.<init>(HQLQueryPlan.java:80)
    at org.hibernate.engine.query.spi.QueryPlanCache.getHQLQueryPlan(QueryPlanCache.java:153)
    at org.hibernate.query.spi.NamedQueryRepository.checkNamedQueries(NamedQueryRepository.java:157)
    at org.hibernate.internal.SessionFactoryImpl.checkNamedQueries(SessionFactoryImpl.java:574)
    at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:321)
    at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:467)
    at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:939)
    at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory`

судя по логам, ошибки с HQLQ, но  я не менял инициализацию дб, как было в патче, подключение к бд пробовал останавливать...
UserServiceTest тожже не проходит((

turhanow [8:46 PM]
ребят, привет) помогите разобраться) в тестах исключение)

`Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init` 

`Caused by: java.lang.NullPointerException
    at org.hibernate.hql.internal.ast.HqlSqlWalker.createFromJoinElement(HqlSqlWalker.java:429)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.joinElement(HqlSqlBaseWalker.java:3920)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromElement(HqlSqlBaseWalker.java:3706)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromElementList(HqlSqlBaseWalker.java:3584)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.fromClause(HqlSqlBaseWalker.java:720)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.query(HqlSqlBaseWalker.java:576)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.selectStatement(HqlSqlBaseWalker.java:313)
    at org.hibernate.hql.internal.antlr.HqlSqlBaseWalker.statement(HqlSqlBaseWalker.java:261)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.analyze(QueryTranslatorImpl.java:271)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.doCompile(QueryTranslatorImpl.java:191)
    at org.hibernate.hql.internal.ast.QueryTranslatorImpl.compile(QueryTranslatorImpl.java:143)
    at org.hibernate.engine.query.spi.HQLQueryPlan.<init>(HQLQueryPlan.java:119)
    at org.hibernate.engine.query.spi.HQLQueryPlan.<init>(HQLQueryPlan.java:80)
    at org.hibernate.engine.query.spi.QueryPlanCache.getHQLQueryPlan(QueryPlanCache.java:153)
    at org.hibernate.query.spi.NamedQueryRepository.checkNamedQueries(NamedQueryRepository.java:157)
    at org.hibernate.internal.SessionFactoryImpl.checkNamedQueries(SessionFactoryImpl.java:574)
    at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:321)
    at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:467)
    at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:939)
    at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory`

судя по логам, ошибки с HQLQ, но  я не менял инициализацию дб, как было в патче, подключение к бд пробовал останавливать...
UserServiceTest тожже не проходит((


stea1th [Jul 23rd at 9:54 PM]
товарищи, а у кого в updateNotFound тесте выбрасывается исключение?


51 replies
Alexander Pilipenko [1 day ago]
Какое?


stea1th [1 day ago]
NotFoundException


stea1th [1 day ago]
оно же по идее должно выбрасываться?


Alexander Pilipenko [1 day ago]
Да. Должно


stea1th [1 day ago]
а у меня почему то не выбрасывается

stea1th [1 day ago]
а ты можешь показать свой метод save?

Merkulov [1 day ago]
у тебя ожидается выброс исключения и если тест прошел успешно значит он был выброшен


stea1th [1 day ago]
в том то и дело, что эксепшн не выбрасывается

Alexander Pilipenko [1 day ago]
em.merge(meal); - не бросает исключение

stea1th [1 day ago]
и что делать? менять его?


Alexander Pilipenko [1 day ago]
Сейчас в meal ключ - id


Alexander Pilipenko [1 day ago]
Ты проверил что еда не новая


Alexander Pilipenko [1 day ago]
Потом сразу ее пытаешься проапдэтить.


stea1th [1 day ago]
@Transactional
   public Meal save(Meal meal, int userId) {
       User u = em.getReference(User.class, userId);
       meal.setUser(u);
       if (meal.isNew()) {
           em.persist(meal);
       } else {
           em.merge(meal);
       }
       return meal;
   }


Merkulov [1 day ago]
а где проверка на пользователя?



Alexander Pilipenko [1 day ago]
Ага. Ты ссылку на гит бросал


stea1th [1 day ago]
вооот

Alexander Pilipenko [1 day ago]
Не дал ты человеку победить ошибку :slightly_smiling_face:

stea1th [1 day ago]
я думал, что оно где то близко


Alexander Pilipenko [1 day ago]
Так близко же

Alexander Pilipenko [1 day ago]
3 строки


stea1th [1 day ago]
сейчас буду думать


Merkulov [1 day ago]
одна строчка и все)


Alexander Pilipenko [1 day ago]
ну можно и 1 :slightly_smiling_face:

Merkulov [1 day ago]
не старайся сразу кодить. сначала в голове построй логическую цепочку действий, так будет проще)

Merkulov [1 day ago]
хотя я сам не всегда этому правилу следую, но стараюсь)

stea1th [1 day ago]
вопрос, а если еда не новая, то у нее уже есть userId?


Alexander Pilipenko [1 day ago]
Да


stea1th [1 day ago]
if(meal.getUser().getId()==userId)
               em.merge(meal);


stea1th [1 day ago]
такую проверку делать?

Alexander Pilipenko [1 day ago]
Прошел тест? (edited)


stea1th [1 day ago]
неа

stea1th [1 day ago]
что то у меня не получается


Alexander Pilipenko [1 day ago]
В тесте передается еда с незаполненным user :slightly_smiling_face:

stea1th [1 day ago]
public Meal save(Meal meal, int userId) {
       User u = em.getReference(User.class, userId);
       if (meal.isNew()) {
           meal.setUser(u);
           em.persist(meal);
       } else {
           if(meal.getUser().getId()==userId)
               em.merge(meal);
           else throw new NotFoundException("Not Found");
       }
       return meal;


stea1th [1 day ago]
какая то дичь, да?


Alexander Pilipenko [1 day ago]
Нет. Почти правильно


stea1th [1 day ago]
user надо проверить на ноль?

Merkulov [1 day ago]
нельзя проверять еду которая приходит, нужно ее сверить с тем что уже есть в бд



Alexander Pilipenko [1 day ago]
Хорошо сказал

stea1th [1 day ago]
так это у меня вроде метод не из теста


stea1th [1 day ago]
это метод из JpaMealRepository


Alexander Pilipenko [1 day ago]
В JdbcRepository ты делал

Alexander Pilipenko [1 day ago]
if (namedParameterJdbcTemplate.update("" +
                           "UPDATE meals " +
                           "   SET description=:description, calories=:calories, date_time=:date_time " +
                           " WHERE id=:id AND user_id=:user_id"
                   , map) == 0) {
               return null;
           }


Merkulov [1 day ago]
ты ведь создаешь эту еду ну или обновляешь, соответственно там могут быть подменянные данные и это не безопасно


Alexander Pilipenko [1 day ago]
Здесь тоже самое

stea1th [1 day ago]
понял

stea1th [1 day ago]
буду делать

stea1th [1 day ago]
все, сделал... фуф.. всем спасибо :slightly_smiling_face:



Prodigy [1 day ago]
не нужно кидать самому NotFoundException, сервис сам его кидает, просто null вернуть

stea1th [1 day ago]
public Meal save(Meal meal, int userId) {
       User u = em.find(User.class, userId);
       if (meal.isNew()) {
           meal.setUser(u);
           em.persist(meal);
       } else {
           if(get(meal.getId(), userId)!=null){
               meal.setUser(u);
               em.merge(meal);
           } else {
               return null;
           }
       }
       return meal;


Join_Selectovich [1:16 AM]
Может кто-то сталкивался с такой ошибкой?
Caused by: org.hibernate.hql.internal.ast.QuerySyntaxException: MEALS is not mapped
01:03:31.132 ERROR org.hibernate.internal.SessionFactoryImpl.<init>:327 - HHH000177: Error in named query: Meal.get
org.hibernate.hql.internal.ast.QuerySyntaxException: MEALS is not mapped [SELECT m FROM MEALS m where m.ID = :id and m.USER_ID= :user_id]


Join_Selectovich [1:16 AM]
Может кто-то сталкивался с такой ошибкой?
Caused by: org.hibernate.hql.internal.ast.QuerySyntaxException: MEALS is not mapped
01:03:31.132 ERROR org.hibernate.internal.SessionFactoryImpl.<init>:327 - HHH000177: Error in named query: Meal.get
org.hibernate.hql.internal.ast.QuerySyntaxException: MEALS is not mapped [SELECT m FROM MEALS m where m.ID = :id and m.USER_ID= :user_id]


Victor [Yesterday at 3:07 AM]
А где в нашем проекте в конфиге dialect у Hibernate настраивается???
в спринг для профессионалов он в LocalContainerEntityManagerFactoryBean, а у нас нет... Он автоматические детектиться?


1 reply
Grigory Kislin [22 hours ago]
есть такой вопрос в занятии


e.pekhterev [Yesterday at 8:30 AM]
@Grigory Kislin @Tanya @Katherine
1. В каких случаях и что лучше использовать: nullable = false или optional = false ?
_if you try to persist an entity with a null field it will throw an exception if it is marked as optional=false (without contacting the database) and the entity will not be added to the JPA persistence context. If it is only annotated to be nullable=false the entity will be added to the persistence context and when trying to write the entity to the database (for example via flush) it will try to write the entity to the database which will deny this and it will throw an exception then._

2. Как задавать каскадирование (cascade = CascadeType.ALL) для нашего случая, когда у нас односторонняя связь на стороне подчиненной энтити (я про поле User user в Meal классе), или это работает только для дуплексных связей? (насколько я понял, каскадирование должно задаваться на стороне владельца, т.е. в классе User, но у а насто одностороняя связь) (edited)


3 replies
Grigory Kislin [22 hours ago]
по каскаду у нас будет видео на след. уроках
optional = false- а что это и куда это?


e.pekhterev [22 hours ago]
это из ссылочки по заданию))))

e.pekhterev [22 hours ago]
вот эта красота, как и во всех уроках этого автора, ну и Lombok оттуда же 

*@OneToOne(optional = false, mappedBy = "passport")*

https://easyjava.ru/data/jpa/jpa-i-svyazi-mezhdu-obektami/
EasyJava
JPA и связи между объектами
Классы в Java могут не только наследоваться друг от друга, но и включать в себя другие классы или даже коллекции классов в качестве полей. Мы уже знаем, что в столбцах таблиц, за некоторыми исключениями, нельзя хранить сложные составные типы и коллекции таких типов, что не... #h2 #hibernate #jpa (84 kB)
Mar 30th, 2016 at 10:20 PM
(edited)


Tanya [Yesterday at 8:48 AM]
1) по первому не скажу, надо почитать
2) cascade = CascadeType.ALL это совсем плохая идея, удалишь еду -> удалишь юзера


5 replies
e.pekhterev [1 day ago]
*2) cascade = CascadeType.ALL это совсем плохая идея, удалишь еду -> удалишь юзера* - это я как раз и понимаю, поэтому и спрашиваю как в таком случае задать каскадирвоание, когда у нас однонаправленная связь.
Через аннотации это вообще возможно? (про скрипты sql и hql помню, что там это есть). (edited)


Tanya [1 day ago]
только на стороне юзера


e.pekhterev [1 day ago]
а на юзере ничего нет))) ну ладно, спасибо)


Alexander Pilipenko [1 day ago]
@Tanya И еще к вопросу про optional. При ManyToOne и OneToOne связях, почти во всех примерах вместе с LAZY используют optional = false. Это обязательное требование? В докуменации про это ничего нет :disappointed:


e.pekhterev [1 day ago]
@Alexander Pilipenko ну вот оттуда же и у меня вопрос появился  - почему мы пишешь nullable = false, а не optional = false;


tim [Yesterday at 3:34 PM]
Подскажите как в jpa console увидеть SQL  запросы ?


1 reply
Alexander Pilipenko [24 hours ago]
Не знаю, то ли это
https://www.jetbrains.com/help/idea/using-jpa-console.html


e.pekhterev [3:48 PM]
Кто-нибудь разобрался как get с Критерией без дублирования сделать? всё завязано на CriteriaBuilder, CriteriaQuery и Root, можно было бы предикат отправлять в какой то общий метод, но для него опять же нужны эти объекты
*_"кто у же сделал ДЗ, предлагаю поколупать Criteria Api, и сделать get (SELECT...) методы  через CriteriaBuilder и так чтобы без дублирования"_* (edited)

Alexander Pilipenko [3:49 PM]
А последнее откуда?

Yevhen Maksymovych [3:49 PM]
Таня писала в чате

Alexander Pilipenko [3:49 PM]
Упс


This message was deleted.


1 reply
Alexander Pilipenko [24 hours ago]
Когда мы заводили репозитории был материал про отличия репозитория и DAO. Там был подобный пример (edited)


e.pekhterev [Yesterday at 3:54 PM]
Ну так чего, кто направит по Критерии? отдельно в каждом запросе всё делаю через критерию, а вот как теперь убрать дублирование


3 replies
Nikolay [23 hours ago]
я через querydsl сделал, но смысл такой же :
private JPAQuery<Meal> createQuery(int userId, Predicate o) {
       return jpaQueryFactory.selectFrom(meal).where(meal.user.id.eq(userId), o).orderBy(meal.dateTime.desc());
   }


e.pekhterev [23 hours ago]
Через критерию там всё по другому


Nikolay [23 hours ago]
тоже самое


Alexander Pilipenko [Yesterday at 3:54 PM]
Посмотри в спойлере. Может это то что нужно


5 replies
e.pekhterev [24 hours ago]
эммм, ты о чём?


Alexander Pilipenko [24 hours ago]
https://habr.com/post/263033/
Хабр
Забудьте о DAO, используйте Repository
Недавно задумался о том, чем отличаются паттерны, позволяющие абстрагироваться от работы с хранилищем данных. Много раз поверхностно читал описания и различные... (50 kB)


e.pekhterev [24 hours ago]
эммм, честно говоря не втыкаю, как это может мне помочь


Alexander Pilipenko [23 hours ago]
Там готовый пример :)


Alexander Pilipenko [23 hours ago]
Сам ещё не делал


Yevhen Maksymovych [Yesterday at 4:05 PM]
кста, ребята, у меня одного такая фигня, что всплывающие оповещения в слаке приходят с опозданием на 10 минут?


2 replies
Prodigy [23 hours ago]
не... норм всё


Егорро [23 hours ago]
В РФ, насколько знаю, после попыток РКН что-то там блокировать Слак в принципе криво работает - какое-то время вообще не коннектился, сейчас часто подвисает, задумывается, просто не реагирует ни на что по минуте и больше...


Kirilo [Yesterday at 4:43 PM]
Ветку по выпускному проекту открыли или как попасть на канал #graduate_project?


2 replies
Victor [23 hours ago]
#graduation
 


Grigory Kislin [22 hours ago]
поправил в ДЗ


Jury Mironov [Yesterday at 7:49 PM]
В spring-db локейшн classpath:/ resources горит красным,  предлагает создать папку и создает ее в пакете test.  Как исправить?


5 replies
Макс Куркудюк [19 hours ago]
Маєш це на увазі?
<jdbc:script location="classpath:db/${jdbc.initLocation}"/>


Jury Mironov [19 hours ago]
а по русски можно?



Макс Куркудюк [19 hours ago]
Имеешь в виду это?
<jdbc:script location="classpath:db/${jdbc.initLocation}"/> (edited)


Jury Mironov [18 hours ago]
не совсем, где postgres.properties


Jury Mironov [15 hours ago]
<context:property-placeholder location="classpath:/resources/db/postgres.properties" system-properties-mode="OVERRIDE"/>


Zearg [Yesterday at 7:49 PM]
Кто-нибудь знает, почему у меня в базу время заносится нормально, а когда достаю то получаю +5 часов. База mysql.


1 reply
Alexander Pilipenko [19 hours ago]
Не видя кода, могу предположить только, что сохраняешь в поле с типом данных хранящим временную зону (edited)


SergeyA [8:59 PM]
Привет! Кто нибудь обьясните систему именования: 
Это фишка Мавена или самой Java?
Untitled 
        import ru.javawebinar.topjava.web -почему команда import использует путь начинающийся именно с "ru"?
topjava\src\main\java\ru\javawebinar\topjava\web -полный путь к файлу:
    \src\main\java\ru\javawebinar\topjava\web
       package ru.javawebinar.topjava.web; - в пакет зависимость загружается с таким путем
    \src\test\java\ru\javawebinar\topjava\web - а в тестировании вообще папка тест, но импортирует описания из соседней ветки:
        import ru.javawebinar.topjava.web.user.AdminRestController; - и почему это видит из класса теста, хотя путь для ветки кода ?!
Collapse 

Tanya [9:08 PM]
как указал структуру так и будут Import формироваться
project structure -> modules


Tanya [Yesterday at 9:08 PM]
image.png



3 replies
SergeyA [17 hours ago]
Да я видел что можно отметить директорию в ИДЕЕ, (хоть и не понимаю до конца этого). Это значит что проект не будет компилироваться из командной строки? 
И я все так же не понимаю как из одной ветки мы получаем классы другой - и зачем структура каталогов должна совпадать?


Kirilo [16 hours ago]
Должна совпадать для наката патчей. Просто они не станут куда надо. (edited)


Kirilo [16 hours ago]
А зачем он должен компилироваться из командной строки? Это все мэйвен делает за нас (edited)


Join_Selectovich [11:24 AM]
Камрады, выручайте. Запулил проект на работу. и Теперь сражаюсь с таким исключением, хотя дома все работало. Пишеть что не может создать бин entityManagerFactory , не могу понять почему так, и чего не хватает, вроде все подкачалось, но похоже чегото не хватает
Failed to load ApplicationContext 
java.lang.IllegalStateException: Failed to load ApplicationContext
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
Caused by: java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
Caused by: java.lang.ClassNotFoundException: javax.xml.bind.JAXBException

Yevhen Maksymovych [11:25 AM]
java 9?
или даже 10?

Join_Selectovich [11:25 AM]
9

Yevhen Maksymovych [11:25 AM]
знакомая ошибка ))

Join_Selectovich [11:25 AM]
поменять на 1.8?

Yevhen Maksymovych [11:25 AM]
или поменяй на 8, или добавь в пом
```<dependency>
    <groupId>javax.xml.bind</groupId>
    <artifactId>jaxb-api</artifactId>
    <version>2.1</version>
</dependency>```

Join_Selectovich [11:28 AM]
Спасибо большое, что б я без вас делал... Java ЁЁ (ЁмаЁ)

Prodigy [12:13 PM]
гуглил бы))


Join_Selectovich [Today at 12:18 PM]
В основном то да, но бывают сложные случаи


10 replies
Victor [2 hours ago]
копипаст ошибки в гугл дает правильный ответ почти всегда


Join_Selectovich [1 hour ago]
Ну так вот как раз тут нужен уже такой уровень понимания чтобы примерно понимать какую именно ошибку гуглить, нужно точно понимать где то место из-за которого все посыпалось. Это приходит наверное с опытом или у некоторых интуитивно или еще как-то. Новичкам тяжело сориентироваться когда экран заливается тысячами строк эксепшенов кровавого цвета..


Join_Selectovich [1 hour ago]
Где-то в видео лекциях был небольшой момент как раскуривать эти эксепшены. Думаю что это один из главнейших навыков для разработчика - разруливать такие вещи.

Victor [1 hour ago]
причина последнего эксепшена и есть корень проблемы, как Григорий писал.


Victor [1 hour ago]
у меня пока, каждый раз так.


Join_Selectovich [1 hour ago]
Почему последнего а не первого?


Victor [45 minutes ago]
я тоже думал первого, но оказалось последнего, а от него уже каскад других начинается. Раньше первый в гугл бросал, и было тяжелее найти. (edited)


Join_Selectovich [26 minutes ago]
Может кто помнит в каком месте рассказывается про разбор эксепшенов...


Join_Selectovich [18 minutes ago]
Начинать смотреть нужно с последнего эксепшен внизу списка или вверху? (edited)


Victor [10 minutes ago]
внизу


Join_Selectovich [12:22 PM]
Пока не достигнешь некоторого уровня знаний, не знаешь даже какой примерно сформировать поисковый запрос
