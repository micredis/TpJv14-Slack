Grigory Kislin [12:50 AM]
joined #hw6.

Grigory Kislin [12:54 AM]
Добро пожаловать: https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson06.md
Начинаем изучать Spring-MVC и слой Web. 
Домашнее задание относительно большие, следующее занятие будет 16.08 по расписанию: https://github.com/JavaWebinar/topjava/
Подтягиваем "хвосты" +  если справились раньше - делаем выпускной проект (edited)

Victor [12:56 AM]
joined #hw6 along with 15 others.


Gagarina6794 [Aug 2nd at 6:38 AM]
Всем привет)  Для IDEA в spring-db.xml не забудьте выставить Spring Profiles: например datajpa, postgres - Никак не пойму зачем нам помнить выставлять в xml профиля, разве только для визуально удобства, если не один не выбирать, автоматом все светятся, если только выборочно, и запускать тесты, то тесты все-равно задействуют все профиля которые им прямо прописаны, потому и используем резолвер для postgres и hqldb


3 replies
Yevhen Maksymovych [1 day ago]
Для визуального удобства, и для интеграции с идеей, чтобы по клику прогуляться в инжектируемый класс из текущего профиля



Yevhen Maksymovych [1 day ago]
Ну и чтобы идея не ругалась на несколько реализаций одного типа бина


e.pekhterev [1 day ago]
у меня ничего не ругалось, на переключение забил, но помнил, что оно есть. жаль, что эту штуку нельзя автоматизировать. (edited)


Aleksey Vra [6:46 AM]
joined #hw6 along with 2 others.


Kirilo [Aug 2nd at 7:45 AM]
Смотрел видео по разбору Optional предыдущего урока, где мы используем метод по умолчанию в интерфейсе и словил себя на мысли, что после 8-ой Java по сути сняты фундаментальные ограничения языка по множественному наследованию, единственное, что делать это придется через интерфейсы.


15 replies
tema.emelyan [1 day ago]
не скомпилируется



Kirilo [1 day ago]
Это если default методы будут иметь одинаковое название.
https://docs.oracle.com/javase/tutorial/java/IandI/multipleinheritance.html (edited)


shtramak [1 day ago]
В этой ссылке все подробно расписано https://www.linkedin.com/pulse/multiple-inheritance-interfaces-java-9-classic-diamond-katkuri (edited)


tema.emelyan [1 day ago]
@Kirilo разные названия можно само собой начиная с первой джавы


Victor [1 day ago]
это не класс, это контракт. Интерфейс не может хранить состояния. Дефолт методы тут ничего не изменили.
Если нужно сделать множественное наследование, можно сделать внутренний класс, и унаследовать его от другого класса, нежели основной.



Kirilo [1 day ago]
@tema.emelyan дефолтных методов в интерфейсах? Ну-ну.


tema.emelyan [1 day ago]
@Kirilo ок, давай разбираться. что ты понимаешь под множественным наследованием?

Kirilo [1 day ago]
Да то, что мы наследуем методы с раных класов. Конечно, поля в интерфейс не запишешь.


tema.emelyan [1 day ago]
ну ты говоришь вот с 8ой джавы теперь всё что угодно можно. вот это конкретно что значит? как здесь множественное наслед-ие появилось?

Kirilo [1 day ago]
Именно, потому что раньше можно было только один клас наследовать и множество интерфейсов, у которых никаких методов не было


tema.emelyan [1 day ago]
это не множественное наследование, это то же самое, что в первой джаве унаследоваться от нескольких интерфейсов и все эти интерфейсы имплементировать


Kirilo [1 day ago]
Эти методы можно использовать как есть. А то просто контракт для обязательной реализации. (edited)


tema.emelyan [1 day ago]
реализация по умолчанию появилась - да. в этой реализации по умолчанию ничего не известно об объекте то есть она тоже основана на контракте. в плане множественного наследования ничего не поменялось. множественное наследование интерфейсов было раньше.


Kirilo [1 day ago]
Интерфейсов было, но теперь появилась возможность наследовать фенкционал! Что было чуть ли не главным отличием интерфейса от класса! (edited)


Grigory Kislin [1 day ago]
отличие интерфейсов от абстрактных классов- нельзя делать члены класса (не статические) и конструкторы... в остальном- да:) (edited)


Stanislav [Aug 2nd at 9:45 AM]
Так и не понял для чего аннотация @SuppressWarnings  (убирает предупреждения компилятора), стоит в CrudMealRepository над getBetween выключает предупреждения JpaQlInspection. Без этой аннотации не заметил ни каких предупреждений (не в idea, ни при рантайме).


15 replies
shtramak [1 day ago]
подчеркивает у многих красным. Может что-то обновилось недавно, но я сам видел этот глюк


Stanislav [1 day ago]
Странно, убирал эту аннотацию и полностью почистил maven - idea кэш, ни чего не подчеркивается


shtramak [1 day ago]
вполне возмножно, что исправили ¯\_(ツ)_/¯


Yevhen Maksymovych [1 day ago]
у меня в последнем билде не исправлено

Yevhen Maksymovych [1 day ago]
без подавления


Yevhen Maksymovych [1 day ago]
Pasted image at 2018-08-02, 10:31 AM



Yevhen Maksymovych [1 day ago]
с подавлением


Yevhen Maksymovych [1 day ago]
Pasted image at 2018-08-02, 10:31 AM



Yevhen Maksymovych [1 day ago]
если кто-то подскажет, как это поправить без подавления, буду признателен :slightly_smiling_face:


Join_Selectovich [1 day ago]
перфекционист :wink: (edited)

Gagarina6794 [1 day ago]
Аннотация маскирует красные подчеркивания, пиши в квери хоть стихи, оно ничего не скажет, как на меня то не совсем полезная вещь, будешь потом долгого искать где ошибка, если поставить такое и начать писать запрос, эту фичу надо осторожно использовать, только на готовом и перепроверенном запросе


Yevhen Maksymovych [1 day ago]
ну я о том и говорю, если кто-то подскажет, как заставить понимать идею обновленный синтаксис jpql (с поддержкой операторов between, like и тп), то буду признателен :slightly_smiling_face:


Yevhen Maksymovych [1 day ago]
а то за что я плачу 130 баксов в год? чтобы меня подчёркивалии? ))



Gagarina6794 [1 day ago]
Вот эта аннотация я считаю вредная, нельзя так с потребителями)


Grigory Kislin [1 day ago]
похоже что уши старой idea. уберу, спасибо (edited)


Jury Mironov [Aug 2nd at 10:23 AM]
После двух патчей по дз HW5 - Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'ru.javawebinar.topjava.repository.MealRepository' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {} (edited)


3 replies
Jury Mironov [1 day ago]
Это при деплое через томкат и выборе списка meal юзеров, так и должно быть?


Михаил [6 hours ago]
Maven Re-Import ты делаешь по необходимости? (edited)


Михаил [6 hours ago]
Pasted image at 2018-08-03, 7:39 PM


Jury Mironov [Aug 2nd at 11:12 AM]
У меня опять конфликты при применении патчей . Я уже не знаю что делать с этим. Постоянно проблемы (edited)


17 replies
e.pekhterev [1 day ago]
я пока только первый накатил, пока норм


Stanislav [1 day ago]
@Jury Mironov ты после каждого патча пробуешь выполнить тесты-сервлет?


Jury Mironov [1 day ago]
После дз. Но конфликты же не связаны с тестами


Stanislav [1 day ago]
хз, ни разу не было конфликтов


Jury Mironov [1 day ago]
у меня на кажом уроке конфликты


e.pekhterev [1 day ago]
@Jury Mironov тебе похоже надо с *stea1th* подружиться))



e.pekhterev [1 day ago]
у меня было только раз, но и то из-за того, что не прочитал инструкции в задании

Grigory Kislin [1 day ago]
@Jury Mironov учиться работать с git. на работе будет уже сложнее. еще почитай внимательно https://github.com/JavaOPs/topjava/wiki/git


Merkulov [1 day ago]
может ты работаешь на нескольких машинах и иногда делаешь update не той ветки)


Merkulov [1 day ago]
ну или забываешь

Merkulov [1 day ago]
и соответственно при накатки патчей будет конфликт

Ignat [1 day ago]
Потрать пару часов на https://learngitbranching.js.org/ Там уроки с визуализацией
learngitbranching.js.org
Learn Git Branching
An interactive Git visualization tool to educate and challenge! (71 kB)
 


stea1th [1 day ago]
а чо сразу я? :slightly_smiling_face:


Jury Mironov [8 hours ago]
Да,  работаю на нескольких машинах,  но я всегда в одной ветке.  До дз я дойти не успеваю. Пока поправлю все ошибки,  пока разберусь,  что происходит вообще...Причем бывает,  что на одном устройстве норм все, а на другом хрень


Jury Mironov [8 hours ago]
да,  кстати,  а почему Вы?)

e.pekhterev [8 hours ago]
потому как насколько помню только у вас двоих тут проблемы с накаткой патчей

Joanna [43 minutes ago]
в одной ветке master....о_0? попробуй присмотреться внимательно, что ты коммитишь и пушишь. Если предыдущий патч неправильно наложен или не наложен(можно и завтыкать), то потом не все гладко. Следи, что тут подтягивается VCS -> Commit -> ChangeList


alexey [Aug 2nd at 12:12 PM]
Народ может кто нибудь объяснить зачем мы подключаем Хибернэйтовский кэш если у на уже есть один?!


5 replies
Yevhen Maksymovych [1 day ago]
это чуть разные кэши. спринговый кэш - это кэш объектов нашей программы, он по сути не имеет никакой связи с БД, там могут лежать какие-нибудь дто из бизнеса. хибернейтовский кэш - это уже кэш персистированных объектов, с которым работает репозиторий, т.е. более низкого уровня



Yevhen Maksymovych [1 day ago]
т.е. кэш хибернейта по сути сидит где-то в районе энтитименеджера первой стеной между твоей программой и бд. а кэш спринга можно в принципе повесить куда угодно, но только там, где уже существуют объекты, т.е. на дао, и выше.


alexey [1 day ago]
т.е. спринговому кэшу нужен объект и ему пофиг откуда он?


Yevhen Maksymovych [1 day ago]
да, ты можешь просто генерить объекты, без хибернейта вообще, и складывать их в спринговый кэш


alexey [1 day ago]
понял. спасибо:+1:


alexey [1:39 PM]
Народ кто нибудь сталкивался с таким варнингом? Что за favicon.ico и как его убрать?
favicon? 
No mapping found for HTTP request with URI [/topjava/favicon.ico] in DispatcherServlet with name 'mvc-dispatcher'

Yevhen Maksymovych [1:40 PM]
положить его в статические ресурсы

alexey [1:42 PM]
откуда я его должен взять?

Yevhen Maksymovych [1:42 PM]
да любой скачай
можно даже с бэтменом


Yevhen Maksymovych [Yesterday at 1:43 PM]
это просто иконка для сайта, которая будет отображаться в закладках и заголовке браузера


2 replies
alexey [12 hours ago]
а почему он ее стал требовать? мы это где то указывали или это идет дефолтом при подключении spring mvc?


Ignat [12 hours ago]
её браузер запрашивает, а в логах тебе сказали, что кто-то хочет `/topjava/favicon.ico`, а диспетчер о таком первый раз слышит (edited)


Victor [Yesterday at 3:27 PM]
темы такие как `8. Конфигурирование Tomcat через maven plugin. Jndi-lookup.` вызывают у меня нервное напряжение. Видео для меня звучит так: послушал много разных слов, 15% уловил, остальное - космос.
Мой вывод такой: скопируй настройки, такие как сделал Григорий, чтобы работать, и иди дальше.


2 replies
Join_Selectovich [7 hours ago]
Знакомые чувства. Потом когда пару дней посидишь,  раз 10 видео это переcмотришь,  потом пытаешся вникнуть в суть материала кучи ссылок, начинаешь улавливать 16.5%, потом опять та же итерация. Дальше, когда ДЗ сделаешь кое-как, еще немного процентов добавляется.. (edited)


Grigory Kislin [3 hours ago]
попробуй вопросы сформулировать (edited)


sky [5:29 PM]
Итак, задание 1.1 Починить тесты InMemoryAdminRestControllerSpringTest/InMemoryAdminRestControllerTest (в новой версии Spring классы spring-mvc требуют WebApplicationContext, поэтому поправьте mock.xml)

Тесты сломались, так как мы кое что убрали из spring-app.xml. 
При чем тут тогда вот это - (в новой версии Spring классы spring-mvc требуют WebApplicationContext)?


Kirilo [Yesterday at 6:36 PM]
Интересно, каким образом hibernate валидатор создает interpolatedMessage, выводя сообщение на языке ОС?


2 replies
vch [7 hours ago]
Очевидно, что у него где-то хранятся языковые файлы с сообщениями.


Grigory Kislin [3 hours ago]
у него внутри есть файлы пропертей. можешь поискать. где-то в занятии будет вопрос


zippospb [12:21 AM]
Скажите, у всех при загрузке страницы /meals нормально подхватывается style.css? у меня его на /users и /index видит великолепно, а вот в /meals - никак. И root в RootController тоже не отрабатывал пока в GetMapping не поставил "/index"


Grigory Kislin [12 hours ago]
кэш обновлял? Ctrl+f5 для хром


zippospb [11 hours ago]
да


Grigory Kislin [8 hours ago]
посмотри вкладку Network в браузере


Daniel [5 hours ago]
@zippospb зайди в meals.jsp, в хедере поменяй ссылку на стиль на *resources/css/style.css*. У меня заработало. (edited)


e.pekhterev [Today at 2:36 PM]
@Grigory Kislin в *JpaUtil* равноценны ли будут две реализации?
>public void clear2ndLevelHibernateCache() {
>        Session s = (Session) em.getDelegate();
>        SessionFactory sf = s.getSessionFactory();
>        sf.getCache().evictAllRegions();
>}
и
>public void clear2ndLevelHibernateCache() {
>        em.getEntityManagerFactory().getCache().evictAll();
>}


И в первом, и во втором случае работаем с кэшем второгу уровня (в первом - с org.hibernate.Cache extends javax.persistence.Cache, а во втором - с его папкой javax.persistence.Cache). (edited)


2 replies
Grigory Kislin [8 hours ago]
не знаю. дебажил?


e.pekhterev [6 hours ago]
Разобрались:
evictAll - Hibernate impl - we only evict entity data here in keeping with the JPA intent (JPA only defines caching for entity data).  For evicting all cache regions (collections, natural-ids and query results), use evictAllRegions() instead. (edited)


zippospb [Today at 3:23 PM]
Вот блин. сначала сделал MealController полностью на аннотациях, а теперь вчитался в задание и придется переделывать на костыльный вариант с HttpServletRequest ))))



1 reply
Grigory Kislin [8 hours ago]
раз сделал- оставь


Victor [3:40 PM]
replied to a thread:

@Grigory Kislin по факту мы выносим настройки. в  context.xml вместо использования .properties файла. Для этого нужно добавлять плагин, как-то по особому его настраивать, подключать урезанный .properties файл (!), понимать что да как с контекстом происходит, деплоить по особому. И все это ради, того чтобы занести настройки  базы в контекст во время для development'а. 
Какая польза для меня как разработчика, в таком усложнении. Сложно = больше вероятность ошибки. Можно сделать проще - нужно делать проще. Или мы уже все в девопсы должны морально готовиться? :slightly_smiling_face:

Victor [8:38 PM]
Теория, в видео с 3:30 о контекстах, мне кажется, расходится с той, что в доках.
1. Исходя из скрина, даже если бин занесен в два контекста, конфликта не будет. Потому что делегирование идет только если бин не найдет.
2. WebAppContext тоже один, но при желании его можно шарить с другими DispatcherServlet, но по разному конфигурировать.
> For many applications having a single WebApplicationContext is simple and sufficient. It is also possible to have a context hierarchy where one root WebApplicationContext is shared across multiple DispatcherServlet (or other Servlet) instances, each with its own child WebApplicationContext configuration.
2018-08-04_20-01-31.png 


Yevhen Maksymovych [3 hours ago]
делегирование идёт, если бин не найден, но повторная инициализция бина может привести к нежелаемым последствиям :slightly_smiling_face:



Yevhen Maksymovych [3 hours ago]
вдруг у него в при поднятии есть какая-то логика, которая происходит в посткриэйте, и закрывается в предестрое. а так мы ее вызовем дважды подряд


Victor [3 hours ago]
понял, то есть сам факт поднятия двух одинаковых синглтон бинов может вызвать проблемы. Даже если мы к бину из root не будем обращаться. (edited)


Grigory Kislin [1 hour ago]
нуда. с ними и сталкивался. в отличии от нескольких DispatcherServlet - ни разу не встречал, думаю что-то редкое. но спасибо за информацию


Kirilo [4:00 PM]
Прикольно. Запустил приложение через плагин с консоли. Работает, правда версия у нас уже другая, чем в лекции, и пришлось в папку проекта становиться. (edited)

sky [5:37 PM]
Возможно ли выполнить последнее задание в 1 запрос c JOIN, с помощью BeanPropertyRowMapper, или это я делаю что-то не так? Не так -  это просто через RowMapper например.. (edited)


svis [Yesterday at 11:35 PM]
2.2 Добавить еще одну роль к ADMIN (будет 2 роли: ROLE_USER, ROLE_ADMIN)  - непонятно, что имеется ввиду. У нас и так две роли, а если к роли Admin добавить еще одну роль то будет три роли :face_with_rolling_eyes: Или это просто надо добавить еще одного админа в тестовых данных? (edited)


4 replies
zippospb [13 hours ago]
так это же к пользователю с именем Admin надо добавить новую роль, тобишь ROLE_USER


Victor [13 hours ago]
там set ролей, юзер может выполнять несколько ролей. Как я понял, нужно в set юзера по имени "Admin" добавить две роли.


svis [13 hours ago]
Ну то есть один юзер по имени ADMIN будет в двух ролях


svis [13 hours ago]
ок, тогда понятно


Kirilo [10:07 AM]
Локализация как-то коряво работает. У меня в браузере русский на втором, английский на третьем. Но все равно русский не покажет, пока его на первый не перетащишь. Использую Firefox. Скачивал chrome специально, чтобы проверить - та же ерунда.


Yevhen Maksymovych [Today at 11:32 AM]
а анотация @BatchSize как-то кореллирует с опцией hibernate.jdbc.batch_size?


2 replies
Grigory Kislin [2 hours ago]
да, полагаю что hibernate.jdbc.batch_size выставляется сразу для всего приложения


Yevhen Maksymovych [2 hours ago]
спасибо!


Crazz [12:58 PM]
кто как поборол - meal форма `<form method="post" action="/meals/create">`, контроллер ждет `@GetMapping("/meals/create")` и `@PostMapping("/meals/create")` и пост почему то не ловится. Если же action поставить `""`, то пост ловится. Но `update/{id}` будет кидать post по этому же адресу, второй метод для update писать? а обьединить пути которые маппятся в одной аннотации можно? (edited)

Yevhen Maksymovych [1:04 PM]
тебе не обязательно вешать один метод на одну урлу. ты можешь перечислить урлы, на которые мапится метод просто массивом в аннотации

Crazz [1:10 PM]
точно, спасибо


turhanow [Today at 8:41 PM]
всем привет! это только у меня после накатки всех патчей томкат зависает с таким исключением?
Untitled
Caused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]
  ... 88 more
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:275)
Caused by: java.lang.ClassNotFoundException: org.postgresql.Driver
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:237)
  at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1285)
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:214)
  at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1119)
  at org.hibernate.id.factory.internal.DefaultIdentifierGeneratorFactory.injectServices(DefaultIdentifierGeneratorFactory.java:152)
  at java.lang.Class.forName0(Native Method)
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.injectDependencies(AbstractServiceRegistryImpl.java:286)
  at java.lang.Class.forName(Class.java:348)
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:243)
  at org.apache.tomcat.jdbc.pool.ClassLoaderUtil.loadClass(ClassLoaderUtil.java:38)
  at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:214)
  ... 89 more
  at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:179)
  at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:119)
06-Aug-2018 20:38:09.578 INFO [localhost-startStop-1] org.apache.jasper.servlet.TldScanner.scanJars At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.
  at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:904)
06-Aug-2018 20:38:09.596 SEVERE [RMI TCP Connection(3)-127.0.0.1] org.apache.catalina.core.StandardContext.startInternal One or more listeners failed to start. Full details will be found in the appropriate container log file
  at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:935)
06-Aug-2018 20:38:09.597 SEVERE [RMI TCP Connection(3)-127.0.0.1] org.apache.catalina.core.StandardContext.startInternal Context [/topjava] startup failed due to previous errors
Collapse


8 replies
Victor [3 hours ago]
вот это проверял? Caused by: java.lang.ClassNotFoundException: org.postgresql.Driver


turhanow [3 hours ago]
в мавен я не менял ничего, у меня там вот это:
<dependency>
                <groupId>org.postgresql</groupId>
                   <artifactId>postgresql</artifactId>
                   <version>${postgresql.version}</version>
               </dependency>


turhanow [3 hours ago]
а вот на стековерфлоу пишут что мол надо скачать библиотеку https://stackoverflow.com/questions/38410850/hibernate-postgresql-driver-issue/38411466#38411466
Stack Overflow
Hibernate: PostgreSQL Driver issue
I know that there are similar questions already, but the answers there didn't help me. So please would you mind to take a look at my particular question? I am not very experienced with Hibernate y...
 


turhanow [3 hours ago]
но что то мне подсказывает что никто в группе этим не занимался, видимо ошибка в другом..


turhanow [2 hours ago]
проблему решил скачав из мавен репозитория драйвер постгрис и положил его в lib tomcat.
но насколько это правильно...


Andrew Kuzin [2 hours ago]
вроде бы у меня была такая ошибка. но я избавился сменой профиля + немного перенастроил адрес, пароль и логин постгреса т.к. постгрес у меня был настроенный до этого курса


turhanow [1 hour ago]
> я избавился сменой профиля + немного перенастроил адрес


вот здесь поподробнее плиз


Andrew Kuzin [32 minutes ago]
ну есть файл postgres.properties, там параметры подключения к постгресу. котрые мне лично приходится менять) хотя помоему это не ваш случай.


Jury Mironov [Today at 10:33 PM]
P_20180806_223147.jpg



2 replies
Ignat [1 hour ago]
Сверху Query закомментируй


Jury Mironov [1 hour ago]
спасибо


turhanow [Today at 9:23 AM]
Хей гайс, у кого все найс с MVC?:slightly_smiling_face:
я никак не могу понять вот что. У нас в RootController есть:
`
@GetMapping("/users")
   public String users(Model model) {
       model.addAttribute("users", service.getAll());
       return "users";
   }
`
из метода видно что мы возвращаем стрингу. Теоретически я догадываюсь, что возвращаем то мы не совсем стрингу, а модель с атрибутом users, но object==String (!). И вот здесь у меня в голове засада, как jsp понимает что ему  с бэкенда возвратилась по факту коллекция, которую нужно отобразить в таблице юзеров??? (edited)


19 replies
Alexander Pilipenko [14 hours ago]
Возвращаем мы совсем стрингу return "users";

Alexander Pilipenko [14 hours ago]
В атрибуты заносим пользователей через model.addAttribute("users", service.getAll());


turhanow [14 hours ago]
Саш...а как модель с атрибутами попадает в JSP... я вот где то в уроке есть ссылка про это почитать? может я пропустил


turhanow [14 hours ago]
и почему м именно стринг возвращаем, на каком этапе именно этот тип данных нам требуется..


Alexander Pilipenko [14 hours ago]
Думаю что зедесь


Alexander Pilipenko [14 hours ago]
http://www.mkyong.com/spring-mvc/spring-mvc-hello-world-example/

Alexander Pilipenko [14 hours ago]
https://www.baeldung.com/spring-mvc-model-model-map-model-view
Baeldung
Model, ModelMap and ModelView in Spring MVC | Baeldung
Learn about the interfaces Model, ModelMap and ModelView provided by Spring MVC.
Oct 17th, 2017 at 4:54 PM
 


Alexander Pilipenko [14 hours ago]
https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-arguments


Alexander Pilipenko [14 hours ago]
String

A view name to be resolved with ViewResolver's and used together with the implicit model — determined through command objects and @ModelAttribute methods. The handler method may also programmatically enrich the model by declaring a Model argument (see above).


shtramak [13 hours ago]
return "users" означает вернуть jsp, в имени которой есть users. ViewResolver внутри добавить префикс и суффикс, который ему прописали. Это может быть даже view/users.jsp , это уж как душе угодно.


shtramak [13 hours ago]
а атрибут "users" и return "users" между собой никак не связаны

turhanow [13 hours ago]
> return "users" означает вернуть jsp, в имени которой есть users
вот за это от души спасибо! я то думал мы возвращаем аттрибут с именем users, а оказывается jsp


turhanow [13 hours ago]
@GetMapping("/users")
  public String users(Model model) {
      model.addAttribute("users", service.getAll());
      *return "users_page";*
  }
если бы названия в проекте немного различали, было бы удобнее разобраться.. (edited)


shtramak [13 hours ago]
:+1:


Yevhen Maksymovych [13 hours ago]
фактически, надо понимать, что хотя мы возвращаем только имя вида, с ним незримо гоняется модель :slightly_smiling_face:



Kirilo [7 hours ago]
При помощи интерфейса ViewResolver DispatcherServlet определяет, какой Вид нужно использовать на основании полученного имени.

Kirilo [7 hours ago]
В Spring web MVC вся работа происходит через DispatcherServlet. Так по имени выбирается нужный файл. https://www.tutorialspoint.com/spring/images/spring_dispatcherservlet.png (27 kB)


Alexander Pilipenko [5 hours ago]
и в видео про это рассказывается


Alexander Pilipenko [5 hours ago]
https://drive.google.com/open?id=0B9Ye2auQ_NsFQThUX2VyQXNiTHM


Maksim K [2:32 PM]
Хеллоу, парни и девушки!) Я снова с вами. То есть наконец-то перешел на 6 левел) И сразу вопросики) По вот этому:
`Apply 6_01_HW5_data_jpa.patch В get получаем и фильтруем Optional<User>`
Я так понимаю здесь описка и имеется ввиду `Optional<Meal>`. Или я что-то не так понимаю?)
И еще, а почему в реализации дз Григорий не использовал "уличную" магию с выводом запросов из названия методов, а использовал @Query. В видео он говорит, что, мол, эта магия работает медленнее и сам же потом говорит, что эта скорость это все относительно. Думаю для нашего проекта это не критично в плане производительности (или нет?). Но зато в целях обучения, для наглядности было бы неплохо использовать эту самую магию)) (edited)


Stanislav [Today at 3:20 PM]
Не могу понять: почему
```redirect:/meals```
работает нормально, а
```redirect:meals```
конкатенирует (http://localhost:8080/topjava/meals/meals), а в RootController-е работает и так и так. (edited)


21 replies
shtramak [8 hours ago]
ну наверн над контроллером стоит @RequestMapping("/meals")? (edited)


Stanislav [8 hours ago]
да :slightly_smiling_face:


Stanislav [8 hours ago]
только до меня не доходит, почему он конкатенирует


shtramak [8 hours ago]
ну вот он и складывает, когда даешь путь относительный (без слеша в начале)


Stanislav [8 hours ago]
спасибо

Stanislav [8 hours ago]
вроде понял)


Stanislav [8 hours ago]
нет, раньше стояло @RequestMapping(value = "/meals") поставил @RequestMapping(value = "meals") все равно то же самое


shtramak [8 hours ago]
Хм, давай все сначала)


shtramak [8 hours ago]
У тебя стоит над контроллером маппинг? Он будет работать для всех методов в контроллере и для view, которые возвращаются как return "string";


shtramak [8 hours ago]
Те маппинги, которые стоят над методами, будут добавлять еще один уровень в урл

Stanislav [8 hours ago]
Все правильно, над JspMealController стоит @RequestMapping(value = "meals")


shtramak [8 hours ago]
а над методом что?


Stanislav [8 hours ago]
@GetMapping("/delete") который return "redirect:meals"


shtramak [8 hours ago]
вот суть в "redirect:meals" и "redirect:/meals"


shtramak [8 hours ago]
в первом случае слеша в начале нет, путь относительный. Он прибавит маппинг контроллера (как я понимаю)

Stanislav [8 hours ago]
В общем понял, тут то же самое что и в файловой системе, относительный-обсолютный

shtramak [8 hours ago]
я не хочу сам лишнего сказать)) Потому что у меня именно насчет redirect сомнения

shtramak [8 hours ago]
https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-redirecting-redirect-prefix

Stanislav [8 hours ago]
он убирает delete и ставит meals


shtramak [8 hours ago]
Здесь крохи написаны, по-подробнеее бы


Stanislav [8 hours ago]
все, спасибо


Mihail Kedel [Today at 5:06 PM]
request.getParameter  в сервлете это тоже самое что аннотация RequestParam в контролере?


1 reply
Kirilo [7 hours ago]
Да. Это спринговская обертка передает ссылки на сервлет таким образом


This message was deleted.


2 replies
Yevhen Maksymovych [7 hours ago]
в тестах же


Mihail Kedel [7 hours ago]
да уже нашёл,спасибо (edited)


Jury Mironov [Today at 5:47 PM]
Как переключать профили, чтобы бины. dataSource не были дублями?  Это в spring-db. xml


1 reply
Ma3stro [5 hours ago]
попробуй mvn clean


Jury Mironov [8 hours ago]
Не понятно как с этими профилями обращаться и переключаться


Ma3stro [6 hours ago]
@Jury Mironov профиль базы можно выбрать во вкладке maven'a, профиль репозитория в tomcat, web.xml и помнике. А для тестов аннотацией


Jury Mironov [5 hours ago]
А где в томкате это?


Ma3stro [4 hours ago]
VM options -Dspring.profiles.active=...


hav [Yesterday at 10:39 AM]
Помогите разобраться с ошибкой javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU'


10 replies
alexey [13 hours ago]
а что конкретно не понятно? app.title есть у тебя в русской локали?


hav [13 hours ago]
файлы есть, app.title есть, но не видит


vch [13 hours ago]
переменная окружения точно создана?

hav [13 hours ago]
да


alexey [13 hours ago]
если остальные видит значит орфография


hav [13 hours ago]
для английской локали тоже не видит... Файлы не трогал, созданы патчем


alexey [13 hours ago]
остальные то видит?


hav [13 hours ago]
app.properties, app_ru.properties - не видит


tema.emelyan [13 hours ago]
переменная окружения не подтянулась скорее всего. Может попробуй её всунуть через IDE или перезагрузись?


hav [12 hours ago]
Все, разобрался. Прописывал в системе переменную, а она была прописана в конфиге запуска идеи, причем неправильно...


alexey [11:26 AM]
Получилось у кого нибудь настроить вывод запросов в базу для Jdbc????


Stanislav [Yesterday at 11:28 AM]
По какой причине после
 ```form method="post" action="meals/filter"``` 
и
 ```return "meals"``` 
адресная строка становится
 ```/topjava/meals/filter``` 
- это же не гет и не "redirect:/meals"


2 replies
Yevhen Maksymovych [13 hours ago]
"action" тебя фактически перебрасывает на этот урл, в контроллере ты возвращаешь вид без редиректа, соответственно, остаёшься на том урле, на котором ты попал в этот метод контроллера


Stanislav [13 hours ago]
ясно спс


Jury Mironov [Yesterday at 3:37 PM]
Could not resolve placeholder 'hibernate. format_sql'


1 reply
Jury Mironov [8 hours ago]
При запуске одного из тестов.  Это можно починить?  Не понимаю как с профилями разобраться


matrocob [Yesterday at 7:29 PM]
подскажите пожалуйста, после накатки всех патчей ошибка такая вылетает при запуске томката... Может я где-то, что-то не досмотрел?
HTTP Status 500 - An exception occurred processing JSP page /WEB-INF/jsp/index.jsp at line 6


5 replies
matrocob [5 hours ago]
а в консоли вылетает такая ошибка

Stacktrace:
    at org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:579)


matrocob [4 hours ago]
Снимок.JPG



hav [4 hours ago]
Смотри переменные окружения. у меня то же самое было.


hav [4 hours ago]
https://topjava14.slack.com/archives/CC0F4AC1W/p1533713945000057
Aleksandr Khromov
Помогите разобраться с ошибкой javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU'
Thread in #hw6Yesterday at 10:39 AM


matrocob [4 hours ago]
спасибо, сейчас гляну


hav [Yesterday at 7:56 PM]
Подскажите по 1.2 Починить Jdbc тесты (валидацию исключить). Не могу разобраться. Тесты падают на подключении JpaUtil. Как сделать чтобы  JpaUtil игнорировалось в jdbc тестах?


30 replies
Stanislav [4 hours ago]
Сделать так, что бы JpaUtils (сброс кеша) поднимался-производился только для Jpa


Stanislav [4 hours ago]
Еще одну абстракцию сделай


Victor_D [4 hours ago]
ну или можно из бинов его убрать в нужной реализации


Stanislav [4 hours ago]
В какой реализации, он внедряется в AbstractServiceTest


hav [4 hours ago]
Я не пойму как сделать чтоб он не внедрялся в jdbc реализации...


Stanislav [4 hours ago]
Есть 2 пути: 1. То что предложил Victor, прописать JpaUtils (и для чего он используется) только в тех где он нужен (где используется хибернейт + кэш 2 ур.) - но это дублирование 4 класса


Stanislav [4 hours ago]
2. Сделать еще одну абстракцию


Stanislav [4 hours ago]
Как AbstractServiceTest


Victor_D [4 hours ago]
не обязательно дублировать в 4 класса


Stanislav [4 hours ago]
ой 2 класса, у нас в User только кэш (edited)


Stanislav [4 hours ago]
все равно дублирование


Victor_D [4 hours ago]
есть аннотация, у нее есть поле


Victor_D [4 hours ago]
т.е. с помощью нее можно заглушить бин


Stanislav [4 hours ago]
По профилю?


hav [4 hours ago]
как


Victor_D [4 hours ago]
не только по профилю

hav [4 hours ago]
Можно подробнее какая аннотация

hav [4 hours ago]
Пока у меня только вариант - перенести на уровень ниже, в реализации jpa и datajpa.


Victor_D [4 hours ago]
имеет право на жизнь, но не практично, @Stanislav говорил про абстрации, тебе в эту сторону двигаться :slightly_smiling_face:


Victor_D [4 hours ago]
если я правильно его понял


Stanislav [4 hours ago]
Правильно, только я не понимаю про какую аннотацию ты пишешь, самому интересно :slightly_smiling_face: (edited)


Victor_D [4 hours ago]
Autowired


Victor_D [4 hours ago]
она же бин подтягивает


Victor_D [4 hours ago]
и она не только на поле ставится


Stanislav [4 hours ago]
я понял через какое место :slightly_smiling_face:

hav [3 hours ago]
Спасибо за подсказки, сделал. Autowired на сеттер, переопределенный в jdbc реализации.

zippospb [3 hours ago]
В autowired ещё есть параметр,  который делает внедрение необязательным


hav [3 hours ago]
Да, required, только я не понял как его применить.


zippospb [2 hours ago]
Ставишь false и тогда туда инжект происходит только если это возможно



hav [2 hours ago]
Работает, и сеттер можно не переопределять


svis [12:41 AM]
При сохранении вновь созданной еды постоянно возникает ошибка Bad value for type timestamp/date/time: {1}; nested exception is org.postgresql.util.PSQLException. Судя по логу не нравится символ "Т" перед временем
java.lang.NumberFormatException: Trailing junk on timestamp: 'T00:37'
Кто-нибудь с таким сталкивался на этом задании?


svis [Today at 12:59 AM]
Can't infer the SQL type to use for an instance of java.time.LocalDateTime. Use setObject() with an explicit Types value to specify the type to use.


2 replies
svis [20 hours ago]
В общем теперь ставлю timestamp вместо localdatetime для sql


svis [20 hours ago]
Timestamp dt = Timestamp.valueOf(meal.getDateTime());
       MapSqlParameterSource map = new MapSqlParameterSource()
               .addValue("id", meal.getId())
               .addValue("description", meal.getDescription())
               .addValue("calories", meal.getCalories())
               .addValue("date_time", dt)
               .addValue("user_id", userId);


Tanya [1:30 AM]
частая ошибка, поэтому уточню
> "1.3.2 в одном контроллере нельзя использовать другой. Чтобы не дублировать код можно сделать наследование. "
- не надо `JspMealController extends MealRestController` - контроллеры должны быть независимы один от другого (edited)


turhanow [Today at 3:36 AM]
парни, может вопрос слегка глупый...но почему мы не можем в JspMealController использовать MealRestController? а должны использовать сервис? ведь MealRestController дает нам уже готовую функциональность...

я про это:
@Autowired
   private MealService service; (edited)


4 replies
Tanya [17 hours ago]
это две разные реализации, независимые друг от друга
JspMealController не является MealRestController-ом, и 
MealRestController не является JspMealController-ом (edited)


hav [10 hours ago]
Можно сделать AbstractMealController, и оба унаследовать от него.


Crazz [8 hours ago]
почему не можем, я наследовал Jsp от Rest контроллера


turhanow [6 hours ago]
Таня выше писала же: 
частая ошибка, поэтому уточню
"1.3.2 в одном контроллере нельзя использовать другой. Чтобы не дублировать код можно сделать наследование. "
- не надо JspMealController extends MealRestController - контроллеры должны быть независимы один от другого (edited)


Макс Куркудюк [Today at 11:29 AM]
А якщо у мене tomcat 9.0, через що не запускається через plagins-cargo-cargo:run, то краще завантажити 8 версію чи можна цю проблему вирішити якось інакше, щоб залишити tomcat 9?


3 replies
Kirilo [5 hours ago]
тобі треба змінити версію в pom.xml По ідеї плагін повинен з'явитися відповідний (edited)


Макс Куркудюк [5 hours ago]
Змінював версію Tomcat у pom.xml, але всеодно cargo:run запускається з tomcat8.5.31
Ну, вже вияснив, що це не залежить від того, яка версія tomcat у мене встановлена на ноуті.


Kirilo [5 hours ago]
більше того, при запускі цього плагіна цей tomcat викачує залежності з інтернету до свого репозиторію. (edited)


hav [1:14 PM]
Не срабатывает переключение профилей Запускаю так:
```mvn clean package -Dspring.profiles.active="postgres,jdbc" -DskipTests=true org.codehaus.cargo:cargo-maven2-plugin:1.6.7:run```
Куда копать?


Макс Куркудюк [Today at 4:22 PM]
Вже поставив tomcat 8.5.32. Але всеодно через plagins-cargo-cargo:run не запускається. Просто, через tomcat-run - запускається... В чому може бети проблема? Патчі нормально лягли..


6 replies
Yevhen Maksymovych [7 hours ago]
карго запускает его не через твой установленный томкат, а через свой встроенный томкат, установка томката на это вообще никак не влияет



Yevhen Maksymovych [7 hours ago]
попробуй сделать по очереди mvn:clean mvn:package cargo:run


Yevhen Maksymovych [7 hours ago]
ну, собственно, он у тебя в эрроре и говорит, что мавен-то он запустил, но отдеплоить ему туда нечего, нет предварительно собранного варника


Макс Куркудюк [7 hours ago]
Пропустив цю настанову Григорія:
Для сборки проекта в окне Maven отключите тесты (Toggele 'Skip Tests' Mode)


Макс Куркудюк [7 hours ago]
Без цього варник збирався не вірно, так як у нас є непрацюючі тести..


Макс Куркудюк [7 hours ago]
Дякую)


Maksim K [Today at 5:20 PM]
А кто-нибудь понял, как можно указать мавен плагину, чтобы он запускал  tomcat тот, который у меня установлен.  `По умолчанию он скачивает его из центрального maven репозитория (можно также указать свой в <container><home>${container.home}</home></container>)`
Это написано в задании. Но что-то у меня не получается указать свой tomcat


1 reply
Maksim K [4 hours ago]
Получилось. Ругалось на отсутствие папки host-manager. У меня скачано несколько версий tomcat и только в одной из них была эта папка. А в остальных нет. Хз как и где я качал эти версии, но этой папки в них не было, причем что все эти версии работали и через LocalTomcat в Идее запускались норм. Для чего cargo-maven2-plugin нужна эта папка так и не понял. (edited)


Kirilo [Today at 5:48 PM]
Кто подскажет, как при создании RowMapper у нас появляется ResultSet? Здесь так же участвует контекст спринга и делает эту магию?


12 replies
Yevhen Maksymovych [5 hours ago]
тут вообще магии никакой


Yevhen Maksymovych [5 hours ago]
resultset появляется как результат jdbc-запроса


Yevhen Maksymovych [5 hours ago]
а rowmapper - это собственно, маппер, который мапит поля этого резалтсета на поля объекта. маппер спринговый, но это и руками делать можно. собственно, раньше так с jdbc и работали



Yevhen Maksymovych [5 hours ago]
получили connection, создали statement, отправили запрос, получили плоский resultset, замапили его на объект


Kirilo [5 hours ago]
Да понимаю, что это тимплейт спринговский (edited)


Yevhen Maksymovych [5 hours ago]
спринг это немного автоматизировал, но совсем чуть-чуть


Kirilo [5 hours ago]
Ага, то бишь, когда он получает данные по запросу, через JdbcTemplate то он ничего не знает о типах получаемых данных и мы как бы указываем ему переопределяя mapRow в RowMapper

Yevhen Maksymovych [5 hours ago]
да, там просто, грубо говоря, табличка приходит. а благодаря RowMapper'у он понимает, какой там тип должен быть у каждого поля, и как оно должно называться в объекте конечном


Kirilo [5 hours ago]
Странно, тогда, почему не допили для enum


Kirilo [5 hours ago]
BeanPropertyRowMapper<Role> ROW_MAPPER

Kirilo [5 hours ago]
чтобы так работало (edited)


Victor_D [1 hour ago]
ResultSet появляется из запроса, RowMapper мапит по row.
*RowMapper* же :slightly_smiling_face:
а запрос всех пользователей или админа выдаст нам 2 строки админа ( с ролью админа и с ролью юзера), соответственно нужно что-то иное для one-to-many
https://stackoverflow.com/questions/10074025/what-is-difference-between-resultsetextractor-vs-rowmapper (edited)


Макс Куркудюк [10:31 PM]
Це нормально, що у мене так багато context` ів?
Може які лишні.. (edited)
Снимоewrк.PNG 


Maxim Gusev [Yesterday at 11:09 PM]
2.1. Помогите разобраться

В
```JdbcMealRepositoryImpl```
добавил

 ```private PlatformTransactionManager transactionManager;

    public void setTransactionManager(PlatformTransactionManager txManager) {
        this.transactionManager = txManager;
    }

    TransactionDefinition txDef;
    TransactionStatus txStatus;```


В конструктор добавил
        ```TransactionDefinition txDef = new DefaultTransactionDefinition();
        TransactionStatus txStatus = transactionManager.getTransaction(txDef);```
В профиль jdbc добавил:
        ```<bean id="jdbcTransactionManager"
              class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
            <property name="dataSource" ref="dataSource" />
        </bean>

        <bean id="???"
              class="ru.javawebinar.topjava.repository.jdbc.JdbcMealRepositoryImpl">
            <property name="dataSource" ref="dataSource" />
            <property name="transactionManager" ref="transactionManager" />
        </bean>```


Не знаю, какое поставить имя бина. Подскажите, я в правильном направлении двигаюсь? (edited)


3 replies
hav [13 hours ago]
Все проще. В JdbcMealRepositoryImpl только аннотации расставить. Ну и пару строчек в профиль jdbc добавить...


Victor_D [13 hours ago]
> 8: Проверьте @Transactional(readOnly = true) сверху Jdbc..RepositoryImpl
я думаю, тебе в эту сторону :slightly_smiling_face:
ну и зачем
> class="ru.javawebinar.topjava.repository.jdbc.JdbcMealRepositoryImpl">
           <property name="dataSource" ref="dataSource" />
           <property name="transactionManager" ref="transactionManager" />
       </bean> (edited)


Merkulov [13 hours ago]
тебе просто нужно подключить праильный менеджер транзакции (2.1 Добавить транзакционность (DataSourceTransactionManager) в Jdbc реализации )для твоего Jdbc профиля ну и сделать чтбы все транзакции работали через аннотацию @Transactional


Chensy [Aug 10th at 4:58 PM]
Всем привет! подскажите, при реализации jdbcUserRepo.. при создании нового юзера нужно для метода save() сначала делать insert в таблицу юзеров, а потом отдельный insert в таблицу ролей? (edited)


2 replies
alexey [2 days ago]
я именно так и делал


Victor_D [2 days ago]
угу, ведь id генерится со при инсерте


Maksim K [Aug 10th at 10:01 PM]
Вопрос по `javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU'.`
Тут уже выше были подобные вопросы. Пишут что надо посмотреть переменные окружения. Про какие переменные идет речь, может кто подскажет?


23 replies
Yevhen Maksymovych [2 days ago]
TOPJAVA_ROOT


Maksim K [2 days ago]
а где ее надо посмотеть? в идеешке где-то есть? или надо в самой винде прописать? и что там прописывать? путь к корневому каталогу проекта?


Victor_D [2 days ago]
Переменные среды в win (edited)


Yevhen Maksymovych [2 days ago]
В самой винде. Должна указывать на каталог проекта


Maksim K [2 days ago]
ща попробую. а че это нигде про это не было сказано? или я что-то пропустил?)


Yevhen Maksymovych [2 days ago]
Ещё в первом уроке было, когда логирование настраивали


Victor_D [2 days ago]
Панель управления\Система и безопасность\Система


Maksim K [2 days ago]
ох. как давно это было) видимо тогда я это пропустил)


Nikolay [2 days ago]
в идее можно назначить эти переменные


Maksim K [2 days ago]
ща глянул в первом уроке действительно про это говорилось. чего я тогда это не сделал? хз)) и как-то ж дожил до 6 левела))
@Victor_D спасибо. я знаю где в винде настраивать переменные среды. уже как-то приходилось)
@Nikolay а где в идее их можно назначить?


Nikolay [2 days ago]
сейчас не у компа, если вспомню правильно, там где меню run/debug, есть пункт edit configuration... (вроде), там несколько вкладок, тебе нужна 3, кажется. там будет environment variable. добавляй и пользуйся (edited)


Maksim K [2 days ago]
@Nikolay спс. нашел. но я уже в винде прописал. все заработало) но буду иметь ввиду (edited)


Maksim K [2 days ago]
Спасибо, парни. А то я тут уже гугл изнасиловал в поисках решения. Надо было сразу у вас спросить))


e.pekhterev [2 days ago]
я тоже прилично бился над этой проблемой, потом решил, а уже потом продолжил смотреть видео и Григорий минут через пять показал чего надо было делать))) уже какой раз так))) (edited)


Maksim K [2 days ago]
я блин ща тоже видео это как раз смотрю. и там про это говорится. ))) я просто сначала установил патч, попробовал запустить, не пошло, начал решать проблему. люди добрые подсказали, а ща смотрю видео и там это оказывается есть. :man-facepalming:


Maksim K [2 days ago]
@e.pekhterev кстати, раз уж пошла такая пьянка. а у тебя получилось сделать чтобы отображалось на английском? я в хроме выставил английский язык на первое место в настройках, перезапустил приложение и все равно на русском все пишет


e.pekhterev [2 days ago]
после патча 6_15_spring_i18n.patch должно выставляться


e.pekhterev [2 days ago]
а до этого нужно было полностью русский удалять


Maksim K [2 days ago]
ну так я после него и пробую. не получается

e.pekhterev [2 days ago]
у меня всё работает правильно


Maksim K [2 days ago]
и в видео Григорий выставил кодировку в UTF-8 и у него в app_ru.properties все стало на русском, а у меня все равно вот такая хрень \u0440\u0438\u043B\. только если поставить в настройках галочку на transparent... тогда пишет на русском

Maksim K [1 day ago]
уже все работает. ниче не менял. пару раз попереставлял языки туда сюда и заработало. магия не иначе)

e.pekhterev [1 day ago]
@Maksim K перед накаткой последнего патча нужно было снять галочку с *transparent native-to-ascii conversion* (если она стоит, то сообщения для ru обновляются некорректно, с этим я тоже бился делая хард резет до предыдущего патча).


e.pekhterev [11:03 AM]
Други и подруги, я так понимаю SpringMain чинить не нужно?

Johann [12:07 PM]
я тоже так понял, но починил, в результате выяснил, что в наследовании MealRestController накосячил, так что может быть полезно.


ahmed [Yesterday at 5:16 PM]
Ребята, а 7 здание через неделю?


2 replies
Yevhen Maksymovych [1 day ago]
В четверг


Kirilo [1 day ago]
https://github.com/JavaWebinar/topjava#Большое-ДЗ--выпускной-проект--подтягиваем-хвосты
JavaWebinar/topjava
Stars
----------------
7

Language
----------------
Java

JavaWebinar/topjavaFeb 15th at 11:52 AM Added by GitHub
(edited)


Maksim K [Yesterday at 9:46 PM]
Ребятки, что вот это значит `1.3.1 разнести запросы на update/delete/.. по разным методам (попробуйте вообще без action=).`? Что значит вообще без action? Это значит вообще его убрать из запроса? То есть что-то типа /meals/update/12345 надо сделать? Или как?


19 replies
sky [1 day ago]
+


Maksim K [1 day ago]
люблю, когда оперативно отвечают))

sky [1 day ago]
)

Maksim K [1 day ago]
ну, если так, тогда это меняет дело. а то я тут подзавис с этим требованием)


shtramak [1 day ago]
если что, @PathVariable в помощь


Maksim K [1 day ago]
@shtramak спс. я в курсе)) но там типа сказано `(аннотации на параметры и адаптеры для LocalDate/Time мы введем позже).` Я так понимаю здесь и имелось ввиду, что @PathVariable введем позже. Или я не так понял?)


sky [1 day ago]
По идее вроде как без них надо на этом этапе попробовать. Но парсинг урла (пусть и с кое-какими упрощалками) меня что-то не привлек, поэтому пафвариэйбл


Maksim K [1 day ago]
Короч, я так понял все забили и сделали с @PathVariable )))


shtramak [1 day ago]
:slightly_smiling_face:


sky [1 day ago]
Остается надеятся что в задании имелись ввиду @RequestParam

sky [1 day ago]
только*


Maksim K [1 day ago]
мы это узнаем через пару дней)

e.pekhterev [1 day ago]
смотри на рутКонтроллер и делай аналогично:
@GetMapping("/meals/create") и т.д. (edited)



e.pekhterev [1 day ago]
либо по классике вместо @GetMapping:
@RequestMapping(value = "/meals/create", method = RequestMethod.GET)


Макс Куркудюк [11 hours ago]
Нам приходить url
http://localhost:8080/topjava/meals?action=update&id=100005
Як зробити, щоб було 
http://localhost:8080/topjava/meals/update?id=100005
Переробляти meals.jsp
<a href="meals/update?id=${meal.id}">Update</a>
Але ж тоді не буде працювати MealServlet... (edited)


sky [11 hours ago]
<a href="meals/update/${meal.id}">Update</a>


Макс Куркудюк [11 hours ago]
Отже не зважати на MealServlet?
Інакше звісно придумав, як можна, але це навряд можна буде назвати хорошим Spring Controller`ом...)


Макс Куркудюк [11 hours ago]
Дякую)

e.pekhterev [9 hours ago]
*Але ж тоді не буде працювати MealServlet* - он и не должен работать, вернее его не должно быть вообще:
_1.3 Удалить сервлеты и перенести функциональность MealServlet в JspMealController контроллер_


Mihail Kedel [Today at 12:38 PM]
Доделал домашку и начал потихоньку делать выпускное задание,и подумал что у нас в проекте,при создании нового юзера,как бы создаётся и новая роль(по сути новая запись в бд),не проще было бы сделать у юзера внешний ключ(например user_role_id),который бы указывал на id роли юзера,тогда б в таблице ролей гораздо меньше записей было бы,или это уже дело вкуса?


3 replies
vch [11 hours ago]
Если делать поле role_id в таблице юзера, то он будет иметь только 1 роль. А нам надо несколько ролей у 1 юзера. Тут 2 варианта - либо доптаблица, либо упаковывать идентификаторы роли через битовые маски в Integer поле.


Mihail Kedel [11 hours ago]
так у нас пока 2 роли только.В моём представление админ должен уметь то ,что умеет делать пользователь + ещё какую то свою функциональность(типо управления пользователями и т.д.)


Stanislav [10 hours ago]
Вы сами отвечаете на свой вопрос
 ```В моем представлении...```
Все зависит от предметной области - что конкретно хочет заказчик-тот кто дает задачу.


Merkulov [Today at 2:16 PM]
В AbstractUserServiceTest поле jpaUtil c аннотацией @Autowired(required = false). получается не совсем правильное решение, так как в некоторых реализациях необходимо это поле, но делать еще абстракцию ради одного поля, как-то... может есть более элегантное решение? куда копать


15 replies
sky [10 hours ago]
можно оставить эту аннотацию, а обращаться в некоторых реализациях к этому полю, только если выполнится какое-нибудь условие, например


Merkulov [10 hours ago]
понял про что ты


Merkulov [10 hours ago]
ммм.. я так и делаю


Merkulov [10 hours ago]
все равно сказали не хорошая идея

Merkulov [10 hours ago]
менторы

Merkulov [10 hours ago]
@Autowired(required = false) получается спринг если нет такого бина то не инжектит и все хорошо, а вот в некоторых реализациях этот бин обязателен, там нужно @Autowired(required = true)

Merkulov [10 hours ago]
а при @Autowired(required = true) падает с ошибкой, что  ожидаемо, так как бина то нет


Stanislav [9 hours ago]
Делай так что бы приняли. По мне так, все это не очень хорошая идея. Например, надо запустить тест только одного метода, как? Так же, тесты должны быть максимально просты, тут же надо разбираться с абстракциями, кто, что, от куда....


sky [9 hours ago]
Ну по разному сделать наверно можно, вот например что придумал только что: создать абстрактный класс AbstractUtil и инжектить его. У него 2 реализации с анатоциями @profile - 1 для jdbc, 1 для всяких jpa. Реализация для jdbc - просто заглушка, а для jpa - существующий JpaUtil


Stanislav [9 hours ago]
Так же, прививают не правильную терминалогию с моками, не используем реальное понятие.


sky [9 hours ago]
Что то будет еще про моки, занятии на 9 вроде


Merkulov [9 hours ago]
на счет классами с двумя реализациями я уже думал

Merkulov [9 hours ago]
*абстрактного класса

sky [9 hours ago]
тоже не примут?

Stanislav [9 hours ago]
Григорий сказал что с Мокито или моки со Спринга работать не будем


Макс Куркудюк [Today at 3:03 PM]
Як можна це виправити?
Виходить, що у meals.jsp даний шлях працює як потрібно, а у mealForm.jsp - виділяє той же шлях червоним і всеодно працює, але якось не вірно...
В першому шлях починається після webapp/WEB-INF/jsp/шлях
В другому - з webapp/шлях (edited)
Снимо222к.PNG



11 replies
e.pekhterev [7 hours ago]
смотри пункт 3 подсказок к ДЗ


Макс Куркудюк [6 hours ago]
3 пункт до ДЗ - там же про url типу /topjava/meals/meals (типу посилання на метод з JspMealController)
А в мене (<jsp:include page="fragments/headTag.jsp"/>) - це ж просто шлях до файлу.
Він же має бути не змінним, так як ми задаємо його у spring-mvc/xml
<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"
         p:prefix="/WEB-INF/jsp/"
         p:suffix=".jsp"/>


Макс Куркудюк [6 hours ago]
Якщо скопіювати весь код mealForm.jsp і вставити у нову наприклад meal.jsp - то дана проблема зникає(шлях нормально розпізнається і не світиться червоним). Але коли змінюю назву цього meal.jsp на mealForm.jsp - з'являється та ж проблема...


Макс Куркудюк [3 hours ago]
Коли змінюю назву файлу mealForm.jsp наприклад на mealForms.jsp - одразу все вирішується, а коли вертаю назву назад - вертається і червоний шрифт...
Що це може бути? Може це так потрібно, а я туплю?


e.pekhterev [3 hours ago]
зайди в headTags.jsp и посмотри, что там.
потом зайди в mealForm и посмотри теперь что лишнее. (edited)


e.pekhterev [3 hours ago]
да и в meals.jsp таже проблема


e.pekhterev [3 hours ago]
подсказка - в headTags.jsp  уже объявлен <HEAD>...</HEAD>
инклудом ты просто вставляешь содержимое документа в текущий и сейчас у тебя тупо дублирование кода


Макс Куркудюк [2 hours ago]
Туплю... Дякую)
Просто у браузері не дублювалось, тому не помітив...


e.pekhterev [2 hours ago]
ничего, бывает

Макс Куркудюк [2 hours ago]
Але всеодно, той адрес має червоний шрифт. 
І через це, певно, так відрізняється header у браузері.. Стилі і кольори зникають.. (edited)
Снимок2343.PNG



e.pekhterev [2 hours ago]
смотри пункт 3 подсказок к ДЗ


Join_Selectovich [Today at 3:12 PM]
В скрпитах initDB.sql у нас на уровне БД для Meal установлено каскадное удаление
*FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE*
Так же каскадное удаление установлено и на уровне Hibernate
*@OnDelete(action = OnDeleteAction.CASCADE)*
как получается что это не приводит к рассинхронизации (edited)


2 replies
Join_Selectovich [8 hours ago]
Кажется разобрался, аннотацией
*@OnDelete(action = OnDeleteAction.CASCADE)* мы лишь указываем Hibernate , что каскадные операции установлены на уровне БД. (edited)


e.pekhterev [7 hours ago]
да, именно это Григорий говорит в видео


Join_Selectovich [3:16 PM]
Вроде же какскадные изменения или в БД устанавливать нужно или на уровне Hibernate, т.е. в одном месте , а у нас оно и там и там (edited)


Kirilo [12:05 PM]
Интересно, что на это этапе в RootController мы вполне могли использовать метод setUser в таком виде:
   @PostMapping("/users")
   public String setUser(@RequestParam Integer userId) {
       SecurityUtil.setAuthUserId(userId);
       return "redirect:meals";
   } (edited)


Maksim K [Aug 13th at 12:06 PM]
Товарищи, нужна помощь. Что-то я ваще уже по ходу туплю. У меня `request.getParameter("id")` возвращает всегда null. Не могу понять что за фигня. Вот мой метод delete к примеру.
`@GetMapping("/meals/delete/{id}")
   public String deleteMeal(HttpServletRequest request) {
       int mealId = Integer.valueOf(request.getParameter("id"));
       delete(mealId);
       return "meals";
   }`


39 replies
Kirilo [2 days ago]
нужно дебажить, чтобы понимать, что происходит и откуда куда что попадает


shtramak [2 days ago]
ну у тебя @PathVariable. Скорее всего, если сотрешь {id}, будет работать


shtramak [2 days ago]
Но это  надо пробовать


Stanislav [2 days ago]
Не туда полез
```...аннотации на параметры и адаптеры для LocalDate/Time мы введем позже```
Если не знаешь аннотации, то делай по старинке, передавай через параметры, а не через uri


Maksim K [2 days ago]
а что с HttpServletRequest request не должно работать? только с @PathVariable?


Stanislav [2 days ago]
А где ты передаешь параметр что бы его получить через request.getParameter("id")?


Stanislav [2 days ago]
Если уж не в терпеж, почитай про @PathVariable и параметр "params" в @GetMapping и @PostMapping



Ignat [2 days ago]
Spring MVC должен передать `HttpServletRequest` если он сигнатуре метода указан. Другой вопрос, зачем он нужен, если тебе нужен только id. Юзай `@PathVariable`.


Maksim K [2 days ago]
я читал про это. видимо я просто не очень разобрался с HttpServletRequest request. получается в request мы можем передать параметр только в методе пост через форму jsp


Ignat [2 days ago]
С request'a можно параметр получить не только в POST запросе.


shtramak [2 days ago]
```<c:url var="updateLink" value="/meals/showmeals">
<c:param name="mealId" value="${meal.id}"/>
</c:url>
<a href="${updateLink}">Update</a>```
(edited)


shtramak [2 days ago]
типа такого тебе в get даст параметр


Maksim K [2 days ago]
ммм...ладно, ща че-нить еще почитаю про реквест


Stanislav [2 days ago]
Ты наверно не понимаешь что в твоем - @GetMapping("/meals/delete/{id}")  - нет параметров


Stanislav [2 days ago]
Это ссылка - url (path)


Maksim K [2 days ago]
ну вот я думал, что здесь {id} передается параметр)


Stanislav [2 days ago]
нет, параметр передается в @GetMapping("/meals/delete", params = "id")


Stanislav [2 days ago]
А так ты id загоняешь в path-url и его вытаскивать надо по другому

Kirilo [2 days ago]
Все так же работает, как в примере с сервлетом, у которого есть запрос и ответ. Просто здесь сам сервлет скрыт, но есть запрос и ответ к нему и от него :slightly_smiling_face: (edited)


Stanislav [2 days ago]
И если уж загонять в url то вот так @GetMapping("/meals/{id}/delete")


Maksim K [2 days ago]
а если параметр передается так @GetMapping("/meals/delete", params = "id"), то урл должен быть что-то типа `/meals/delete?id=123`


Stanislav [2 days ago]
да


Maksim K [2 days ago]
нда. по ходу я просто всего начитался и у меня каша в голове. уже все попутал. надо все переосмыслить) но в любом случае хорош, что спросил. уже кое-что прояснилось. а то жил бы так в неведении))


Stanislav [2 days ago]
Помимо чтения текста, советую читать исходники (берешь гит, в поиске вводишь ключевые слова и смотришь кто как делает). (edited)


Kirilo [2 days ago]
еще раз посмотри как с сервлетом все было, чтобы понимать, что происходит (edited)


Maksim K [2 days ago]
а еще почему надо так загонять параметр @GetMapping("/meals/{id}/delete"), а не так @GetMapping("/meals/delete/{id}")


Maksim K [2 days ago]
какая разница?

Stanislav [2 days ago]
сейчас, была ссылка


Kirilo [2 days ago]
как ссылки раставишь над методами контроллера, так и будет


Stanislav [2 days ago]
Руководствоваться логикой, сейчас кину ссылку

Ignat [2 days ago]
Если руководствоваться логикой, то удалять надо через `DELETE` а не `GET`

Ignat [2 days ago]
Тогда вопрос где ставить `id` самовыпилится сам собой

Stanislav [2 days ago]
https://blog.mwaysolutions.com/2014/06/05/10-best-practices-for-better-restful-api/


Stanislav [2 days ago]
https://habr.com/company/yandex/blog/265569/
Хабр
15 тривиальных фактов о правильной работе с протоколом HTTP
Внимание! Реклама! Пост оплачен Капитаном Очевидность! Ниже под катом вы найдёте 15 пунктов, описывающих правильную организацию ресурсов, доступных по... (435 kB)


Maksim K [2 days ago]
ну вот, кстати, про это я тоже не понял. пробовал и ставить @DeleteMapping. Какая разница между гет и делит?


Stanislav [2 days ago]
Эти ссылки в выпускном проекте есть


Maksim K [2 days ago]
я читал по другим ссылкам. ща эти почитаю. спасибо. а выпускной я не начинал. мне бы тут все успеть и понять)


Prodigy [2 days ago]
а так, не?)
```@RequestMapping(value = "edit/{id}", method = RequestMethod.GET)
public String showEdit(@PathVariable("id") Integer id, Model model)```
(edited)


Grigory Kislin [2 days ago]
@Maksim K параметры в @RequestMapping у нас будут на след. уроке. пока см. 1.3
>  Можно по аналогии с RootController#setUser принимать HttpServletRequest request (аннотации на параметры и адаптеры для LocalDate/Time мы введем позже).
тогда каши не будет:)


Victor [Aug 13th at 3:07 PM]
Сломалось моё приложение, пока спал:grin:. Вылетает на ошибке '''org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set''' попробовал загрузить HW5, та же ошибка. Думаю сносить репозитарий Maven. Help me, please...


6 replies
Ma3stro [2 days ago]
А может попробовать установить диалект сначала?) (edited)


Mihail Kedel [2 days ago]
+,тоже самое хотел сказать,https://stackoverflow.com/questions/26548505/org-hibernate-hibernateexception-access-to-dialectresolutioninfo-cannot-be-null
Stack Overflow
org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set
I am trying run a spring-boot application which uses hibernate via spring-jpa, but i am getting this error: Caused by: org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be n...
 


Victor [2 days ago]
У нас диалект сам устанавливается... Устанавливать не нужно, где-то на первых уроках это было.


Grigory Kislin [2 days ago]
это- нет коннекта к базе (edited)



realcorwin [2 days ago]
в следующий раз не будешь спать! :slightly_smiling_face:

Victor [2 days ago]
Спасибо!
Говорила мне бабушка: Если что не так, перезагрузи комп... )))))


Mihail Kedel [Aug 13th at 4:44 PM]
@Merkulov говорил что писать @Autowired(required = false) над полем jpaUtil не совсем правильно,поэтому я попробовал изменять аннотацию Autowired(точнее её параметр required) прямо в runtim'е с помощью reflection,но падает та же ошибка.Подскажите кто reflection знает,что не так.Просто,как по мне,довольно интересная концепция. (edited)
Untitled
​
@Override
  @Before
  public void setUp() throws Exception {
    Field field = JdbcUserServiceTest.class.getDeclaredField("jpaUtil");
    Annotation oldAutowired = field.getAnnotation(Autowired.class);
    field.setAccessible(true);
​
    Annotation newAutowired = new Autowired(){
​
      @Override
      public Class<? extends Annotation> annotationType() {
        return null;
      }
​
      @Override
      public boolean required() {
        return false;
      }
    };
​
    Map<Class<? extends Annotation>, Annotation> annotationMap =
        (Map<Class<? extends Annotation>, Annotation>) field.get(JdbcUserServiceTest.class);
    annotationMap.put(Autowired.class, newAutowired);
  }
Collapse


6 replies
Alexander Pilipenko [2 days ago]
ИМХО ошибка возникает еще до выполнения твоего кода

shtramak [2 days ago]
Непонятно, что делает твой код, если честно.. Спринг работает с проксями, ты колдуешь над оригинальным классом. Если уж тебе хочется такие задумки делать, то это надо через BeanPostProcessor все делать (Борисов и спринг-поторошитель в помощь). Но непонятно зачем



e.pekhterev [2 days ago]
и зачем вы так делаете? там через наследование всё решается


hav [2 days ago]
Autowired можно не только над полем ставить...


Alexander Pilipenko [2 days ago]
Что-то у меня пока ни как не получается с помощью такого метода сдалать, чтобы тесты работали


Nikolay [2 days ago]
можно мок сделать еще для jdbc реализации


dmitry_ov [Aug 13th at 6:34 PM]
Коллеги, а кто как сравнивает свой репозиторий с "эталонным", который у Григория  ?
Какие инструменты есть.
Подходит ли Meld для такой задачи ? (edited)


11 replies
Victor [2 days ago]
копипаст и смотри контроль версий :slightly_smiling_face:

dmitry_ov [2 days ago]
Подходит ли Meld для такой задачи ?


Victor [2 days ago]
в idea в git есть compare branches... сам не пользовался


sky [2 days ago]
пкм внутри класса  -> compare with clipboard - сравнивает со скопированным в буфер


Stanislav [2 days ago]
А зачем такое делать?:thinking_face:


dmitry_ov [2 days ago]
Убедиться, что правильно накатил патчи


Yevhen Maksymovych [1 day ago]
я писал инструкцию как-то в теме гита


Yevhen Maksymovych [1 day ago]
```git remote add -f b https://github.com/JavaWebinar/topjava.git
git remote update
git diff master remotes/b/master > canonical.patch
git remote rm b```



Yevhen Maksymovych [1 day ago]
добавляем репозиторий Григория, и делаем дифф в файл. если что-то отличается, этот же файл можем потом накатить патчем


Ignat [1 day ago]
@Yevhen Maksymovych лучше конечно не `b` называть, а `upstream`. И понятней, и по уму чтоб сразу было.


Ignat [1 day ago]
Зачем Meld если compare with branch в idea сделает тоже самое только без дополнительных приседаний.


turhanow [Yesterday at 11:57 AM]
ребят, привет. не могу преодолеть тест апдейт...исключение:
'java.sql.SQLException: statement is not in batch mode'
batchUpdate делал по анологии с https://www.mkyong.com/spring/spring-jdbctemplate-batchupdate-example/
почему пишет что не находится в пакетном режиме?


6 replies
Merkulov [1 day ago]
какой у тебя sql запрос? напиши


turhanow [1 day ago]
UPDATE user_roles SET role=? WHERE user_id=?


Merkulov [1 day ago]
а если нужно вставить новую роль пользователю? есть запрос для вставки записи


Merkulov [1 day ago]
твой запрос обновляет только существующие записи в таблице, а если я при редактировании пользователя добавлю ему новую роль то этот запрос обновит то что есть по id пользователя записи и ничего не добавит, а ты, наверное, в тесте добавляешь новую роль и хочешь чтобы работало через batchUpdate, я думаю, что запрос не подходит для batchUpdate, типа не может вставить весь пакет обновляемых данных, хотя могу ошибаться. Делай строго по примеру выше который ты слал...


Merkulov [1 day ago]
Использование batch режима выполнения запросов обычно гораздо эффективнее. В этом режиме запросы не выполняются сразу, каждый по отдельности, а накапливаются и выполняются одним большим запросом с множеством данных. Например, если вы делаете несколько update запросов, то каждый запрос будет выполнен как отдельный самостоятельный запрос. В batch режиме ваши update запросы будут отправлены одним заданием, что производительнее.


Merkulov [1 day ago]
https://easyjava.ru/spring/spring-data-access/batch-operacii-v-spring-jdbc/
EasyJava
Batch операции в Spring JDBC
Использование batch режима выполнения запросов обычно гораздо эффективнее. В этом режиме запросы не выполняются сразу, каждый по отдельности, а накапливаются и выполняются одним большим запросом с множеством данных. Например, если вы делаете несколько update запросов, то каждый... #h2 #jdbc #spring (39 kB)
Jan 7th, 2016 at 3:13 PM


Join_Selectovich [9:17 PM]
В видео про кэш хибернейта видно что из spring-db.xml есть ссылка на файл с конфигурацией кеша *ehcache.xml* у нас же после наката патчей в spring-db.xml этого нет.
Внимание вопрос!
С какими же параметрами в вступит работу кэширование 2го уровня Hibernate?


Join_Selectovich [Yesterday at 9:17 PM]
https://drive.google.com/file/d/0B9Ye2auQ_NsFeTV0SUFfblk5NE0/view
c 5ой минтуы


7 replies
sky [1 day ago]
теперь у нас hibernate-jcache и ссылка https://imhoratiu.wordpress.com/2017/01/26/spring-4-with-ehcache-3-how-to (edited)


Join_Selectovich [1 day ago]
зашибись ) .  видео получается подустарело немного.
и че-то ссылка не открывается.
а этот jcache тоже работает с ehcache.xml?


Join_Selectovich [1 day ago]
еш-кэш ) - буду вспомиать этот файл когда детей кашей кормить буду :slightly_smiling_face:


Grigory Kislin [1 day ago]
@Join_Selectovich в уроке под видео есть - Кэш мигрировал на 3.x
конфигурацию счас еще проверю- похоже что у нас идет по умолчанию



Grigory Kislin [1 day ago]
да, при запуске выдает WARN:
22:08:19.342 WARN  o.h.cache.jcache.internal.JCacheRegionFactory.createCache:93 - HHH90001006: Missing cache[ru.javawebinar.topjava.model.User.roles] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting 'hibernate.javax.cache.missing_cache_strategy' to 'create'.

22:08:19.353 WARN  o.h.cache.jcache.internal.JCacheRegionFactory.createCache:93 - HHH90001006: Missing cache[ru.javawebinar.topjava.model.User] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting
'hibernate.javax.cache.missing_cache_strategy' to 'create'.

https://github.com/hibernate/hibernate-orm/blob/master/documentation/src/main/asciidoc/userguide/chapters/caching/Caching.adoc#jcache-missing-cache-strategy (edited)


Join_Selectovich [1 day ago]
Как в этом всем можно ориентироваться? :shocked_face_with_exploding_head: столько всего неочевидного...


Also sent to the channel
Grigory Kislin [10 hours ago]
@Join_Selectovich ну...
- Кэш мигрировал на 3.x- видно в уроке..
- url что я дал есть в `spring-db.xml` над пропертями- зайти и прочитать..
ну и логи посмотреть исходя из этого... или можно даже без url
те немного поискать и все есть
просто начинать это делать- и все станет очевидно со временем


Alex_Akkerman [11:00 PM]
Доброе время суток, помогите разобраться в чем заминка, с клонировал  проект https://github.com/JavaWebinar/topjava.git запускаю вылетает ошибка   во вложении лог
topjava.log 
2018-08-14 22:54:54,134 INFO  org.springframework.web.context.ContextLoader.initWebApplicationContext:270 - Root WebApplicationContext: initialization started
2018-08-14 22:54:54,194 INFO  o.s.web.context.support.XmlWebApplicationContext.prepareRefresh:590 - Refreshing Root WebApplicationContext: startup date [Tue Aug 14 22:54:54 EEST 2018]; root of context hierarchy
2018-08-14 22:54:54,236 INFO  o.s.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions:316 - Loading XML bean definitions from class path resource [spring/spring-app.xml]
2018-08-14 22:54:54,360 INFO  o.s.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions:316 - Loading XML bean definitions from class path resource [spring/spring-tools.xml]
2018-08-14 22:54:54,540 INFO  o.s.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions:316 - Loading XML bean definitions from class path resource [spring/spring-db.xml]
2018-08-14 22:54:54,609 INFO  o.s.b.f.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions:139 - Skipped XML bean definition file due to specified profiles [hsqldb] not matching: class path resource [spring/spring-db.xml]
2018-08-14 22:54:54,617 INFO  o.s.b.f.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions:139 - Skipped XML bean definition file due to specified profiles [tomcat] not matching: class path resource [spring/spring-db.xml]
2018-08-14 22:54:54,619 INFO  o.s.b.f.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions:139 - Skipped XML bean definition file due to specified profiles [jdbc] not matching: class path resource [spring/spring-db.xml]
2018-08-14 22:54:54,636 INFO  o.s.b.f.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions:139 - Skipped XML bean definition file due to specified profiles [jpa] not matching: class path resource [spring/spring-db.xml]
2018-08-14 22:54:55,382 INFO  org.ehcache.xml.XmlConfiguration.parseConfiguration:177 - Loading Ehcache XML configuration from /home/alex/IdeaProjects/topjava/target/topjava/WEB-INF/classes/cache/ehcache.xml.
2018-08-14 22:54:55,399 WARN  o.s.web.context.support.XmlWebApplicationContext.refresh:558 - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Cannot create inner bean 'org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter#65a7c516' of type [org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter] while setting bean property 'jpaVendorAdapter'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter#65a7c516' defined in class path resource [spring/spring-db.xml]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0': Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
2018-08-14 22:54:55,411 ERROR org.springframework.web.context.ContextLoader.initWebApplicationContext:316 - Context initialization failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [spring/spring-db.xml]: Cannot create inner bean 'org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter#65a7c516' of type [org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter] while setting bean property 'jpaVendorAdapter'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter#65a7c516' defined in class path resource [spring/spring-db.xml]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0': Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:327)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:124)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1611)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1363)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:580)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1089)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:859)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:550)
	at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:409)
	at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:291)
	at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:103)
	at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4627)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5091)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:742)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:718)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:703)
	at org.apache.catalina.startup.HostConfig.manageApp(HostConfig.java:1737)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:564)
	at org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:287)
	at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:809)
	at java.management/com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
	at org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:456)
	at org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:405)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:564)
	at org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:287)
	at java.management/com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:809)
	at java.management/com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
	at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1466)
	at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.access$300(RMIConnectionImpl.java:75)
	at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1307)
	at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1399)
	at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:827)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:564)
	at java.rmi/sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:359)
	at java.rmi/sun.rmi.transport.Transport$1.run(Transport.java:200)
	at java.rmi/sun.rmi.transport.Transport$1.run(Transport.java:197)
	at java.base/java.security.AccessController.doPrivileged(Native Method)
	at java.rmi/sun.rmi.transport.Transport.serviceCall(Transport.java:196)
	at java.rmi/sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:567)
	at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:800)
	at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:682)
	at java.base/java.security.AccessController.doPrivileged(Native Method)
	at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:681)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
	at java.base/java.lang.Thread.run(Thread.java:844)
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter#65a7c516' defined in class path resource [spring/spring-db.xml]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0': Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:589)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:312)
	... 60 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0': Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:378)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:110)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1611)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1363)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:580)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:204)
	at org.springframework.aop.framework.autoproxy.BeanFactoryAdvisorRetrievalHelper.findAdvisorBeans(BeanFactoryAdvisorRetrievalHelper.java:94)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.findCandidateAdvisors(AbstractAdvisorAutoProxyCreator.java:109)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.findEligibleAdvisors(AbstractAdvisorAutoProxyCreator.java:94)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.getAdvicesAndAdvisorsForBean(AbstractAdvisorAutoProxyCreator.java:76)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.wrapIfNecessary(AbstractAutoProxyCreator.java:352)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.postProcessAfterInitialization(AbstractAutoProxyCreator.java:304)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:439)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1712)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:581)
	... 62 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.AnnotationCacheOperationSource#0': Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:589)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:367)
	... 80 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.config.internalJCacheAdvisor': Cannot resolve reference to bean 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0' while setting bean property 'cacheOperationSource'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:378)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:110)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1611)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1363)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:580)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:204)
	at org.springframework.aop.framework.autoproxy.BeanFactoryAdvisorRetrievalHelper.findAdvisorBeans(BeanFactoryAdvisorRetrievalHelper.java:94)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.findCandidateAdvisors(AbstractAdvisorAutoProxyCreator.java:109)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.findEligibleAdvisors(AbstractAdvisorAutoProxyCreator.java:94)
	at org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator.getAdvicesAndAdvisorsForBean(AbstractAdvisorAutoProxyCreator.java:76)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.wrapIfNecessary(AbstractAutoProxyCreator.java:352)
	at org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator.postProcessAfterInitialization(AbstractAutoProxyCreator.java:304)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:439)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1712)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:581)
	... 86 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.interceptor.DefaultJCacheOperationSource#0': Cannot resolve reference to bean 'ehCacheManager' while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:378)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:110)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1611)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1363)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:580)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:367)
	... 104 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'ehCacheManager' defined in class path resource [spring/spring-tools.xml]: Cannot create inner bean 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' of type [org.springframework.cache.jcache.JCacheManagerFactoryBean] while setting bean property 'cacheManager'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:327)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:124)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1611)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1363)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:580)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:317)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:315)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:367)
	... 114 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.jcache.JCacheManagerFactoryBean#61de3c07' defined in class path resource [spring/spring-tools.xml]: Invocation of init method failed; nested exception is java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1708)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:581)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:503)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:312)
	... 124 common frames omitted
Caused by: java.lang.NoClassDefFoundError: javax/xml/bind/JAXBException
	at org.ehcache.xml.XmlConfiguration.parseConfiguration(XmlConfiguration.java:178)
	at org.ehcache.xml.XmlConfiguration.<init>(XmlConfiguration.java:166)
	at org.ehcache.xml.XmlConfiguration.<init>(XmlConfiguration.java:134)
	at org.ehcache.jsr107.EhcacheCachingProvider$ConfigSupplier.getConfiguration(EhcacheCachingProvider.java:327)
	at org.ehcache.jsr107.EhcacheCachingProvider.getCacheManager(EhcacheCachingProvider.java:127)
	at org.ehcache.jsr107.EhcacheCachingProvider.getCacheManager(EhcacheCachingProvider.java:78)
	at org.springframework.cache.jcache.JCacheManagerFactoryBean.afterPropertiesSet(JCacheManagerFactoryBean.java:82)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1767)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1704)
	... 127 common frames omitted
Caused by: java.lang.ClassNotFoundException: javax.xml.bind.JAXBException
	at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1292)
	at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1121)
	... 136 common frames omitted


zippospb [23 hours ago]
Причина почти сразу находится поиском по последнему в логе эксепшену



zippospb [22 hours ago]
И в 4 уроке Григорий давал ссылку с вариантом решения данной проблемы (edited)



Alex_Akkerman [2 hours ago]
Если вы используете Java 9, то возникают проблемы с JAXBException (пакет java.xml.bind). См. решение ?


zippospb [2 hours ago]
Да


Grigory Kislin [1:42 PM]
replied to a thread:

@Join_Selectovich ну...
- Кэш мигрировал на 3.x- видно в уроке..
- url что я дал есть в `spring-db.xml` над пропертями- зайти и прочитать..
ну и логи посмотреть исходя из этого... или можно даже без url
те немного поискать и все есть
просто начинать это делать- и все станет очевидно со временем

Maksim K [4:10 PM]
Помогите понять ошибку. При редактировании или создании еды вылазит эта ошибка
```16:07:35.951 DEBUG o.s.w.s.handler.AbstractHandlerExceptionResolver.resolveException:136 - Resolving exception from handler [public java.lang.String ru.javawebinar.topjava.web.JspMealController.updateMeal(int,ru.javawebinar.topjava.model.Meal)]: org.springframework.validation.BindException: org.springframework.validation.BeanPropertyBindingResult: 1 errors
Field error in object 'meal' on field 'dateTime': rejected value [2015-05-06T20:00]; codes [typeMismatch.meal.dateTime,typeMismatch.dateTime,typeMismatch.java.time.LocalDateTime,typeMismatch]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [meal.dateTime,dateTime]; arguments []; default message [dateTime]]; default message [Failed to convert property value of type 'java.lang.String' to required type 'java.time.LocalDateTime' for property 'dateTime'; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [@javax.persistence.Column @javax.validation.constraints.NotNull java.time.LocalDateTime] for value '2015-05-06T20:00'; nested exception is java.lang.IllegalArgumentException: Parse attempt failed for value [2015-05-06T20:00]]```
Не могу понять почему не парсится дата.

Yevhen Maksymovych [4:11 PM]
ну, очевидно, нет конвертера из String'а в LocalDateTime


Yevhen Maksymovych [Today at 4:11 PM]
дальше по урокам мы его подключим, а пока - только руками


21 replies
Maksim K [7 hours ago]
Так а где его подключить?


Maksim K [7 hours ago]
Он в mealForm должен быть? Просто когда нажимаю кнопку save на странице, то даже в метод пост не заходит. сразу вылазит ошибка.


Yevhen Maksymovych [7 hours ago]
ну да, ты наверняка указал какой-нибудь @RequestParam LocalDateTime dateTime, и падает все ещё на этапе валидации


Alexander Pilipenko [7 hours ago]
Лучше код покажи


Yevhen Maksymovych [7 hours ago]
если в контроллере хочешь напрямую взять из контроллера LocalDateTime, а не String, копни, например, сюда


Yevhen Maksymovych [7 hours ago]
https://stackoverflow.com/questions/40274353/how-to-use-localdatetime-requestparam-in-spring-i-get-failed-to-convert-string
Stack Overflow
How to use LocalDateTime RequestParam in Spring? I get "Failed to convert String to LocalDateTime"
I use Spring Boot and included jackson-datatype-jsr310 with Maven: <dependency> <groupId>com.fasterxml.jackson.datatype</groupId> <artifactId>jackson-datatype-jsr31...
 


Ignat [7 hours ago]
Проще аннотацию на поле повесить


Maksim K [7 hours ago]
я ваще не понимаю. вот мой метод апдейт
 ```@GetMapping("/meals/update/{id}")
    public String updateForm(@PathVariable("id") int id, Model model) {
        Meal meal = get(id);
        model.addAttribute("meal", meal);
        return "mealForm";
    }```
Здесь я достаю из базы еду и добавляю ее в модель. а потом перехожу на страницу милФорм. там отображается еда, которую я достал из базы. Я ее там изменяю и нажимаю сохранить и вылазить ошибка. И в метод пост не заходит. Может у меня этот метод неправильный.


Yevhen Maksymovych [7 hours ago]
ну там в топике про аннотацию тоже было


Yevhen Maksymovych [7 hours ago]
покажи, что у тебя висит на посте


Yevhen Maksymovych [7 hours ago]
у тебя в пост и не зайдёт, это же спринг. ты декларативно что-то объявляешь, бинпостпроцессор по этим аннотациям строит прокси для твоего класса, и по факту до того, как попасть в метод, вызывается логика прокси, которую ты заключал в аннотации, а потом уже твой код. у тебя падает где-то на этапе прокси, потому в методе ты и не можешь отдебажить по бряке


e.pekhterev [7 hours ago]
я чёт думал мы уже давно всё конвертим нормально


Yevhen Maksymovych [7 hours ago]
конвертим нормально, но строка датаВремя - слишком неоднозначная, чтобы спринг на себя взял выбор конвертера


Maksim K [7 hours ago]
@Yevhen Maksymovych спасибо за помощь. короче у меня был косяк с методом пост. не буду писать что там было, ибо стыдно( в общем надоело тупить и я взял и подсмотрел готовое решение. впервые за всю стажировку скатал кусок готового решения. мне ужасно стыдно. пойду напьюсь с горя(


Ignat [6 hours ago]
Копировать не стыдно, стыдно когда копируешь не разобравшись как и почему этот код работает.


Егорро [6 hours ago]
Была та же самая проблема, решилась чуть ли не сама собой - то ли Идею перезапустил, то ли когда пересобрал, вдруг начало опять нормально парсить. Причем самое смешное, что в дебаггере текущее значение парсилось нормально, а в работе падало с исключением


e.pekhterev [6 hours ago]
мы так или иначе копируем код из ссылок, которые нам даются в задании


e.pekhterev [6 hours ago]
и на работе я так понимаю тоже будем искать готовые решения, но оно много приятнее, когда находишь, перерабатываешь и сам чего то пишешь, а если списать - то да, кроме как напиться ничего больше не хочется


Maksim K [6 hours ago]
Да ладно, не утешайте меня)) Не напьюсь я. Подзавязал я с этим. Да и некогда. Еще есть сегодня важные дела. Самое обидно, что начитался этих книг, статей, насмотрелся видосов. И вот читаешь/смотришь и все так понятно кажется, а как надо что-то написать, то тупняк. Ну и х... с ним. Буду еще читать, смотреть пока не допру. На зло врагам, на радость маме)



Grigory Kislin [14 minutes ago]
есть еще вариант- не забегать вперед а делать по HW занятия


Grigory Kislin [14 minutes ago]
по нему принимаем `HttpServletRequest request`
