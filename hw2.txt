Grigory Kislin [1:35 AM]
joined #hw2.

Grigory Kislin [1:37 AM]
renamed the channel from “hw02” to “hw2”

Grigory Kislin [1:39 AM]
Достаточно сложное занятие (по коду и ДЗ):  каркас приложения. Spring (edited)
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md
Успехов! (edited)

Tanya [1:42 AM]
joined #hw2 along with 17 others.

Gagarina6794 [6:41 AM]
https://www.jetbrains.com/help/idea/use-patches.html (вариант применения патчей из любого удобного места на компьютере)

Victor_D [6:46 AM]
joined #hw2.

Kiri [9:02 AM]
github у кого-нибудь пашет?

denis [9:08 AM]
не пашет

Yevhen Maksymovych [9:09 AM]
У меня норм

Chensy [9:09 AM]
у меня тоже норм

Yevhen Maksymovych [9:10 AM]
Роскомнадзор?

denis [9:10 AM]
не скорее  microsoft))

matrocob [11:44 AM]
я так понимаю в классе InMemoryMealRepositoryImpl в методе save, метод computeIfPresent -> делает типо обновление существующего значения?

Yevhen Maksymovych [11:53 AM]
не ленись, провались в сорсы, там ничего сложного :slightly_smiling_face:

matrocob [11:57 AM]
та уже посмотрел)) спасибо)

Grigory Kislin [12:25 PM]
jsp:useBean- поменял ссылку на рабочую http://www.labir.ru/j2ee/jspUseBean.html (edited)

matrocob [7:01 PM]
оо прикольно, уже <spring.version>5.0.7.RELEASE</spring.version> ))

roudder [10:27 PM]
йо, гайз, а есть кто сейчас курит дз?)
nvm, подскажите, что именно из всех слоев мне нужно расширить(api) для userId (сейчас по хорошему)
то есть я правильно понимаю, если этот юзер id будет известен только на веб леере, соответственно он будет прокидываться дальше котролер - сервайс - реп. (до конца)
поправьте, если ошибаюсь где

Alexserden [10:58 PM]
кто накатил все патчи из 2-го задания ? у меня идея ругается на классы

roudder [11:01 PM]
не было проблем с накатом

Alexserden [11:08 PM]
class MealsUtil остался как hw1 задании, без изменений

Victor_D [11:11 PM]
накатил все патчи, MealsUtil изменился согласно описанию/видео
не только он в сумме 35 файлов в изменениях

Alexserden [11:13 PM]
я посмотрел сам патч, Apply 2_1_HW1.patch он без изменений, качал отсюда 
https://drive.google.com/drive/folders/0B9Ye2auQ_NsFfkpsWE1uX19zV19IVHd0bTlDclc5QmhMMm4xa0Npek9DT18tdkwyLTBZdXM

Victor_D [11:22 PM]
uploaded this image: image.png 


roudder [11:27 PM]
https://topjava14.slack.com/archives/CBK7XFLE9/p1530819078000307 касательно этой месаги, я так понимаю что правильный подход в следующем: не менять сигнатуру всех слоев на + userId, на уровне сервайза получить энтити  с гетом и обработать с AuthorizedUser (сравнить с userId из энтити) - в зависимости от этого уже поведение... В уроке кстати, насколько помню было написано, что на веблейере эт надо делать, мне, кажется, и в сервисе норм не? (edited)
roudder
поправьте, если ошибаюсь где
Posted in #hw2Today at 10:31 PM

Alexserden [11:41 PM]
commented on Victor_D’s file image.png
Изменения в MealsUtil:
Сделал константу List<Meal> MEALS
Переименовал TimeUtil в DateTimeUtil

Alexserden [11:41 PM]
где эти изменения тут ?
Victor_D [11:47 PM]
про MEALS: строки 214-221.
Victor_D [11:47 PM]
все патчи тянул с https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md , соответственно с переходом на гугл диск


Crazz [12:01 AM]
жесть, патчи ставятся криво, из pom`а исчезают нужные зависимости

svis [1:52 AM]
У меня при применении патчей HW01 из второго урока в браузерах с движком firefox в дате остается T. Это только у меня так или у всех такое? (edited)

svis [1:55 AM]
uploaded this image: Screenshot_1.png 


roudder [2:26 AM]
uploaded and commented on this image: Screen Shot 2018-07-06 at 03.21.23.png 

после патчей вот такое у меня

Баранчиков Александр [6:17 AM]
Почему календарь не отображается?

zippospb [8:18 AM]
Firefox нужный html5 тег не поддерживает. Проверь в хроме

Yevhen Maksymovych [9:36 AM]
это очень некрасиво со стороны файрфокса :slightly_smiling_face:
кста, кто в теме фронта, почему вообще так? спеки опубликованы 4 года назад, почему геко упорно сопротивляется его поддержке?

Егорро [9:42 AM]
@Yevhen Maksymovych можно сделать просто 2 поля, type="date" (value="${meal.dateTime.toLocalDate()}") и type="time" (аналогично), тогда в FF работает (edited)

Andy Fleer [12:29 PM]
Друзья, после применения патчей, проект не компилируется. По большей части ругается на отсутствие нескольких методов в Meal. Я правильно понимаю, что когда реализую интерфейсы ( по заданию), то всё должно уладиться?
или какой-то косяк?

Alexander Pilipenko [12:35 PM]
У меня тоже не компилировался. Сложно сказать как правильно, т.к. нельзя уверенно утверждать, что патчи накатились верно. Я сделал ветку HW2 и в ней правлю (edited)


e.pekhterev [1:23 PM]
@Yevhen Maksymovych и эксплорер 11-ый тоже не поддерживает

Yevhen Maksymovych [1:25 PM]
консерватор :slightly_smiling_face:


tim [Yesterday at 2:17 PM]
in #hw2
Подскажите, а как лучше справиться с ошибкой, которая присутствует в проекте: Когда редактируешь MEAL в строке DateTime, HTML5 позволяет ввести пятизначный год  на что успешно вылетает исключение Message Text '43564-05-31T05:59' could not be parsed at index 0, что вполне логично. Как красиво побороть это?


2 replies
vch [1 day ago]
исключение где генерируется? В сервлете при парсинге даты? Тогда делай catch и выводи любое красивое сообщение.
Хотя вроде как пока обработка ошибок по ТЗ необязательна.


Егорро [1 day ago]
Можно вроде задать ограничение типа max="2015-01-01T00:00"


Yevhen Maksymovych [2:20 PM]
Валидировать ввод с помощью js. (edited)

Alexander Pilipenko [2:40 PM]
Регулярное выражение в паттерн можно прописать
На input field

Andy Fleer [3:16 PM]
Народ скажите, как у вас легли патчи?
После патчей проект компилируется без ошибок или с ошибками?


Yevhen Maksymovych [Yesterday at 3:16 PM]
in #hw2
без ошибок


29 replies
Andy Fleer [1 day ago]
Подскажи как его можно откатить или обновить до состояния с которого снова применить патчи


Andy Fleer [1 day ago]
Можно же как-то скачать нужное исходное состаяние


Andy Fleer [1 day ago]
и снова не него положить патчи


Yevhen Maksymovych [1 day ago]
а ты на ветку "master" переключился перед накаткой патчей?


Andy Fleer [1 day ago]
да


Yevhen Maksymovych [1 day ago]
в любом случае, переключайся на мастер, выбирай в Version Control - Log последний коммит, и откатывайся до него

Join_Selectovich [1 day ago]
https://github.com/JavaOPs/topjava/wiki/Git


Join_Selectovich [1 day ago]
там есть пункт как откатить патч


Andy Fleer [1 day ago]
Я делал комит на каждую заплатку


Andy Fleer [1 day ago]
Не последний видимо, а все заплатки

Andy Fleer [1 day ago]
?


Yevhen Maksymovych [1 day ago]
можешь откатиться до последнего патча с прошлого урока

Yevhen Maksymovych [1 day ago]
перед накаткой пачтей не забудь проверить, что у тебя в version control - local changes нет изменений

Andy Fleer [1 day ago]
Reset Current Branch to Here Hard?


Yevhen Maksymovych [1 day ago]
ага


Andy Fleer [1 day ago]
Сделал

Andy Fleer [1 day ago]
Как можно сравнить все ли совпадает с версией Григория

Andy Fleer [1 day ago]
?


Andy Fleer [1 day ago]
или может можно накатить его варчию

Andy Fleer [1 day ago]
версию*

Andy Fleer [1 day ago]
Сравинил просто построчно

Andy Fleer [1 day ago]
Что разное скопировал себе


Andy Fleer [1 day ago]
Накатываю первый патчи


Andy Fleer [1 day ago]
патч

Andy Fleer [1 day ago]
и


Andy Fleer [1 day ago]
[2018-07-06 03:42:39,012] Artifact topjava:war exploded: Error during artifact deployment. See server log for details.


Andy Fleer [1 day ago]
То есть после первого не компилируется

Andy Fleer [1 day ago]
Это нормально вообще

Andrew [24 hours ago]
revert делай из идеи если еще не успел это дело запушить. это стрелочка такая... фиолетовая кажется. А вообще при накатке патчка, в диалоговом окне накатки можно посмотреть изменения, там тоже кнопочка вверху.


Ma3stro [3:21 PM]
Кто как предусмотрел при реализации фильтрации отсутствие каких-либо параметров? Например endDate / endTime


Andy Fleer [Yesterday at 4:48 PM]
in #hw2
Друзья, прошу помощи! Задолбался! Надо применить патчи и т.п..... Я вообще ниче не понимаю... То патчи накатываются, а потом не компилируется, то гворит мёрджить надо... в объяснении что делать в таком случае гворится, что нужно сравнить что есть где-то в мастере и где-то у меня.... не понимаю, что с чем сравнить


3 replies
Yevhen Maksymovych [23 hours ago]
так, давай свой гит


Andy Fleer [23 hours ago]
https://github.com/andyfleer/topjava/commits/master


Yevhen Maksymovych [23 hours ago]
сделал для тебя патч, накати его


Avaaron [Yesterday at 5:46 PM]
in #hw2
народ, спасайте, начал делать в ветке мастер, но после патчей ещё не комитил


15 replies
Yevhen Maksymovych [22 hours ago]
выбираешь ченджлист - шелф ченджес


Yevhen Maksymovych [22 hours ago]
создаёшь новую ветку, аншелф ченджес


Yevhen Maksymovych [22 hours ago]
вуаля


Avaaron [22 hours ago]
не понял, что за шелф


Yevhen Maksymovych [22 hours ago]
если ещё не делал коммит, на вкладке "version control/Local changes" будет виден ченджлист со всеми изменениями с последнего коммита


Avaaron [22 hours ago]
так


Yevhen Maksymovych [22 hours ago]
ты правой кнопкой на него жмёшь, выбираешь "shelf changes"


Yevhen Maksymovych [22 hours ago]
он тебе создаёт отложенный коммит, все изменения которого видны на вкладке "Shelf", а текущую ветку откатывает до состояния предыдущего коммита


Yevhen Maksymovych [22 hours ago]
после этого ты создаешь новую ветку - в данном случае "HW02"


Yevhen Maksymovych [22 hours ago]
заходишь на вкладку "Shelf", там опять правой кнопкой на этот ченджлист, и "Unshelf changes"


Yevhen Maksymovych [22 hours ago]
и он тебе применит эти изменения, но уже в новой ветке


Yevhen Maksymovych [22 hours ago]
т.е. ты фактически октатишь ветку мастер до посткоммитного состояния, а все изменения, сделанные после него, перенесёшь в новую


Avaaron [22 hours ago]
спаси

Avaaron [22 hours ago]
бо

Yevhen Maksymovych [22 hours ago]
:+1:


denis [5:48 PM]
как вариант можно все это закоммитить в HW2 а в мастер потом заново патчи накатить

Avaaron [5:50 PM]
накатка патчей отменит текущие изменения?

denis [5:56 PM]
конфликты будут. У тебя же уже накатаны патчи. Если хочешь отменить только свои изменения - там кнопка revert есть. либо можно спрятать изменения, закомитить а потом применить спрятанные изменения

Avaaron [5:56 PM]
та всё, подсказали уже

Jury Mironov [6:06 PM]
1: переименовать MockUserRepositoryImpl в InMemoryUserRepositoryImpl и имплементировать по аналогии с InMemoryMealRepositoryImpl

Jury Mironov [6:06 PM]
uploaded this image: Snap 2018-07-06 at 18.06.03.png 


Ma3stro [6:07 PM]
папочка "mock" в repository
если ты потерял

Ant [6:07 PM]
mock

Jury Mironov [6:08 PM]
спасибо, люди добрые), я не видел в упор, что папка не открыта
:see_no_evil:

denis [6:17 PM]
@Andy Fleer Григорий ссылку давал в #general на проект с закомиченными патчами 1урока. Удали свой и накати на него патчи 2-го занятия

Andy Fleer [6:19 PM]
Ага... Спасибо

Stanislav [7:34 PM]
Если слой сервисов не просто делегируют репозиторий, а содержат какую то логику, почему репозиторий должен проверять на предмет не соответствия не своей еды? (по заданию написано что репозиторий должен)


matrocob [Yesterday at 9:02 PM]
in #hw2
Мне вообще не понятно почему в проекте получается такая связь model-repo-service-controller- и view по идее.. разве нельзя откинуть либо сервис либо откинуть контроллер и сделать сервис тем же ж контроллером?



18 replies
Merkulov [19 hours ago]
это делается для малосвязанности и следовательно для дальнейшего удобного расширения приложения


Ma3stro [19 hours ago]
Приучают к реальным разработкам, как понимаю


Yevhen Maksymovych [19 hours ago]
Это же ООП, чем больше уровней абстракции, тем сильнее ты программист (edited)



matrocob [19 hours ago]
Хорошо... Вот допустим убираем сервис, оставляем контроллер... Что мешает сделать ещё один или ещё пять контроллеров и назвать каждый контроллер,  за что он отвечает? Я не пытаюсь спорить, мне реально интересно, скорее всего, позже я буду вспоминать этот комментарий и думать какой я глупый был (edited)


Join_Selectovich [18 hours ago]
по-моему очень хороший вопрос.. здесь хорошо бы разобраться


dimlo [17 hours ago]
Optional, пункт 6, 6.1:


dimlo [17 hours ago]
6: в MealServlet сделать инициализацию Spring, достать MealRestController из контекста и работать с едой через него (как в SpringMain). pom.xml НЕ менять, работаем со spring-context. Сервлет обращается к контролеру, контроллер вызывает сервис, сервис - репозиторий.
6.1: учесть, что когда будем работать через Spring MVC, MealServlet удалим, те вся логика должна быть в контроллере


Yevhen Maksymovych [17 hours ago]
Вообще, это скорее традиция: контроллер-сервис-дао, которая в случае спринга имеет ещё и встроенные механизмы реализации. В данном случае репозиторий - это сущность, которая работает напрямую с БД. У неё в целом довольно традиционно сложившийся интерфейс, который в спринге может вообще не иметь пользовательской имплементации.



Yevhen Maksymovych [17 hours ago]
Соответственно, если мы хотим накрутить на него какую-то логику - мы используем промежуточный слой сервиса


dimlo [17 hours ago]
Я так понимаю, после удаления сервлета останется классический Spring MVC


Yevhen Maksymovych [17 hours ago]
Здесь он будет выполнять валидацию и бросать эксепшены


Yevhen Maksymovych [17 hours ago]
А контроллер - это контроллер. Его задача не с БД работать, а получать данные из модели и отдавать в вид

Yevhen Maksymovych [17 hours ago]
Он может в принципе делать это и напрямую из репозиториев, но тогда ему придётся на себя как минимум брать работу валидации. А эту штуку хорошо бы передвинуть поближе к сущностям, чтобы они сами себя валидировали


Yevhen Maksymovych [17 hours ago]
В энтити мы это засунуть не можем, там не должно быть логики по традиции. В репозиторий тоже - он может не иметь реализации, остаётся сервис :-)


Yevhen Maksymovych [17 hours ago]
Но опять же, это все дело вкуса и конкретной архитектуры :-)

sky [17 hours ago]
Мне кажется сервис не про это. Это такой шаблон dao->service->controller (но это не точно).
И чтоб понять зачем все эти слои, нужно понять проблематику, зачем они вообще были придуманы, и посмотреть на большой проект, где все они задействованы для дела.
Не зряж у спринга архетип service есть.



Yevhen Maksymovych [17 hours ago]
Не, я про данный конкретный случай - вообще слой сервиса бизнес-логику какую-то на себя берет


Victor [14 hours ago]
Опять же про конфигурацию: Если мы закладываем в реализацию сервиса бизнеслогику, она не должна знать про реализацию dao и то, через что идет соединение с базой данных. И в обратную сторону... Можно подменить dao не изменяя бизнеслогики. (edited)


Ilya V [9:10 PM]
Привет я ещё застрял на HW1 но там уже никто наверное не ответит
Как достать атрибут класса в jsp

Ilya V [9:11 PM]
added this Plain Text snippet: Untitled 
<%@ taglib uri='http://java.sun.com/jsp/jstl/core' prefix='c'%>
<html>
<head>
  <title>Заголовок</title>
</head>
<body>
<jsp:useBean id="obj" class="ru.javawebinar.topjava.util.Tst"/>
"${obj.a}"
<br />
</body>
</html>
Collapse 

Ma3stro [9:11 PM]
${param.field}

Ilya V [9:11 PM]
нет


Ilya V [Yesterday at 9:11 PM]
in #hw2
`javax.el.PropertyNotFoundException: Property [a] not found on type [ru.javawebinar.topjava.util.Tst]`


13 replies
Ma3stro [19 hours ago]
setAttr делаешь? геттеры есть?


Ilya V [19 hours ago]
Конечно


Ilya V [19 hours ago]
```request.setAttribute("tstobj", new Tst());
        request.setAttribute("tstval", 123);
        getServletContext().getRequestDispatcher("/tst.jsp").forward(request, response);```


Ilya V [19 hours ago]
причем переменная tstval достается


Ma3stro [19 hours ago]
${tstobj.field}

Ma3stro [19 hours ago]
в jsp:useBean аттрибут value на tstobj, можно и без useBean

Ilya V [19 hours ago]
да ошибка исчезла


Ilya V [19 hours ago]
но ничего не показывает


Ilya V [19 hours ago]
ладно буду разбираться спасибо!

Ma3stro [19 hours ago]
потому что в объекте new Tst() у тебя для переменной нет значения, скорее всего


Ilya V [19 hours ago]
Есть )


Ilya V [19 hours ago]
```public class Tst {
    public static final int a = 1;
    public static final str b = 412;
    public static final int c = 1211;
}```



dimlo [17 hours ago]
jsp достает геттерами (edited)


Andy Fleer [9:16 PM]
Объясните мне вот это        return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);


Andy Fleer [Yesterday at 9:16 PM]
in #hw2
откуда берется oldMeal


4 replies
Ma3stro [19 hours ago]
по ключу id старое значение (oldMeal), затем меняется на новое (meal)


Gagarina6794 [18 hours ago]
.computeIfPresent - посмотри документацию, как работает этот метод

matrocob [18 hours ago]
https://youtu.be/DlJ-yKPS8ss лови ссылку, я по нему разобрался
YouTube KK JavaTutorials
Java 8-Map computeIfPresent Default Method
 


Andy Fleer [5 hours ago]
Спасибо. Ок


Andy Fleer [9:16 PM]
?


Avaaron [Today at 12:27 AM]
in #hw2
LF would be replaced by CRLF in src/main/java/ru/javawebinar/topjava/repository/mock/InMemoryMealRepositoryImpl.java.....что это значит??? в идее выставлено crlf. Как бороться?


1 reply
Victor [14 hours ago]
что-то похожее было. Я открывал в notepadd++ и вручную что-то менял. В гугле находил решение...


Avaaron [12:32 AM]
глюк какой-то, побеждается стиранием страницы и копированием в неё кода снова

Victor [3:18 AM]
uploaded this image: 2018-07-07_03-16-34.png 


alexey [Today at 10:35 AM]
in #hw2
Народ, вопрос по пункту 7. Саму логику фильтрации то делать(в контролере, сервисе и репозитории ) или только набросок в jsp и сервлете?


1 reply
Ma3stro [5 hours ago]
Естественно. Нужно сделать, чтобы фильтровало:)


Merkulov [Today at 11:46 AM]
in #hw2
атомарность операций не требуется (коллизии при одновременном изменении одного пользователя можно не учитывать)


2 replies
Merkulov [4 hours ago]
я так понимаю нам уже конкарент хешмеп не нужен?


Victor [2 hours ago]
я тоже так понял, похоже из-за того что добавили юзеров и админа.


Ma3stro [Today at 11:52 AM]
in #hw2
Кто-то делал реализацию через двойную мапу?


1 reply
Vitaly [3 hours ago]
кто-то делал :slightly_smiling_face:


Andy Fleer [Today at 12:04 PM]
in #hw2
Проверка понимания. В ДЗ мы делаем в форме добавления еды <select> с выбором юзера. Это на сейчас. Так мы эмулируем якобы действия разных пользователей. На отображении списка милов делаем то же


5 replies
Vitaly [3 hours ago]
все верно


Vitaly [3 hours ago]
сначала выбирается пользователь, потом уже работаем с его id


dimlo [2 hours ago]
Мое видение: форма выбора пользователя на index, с которой id передается (setId) в securityUtil. Потом, при каждом запросе из securityUtil подтягивается id


Andy Fleer [2 hours ago]
Селект это уже вроде в Optional части


Andy Fleer [2 hours ago]
угу?


Andy Fleer [12:04 PM]
Так понимаю?
или?


Merkulov [Today at 12:23 PM]
in #hw2
когда мы удаляем пользователя, мы ведь должны удалить всю его еду? так вроде логично)


2 replies
vch [2 hours ago]
ага, а так же накладные, платежи и т.п, в итоге все отчёты исказятся... В общем - неочевидно. Далеко не всегда надо удалять все связанные данные.


dimlo [2 hours ago]
А мне идея понравилась)


Join_Selectovich [Today at 1:52 PM]
in #hw2
подскажите пожалуйста, 
есть *interface UserService* в _package ru.javawebinar.topjava.service;_  и 
есть *interface UserRepository* в _package ru.javawebinar.topjava.repository;_
они повторяют друг друга 
внимание впрос - почему так сделано, в чем смысл дублирования , может я что-то пропустил


5 replies
dimlo [2 hours ago]
Repository - слой работы с данными, service - логика приложения. Controller (пока что сервлет) общается с service. Service работает с repository через интерфейс, поэтому, когда мы захотим изменить базу данных, мы подставим новую имплементацию, а другие слои останутся неизменны



Join_Selectovich [2 hours ago]
@dimlo благодарю за ответ, я все понял. Только вот еще нужно понять почему Controller(servlet) общается с repository через service, пока что этот слой кажется избыточным..


dimlo [1 hour ago]
Пока, да. Я так понимаю, это паттерн для удобной разработки больших приложений. Ну, чтоб можно было одной команде дать таск по обработке, преобразованию данных, а другие люди занимались бы вопросами хранения и предоставления данных (например, переходом с mysql на mongo)


Join_Selectovich [1 hour ago]
по-моему Другую имплементацию репозитория можно подставить даже если и не будет слоя сервис, Действительно. похоже что это все для промышленных разработок так проектируют (edited)


dimlo [1 hour ago]
Я просто принял эту идею, когда делал вступительное задание и теперь она мне нравится) а так, да, куда подставлять имплементацию, по сути, все равно


Artem [Today at 1:52 PM]
in #hw2
коллеги, а почему вот нам уже второй урок подряд напоминают, что "не надо в названиях методов повторять названия класса", а вот, например, в классе role мы все равно пишем: ROLE_USER и ROLE_ADMIN ? Может тогда просто USER и ADMIN ?


3 replies
vch [2 hours ago]
Григорий однажды отвечал на этот вопрос - что это особый случай и все роли принято так называть.



Artem [2 hours ago]
Спасибо, я пропустил этот ответ, значит.


vch [2 hours ago]
это было в одном из предыдущих topjava


KaryNaiKo [Today at 1:54 PM]
in #hw2
Объясните плс, как работает строчка "<tr class="${meal.exceed ? 'exceeded' : 'normal'}">"


14 replies
Join_Selectovich [2 hours ago]
http://developer.alexanderklimov.ru/android/java/logic_operators.php


Join_Selectovich [2 hours ago]
там раздел *Тернарный оператор* почитай (edited)


Join_Selectovich [2 hours ago]
Тренарный правильно


Victor [2 hours ago]
вряд ли :
ternary [ˈtɜːnərɪ]


Join_Selectovich [2 hours ago]
@Victor ternary переводится как *тринарный* (edited)

Victor [1 hour ago]
https://www.lingvolive.com/ru-ru/translate/en-ru/ternary
lingvolive.com
Переводы «ternary» (En-Ru) на ABBYY Lingvo Live
ABBYY Lingvo Live — бесплатные словари и сообщество изучающих иностранные языки. Переводите, спрашивайте, узнавайте! (262 kB)


Victor [1 hour ago]
в каком словаре это?

Join_Selectovich [1 hour ago]
хотя тринарный и тернарный наверное можно

Join_Selectovich [1 hour ago]
https://www.multitran.ru/c/m.exe?CL=1&s=ternary&l1=1
Словарь Мультитран
ternary
англо-русский словарь
 


Victor [1 hour ago]
и не использует никто так:  тренарный


Join_Selectovich [1 hour ago]
тринарный как-то поприятнее и


Victor [1 hour ago]
по версии пользователя под ником Gruzovik ))))) - это точно верный перевод

Join_Selectovich [1 hour ago]
вариант с тернарным тоже от Gruszovik  :slightly_smiling_face:


Victor [1 hour ago]
English - наше все! так что тернарный и не стоит себе обучение усложнять


KaryNaiKo [1:54 PM]
как выбирается exceeded или normal?

Artem [1:54 PM]
@Join_Selectovich да, упустил
ниже скрин прилагаю, думаю, что с той же целью сделано (edited)

Artem [1:54 PM]
uploaded this image: Снимок экрана от 2018-07-07 13-53-42.png 


Join_Selectovich [2:02 PM]
Какой-то странный вопрос: " _Зачем в AdminRestController переопределяются методы родителя с вызовом тех же родительских?_ "
по-моему обрезали слово _методов_ ... (edited)

Join_Selectovich [2:09 PM]
Вопрос хороший, но ответ как мне кажется другой там должнен быть. 
Я думаю что финт с вызовом реализованных методов из абстрактного класса сделан всего лишь для того что-бы его сделать не абстракным, и в последующем, это позволит его инстанцировать. (edited)

Join_Selectovich [2:15 PM]
хотя нет, этот класс можно будет инстанцировать даже если удалить все переопределения методов из public class AdminRestController.
Ладно, нужно дождаться будущего и убедиться что для этого класса наличие методов будет обязательным (edited)


matrocob [4:16 PM]
added and commented on this Java snippet: Untitled 
​
  private final MealService service;
​
  @Autowired
  public MealRestController(MealService service) {
    this.service = service;
  }
​
или вот так?
​
 	@Autowired
  private MealService service;
Collapse 
ребят подскажите в MealRestController надо писать так? Просто при добавлении  appCtx.getBean(MealRestController.class);
в SpringMain выскакивает ошибка, при создании новой еды -> restController.create(new Meal.... ->

Exception in thread "main" org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'ru.javawebinar.topjava.web.meal.MealRestController' available
matrocob [4:17 PM]
Или надо в spring-app.xml указать, что контроллер это наш бин?


Andy Fleer [Jul 7th at 4:22 PM]
in #hw2
" Реализовать слои приложения для функциональности "еда". API контроллера должна удовлетворять все потребности демо приложения и ничего лишнего (см. демо).

   Смотрите на реализацию слоя для user и делаете по аналогии! Если там что-то непонятно, не надо исправлять или делать по своему. Задавайте вопросы. Если действительно нужна правка- я сделаю и напишу всем."  Не понимаю, что от меня хотят. По аналогии с чем в User? Объясните что сделать надо?


3 replies
matrocob [1 day ago]
например UserService посмотри как реализован, сделай MealService такой же и дальше по всем интерфейсам и классам


Join_Selectovich [1 day ago]
Для начала нужно понять где реализация какого=то слоя для юзера..


Join_Selectovich [1 day ago]
_Смотрите на реализацию слоя для user и делаете по аналогии!_


Victor [4:22 PM]
commented on matrocob’s snippet Untitled
MealRestController отмечен как бин?
Victor [4:23 PM]
@controller на классе?

matrocob [4:23 PM]
Да
Аннотацию указал

Victor [4:23 PM]
commented on matrocob’s snippet Untitled
Или надо в spring-app.xml указать, что контроллер это наш бин? - или так
Victor [4:24 PM]
но если уже начал с аннотациями, то лучше через@controller


roudder [Jul 7th at 4:56 PM]
in #hw2
гайз, а вот вопрос, когда я инвокаю из сервлета метод котролера-сервайса-реп(из контекста спринг) репозиторий в конце пустой лежит, то есть нестатич блок еще не отработал. (edited)


25 replies
Yevhen Maksymovych [1 day ago]
покажи гит


roudder [1 day ago]
https://github.com/roudder/topjava/tree/HW02


roudder [1 day ago]
там пока мног уг ток)


Yevhen Maksymovych [1 day ago]
не беда. пустой реп в милах получаешь?

roudder [1 day ago]
ага


roudder [1 day ago]
ну то есть мануально он в сервлете  в инит метод есть


roudder [1 day ago]
а дальше, даже когда попадает в экземелпяр милрепимпла реп пустой

roudder [1 day ago]
там не прокси


roudder [1 day ago]
в нонстатик блок не заходит


roudder [1 day ago]
по брейку


Yevhen Maksymovych [1 day ago]
гхм, проблему нашёл, исправить её просто, но я в упор не понимаю, почему так происходит, как-то даже растерялся


Yevhen Maksymovych [1 day ago]
у тебя дважды инстанциируется InMemoryMealRepositoryImpl - сперва ты его создаёшь вручную, потом поднимаешь спринг контекст, в рамках которого спринг инстанциирует его как свой компонент


Yevhen Maksymovych [1 day ago]
почему-то при таком "повторном" инстациировании он ломается. починить проще простого - не инстанциируй его в ините, во-первых он тебе в принципе не нужен, ты всё будешь делать через сервис, во вторых, если очень хочешь, вытащи его из контекста


Yevhen Maksymovych [1 day ago]
но я не могу понять, почему он ломается

Yevhen Maksymovych [1 day ago]
вот тут уже реально какая-то мистика:

Yevhen Maksymovych [1 day ago]
а, всё, догнал

Yevhen Maksymovych [1 day ago]
короче, ты используешь лист милов, чтобы заполнить милрепозиторий в блоке {}


Yevhen Maksymovych [1 day ago]
но логика добавления милов в репозиторий такова, что если мил новый, ему присвоится ид, и он попадёт в репозиторий. если ид уже есть, но в репозитории такого мила нет - метод сейв его проигнорирует

Yevhen Maksymovych [1 day ago]
при первом инстанциировании ты собрал корректный репо, но при этом всем милам из статического листа раздал ид

Yevhen Maksymovych [1 day ago]
при повторном инстанциировании эти милы не добавятся в репо, потому что они уже не новые.


Yevhen Maksymovych [1 day ago]
в итоге у тебя получилось два инстанса милрепозитория - созданный вручную с заполненным списком милов, и инстанциированный спрингом с пустым списком


Yevhen Maksymovych [1 day ago]
понятное дело, что сервис лезет в свой репо, инстанциированный ему спрингом


Yevhen Maksymovych [1 day ago]
а там - пусто

roudder [1 day ago]
блин, круто. да все верно, касательно 2 раз создания репа, но я не думал, что это может заафектить, в итоге сейв и его логика рут коз, а я блин думал, в чем-то другом проблема, не там рыл. Спасибо большое :+1:


Yevhen Maksymovych [1 day ago]
:+1:


roudder [4:57 PM]
как с этим жить?) (edited)


Mihail Kedel [Jul 7th at 5:12 PM]
in #hw2
у меня в проекте класса LoggedUser нету,в каком он был патче?Или так и должно быть?


5 replies
Victor [1 day ago]
нету у меня тоже


Yevhen Maksymovych [1 day ago]
его и не должно быть


Yevhen Maksymovych [1 day ago]
он был в topjava13


Yevhen Maksymovych [1 day ago]
```Поменял LoggedUser на SecurityUtil.```


Mihail Kedel [1 day ago]
Спасибо,не заметил (edited)


sky [Jul 7th at 8:50 PM]
in #hw2
В задании, вроде как, не сказано ничего о том что нужно реализовывать users.jsp и/или UserServlet. А потом вдруг в 8ом задании нужно делать SecurityUtil.setAuthUserId(userId) в UserServlet. Кто в курсе?


11 replies
Yevhen Maksymovych [1 day ago]
ну, это же опционал. подразумевается, что если решил показать класс, и сделать его, значит сможешь и всё необходимое для этого сообразить


Merkulov [1 day ago]
8: добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и SecurityUtil.setAuthUserId(userId) в UserServlet). Настоящая атворизация будет через Spring Security позже.


Merkulov [1 day ago]
там ведь нужно просто сделать комбобокс с выбором пользователя и все


sky [1 day ago]
Что значит показать класс? Я просто не догоняю, если пользователя надо выбирать на index.html зачем нужно что то делать в UserServlet? Я бы понял, если бы нужно было отрисовывать всех пользователей, при переходе на Users  с indexa и выбирать там авторизованного, но выбор то надо в indexe уже сделать. А судя по заданию, там вообще ни одного лишнего слова нет, и только одна очепятка


Yevhen Maksymovych [1 day ago]
а в чем проблема выбрать пользователя из индекса?


Yevhen Maksymovych [1 day ago]
сделай форму, на пост - отправляй в юзерсервлет


Yevhen Maksymovych [1 day ago]
большего не требуется


sky [1 day ago]
А UserServlete только в doPost сетить авторизованного, или еще что предполагается?

Yevhen Maksymovych [1 day ago]
не, только сетить


sky [1 day ago]
я просто это сделал в MealServlete в гете, но терь ясно. А ты выполнил уже оптионал?


Yevhen Maksymovych [1 day ago]
я, сказать по-честноку, ещё в прошлый раз выполнил :slightly_smiling_face: щаз по второму разу прохожу


Artem [Jul 7th at 10:20 PM]
in #hw2
ребят, как заставить сервлет инициализировать репозиторий из спринга?


11 replies
Victor [1 day ago]
буду пробовать через init() метод сервлета запускать спринг, а спринг сам все свяжет и запустит


Artem [1 day ago]
хм..)


Artem [1 day ago]
неа(


Artem [1 day ago]
Не работает


Victor [1 day ago]
@Override
   public void init(ServletConfig config) throws ServletException {
       super.init(config);
       тут код для спринга;
   }


Artem [1 day ago]
super.init(config);
repository = SpringMain.getRepository();

да, сработало) Спасибо!!) (edited)



Victor [1 day ago]
только не надо через SpringMain, нужно взять сделать контекст и взять бин прямо в сервлете.



Victor [1 day ago]
что-то не так получается. В каждом сервлете же не запустишь свой спринг, верно?


Yevhen Maksymovych [1 day ago]
тоже не лучшая идея, кмк: контекст спринга сам по себе должен быть синглтоном, и его бины - синглтоны. если мы в каждом сервлете будем поднимать свой контекст - всякое может случиться


Victor [1 day ago]
выдумываю:
сделать отдельно утиль синглетон с контектом спринга.
на каждом сервлете его инициализировать.
первый сервлет возьмет новый контекст.
следующий сервлет возьмет существующий контект.


Victor [1 day ago]
@Yevhen Maksymovych Если так сделать? Сохранить объект в ServletContext и проверять на каждом сервлете есть там уже объект или нет. 
@Override
   public void init(ServletConfig config) throws ServletException {
       super.init(config);
       ServletContext servletContext = config.getServletContext();
       Object appContext = servletContext.getAttribute("SpringAppContext");
       if (appContext == null) {
           ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml");
           servletContext.setAttribute("SpringAppContext", appCtx);
           appContext = appCtx;
       }
       if (appContext instanceof ConfigurableApplicationContext) {
           mealService = ((ConfigurableApplicationContext) appContext).getBean(MealService.class);
       }
   }


Join_Selectovich [10:28 PM]
добавь туда параметр нужного класса с аннотацией autowired (edited)


Join_Selectovich [Jul 7th at 10:29 PM]
in #hw2
может так поможет...


3 replies
Yevhen Maksymovych [1 day ago]
это помогло бы, если бы сервлет инстанциировался спрингом :slightly_smiling_face:


Join_Selectovich [1 day ago]
:slightly_smiling_face:


Artem [1 day ago]
@Yevhen Maksymovych так как же? :slightly_smiling_face:


zippospb [Jul 7th at 10:56 PM]
in #hw2
Народ, как вы фильтр реализуете? Я так понимаю, передать аргументы из input в метод doGet имеющегося mealservlet не получится, а doPost уже занят логикой create/update meal


14 replies
roudder [1 day ago]
хороший вопрос, тоже пока не знаю как сделать лучше. Мне , кажется, это по-любому пост, вот только можно ли как-это в сервлете разграничить по разным пост - формам. И следует вопрос, городить там всю логику по выдеранию параметров?


zippospb [1 day ago]
в одном сервлете один пост. Только если вводить специальный параметр action и делить логику doPost на две части


zippospb [1 day ago]
т.е. будет приватный input со значением либо create/update либо filter, а в doPost if/else


zippospb [1 day ago]
но это блин вообще некрасиво


roudder [1 day ago]
да не оч

Victor [1 day ago]
по-моему фильтр это doGet. Ведь ничего в базе менять не будем.

Victor [1 day ago]
а MealRestController не делал пока? Нужно с него начинать, а потом фильтр, как я понял


zippospb [1 day ago]
вот зашел я на страничку /meals, там мне показался весь список еды для моего пользователя. У меня там есть form с методом get, 4 input (две даты и два времени) и кнопка submit. Чтобы форма адресовала в doGet параметры, у нее есть аттрибут action, в который и нужно вставлять данные из инпутов. Но страничка-то в браузер подается статичная и этот аттрибут уже определен. Как его можно переопределить?


zippospb [1 day ago]
с контроллером особых проблем нет


zippospb [1 day ago]
я просто переделал метод getAll() на getAll(LocalDate fromDate, LocalDate toDate, LocalTime fromTime, LocalTime toTime)

Victor [1 day ago]
нужно думаю сделать так:
<form method=GET...
и тогда по нажатию кнопки submit полетит не Post а Get.


zippospb [1 day ago]
Нда... Действительно))) надо было сначала попробовать, а потом уже спрашивать) форма сама подставляет атрибуты в адрес)))


zippospb [1 day ago]
спасибо


Ma3stro [12 hours ago]
Я сделал через post запрос. В этом запросе передаю скрытый параметр filter для разграничения фильтрации и create/update


Maksim K [Jul 7th at 11:57 PM]
in #hw2
Тут столько много вопросов задают. Ну и я задам) Вопрос по
return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);
Да я знаю, что уже спрашивали. Но у меня немного другой вопрос. Как работает метод я понимаю. Только не могу понять зачем он нам. В тексте второго задания написано такое
Поправил InMemoryMealRepositoryImpl.save(). Если обновляется еда, которой нет в хранилище (c несуществующим id), вставка не происходит.(с)
И я не пойму, как может быть несуществующая еда? Если мы в таблице щелкнули на кнопку редактирования, значит мы редактируем какую-то конкретную еду. Т.е. id там по-любому есть. Как он может быть несуществующим. Или это типа тоже на будущее и в этом есть какой-то смысл?


14 replies
Stanislav [1 day ago]
Способы: 1. У нас есть контролер Meal, который будет давать на ружу API 2. Любой может открыть сорсы html и изменить скрытые поля


Maksim K [24 hours ago]
Эмм. Первый способ я не понял, а про второй интересно. Как можно изменить скрытые поля?


Stanislav [24 hours ago]
Сохраняешь html, убираешь скрытое поле, загружаешь его, в это поле теперь можно ручками  подставить что угодно. Можно сразу в html в скрытое поле проставит что угодно.


Stanislav [24 hours ago]
Да и когда get запрос, ты параметры видишь, можно в эти параметры ставить что хочешь. Часто сам таким пользуюсь, например на форуме, переход на любую страницу.


Tanya [24 hours ago]
с таким проще играться через developer tools  браузере (edited)


Maksim K [24 hours ago]
Я не очень понимаю как это. Можно поподробнее или ссылочку где про это почитать)


Maksim K [24 hours ago]
Ну вот я сохранил html, изменил значение поля id . И что теперь? Как его в приложении использовать?

Stanislav [24 hours ago]
открывай  в браузере

Stanislav [24 hours ago]
иди по ссылке

Maksim K [24 hours ago]
Я наверно че-то не понимаю. Я сохранил на компе на рабочем столе. И открывается он в браузере с рабочего стола.


Stanislav [24 hours ago]
Ок. Ты понимаешь что такое get запрос?


Maksim K [24 hours ago]
:blush:

Stanislav [24 hours ago]
Скопируй сюда ссылку get запроса при переходе к редактированию существующей еды,  воего приложения.


Maksim K [24 hours ago]
Я дико извиняюсь, а куда эту ссылку вставить?)


turhanow [Yesterday at 1:29 AM]
in #hw2
Почему добавляем логику в meal (метод isNew()) а не создаем, например, в классе MealsUtil соответствующий метод?



1 reply
Vitaly [22 hours ago]
думаю, это просто сложившийся шаблон/практика для различных entity, в дальнейшем будет сохранение через ORM/hibernate, там это реализовано через класс AbstractPersistable, загляни в него (edited)


zippospb [Yesterday at 2:07 AM]
in #hw2
для этого есть аттрибут value. я туда вписывал =${param.название инпута} (edited)


1 reply
Victor_D [22 hours ago]
спасибо


Victor [2:11 AM]
added this PHP snippet: Вот я бы перефразировал это условие, потому что минут 15 разбирался что оно значит. Как-то так :" после авторизации (сделаем позднее), id авторизованного юзера можно вернуть через SecurityUtil.authUserId()..." 
4.1: после авторизации (сделаем позднее), id авторизованного юзера будет попадать в SecurityUtil.authUserId(). Запрос попадает в контроллер, методы которого будут доступны снаружи по http, т.е. запрос можно будет сделать с ЛЮБЫМ id для еды (не принадлежащем авторизированному пользователю). Нельзя позволять модифицировать/смотреть чужую еду.

Andrew [12:22 PM]
по всей этой тематике слоев, то что экземпляр репозитория мы держим в сервлете ни кого не смущает ?

Stanislav [12:24 PM]
А ты читал задание Optional? (edited)

Andrew [12:27 PM]
из опшинала следует, что взаимодействовать с репозиторием нужно через слои приложения, а точкой входа должен быть экземпляр контроллера, то есть обращение через MealRestController.
и по цепочке к данным

Stanislav [12:28 PM]
И, как это вяжется с "то что экземпляр репозитория мы держим в сервлете ни кого не смущает ?" ?
До тематики по слоям, другого выбора не было, логически.
А когда появится Spring MVC и сервлет уйдет и внедрения spring контекста. Все постепенно...


Andrew [Yesterday at 12:33 PM]
in #hw2
Если уж логически то если есть контроллер нафига сервлет, а если есть сервлет нафига контроллер ? Я в задании не пойму, что мне с контроллером делать и где спрингом потерял данные вчера на nullpointer exeption остановился((


1 reply
Ma3stro [10 hours ago]
вместо репозитория поставь в сервлет контроллер и бери методы оттуда


Stanislav [Yesterday at 12:35 PM]
in #hw2
Сервлет и контроллер разные вещи. Контроллер это пред введение в Spring MVC.


6 replies
shomnest [9 hours ago]
Почему разные?


Stanislav [9 hours ago]
Контролер это паттерн-абстракция над сервлетом.


shomnest [9 hours ago]
Так по сути сервлет в этом случае и является реализацией паттерна


Stanislav [9 hours ago]
Я имел ввиду контроллер в контексте spring-а. Сервлет является частью структуры J2EE, и каждый сервер приложений Java (Tomcat, Jetty и т.д.) создан для запуска сервлета. Сервлет - это уровень "низкого уровня" в стеке J2EE. Вам не нужен сервлет .jar для запуска приложения, поскольку он предварительно упакован с сервером приложений

A Spring MVC-контроллер - это библиотека, построенная на сервлете, чтобы упростить задачу. Spring MVC предлагает более встроенные функции, такие как параметр формы для сопоставления параметров метода контроллера, упрощение обработки представлений двоичной формы (т.е. когда ваша форма может загружать файлы) и т.д.


shomnest [9 hours ago]
@Stanislav эм, причем тут Spring? Если мы говорим в общем случае про паттерн Контроллер?


Stanislav [9 hours ago]
Выше написал: Я имел ввиду контроллер в контексте spring-а.


Andrew [12:36 PM]
но добавляем мы его уже на этом этапе)

Merkulov [12:37 PM]
ребят, как для двух форм сделать одну кнопку сохранения ?

Andrew [12:38 PM]
может не через форму ?

Merkulov [12:39 PM]
нужен пост запрос

Andrew [12:40 PM]
я не шарю в фронт энде, но пост по моему можно и в ссылки объявить

Merkulov [12:41 PM]
я тоже не особо в фронте, нужно попробовать через js


tim [Yesterday at 1:10 PM]
in #hw2
Ребят подскажите когда такое возможно: 2.2: get\update\delete - следите, чтобы не было NPE (NullPointException может быть, если в хранилище отсутствует юзер или еда).


4 replies
shomnest [9 hours ago]
Ты попробуй обратиться к несуществующему объекту в мапе


tim [8 hours ago]
Ну так и делал Ексепшен не вылетает


tim [8 hours ago]
map.get()  и  map.remove()


Victor [5 hours ago]
эксепшена не будет, но по id вернется null:
@return the value to which the specified key is mapped, or {@code null} if this map contains no mapping for the key
вот этот null и нужно ловить


tim [1:10 PM]
Пытаюсь достать из мапы несуществующее значение и удалить NullPointException  не вылетает


e.pekhterev [Yesterday at 2:44 PM]
in #hw2
Ребята, подскажите плиз, еду сортировать именно по дате или по ДатаВремя?
"3.3: список еды возвращать отсортированный в обратном порядке по датам"


17 replies
Ma3stro [9 hours ago]
ДатаВремя, последняя добавленная еда в самом начале (edited)


e.pekhterev [9 hours ago]
спасибо) (edited)


e.pekhterev [9 hours ago]
@Ma3stro, "последняя добавленная еда в самом начале" - последняя добавленная еда может иметь дату гораздо раньше, чем мы её добавляем

Ma3stro [9 hours ago]
*Сортировка в обратном порядке, это имел в виду:)


e.pekhterev [9 hours ago]
ну я уже сообразил))) спасибо ещё раз)


Merkulov [9 hours ago]
вроде написано конкретно по датам

e.pekhterev [9 hours ago]
)))) опять в тупик ставите))) где правда, брат? сортировка по дате или по ДатаВремя? давайте проголосуем?


e.pekhterev [9 hours ago]
ладно, у Тани спрошу лучше


Merkulov [9 hours ago]
тока напиши как правильно)

e.pekhterev [9 hours ago]
вот теперь точно не напишу)))


Merkulov [9 hours ago]
))

Merkulov [9 hours ago]
пиши пиши, согласно тз по датам, я так и сделал

Merkulov [9 hours ago]
я дума. это не столь важно


Merkulov [9 hours ago]
*думаю

e.pekhterev [9 hours ago]
10Q


e.pekhterev [9 hours ago]
Катерина сказала цитирую "По датавремени"


e.pekhterev [9 hours ago]
так что это в условии немного не точно указано


Merkulov [Yesterday at 2:53 PM]
in #hw2
как сделать DateTimeUtil метод isBetween через дженерики куда копать?


15 replies
Stanislav [9 hours ago]
Копать к дженерикам :slightly_smiling_face: другими словами, метод isBetween должен правильно сравнивать и дату и время и дату с временем.


Stanislav [9 hours ago]
Ты можешь перегрузить метод isBetween, но это будет не универсально, а дженерики как раз делают так, что бы ты мог любой тип данных подставить.


Merkulov [9 hours ago]
перегрузка не универсальна, с этим согласен, дата и время вроде ни от кого не наследуются, вот возникает вопрос, что будет для них общим, для корректного сравнения даты и времени


Merkulov [9 hours ago]
щас покопаюсь еще

Stanislav [9 hours ago]
Наследуются, от многого

Stanislav [9 hours ago]
Общим будет то, что сравнивается, ибо если не сравнивается, то и exception


Merkulov [9 hours ago]
public final class LocalDate
       implements Temporal, TemporalAdjuster, ChronoLocalDate, Serializable {


shomnest [9 hours ago]
@Stanislav LocaleDate наследуется только от Object

Merkulov [9 hours ago]
вот про это только хотел написать

Stanislav [9 hours ago]
Смотрите еще, там есть интересное наследование

Stanislav [9 hours ago]
Отталкивайтесь даже не от наследования, а от того, как вы сравниваете



sky [9 hours ago]
гляньте в  ChronoLocalDate

Merkulov [3 hours ago]
короче, я сделал с дженериками, все ок, разобрался  )


Stanislav [3 hours ago]
молодец! :slightly_smiling_face:


Merkulov [3 hours ago]
спс:slightly_smiling_face:


e.pekhterev [Yesterday at 3:34 PM]
in #hw2
немного (или много) не понял, где инициализировать контекст спринга, в сервлетах вроде как совсем не логично


3 replies
sky [8 hours ago]
может как то так https://stackoverflow.com/questions/18745770/spring-injection-into-servlet (edited)



e.pekhterev [8 hours ago]
спасибо, попробую так


Ma3stro [7 hours ago]
Я сделал как в spring main, в init (edited)


turhanow [Yesterday at 4:45 PM]
in #hw2
> 1.3: предусмотрите случай одинаковых User.name (порядок должен быть зафиксированным).


имеется ввиду в сортировке?
не совсем понятно, что значит "порядок должен быть зафиксированным". порядок чего? элементов в возвращаемой коллекции в методе getAll() ?) (edited)



19 replies
Stanislav [7 hours ago]
Я уже спрашивал, мне ответили "Пользователи с одинаковыми User.name могут быть. Если такие будут, чтобы выводились всегда в одинаковом порядке.".


turhanow [7 hours ago]
то есть предусмотреть вторичную сортировку по id? он уже уникальный, т.е. если имена одинаковые, то id уникальный и вторичная сортировка по нему возвратит всегда один и тот же вариант:thinking_face:


Stanislav [7 hours ago]
Это уже как ты сам сделаешь, но смысл думаю ясен, > 1 сортировки, иначе не проходит по требованию.


Merkulov [6 hours ago]
если не ошибаюсь эту проблему решает thenComparing



Join_Selectovich [6 hours ago]
https://stackoverflow.com/questions/4805606/how-to-sort-by-two-fields-in-java
Stack Overflow
How to sort by two fields in Java?
I have array of objects person (int age; String name;). How can I sort this array alphabetically by name and then by age? Which algorithm would you use for this ?
 


turhanow [6 hours ago]
как реализовать через thenComparing мне известно, затупил на том что не сразу понял слова "в зафиксированном порядке":slightly_smiling_face:

Join_Selectovich [5 hours ago]
да, фраза очень странная.. похоже у всех вопросы вызывает (edited)

Victor [5 hours ago]
я сразу по имени, а потом по мылу сортанул.

turhanow [4 hours ago]
так мыло может быть одинаковое. например один юзер зареган с разных имейл


Stanislav [4 hours ago]
Смотри разрез, вторая сортировка идет в разрезе первой

turhanow [4 hours ago]
это мне коммент?)

Stanislav [4 hours ago]
аха

Stanislav [4 hours ago]
Что такого что у пользователя мыло может быть одинаковое?

turhanow [4 hours ago]
в том что у юзера есть и другие поля, следовательно если например дата регистрации будет разной, или поменяется роль, то сортировка не возвратит фиксированную последовательность:thinking_face:
или я что то недогоняю))


turhanow [4 hours ago]
а вот id фиксирован, он не меняется в БД

Stanislav [4 hours ago]
ну и если на то пошло, то и id не проблема поменять :slightly_smiling_face:

Stanislav [4 hours ago]
по id тоже правильно - имхо


turhanow [4 hours ago]
в наше время даже пол не проблема поменять)))
но в нашей бизнес логике нет такого требования, чтобы менялись id (например если бы id при удалении переприсваивался , т.е. как индекс в ArrayList смещался на позицию ниже)


Stanislav [4 hours ago]
согласен


Andy Fleer [5:36 PM]
Что нужно реализовать в MealRestController ? Не понимаю роль. Всё делается вроде в MealServlet


Andy Fleer [Yesterday at 5:40 PM]
in #hw2
4.2: SecurityUtil может использоваться только на слое web (см. реализацию ProfileRestController).  Значит ли это, что по факту я не могу использовать в MealServlet вот такое обращение к идентификатору пользователя                 ... repository.delete(id, SecurityUtil.authUserId()); ... ?


9 replies
vch [6 hours ago]
подозреваю, что по факту ты вообще не можешь из сервлета обращаться к репозиторию напрямую... Это так же к твоему предыдущему вопросу про контроллер (edited)


Andy Fleer [6 hours ago]
Страшные слова говоришь ты мне :rolling_on_the_floor_laughing::rolling_on_the_floor_laughing::rolling_on_the_floor_laughing:

Andy Fleer [6 hours ago]
Сервлет -> Контроллер -> Сервис -> Репозиторий


Andy Fleer [6 hours ago]
Получается так?


vch [6 hours ago]
да. И потом сервлет исчезнет.

Andy Fleer [6 hours ago]
Йоптить!! ))))


Andy Fleer [6 hours ago]
Седых полос прибавилось)))


Andy Fleer [6 hours ago]
:rolling_on_the_floor_laughing:


Andy Fleer [6 hours ago]
Пошел пилить контроллер


Avaaron [Yesterday at 7:07 PM]
in #hw2
кто делал уже выбор пользователя, как передать параметр из index  в сервлет?


14 replies
Ma3stro [5 hours ago]
Можно передать на UserServlet, а затем форвардиться на /meals

Avaaron [5 hours ago]
не понял


Avaaron [5 hours ago]
вопрос как раз был как передать в сервлет


Ma3stro [5 hours ago]
я сделал так: передал на юзер сервлет, засетил переданный auth id, делаю форвард на еду


Avaaron [5 hours ago]
да ёшкин  кот, )))) как????


Ma3stro [5 hours ago]
Что как? В чем вопросы?

Avaaron [5 hours ago]
у меня форма, в ней эта конструкция select, я тыкаю на кнопик, форма отправляется...как отправить на сервлет?


Ma3stro [5 hours ago]
form action='UserServlet'

Ma3stro [5 hours ago]
принять getParametr()


Avaaron [5 hours ago]
ах, вот, спасибо


Avaaron [4 hours ago]
мда, не приходит ничего в сервлет таким образом


Avaaron [4 hours ago]
ты форму из index отправляешь?

Ma3stro [4 hours ago]
да

Avaaron [4 hours ago]
а потом оттуда же по ссылке на meals переходишь?


Andy Fleer [7:08 PM]
uploaded and commented on this image: image.png 

Объясните как это работает. UserService это же интерфейс. При этом мы объявляем переменную с его типом и начинаем вызывать методы.  Как он понимает какую имплементацию выбрать?
Ma3stro [7:09 PM]
Волшебный @Autowired


Ma3stro [7:26 PM]
added and commented on this Java snippet: Untitled 
  public Meal save(Meal meal, int userId) {
    if (meal.isNew()) {
      meal.setId(counter.incrementAndGet());
      if (repository.get(userId) == null) {
        Map<Integer, Meal> map = new HashMap<>();
        map.put(meal.getId(), meal);
        repository.put(userId, map);
        return meal;
      } else {
        Map<Integer, Meal> map = repository.get(userId);
        map.put(meal.getId(), meal);
        repository.put(userId, map);
        return meal;
      }
    } else {
      Map<Integer, Meal> map = repository.get(userId);
      if (map.containsKey(meal.getId())) {
        map.put(meal.getId(), meal);
        repository.put(userId, map);
        return meal;
      } else {
        return null;
      }
    }
  }
Collapse 
Как упросить этот код средствами дефолтных методов из Map?


Ma3stro [Yesterday at 7:27 PM]
in #hw2
Что-то он очень большой


16 replies
sky [4 hours ago]
почему репозиторий это мап<int, map> а не мап<int, meal> для начала?


Ma3stro [4 hours ago]
@sky, я использую двойную мапу для хранения еды


vch [4 hours ago]
@sky Как раз это не ошибка. Можно и так.

Ma3stro [4 hours ago]
@vch, ну код отрабатывает верно, может быть стилистические ошибки?

sky [4 hours ago]
т.е. в meal не стали поле userId добавлять?


Ma3stro [4 hours ago]
не стал)

Ma3stro [4 hours ago]
но сначала и так сделал


vch [4 hours ago]
@Ma3stro увы, он отрабатывает неверно иногда... Но у тебя ещё есть несколько дней для поиска этих случаев.


Stanislav [4 hours ago]
вдруг понадобится https://vertex-academy.com/tutorials/ru/java-8-novye-metody-map/
Vertex Academy
Java 8 новые методы в Map • Vertex Academy
Данная статья написана командой Vertex Academy. Это одна из статей из нашего Учебника по Java 8. Надеемся, что данная статья Вам будет полезна.
Nov 19th, 2017 at 4:06 AM
 


Stanislav [4 hours ago]
не используй containsKey

Stanislav [4 hours ago]
много return-ов, надо сократить или всего 1.


Stanislav [4 hours ago]
repository.get(userId) используешь аж 3 раза, сократить до 1


turhanow [4 hours ago]
если по чесноку, то не совсем понятно, зачем создавать столько мап...
Смотрим, 
Meal extends AbstractBaseEntity (далее по тексту - ABE)
ABE уже содержит id, а Meal поле с userId

то есть репу можно создавать с мапой key = UserId, value = ABE

когда поступает еда для save, нужно проверить соответсвие userId (которое в Meal) с ключем из репы. и если такого значения нет, сохранить или обновить.

но если еда новая и у нее нет ни Id ни userId, то засетить надо и то и другое. id ты сделалб а userId ведь можно из утильного класса достать по зареганному юзеру и пололжить значение в Meal (засетить) :thinking_face: (edited)


Ma3stro [3 hours ago]
@turhanow, это как вариант реализации, я сделал обоими способами: с userId и без (edited)

turhanow [3 hours ago]
@Ma3stro а почему не используешь putifAbsent ?


Ma3stro [3 hours ago]
Уже смотрю на этот метод, буду рефакторить


Join_Selectovich [Yesterday at 8:32 PM]
in #hw2
Подскажите пожалуйста , А на каком слое обычно сортировку в необходимом порядке выполняют?  web или service? (edited)


2 replies
Yevhen Maksymovych [4 hours ago]
Вообще, смотря что. Энтити может сортировать БД. А если у тебя сервис отдаёт DTO - то вполне может сервис сортировать



e.pekhterev [2 hours ago]
вот никак не думал, что это всё может быть в базе, или в dao, или как тут предлагают делать в репозитории


Stanislav [8:32 PM]
Репозиторий т.к. сортировку можно сделать средствами sql
Когда будет Spring Data там даже sql не нужен, запрос наименованием формируется

Join_Selectovich [8:34 PM]
хм... я думал функция репозитория = просто хранить ,  а как отображать это уже определить в слое web (edited)


Stanislav [Yesterday at 8:35 PM]
in #hw2
Представь, ты вытаскиваешь с базы голые данные, потом сервис их сортирует, может еще фильтрацию делает....SQL позволяет получить сортированные-фильтрованные самим SQL сервером, что на много быстрее + нет двойной работы



3 replies
e.pekhterev [2 hours ago]
но в нашем случае, если мы будем делать сортировку и фильтрацию в репозитории, то и тащить из репозитория нужно DTO, иначе данные будут некорректные


Stanislav [2 hours ago]
Нет, все норм, данные корректны

e.pekhterev [1 hour ago]
я о том, что если мы сортируем и по дате, и по времени в репозитории, но будет дальше отдавать не DTO, а объекты класса Meal, а уже в сервлете или в контроллеру выполнять преобразование в DTO (MealWithExceeded), тогда у нас не будут коррекны данные по калориям (по их превышению)


Stanislav [8:36 PM]
Когда будет Spring Data ты поймешь на сколько это просто

Join_Selectovich [8:39 PM]
ну да, понял , спасибо

Alexander Pilipenko [8:45 PM]
Это все очень холиварная тема
Многие считают что нужно делать максимум на уровне сервисов.


Alexander Pilipenko [Yesterday at 8:46 PM]
in #hw2
Как вариант - распределенные транзакции


17 replies
Stanislav [3 hours ago]
У тебя база сотни гигов, тебе нужно получить по фильтрам данные, ты хочешь 10 гигов загрузить в память и на уровне сервисов фильтрацию и сортирвку делать :slightly_smiling_face: А как насчет того зачем вообще нужен SQL запросов? Что тут холиварного?


Stanislav [3 hours ago]
А теперь представь это на 1000+ тредов


Alexander Pilipenko [3 hours ago]
А теперь представь запрос данных из 100+ DWH


Alexander Pilipenko [3 hours ago]
Сложи все это в HADOOP

Alexander Pilipenko [3 hours ago]
Ну и далее идем в войны веры

Stanislav [3 hours ago]
При чем тут биг дата :slightly_smiling_face:


Alexander Pilipenko [3 hours ago]
Потому что данные при распределенных транзакциях могут быть неоднородны (edited)


Alexander Pilipenko [3 hours ago]
По нашей архитектуре - тянем все данные и обрабатываем на сервере приложений


Alexander Pilipenko [3 hours ago]
Формирование списка в getWithExceeded


Stanislav [3 hours ago]
....) ок....

Alexander Pilipenko [3 hours ago]
И по запросам в 10 гигов. Был пример когда было быстрее все затянуть к себе

Alexander Pilipenko [3 hours ago]
Опять же есть кэши разных уровней.

Alexander Pilipenko [3 hours ago]
и да. Все выше сказанное ИМХО.


Alexander Pilipenko [2 hours ago]
Перечитал задание.


Alexander Pilipenko [2 hours ago]
В нашем случае в ТЗ однозначно написано:


Alexander Pilipenko [2 hours ago]
Изменить MealRepository и InMemoryMealRepositoryImpl таким образом, чтобы вся еда всех пользователей находилась в одном общем хранилище, но при этом каждый конкретный авторизованный пользователь мог видеть и редактировать только свою еду.
3.1: реализовать хранение еды для каждого пользователя можно с добавлением поля userId в Meal ИЛИ без него (как нравится). Напомню, что репозиторий один и приложение может работать одновременно с многими пользователями.
3.2: если по запрошенному id еда отсутствует или чужая, возвращать null/false (см. комментарии в UserRepository)
3.3: список еды возвращать отсортированный в обратном порядке по датам
3.4: атомарность операций не требуется (коллизии при одновременном изменении одного пользователя можно не учитывать)


Alexander Pilipenko [2 hours ago]
3.3 -> возвращаем уже отсортированный список


Andy Fleer [8:46 PM]
uploaded and commented on this image: image.png 

Подскажите выполнение вот этого getAll должно вызвать getAll из MealServiceImpl ?

Alexander Pilipenko [8:46 PM]
+
Т.е. да

Ma3stro [8:47 PM]
а в MealWithExceed когда конвертируешь?


Alexander Pilipenko [Yesterday at 8:49 PM]
in #hw2
MealWithExceed - возвращает список TO. Вызываться должен при передаче данных во фронт для списка


6 replies
Ma3stro [3 hours ago]
И когда ты предлагаешь конвертировать в TO? По ТЗ сказано, что логика вся должна быть в контроллере, а не в сервлете


Join_Selectovich [3 hours ago]
слушайте, а это формирование dTO должно быть уже в существующей имплементации (в _MealServiceImpl_) или это отдельно нужно реализовать ?


Ma3stro [3 hours ago]
Я в контроллере сделал - https://stackoverflow.com/questions/31644131/spring-dto-dao-resource-entity-mapping-goes-in-which-application-layer-cont
Stack Overflow
Spring DTO-DAO (Resource - entity) mapping goes in which application layer: Controller or Service?
I'm writing a Spring (4.1.7) web application that exposes a RESTful service and wish to use DTO "resource" objects for communication between Controller and client browser rather than expose my
 


Alexander Pilipenko [3 hours ago]
И я так же сделал. Но в чем противорчие не понимаю


Alexander Pilipenko [1 hour ago]
Полезно читать ТЗ


Alexander Pilipenko [1 hour ago]
4.4: конвертацию в MealWithExceeded можно делать как в слое web, так и в service (Mapping Entity->DTO: Controller or Service?)


Janna [11:17 PM]
@Katherine, @Tatiana, @all

 
   private UserRepository repository = new InMemoryUserRepositoryImpl();

   @Autowired    public UserServiceImpl(UserRepository repository) {
       this.repository = repository;
   }
вижу они не в этом канале
ну ладно
у кого были проблемы с этим участком кода?
я смогла только так исправить:
@Autowired
   @Qualifier("userRepository")
   private UserRepository repository;
типа 2 бина одного интерфейса :disappointed:


Janna [Yesterday at 11:19 PM]
in #hw2
в случае с конструктором не доходит до меня как сделать надо


2 replies
Victor [1 hour ago]
1. у тебя поле по коду инициализируется, а потом еще сверху пытается через автосвязывание опять инцизиализироваться.
2. UserRepository repository нужно поменять на UserRepository userRepository чтобы  Qualifier не использовать. Тогда будут имена по умолчанию.


Victor_D [1 hour ago]
попробуй clean в maven


shtramak [11:37 PM]
Поковырял детально все патчи и по ходу появилось несколько вопросов... Выдавать буду отдельными сообщениями, чтоб если что можно было тредить по каждому вопросу отдельно


shtramak [Yesterday at 11:37 PM]
in #hw2
1. Почему поле _registered_ класса *User* имеет тип _Date_? Почему не используем LocalDateTime? Класс _Date_ вроде как вообще не рекомендован к использованию как минимум ввиду того, что он mutable. И даже если все же принять его к использованию, то делаем мы это небезопасно - во всех местах инициализации она происходит напрямую, ну, и геттер так же выдает прямую ссылку на наше поле _registered_. (edited)


12 replies
Victor [22 minutes ago]
вроде потому что нужна чтобы _registered_ поле не зависело от локали, как бы абсолютное а не относительное.


tema.emelyan [18 minutes ago]
LocalDateTime тоже вроде бы абсолютное

shtramak [17 minutes ago]
@tema.emelyan все так, в классах LocalDate и LocalDateTime не хранится инфа о часовом поясе или смещении по времени

tema.emelyan [16 minutes ago]
я и не говорю, что хранится


tema.emelyan [14 minutes ago]
будет использоваться время, которое на сервере. внутри одного сервера зона одинаковая должна быть, так что смещение вроде бы не нужно


shtramak [13 minutes ago]
@tema.emelyan я утверждал что ты прав) а вообще хорошая линка на это дело была еще в нулевом уроке - https://www.mscharhag.com/java/java-8-date-time-api

tema.emelyan [13 minutes ago]
а, понятно

tema.emelyan [12 minutes ago]
вообще вроде бы на сервере реккомендуют время UTC использовать, так что смещение не только одинаковое, его вообще нет

shtramak [11 minutes ago]
к сожалению тут не компетентен (

tema.emelyan [9 minutes ago]
вообще проект ведётся давно, LocalDateTime ввели в Java 8 и всякие hibernatы его по-моему не сразу подхватили так что может быть от части по историческим причинам


shtramak [8 minutes ago]
хз, мож и так )


shtramak [7 minutes ago]
но тогда все равно остается вопрос небезопасности принятого решения... (edited)


shtramak [11:37 PM]
2. Почему у поля _roles_ класса *User* нет сеттера? И опять вопрос по поводу mutable - почему геттером _roles_ возвращается прямая сслыка на Set<Role>? Мне кажется, что правильнее было бы возвращать что-то типа _*Collections.UnmodifiebleSet(roles)*_. Ибо через геттер можно получить доступ к нашей ссылки и задать ему любой набор ролей. Или так задумано и по этой причине и нет сеттера?


shtramak [Yesterday at 11:38 PM]
in #hw2
3. Интерфейс UserRepository - delete(int id):boolean, а UserService - delete(int id):void. Почему во втором случае мы не возвращаем тот же boolean? Нам же может где-то на контроллере понадобиться результат запроса на удаление...


1 reply
Victor [19 minutes ago]
обрабатывать нужно на уровне service, вроде. Хотя я долго не думая на boolean поменял и service )))


shtramak [11:39 PM]
added and commented on this Java snippet: Untitled 
Вместо
@Override
public User get(int id) throws NotFoundException {
  return checkNotFoundWithId(repository.get(id), id);
}
Я предлагаю:
public User get(int id) throws NotFoundException {
  return repository.get(id)
    .orElseThrow(() -> new NotFoundException("Not found entity with " + id));
}
Collapse 
4. Общий вопрос по поводу геттеров и возвращаемых ими _*null*_ - почему мы не пользуемся средствами Optional API? Покажу на примере, что я имею в виду. Optional дает нам контроль над NPE и возможность писать в понятном декларативном стиле, нет надобности писать специальные утильные методы типа _checkNotFoundWithId(boolean found, int id)_, ну и вся логика метода представлена непосредственно в нем, без необходимости смотреть чем занимается тот же _checkNotFoundWithId_


tema.emelyan [12:14 AM]
commented on shtramak’s snippet Untitled
понимаю желание использовать Optional но наверное утильный метод можно оставить. Это наверное don't repeat yourself. У тебя будет много методов, которые вернут Optional и тебе везде придётся писать orElseThrow. А если потом захочешь другой эксепшн бросать или мессадж поменять и тд

Я бы тоже как и в твоём примере обработку null засунул в репозиторий. чем скорее null увидишь тем лучше мне кажется. возможно я не прав

ps можно вообще всё в контроллере написать, тогда не нужно будет смотреть кто чем занимается :slightly_smiling_face:


zippospb [Jul 9th at 2:10 AM]
in #hw2
Кто-нибудь смог сделать с помощью дженериков DateTimeUtil.isBetween универсальным? У меня получилось только  с wildcard <? extends Comparable>,  но идея в таком случае ругается.  Мол слишком обобщенно и небезопасно


8 replies
turhanow [2 days ago]
Попробуй компаробл тоже сделать типизированным


zippospb [2 days ago]
Я могу типизировать либо LocalTime либо LocalDate либо их предком, но общего предка, реализующего интерфейс Comparable у них нет


Tanya [2 days ago]
а для чего им общий предок?


zippospb [2 days ago]
Я не нашёл как можно типизировать одновременно двумя классами, поэтому и думал общем предке

Tanya [2 days ago]
не надо типизировать двумя классами

Tanya [2 days ago]
покажи полностью твой вариант с <? extends Comparable>


turhanow [2 days ago]
Почему знак вопроса? Я там просто Т поставил и по моему работает :thinking_face:


zippospb [2 days ago]
@Tanya спасибо за ссылку! Похоже я понял, в чем проблема. Вечером проверю


Join_Selectovich [Jul 9th at 2:11 AM]
in #hw2
<T extends Comparable>,


2 replies
zippospb [3 days ago]
Идея дает так сделать, но ругается на небезопасность метода


dimlo [1 day ago]
<T extend Compatable<T>>  не ругается


Tanya [4:35 AM]
по дженерикам https://docs.oracle.com/javase/tutorial/extra/generics/morefun.html (edited)

Gagarina6794 [7:38 AM]
7: добавить в meals.jsp и MealServlet две отдельные фильтрации еды: по дате и по времени (см. демо)  Это как? На странице jsp делаем форму для фильтрации по датам\времени, берем оттуда данные для фильтрации и с ними переходим на ту же страницу но с отфильтрованными данными? (edited)

Tanya [7:39 AM]
см демо
т.е. даты отдельно / время отдельно
если указываешь между 5 мая и 8 мая, 10 утра и 11 утра - то получаем записи даты 5,6,7,8 мая, и между 10 и 11 утра, а не между 5мая 10утра и 8 мая 11 утра (edited)


Gagarina6794 [Jul 9th at 7:43 AM]
in #hw2
это я сделала, не могу нормально получить данные из формы и применить их для этой фильтрации ) думалка здесь поломалась)) (edited)


8 replies
Yevhen Maksymovych [2 days ago]
а в чем проблема? получаешь как и любой другой параметр из реквеста


Gagarina6794 [2 days ago]
Та вроде дошло, я там немного не той дорогой пошла... Думала надо ещё один экшн для фильтрации делать, а нет, не надо, там всё проще


e.pekhterev [2 days ago]
экшин у тебя автоматом правильный в данном случае проставляется (когда экшин пустой - тогда гетALL


e.pekhterev [2 days ago]
ну и ещё по хорошему нужно сохранять фильтрацию после операций delete/update/add как это делается в дэмо-приложении


e.pekhterev [2 days ago]
инжектится всё вроде как нормально, во всяком случае еду контроллер выдает. поднимай нормально контекст в общем.


Gagarina6794 [2 days ago]
Ты так написал как будто видишь чего я там делаю)) доберусь до ноута, буду решать что и куда, спасибо)


e.pekhterev [1 day ago]
упс, ветки перепутал с последним сообщением про "инжектитися ... "))) а предыдущие по теме))) (edited)


Gagarina6794 [1 day ago]
))) все сделала, РАБОТАЕТ!


Andy Fleer [Jul 9th at 10:41 AM]
in #hw2
Друзья, нужна помощь. Видимо что-то я намудрил или недомудрил  с аннотациями. Все методы MealServiceImpl, которые я вызываю из MealRestController кончаются ничем. Т.е. пытаюсь логировать, что возвращает метод - либо пусто, либо вообще строка логирования не срабатывает. Ставлю логирование в вызываемый метод. Результат предсказуемый - тишина.


55 replies
Yevhen Maksymovych [2 days ago]
проверь что всё автовайрится по цепочке repository->service->controller. Ну и заодно проверь, что ты не инстанциируешь репозиторий дважды (при текущей его реализации при втором инстанциировании его внутреняя мапа будет пустой)



Andy Fleer [2 days ago]
В MealRestController
   @Autowired
   private MealService service;
В MealServiceImpl  @Autowired
   public MealServiceImpl(MealRepository repository) {
       log.info("Repository is initialized");
       this.repository = repository; }


Andy Fleer [2 days ago]
В репозитории же не должно ничего автовайрится?


Yevhen Maksymovych [2 days ago]
тогда показывай гит

Yevhen Maksymovych [2 days ago]
нет, в репозитории не должно


Andy Fleer [2 days ago]
https://github.com/andyfleer/topjava/tree/HW2

e.pekhterev [2 days ago]
в ините не надо создавать контроллер, нужно инициализировать контектс спринга и подтянуть из него контроллер


Yevhen Maksymovych [2 days ago]
может он ещё не опционал делает :slightly_smiling_face:


Yevhen Maksymovych [2 days ago]
в любом случае, если ты делаешь не оционал, у тебя автоматом всё не проавтовайрится. эта магия работает, только если ты берёшь компонент из контекста спринга. сейчас ты создаёшь контроллер вручную, следовательно тебе надо озаботиться о внутренних зависимостях этой цепочки самостоятельно


e.pekhterev [2 days ago]
в контроллере autowired делай так же как в сервисе (не на поле класса, а на констукторе контроллера, при этом само поле private final)

Andy Fleer [2 days ago]
То есть надо для этого сделать конструктор по умолчанию


Andy Fleer [2 days ago]
так?


e.pekhterev [2 days ago]
@Yevhen Maksymovych, ну как не опционал, если в сервлете он уже дергает этот созданный ручками контроллер.


e.pekhterev [2 days ago]
ну открой сервис и посмотри как там ты сделал. 
В видео к уроку или в описании об это говорилось, лучше делать через конструктор, чтоб не словить проблем.

e.pekhterev [2 days ago]
но основной трабл, что ты создаешь бин Контроллера, а не спринг



Yevhen Maksymovych [2 days ago]
но в целом это полировка. чтобы взлетело тебе надо контекст спринга поднять. работать будет и при инъекции через поля класса, и через конструктор, и через сеттер - один фиг


e.pekhterev [2 days ago]
будет


e.pekhterev [2 days ago]
не спорю, просто заметил и написал сразу

e.pekhterev [2 days ago]
почитай ДЗ, ты ещё не выполнил основное ДЗ, а уже начал Optional ковырять.
Смотри "5: включить классы еды в контекст Spring (добавить аннотации) и вызвать из SpringMain любой метод MealRestController (проверить что Spring все корректно заинжектил)"


e.pekhterev [2 days ago]
нужно это сначала сделать и простестить как всё работает, как всё инжектится, да и вообще весь функционал реста проверить


Andy Fleer [2 days ago]
Надо сказать, что глюк возник еще до того как я начал Spring прикручивать


Andy Fleer [2 days ago]
Это я его потом начал крутить. С гипотезой, что может спринга животворящего не хватает тут

Andy Fleer [2 days ago]
То есть мне надо где-то в сервлете вот это запустить ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml") ?


Andy Fleer [2 days ago]
или что?


Alexander Pilipenko [2 days ago]
Выше уже про это написали

Alexander Pilipenko [2 days ago]
вызвать из SpringMain любой метод MealRestController


Alexander Pilipenko [2 days ago]
Если там работает,то прописать в init методе сервлета

e.pekhterev [2 days ago]
6: в MealServlet сделать инициализацию Spring, достать MealRestController из контекста и работать с едой через него (как в SpringMain). pom.xml НЕ менять, работаем со spring-context. Сервлет обращается к контролеру, контроллер вызывает сервис, сервис - репозиторий.



e.pekhterev [2 days ago]
ну и выше я написал где и что

e.pekhterev [2 days ago]
сейчас у тебя эксепшин, потому как контекст не подключен и в контреллере инчего не заавтоваярилось 
"java.lang.NullPointerException
    ru.javawebinar.topjava.web.meal.MealRestController.getAll(MealRestController.java:23)"


Andy Fleer [2 days ago]
Если я делаю в MealRestController вот так     private final MealService service;

   @Autowired
   public MealRestController(MealService service) {
       this.service = service;
   } то получается в SpringMain мне вызывать надо будет с параметром ссылкой на сервис. Но это как-то тут странно


Andy Fleer [2 days ago]
Я чет запутался в магии

Andy Fleer [2 days ago]
try (ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml")) {
           System.out.println("Bean definition names: " + Arrays.toString(appCtx.getBeanDefinitionNames()));
           AdminRestController adminUserController = appCtx.getBean(AdminRestController.class);
           adminUserController.create(new User(null, "userName", "email@mail.ru", "password", Role.ROLE_ADMIN));
           MealRestController mealRestController = new MealRestController(new MealServiceImpl(new InMemoryMealRepositoryImpl()));
           mealRestController.getAll(1);
       }


Andy Fleer [2 days ago]
Это нормальный вызов?


Andy Fleer [2 days ago]
Вот он отдельно:


Andy Fleer [2 days ago]
MealRestController mealRestController = new MealRestController(new MealServiceImpl(new InMemoryMealRepositoryImpl()));
           mealRestController.getAll(1);


Andy Fleer [2 days ago]
Тут теперь кажется уже, что мало магии))))

Yevhen Maksymovych [2 days ago]
вот это излишне

Yevhen Maksymovych [2 days ago]
```Andy Fleer [16 minutes ago]
MealRestController mealRestController = new MealRestController(new MealServiceImpl(new InMemoryMealRepositoryImpl()));
           mealRestController.getAll(1);```


Yevhen Maksymovych [2 days ago]
если у тебя милрестконтроллер - компонент спринга, ты его можешь вытащить из контекста точно так же, как выше вытаскиваешь AdminRestController


Yevhen Maksymovych [2 days ago]
через .getBean()

Yevhen Maksymovych [2 days ago]
магии там никакой нет. Можешь представить себе контекст спринга как обычную мапу вида <Class, Object>. Когда ты инициализируешь контекст, отрабатывает грубо говоря его конструктор, который парсит xml-файл, который ты ему скормил, ищет там упоминания классов, которые ты туда внёс, создаёт их экземпляры, и заносит в мапу. причём если в этих классах есть какие-то члены других классов из этой мапы, он их автоматом инициализирует.


Yevhen Maksymovych [2 days ago]
в первом приближении это недалеко от истины :slightly_smiling_face: по факту там есть вместо конструктора BeanFactory, зависимости подтягивает BeanPostProcessor, а хранение несколько сложнее, чем обычная мапа, но магии всё равно никакой нет. всё в пределах возможностей языка. (edited)


Andy Fleer [2 days ago]
О! Чудо!


Andy Fleer [2 days ago]
Заработало из SpringMain


Andy Fleer [2 days ago]
Ну может магии и нет, но, классно, однако!!!

Yevhen Maksymovych [2 days ago]
добро пожаловать в мир IoC :slightly_smiling_face:

Andy Fleer [2 days ago]
Руками все это не вызываешь, а оно бац! раотает!))

Andy Fleer [2 days ago]
Прямо бодрит это))))

Andy Fleer [1 day ago]
Но вот парадокс. Из SpringMain запустил. Логи показывают что метод вызвался (тот самый getAll()). Воткнул эту же инициализацию  спринга в Сервлет в init() логи показывают, что метод вызывается. Но вот там где надо собстенно работать, я получаю по прежнему nullpointerexception


Andy Fleer [1 day ago]
Не понимаю

Andy Fleer [1 day ago]
Всё

Andy Fleer [1 day ago]
Заработало

Andy Fleer [1 day ago]
Тут уже мой косяк был. На уровне экземпляра уже была переменная mealRestController. Я ее переобъявил в init. Ну и то что я объявил в инит заканчивало свою область видимости в инит


e.pekhterev [1 day ago]
хотя бы 3-4 главы почитай Spring in Action и жить станет много легче, тяжело кодить то, что вообще не понимаешь


Join_Selectovich [Jul 9th at 12:24 PM]
in #hw2
_5.6: В REST при update принято передавать id (см. AdminRestController.update)_  ну я посмотрел в контроллер , а туда два параметра заходит *update(User user, int id)*. Как понимать этот пункт, что этим хотели сказать, как вы это понимаете?


8 replies
Yevhen Maksymovych [2 days ago]
именно то, что написано: дескать, хотя id и есть внутри юзера (его можно достать по user.getId(), при ресте принято для подстраховки передавать id дополнительно) (edited)


Join_Selectovich [2 days ago]
спасибо тебе добрый человек @Yevhen Maksymovych


Yevhen Maksymovych [2 days ago]
я, если честно, не очень понимаю, логику этого, но предполагаю, что для того, чтобы сервер мог сразу идентифицировать объект, который обрабатывает, не залазя в дебри энтити. там, например, может быть какой-нибудь прокси, или какой-то сложный метод извлечения этого ид


Join_Selectovich [2 days ago]
просто сначала пишут что принято передавать id , а потом смотришь там еще и user ... понятно что юзер должен быть обязательно чтобы обновить данные , но поначалу воспринимается как противоречие...
если бы написано было что "при update принято так же дополнительным параметром передвать id обновляемой сущности"


Join_Selectovich [2 days ago]
вопросов бы никаких не было


Victor [2 days ago]
если говорят, что принято передавать id, это не значит что только id. Смысл в том, что кроме всего обязательно должно быть id. Думаю есть какая -то практика использования этого параметра.


Join_Selectovich [1 day ago]
ну вот видите, вы же когда поясняете используете фразу "кроме всего" - она и снимает все неоднозначности


Victor [1 day ago]
у меня такая тоже проблема бывает: прочитаю и выдумаю от себя ))) 
в условии нет запрета на другие параметры и точка


Alexander Pilipenko [2:20 PM]
В ДЗ сказано, что закрывать спринг кониекст лучше в методе destroy сервлета
Если так делать, то у меня падает nullpointerexception
Кусок сервлета:
public class MealServlet extends HttpServlet {
   private static final Logger log = LoggerFactory.getLogger(MealServlet.class);


   ConfigurableApplicationContext appCtx;
   private MealRestController controller;

   @Override
   public void init(ServletConfig config) throws ServletException {
       super.init(config);

       ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml");

       controller = appCtx.getBean(MealRestController.class);
   }

   @Override
   public void destroy() {
       log.info("appCtx {}" , appCtx);
       // appCtx.close();
   }

Yevhen Maksymovych [2:21 PM]
вот тут ошибка...
ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml");
ключевое слово "область видимости" :slightly_smiling_face:

Alexander Pilipenko [2:22 PM]
Ой

Ну я тупой


Alexander Pilipenko [Jul 9th at 2:23 PM]
in #hw2
Спасибо


1 reply
Yevhen Maksymovych [2 days ago]
незачт :slightly_smiling_face:


Alexander Pilipenko [Jul 9th at 2:25 PM]
in #hw2
Но от сюда следует интересный результат. Можно в init использовать автозакрытие для контекста


33 replies
Victor [1 day ago]
я в дестрой закрывал. Думаю, тут могут быть скрытые сложности. Лучше по старинке.


Victor [1 day ago]
Думаю что best practice in slake - пользоваться threads


Alexander Pilipenko [1 day ago]
Я исправлюсь :slightly_smiling_face:

Yevhen Maksymovych [1 day ago]
это не очень хорошо делать. вдруг тебе в каком-то другом методе придётся достать из контекста ещё один бин, придётся заново для этого поднимать контекст


Yevhen Maksymovych [1 day ago]
или в каком-то другом сервлете :slightly_smiling_face: идеальный вариант (пока используя то, что есть в проекте) - поднять спринг контекст после поднятия сервлет контекста, и погасить спринг контекст перед гашением сервлет контекста


Yevhen Maksymovych [1 day ago]
тут кто-то выше уже бросал ссылку на то, как это сделать с помощью listener'а

Alexander Pilipenko [1 day ago]
SKY бросал


Alexander Pilipenko [1 day ago]
Решил не заморачиваться пока


Victor [1 day ago]
я в контекст приложения, который общий для всех сервлетов, сохраняю контекст. Тогда можно использовать для каждого сервлета один контекст.



Victor [1 day ago]
думаю что такой вариант выгоднее, чем listner'ы


e.pekhterev [1 day ago]
я что то сомневаюсь, что таким образом контекст закроется. Если бы ты его определил там в try with resource, тогда бы точно закрылся.


Victor [1 day ago]
а как бинами пользоваться, если контекст закрыли сразу же после того как бин взяли. Смысл таков: открыли контекст, сохранили, пока он работает берем бины и пользуем, в конце закрыли.


Victor [1 day ago]
ведь Когда выполнение команд блока try закончится, независимо от того – нормально оно закончилось или было исключение, для объекта, созданного внутри круглых скобок (), будет вызван метод close();

Yevhen Maksymovych [1 day ago]
контекст-то закроется, но бины инстанцированные останутся, если на них остались ссылки вне блока, например, если на них ссылается член сервлета


Yevhen Maksymovych [1 day ago]
но, это, конечно, не значит, что надо закрывать контекст, после того как забрали оттуда всё нужное ))))



Join_Selectovich [1 day ago]
на счет закрытия в подсказках написано:
_8.1: Закрывать springContext в сервлете грамотнее всего в HttpServlet.destroy(): если где-то в контексте Spring будет ленивая инициализация, метод-фабрика, не синглтон-scope, то контекст понадобится при работе приложения. У нас такого нет, но делать надо все грамотно._ (edited)



dimlo [1 day ago]
@Victor "я в контекст приложения, который общий для всех сервлетов, сохраняю контекст". Правильно ли я понял: в блоке init сделать что-то подобное: 
ServletContext servletContext = config.getServletContext();        servletContext.setAttribute("appCtx", context);    и потом этот контекст можно будет подтянуть из любого сервлета?


Victor [1 day ago]
да, я так делал



dimlo [1 day ago]
Спасибо


e.pekhterev [1 day ago]
@Join_Selectovich на счёт грамотнее всего - тут вопрос очень спорный, у нас 2 сервлета, один спринг-конетекст, так и что нам делать для сервлета юзверей?? тоже в нём контекст поднимать и потом дейстроить? 
я так понимаю как сейчас делаем - это просто заглушка своего рода, просто пока не дошли до контекстЛисенера или дальше до норм спринга без этих сервлетов



Victor [1 day ago]
ну я это решил: проверяют если в атрибутах контекст, если есть, беру и использую, если нет, создаю, сохраняю и использую.
if else :slightly_smiling_face: (edited)


e.pekhterev [1 day ago]
@Victor честно говоря не понял где и в каких атрибутах ты проверяешь контекст.


Victor [1 day ago]
вот вот, сразу критика, а потом разбираемся что атрибуты оказываются разные бывают )))


Yevhen Maksymovych [1 day ago]
я так понимаю, в атрибутах контекста сервлета



e.pekhterev [1 day ago]
@Victor ничего не понял, можешь схему объяснить, вот у нас сейчас есть сервлет еды, в нем поднимается контекст.
запускаем приложение, обращаемся по урлу к сервлету юзеров, который что делает?? как он понимает, что контекст уже создан в сервлете еды (или ещё не создан) и не нужно больше создавать? он вообще должен ли знать, что есть сервлет еды или ещё какие то сервлеты? (edited)


Yevhen Maksymovych [1 day ago]
я за него попробую: вероятно, каждый сервлет в методе init() проверяет наличие в контексте сервлета (который общий для всех сервлетов) наличие инициализированного контекста спринга, при нахождении оного - достаёт оттуда нужный ему бин (если ему что-то нужно), если не находит - создаёт контекст. при дестрое сервлета - кто первый успеет, закроет контекст спринга


Yevhen Maksymovych [1 day ago]
вообще, это для листенера задача, чтобы не проверять, есть ли там этот самый контекст, просто положить его при старте, и убить при дестрое

Yevhen Maksymovych [1 day ago]
а сервлеты по необходимости уже пусть оттуда его берут, листенер гарантированно его туда положит. ну, если сможет поднять


Victor [1 day ago]
@Yevhen Maksymovych я б так хорошо не смог объяснить :slightly_smiling_face:
вот листенер, он же постоянно работает, пока работает приложение? То есть больше ресурсов будет тратиться, чем если сделать if else в сервлете, верно? (edited)


Yevhen Maksymovych [1 day ago]
не, фактически, томкат на каждые важные с его точки зрения события инвокает триггеры - независимо от того, висят на них пользовательские листенеры или нет (edited)

Yevhen Maksymovych [1 day ago]
подозреваю, что там висит уйма дефолтных листенеров, но со 100% гарантией сказать не могу, не интересовался :slightly_smiling_face:


e.pekhterev [1 day ago]
спасибо, надо посмотреть/попробовать

Yevhen Maksymovych [1 day ago]
если ты повесишь листенер имплементирующий ServletContextListener, он отработает ровно дважды - при старте контекста сервлета и при его финише, больше он по идее инвокнуться не должен (edited)


Alexander Pilipenko [2:25 PM]
В смысле не из тупости, а из exception только во время destroy


Gagarina6794 [Jul 9th at 5:46 PM]
in #hw2
8: добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и SecurityUtil.setAuthUserId(userId) в UserServlet).    Как-то смутно представляю что требуется. Это нам надо в зависимости от выбранного user-a на html перейти на users.jsp с параметрами в зависимости от выбора 1 и 2?



21 replies
tkorky [1 day ago]
перейти на meals.jsp в зависимости от юзера


tkorky [1 day ago]
соответственно там будет еда именно для этого юзера :slightly_smiling_face:


Join_Selectovich [1 day ago]
похоже нужно в сервлете из request-а страницы index.html вытянуть это значение и подставить в методы контролера...

e.pekhterev [1 day ago]
не совсем так, после выбора юзера в index.html нужно обратиться к сервлету пользовтелей, сообщить о выбранном юзере, а он в свою очередь установит id аутентифицированного пользователя в SecurityUtil и далее отправит на сервлет Еды для вывода данных конкретного пользователя (edited)


Join_Selectovich [1 day ago]
я так понимаю реквест из index.html пойдет через MealServlet на UserServlet

Join_Selectovich [1 day ago]
и потом обратно вернется к UserServlet-y


e.pekhterev [1 day ago]
давай ещё раз, мы попадаем на главную страницу, где у нас есть окошко логина и пароля, так собственно зачем нам кузнец, т.е. еда, за авторизацией мы сразу ломимся на сервлет, который с юзерами работает. а вот уже после, когда юзер авторизован сервлетом юзера уже можно отправить запрос сервлету еды, чтобы он дал данные только что залогиневшегося пользователя



Gagarina6794 [1 day ago]
Теперь всё понятно)) так бы сразу написали в задании)



Join_Selectovich [1 day ago]
ну :slightly_smiling_face:


Join_Selectovich [1 day ago]
а что на счет хранения параметров фильтра _8.2: Не храните параметры фильтра как члены класса сервлета, это не многопоточно!_


Join_Selectovich [1 day ago]
где хранить если не в сервлете?


Join_Selectovich [1 day ago]
отдельный репо можт завести под это дело )

e.pekhterev [1 day ago]
@Gagarina6794 на работе будут писать раз в 10 меньше, чем у нас в условии и нужно будет делать сразу правильно, при этом желательно не отвлекать своего руководителя от его собственной работы своими вопросами)))


Join_Selectovich [1 day ago]
я вот думаю что может специально так пишут чтобы не понятно было, чтобы народ повтыкал подумал покрутил поспрашивал, так оно лучше запоминается , с кровью и пОтом...


Gagarina6794 [1 day ago]
Как уже будет, выгонят за такое, буду опять бухгалтером или вёрсткой займусь)) всегда есть выбор


e.pekhterev [1 day ago]
ну какие то моменты разжеваны, а что то нет, но это больше потому, что мы только учимся и опыта мало, как научимся - всё будет казаться банальненько и понятно сразу


Gagarina6794 [1 day ago]
А и на работе ж тоже надо спрашивать, общение оно надо чтобы присутствовало в меру допустимого, тогда как работать чтобы всё работало как надо


e.pekhterev [1 day ago]
спрашивать и уточнять по любому нужно, но желательно в момент получения задания, но вот потом нужно делать это задание и не мешать начальнику пить кофе с девчулями с ресепшина  и закусывать пирожинками (edited)



Gagarina6794 [1 day ago]
Так и работай, я буду кофе пить с начальником и обсуждать задания, и закусывать пирожинками



e.pekhterev [1 day ago]
ну как бы я тот самый начальник, а ты совсем не с ресепшина)))


Gagarina6794 [1 day ago]
Что за глупости, конечно не с ресепшена, там мало платят)))


Join_Selectovich [5:49 PM]
только хотел то же самое спросить


dimlo [Jul 9th at 5:55 PM]
in #hw2
я сделал radio buttons на index.html и кнопка отправить. action - отдельный сервлет, который вызывает setUserId у SecurityUtil и делает редирект на /meals


2 replies
e.pekhterev [1 day ago]
зачем делать отдельный сервлет, если написано: "сделать ... SecurityUtil.setAuthUserId(userId) в UserServlet"


dimlo [1 day ago]
ок, логично)


Andy Fleer [Jul 9th at 6:03 PM]
in #hw2
4.3: если еда не принадлежит авторизированному пользователю или отсутствует, в MealServiceImpl бросать NotFoundException. ValidationUtil и так бросает это усключение. Это и имеется в виду? Ну и бросать то бросаем, а овить не надо? кто что думает?


13 replies
e.pekhterev [1 day ago]
если тебе мало валидейшинУтила, то можно ещё пару тройку раз бросисть исключение, оно рантайм, так что ничего страшного не произойдет)))


dimlo [1 day ago]
я не ловил. получаю error 500


e.pekhterev [1 day ago]
в браузере я так понимаю? почитай что такое ошибки начинающиеся на 5

dimlo [1 day ago]
так там дальше расшифровка ошибки идет, в браузере. Я так понимаю, что подобное поведение и ожидается (edited)


e.pekhterev [1 day ago]
скорее всего ошибка там в другому, смотри чего написано, ставь точки останова и дебаж (edited)


Andy Fleer [1 day ago]
Мне валидейшн утила достаточно.))) Правильно понимаю, что exception выбрасываем, а с его обработкой не морочимся. Нет же в задании? не пропустил? Так же поняли?


dimlo [1 day ago]
@e.pekhterev Браузер выдает: HTTP Status 500 - Мое сообщение об ошибке. В первой строке описания exception - наш NotFoundException. Условия появления - список еды для пользователя пуст (принудительно не заполнил в MealsUtil). Ошибка брошена в слое service


dimlo [1 day ago]
@Andy Fleer Я не обрабатывал, могу ее получить при умышленном создании определенных условий

Andy Fleer [1 day ago]
да да... я так же... для теста провоцирую

e.pekhterev [1 day ago]
я ж выше написал, NotFoundException extends RuntimeException, что это значит? это значит, что это unchecked эксепшин, т.е. никто от нас и не ждёт её обработки, выбросили и забыли)))


Andy Fleer [1 day ago]
Ок))) Теперь понятно написал)) Убедительно))


Andy Fleer [1 day ago]
Спасибо))


e.pekhterev [1 day ago]
обрабатывать их можно, если потребуется (их же там не просто так воткнули), но в данном задании это не требуется.


stea1th [9:49 PM]
2.1: В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.
может кто то это на русский перевести?
вообще не понятно, что имеется ввиду...


stea1th [Jul 9th at 9:54 PM]
in #hw2
памажитии пажалуста


40 replies
Yevhen Maksymovych [1 day ago]
имеется в виду, что контроллер не должен принимать в своих методах id пользователя


Yevhen Maksymovych [1 day ago]
он должен брать авторизованного пользователя из своего окружения


Yevhen Maksymovych [1 day ago]
из утильного класса в данном случае


sky [1 day ago]
не должен принимать id в качестве аргумента


stea1th [1 day ago]
о каком контроллере воообще идет речь?

stea1th [1 day ago]
а в Meal может быть userId?


sky [1 day ago]
Cvjnhb

sky [1 day ago]
Смотри


sky [1 day ago]
Meal кладем в репозиторий


sky [1 day ago]
репозиторий кладем в сервис


sky [1 day ago]
сервис в контроллер

sky [1 day ago]
и в контроллере вызываем методы


sky [1 day ago]
в которые нельзя передовать userId как аргумент


stea1th [1 day ago]
MealRestController?

sky [1 day ago]
ага


Yevhen Maksymovych [1 day ago]
ога


stea1th [1 day ago]
но в Meal может быть userId?

sky [1 day ago]
может


stea1th [1 day ago]
а где можно тогда параметр userId задавать?


stea1th [1 day ago]
я в репозитории сделал метод public List<Meal> getAllByUserId(int userId)

sky [1 day ago]
Посмотр внимательно на классы, которые с патчами появились, в одном из них


stea1th [1 day ago]
тот метод лишний?

e.pekhterev [1 day ago]
подумай лучше о том, по какому id удобней было бы доставать из карты еду для пользователя (при этом желательно не бегать по всем Энтри мапы).


e.pekhterev [1 day ago]
это вариант, когда в Meal у нас нет поля userId

stea1th [1 day ago]
а можно с userId? а то я его запилил


e.pekhterev [1 day ago]
можно, но по мне так не рационально его там хранить в данной реализации, да и дальше тоже


vch [1 day ago]
@stea1th можно. Есть разные варианты, все равноценные

stea1th [1 day ago]
блин, я наверное тупой, но реально не догоняю


e.pekhterev [1 day ago]
была бы база данных - тогда имел бы смысл, в нашем варианте, когда база захардкожена даже как то глупо делать userId полем класса Meal (edited)


e.pekhterev [1 day ago]
слишком большие накладные расходы


stea1th [1 day ago]
по мне так было бы идеально в юзере сделать лист с его едой и не париться


e.pekhterev [1 day ago]
на том уроке уже было пройдено, что лист это плохо в данном варианте

e.pekhterev [1 day ago]
в общем подумай

stea1th [1 day ago]
вопрос еще

stea1th [1 day ago]
эти checknotfound методы

stea1th [1 day ago]
что они проверяют?


e.pekhterev [1 day ago]
ну так пройди через контрол по ним и поизучай

e.pekhterev [1 day ago]
это валидация

e.pekhterev [1 day ago]
которую мы будем прикручивать позже


e.pekhterev [1 day ago]
т.е. когда будет некорректный ввод в поля формы, изменен юзер или нет, достаточно ли сложный пасворд и т.д.


zippospb [Jul 9th at 11:04 PM]
in #hw2
кто мне может объяснить, зачем нам создавать в контроллере отдельно метод без фильтра и отдельно с фильтром, когда можно все в одном методе сделать (просто отсутствующие параметры подменять на .MIN и .MAX?


2 replies
Victor [1 day ago]
ответ наверное будет спойлером... Думаю что реализация будет разная изза Rest API.


Victor [1 day ago]
Думаю что best practice in slake - пользоваться threads


zippospb [11:05 PM]
метод getAll


hav [Yesterday at 10:14 AM]
in #hw2
Помогите с фильтрами. Сделал поля для ввода дат и времени. Как их в сервлете правильно получить?


9 replies
Yevhen Maksymovych [1 day ago]
так же, как и любой другой параметр. req.getParameter(paramName)


hav [1 day ago]
Это понятно. Делать еще action, например filter? Или в ветке all? Тогда надо будет проверять есть ли эти параметры.


Victor [1 day ago]
Я action добавлял. Думаю правильно отделить фильтр. В jsp form method=get.  остальное по аналоги с формой в редактировании meal.


hav [1 day ago]
Сделал action. А параметры фильтра где сохранять?


e.pekhterev [1 day ago]
action не надо, фильтрации должна сохраняться при любых операциях с едой (create/update/delete), поэтому отдельного экшина не нужна, фильтр работает для всех экшинов (edited)


hav [1 day ago]
Тогда наверное правильнее будет проверять есть ли в параметрах даты/время, если есть - сохранять их в контроллере. А контроллер выдает весь список, если фильтры пустые, или отфильтрованный, если не пустые.


Yevhen Maksymovych [1 day ago]
в контроллере ничего не надо сохранять. он шарится между всеми пользователями (edited)


hav [1 day ago]
Тогда где сохранять фильтры?

vch [1 day ago]
варианта вроде всего 2 - либо при каждом запросе добавлять в параметры, либо в сессию


Andy Fleer [Yesterday at 2:00 PM]
in #hw2
5.6: В REST при update принято передавать id (см. AdminRestController.update)    Если я передаю так     public void update(Meal meal, int id), то логично, что дальше я и в сервисе должен принять id.  То есть дальше я должен менять интерфейс MealService. Чет будто фигня какая-то. Вам не кажется?


18 replies
Yevhen Maksymovych [1 day ago]
#edited я тут написал какую-то фигню, не подумав, и стёр её :slightly_smiling_face: (edited)



Gagarina6794 [1 day ago]
тоисть получается мы сейчас в update просто этот userId как параметр выставляем но пока не используем? (edited)


Yevhen Maksymovych [1 day ago]
а, блин, что я пишу )))


Gagarina6794 [1 day ago]
в контролере же берем userId из Security? (edited)

Yevhen Maksymovych [1 day ago]
я почему-то по диагонали прочёл, что речь идёт о userId

Gagarina6794 [24 hours ago]
поправила вопросы))


Yevhen Maksymovych [24 hours ago]
да, в контроллере из секьюрити, но сверху спросили про id Meal'а, а не юзера

Gagarina6794 [24 hours ago]
я перефразировала в правильном направлении)

Yevhen Maksymovych [24 hours ago]
т.е. у реста должно быть что-то вроде MealRestController.update(Meal meal, int id), где id - ид не юзера, а мила, который тут же, положила


Yevhen Maksymovych [24 hours ago]
а в сервис он уже передаст update(Meal meal, int userId)


Gagarina6794 [24 hours ago]
то он пока здесь для красоты?


Yevhen Maksymovych [24 hours ago]
большей частью, да, ну, можно для порядка сделать проверку, что meal.getId() == id

Gagarina6794 [24 hours ago]
спасибочки)


e.pekhterev [24 hours ago]
он там не для красоты


e.pekhterev [24 hours ago]
каждный раз при обращении контроллер будет запрашивать откуда то userId, и дальше обрабатывать для текущего пользователя запросы, но сам контроллер в своим метод не должен получать аргументах userId, как и сказано в задании


Yevhen Maksymovych [24 hours ago]
да речь не про юзерид идёт (edited)

Yevhen Maksymovych [24 hours ago]
а про meal.id, которая контроллеру приходит из сервлета вмести с милом для апдейта

Gagarina6794 [21 hours ago]
Кроче, апдейт мой отвалился)) раньше работал) но там реализация всего была другая, переделала и всё... не апдейтит


anyonepaw [4:23 PM]
не работает doPost()
кто может посоветовать:  почему из index.html, когда я отправляю
```<form action="users.jsp" method="post">```
c таким select'ом
```<select onchange="this.form.submit()" name="userId" >
            <option disabled selected>Выберите пользователя</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>```
POST запрос из сабмита отправляется на user.jsp и меня редиректит туда же
но log.debug в дупост спит и вообще метод doPost в сервлете не выполняется, но и doGet тоже не выполняется
с чем это может быть связано?


Alexander Pilipenko [Yesterday at 4:26 PM]
in #hw2
action="users.jsp"  -  ты напрямую передаешь управление на users.jsp. А не на сервлет (edited)


7 replies
anyonepaw [22 hours ago]
мм, ясно
а как прописать в action сервлет? action = 'userServlet' не работает


anyonepaw [22 hours ago]
@Alexander Pilipenko разве то, что я говорю открыть user.jsp - это не означает открытие его сервлета? (edited)


Alexander Pilipenko [22 hours ago]
У тебя сервлет прописан в web.xml

Alexander Pilipenko [22 hours ago]
Если ничего не менял, то он замаплен на users

Alexander Pilipenko [22 hours ago]
Я делал, так <form method="post" action="users">

Alexander Pilipenko [22 hours ago]
http://htmlbook.ru/html/form/action

anyonepaw [22 hours ago]
спасибо большое!:+1: я не знаю, почему пропускала этот вариант
он просто замаплен как "/users"


Daniel [Yesterday at 7:46 PM]
in #hw2
Товарищи, помогите, пожалуйста.
Когда запускаю SpringMain, то на строке с объявлением контекста *try (ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml"))* выдает кучу дерьма, озаглавленную вот этим:
Exception in thread "main" org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'inMemoryMealRepositoryImpl' defined in file [C:\projects\topjava\target\classes\ru\javawebinar\topjava\repository\mock\InMemoryMealRepositoryImpl.class]: Instantiation of bean failed; nested exception is java.lang.NoClassDefFoundError: javax/servlet/http/HttpServlet


6 replies
Andy Fleer [19 hours ago]
У меня чет похожее было.Проверь аннотацию для репозитория. Написано сверху @Repository ?


Victor [18 hours ago]
потому что у <groupId>javax.servlet</groupId><scope>provided</scope> и он не видит javax.servlet после запуса. Уберите временно и обнови мавен, а когда томкат будешь запускать, опять поставь. (edited)


Daniel [18 hours ago]
Аннотации стоят. Пробовал *mvn clean install* & *mvn package*. Само веб-приложение, сервлеты работают нормально. А вот когда для теста запускаю *SpringMain*, вываливается такая вот телега...


Victor [17 hours ago]
так убери scope>provided</scope>, неужели не помогло? по крайней мере эту ошибку снимет. Может другая еще есть и она будет в логах тогда


Daniel [16 hours ago]
@Victor Спасибо большое, я сначала неправильно твою инструкцию понял. Теперь заработало. Только когда возвращаю на место *<scope></scope>*, обновляю maven, запускаю и все равно не работает. Поэтому просто удалил эту строчку. Это не критично?


Victor [16 hours ago]
Это из-за особенностей твоей реализации. Когда будешь томкат запускать, верни строку полностью. Иначе у него будет 2 библиотеки сервлетов (edited)


Daniel [7:47 PM]
Не понимаю, в чем дело, ибо javax.servlet.* у меня есть в проекте.


Sergey [Yesterday at 8:13 PM]
in #hw2
Подскажите, пожалуйста.
Правильно ли я понимаю,  (в случае добавления поля userId в Meal)  что для реализации рестконтроллера meal - на всех обращениях к сервису из контроллера передается authUserId() и пропускается по всем слоям в виде аргумента вплоть до репозитория и лишь там проверяется валидность аутентификации и готовится ответ в виде эксепшена или данных? Ведь для этого надо на всех слоях добавлять к каждому методу аргумент и редактировать интерфейс репозитория. Не слишком ли это трудоемко? :face_with_raised_eyebrow:


5 replies
Yevhen Maksymovych [18 hours ago]
Да

Sergey [18 hours ago]
А есть ли более элегантное решение?


Yevhen Maksymovych [18 hours ago]
"да" - это было к "правильно ли я понимаю" :slightly_smiling_face:


Yevhen Maksymovych [18 hours ago]
что тут трудоемкого? дописать аргумент в несколько методов? ну, это такой себе рефакторинг


Yevhen Maksymovych [18 hours ago]
а то что лишняя переменная будет гулять между слоями - ну, одной больше, одной меньше. ты же сам проектируешь интерфейс общения между слоями, кто тебе может запретить добавить туда что-то или убрать :slightly_smiling_face:


Vladimir Gorbatenko [Today at 11:15 AM]
in #hw2
Всем привет! Что-то я пропустил. Зачем мы используем такую форму "LocalDateTime.now().truncatedTo(ChronoUnit.MINUTES)" ?


14 replies
Alexander Pilipenko [3 hours ago]
Хороший вопрос. В теории, в течении часа может быть несколько приемов пищи, но в течении минуты несколько приемов пищи быть не может (edited)


Alexander Pilipenko [3 hours ago]
Т.е. отслеживать до секунды время приема - нет смысла


Alexander Pilipenko [3 hours ago]
Поэтому секунды откидываем

Stanislav [3 hours ago]
Округление для даты-время, тип округления задаем в скобках.

Yevhen Maksymovych [3 hours ago]
да это понятно, но какой практический смысл в этом? защита, чтобы пользователь не записал в реп две еды с одинаковой датой, разнящиеся милисекундами? дак у нас на текущий момент никаких констрейнтов нет. пусть записывает с одинаковыми минутами. объективно, на текущий ммоент - чисто, чтобы показать, что такой метод есть.


Alexander Pilipenko [3 hours ago]
Могу предположить, что в БД будет проверка

Егорро [1 hour ago]
Если минуты не обрезать у now(), то в поле input в браузере могут не только секунды, но даже миллисекунды прописываться


Егорро [1 hour ago]
https://i.imgur.com/719xOvE.jpg (68 kB)
скриншот сравнения


Yevhen Maksymovych [1 hour ago]
странно

Yevhen Maksymovych [1 hour ago]
с точки зрения LocalDateTime время у него хранится отдельно в LocalTime, где каждый разряд - отдельная переменная

Yevhen Maksymovych [1 hour ago]
транкэйтом мы просто обнуляем часть этих переменных

Yevhen Maksymovych [1 hour ago]
а, всё понятно

Yevhen Maksymovych [1 hour ago]
вся магия в LocalTime.toString(), который аппендит разряды, только если они не нулевые


Yevhen Maksymovych [1 hour ago]
ну, учитывая, что по-хорошему нам бы вручную форматить вывод даты - чтобы не было этой жуткой "Т" в середине, использовать транкейт для того, чтобы не выводить последние разряды - так себе решение :slightly_smiling_face:


dustnfox [1 day ago]
Ну вообще да. Склоняюсь к мысли, что Григорий в это образовательных целях больше использует.


turhanow [8:55 PM]
> 5.7: Сделайте отдельный getAll без применения фильтра
правильно ли я понимаю, что целесообразность данного пункта в экономии памяти и времени на обработку в стриме при выборке списка из репы?

иначе ведь можно было бы сделать всего один метод и передавать null, с последующей заменой на MIN / MAX

SergeyA [9:49 PM]
added this Plain Text snippet: Доброй ночи. вопрос по преобразованиям с использованием стримов: 
repository.values().stream().sorted().collect(Collectors.toList()); //получаем коллекцию values - её в стриме сортируем - и потом опять в коллекцию 
//- *это нормально, так гонять данные из формата в формат? *
repository.values().stream().filter(u -> u.getEmail().equalsIgnoreCase(email)).findFirst().get(); // А это не ПИПЕЦ?! )))
Yevhen Maksymovych [9:51 PM]
с чего бы пипец?
Yevhen Maksymovych [9:53 PM]
фильтр выполняется последовательно. как только первый совпадёт, тебе вернётся значение, и итерирование прервётся
Yevhen Maksymovych [9:54 PM]
равно как и сортировка, ты не парься, всё уже оптимизировано до тебя, оно там не пузырьком сортируется, будь спокоен :slightly_smiling_face:
sky [10:02 PM]
Была, по моему в районе нулевого урока, статья, о целесообразности использования stream api где попало. И вот первый вариант с сортировкой точно не ок. Но это с точки зрения перформанса. Но читаемость стрим ап very high, и если это не приводит к сужению перфоманса всего приложения, то его использование оправдано. Хождение в бд всяко больше съест (perhaps). Но привыкаешь к нему очень быстро. И потом, то что быстро решится на стримах, будет сложнее сообразить на циклах..


Maksim K [Jul 11th at 10:02 PM]
in #hw2
Может кто подсказать по реализации DateTimeUtil.isBetween с помощью дженериков. Я что-то вообще не пойму как надо делать. Хоть объясните, что надо сделать. Я так понимаю мы в метод должны передать meal.getDate(), meal.getTime() и  LocalDate startDate, endDate, LocalTime startTime,  endTime и там все это сравнить. Так ли это? И Если так, то куда там дженерики прикрутить


34 replies
Victor [2 days ago]
не совсем. в старой версии метод сравнивал только LocalTime . Нужно сделать так, чтобы ему можно было передавать и LocalTime  и LocalDate.


turhanow [2 days ago]
смотри, если делать двумя методами, то везде идет compareTo. А откуда этот метод? из интерфейса Comparable. Значит подаваемые в метод isBetween объект должен реализовывать этот интерфейс. осталось прописать это грамотно в public static <вот здесь> ....


sky [2 days ago]
пара hints - во первых к объектам внутри метода isBeetwen уже применяется определенный метод, именно он должен быть и у дженерика. Как применить дженерик к статик методу смотри (не самую лучшую, что удалось нарыть) ссылку https://stackoverflow.com/questions/4409100/how-to-make-a-java-generic-method-static (edited)


Maksim K [2 days ago]
а метод принимает 3 аргумента?


Victor [2 days ago]
Да


Maksim K [2 days ago]
так вот я не могу понять логику или я вообще ниче не понимаю. как это понимаю я: если мы сравниваем по датам, то передаем meal.getDate() и даты из формы и сравниваем. если по времени, то передаем meal.getTime() и время из формы и тоже сравниваем. А если и по датам и по времени, то как? два раза метод вызывать что ли? или как? че-то я совсем запутался


turhanow [2 days ago]
getDate и getTime реализуют интерфейс Comparable))
а точнее LocalDate и LocalTime. Это то что их объединяет - ключ к решению) остается это прописать в <тынц тынц>) (edited)


Victor [2 days ago]
Да, два раза


Maksim K [2 days ago]
спс за подсказки про Comparable. но я ща не про реализацию, а вообще про логику. Зачем нам дженерики и потом два раза метод вызывать? а не проще ли сразу в метод передать все аргументы и даты и времени и сразу все сравнить?


Maksim K [2 days ago]
ну то есть оставить метод как был, только еще добавить туда даты и просто вместе сравнить (edited)

Victor [2 days ago]
получается унивесальный метод, который можно вызывать и встраивать в свою логику. Не нужно дублировать код.


sky [2 days ago]
у меня получился 1 метод isBetween, у которого я слегка изменил сигнатуру, думаю примерно это и требуется, причем количество принимаемых аргументов не поменялось


sky [2 days ago]
метод is between вызывается в разных местах


Victor [2 days ago]
>у то есть оставить метод как был, только еще добавить туда даты и просто вместе >сравнить
Если так сделать, то будет в коде два раза сравнение все равно. Вот эти два шага и объединяем (edited)


sky [2 days ago]
в одном месте у него на входе даты - в другом таймы, так надо по заданию

Victor [2 days ago]
Тем более что да: даты у нас в репозитарии будут сравниваться, а время в сервисе или    контроллере



Maksim K [2 days ago]
я наверно опять туплю)) а что нельзя в репозитории сразу сравнить и даты и время?

Maksim K [2 days ago]
а вот ща в задании увидел, что "2.4: Фильтрацию по датам сделать в репозитории т.к. из базы будем брать сразу отфильтрованные по дням записи." ТАк вот вопрос, а из базы нельзя сразу брать отфильтрованные по дням и по времени?


sky [2 days ago]
Прочитай еще раз внимательно задание, там есть указание, где конкретно мы делаем объекты MealWithExceeded из Meal. При этом процессе у нас и предполагается фильтрация по времени


sky [2 days ago]
По идее нас никто не ограничивает в реализации того функционала, который указан в задании, но, именно то, как он указан, и является во многом правильным путем в решении задачи. Причем в формулировке поставленной задачи, во многом кроется и ее решение (или намек на решение определенного пункта будет в следующем, или через пару - другую)


Maksim K [2 days ago]
ну я читал, что MealWithExceeded из Meal делаем или в сервисе или в контроллере. я сделал в контроллере. ну, если я правильно это сделал. я в методе где надо получить список еды запросил у сервиса список meal, сервис запросил у репозитория. репозиторий вернул сервису, сервис вернул контроллеру и уже в контроллере я этот список переделал в mealWithExceed.


Maksim K [2 days ago]
аааааааа....

Maksim K [2 days ago]
я наверно понял


Maksim K [2 days ago]
типа,если мы получим в контроллер список meal отсортированный по дате и по времени, а потом там преобразуем его в mealWithExceed, то там неверно посчитается exceed  за сутки, так??



Maksim K [2 days ago]
судя по лайку,я прав:grin: ептить. а я уже который день не догоняю какого х... тут все пишут про дженерики, думаю зачем так усложнять, если можно сразу сравнить по дате и по времени. и только ща понял. спасибо, парни, что навели меня на правильный ответ.



Maksim K [2 days ago]
и вообще, не знаю, как у кого, но лично у меня в этом втором задании больше сложности вызывает не реализация методов (тут вроде ниче особо сложного нету), а именно понять, что от меня хотят. И как это вообще все будет потом взаимодействовать и работать



sky [2 days ago]
Курс вообще походу крайне грамотно построен, надо задание перечитывать по мере выполнения, и будешь натыкаться на подсказки скрытые в вопросах

turhanow [2 days ago]
понимаю) я как то на basejava 10 часов сидел думал как реализовать объектную модель))


Maksim K [1 day ago]
ну да. тут бывает такой тупняк, что ваще долго сидишь и пытаешься понять что надо делать. помнится, где-то было написано, что для прохождения этой стажировки достаточно уделять несколько часов в неделю (вроде) и все получится. я хз как кто, а я тут днями зависаю и то не успеваю в положенный срок сделать задание. вот ща только само задание доделал. и то не факт, что правильно. а еще Optional:triumph: (edited)


sky [1 day ago]
фильтрация уже оптионал, причем самый его сок


Maksim K [1 day ago]
ну я так понял, что обычное задание это реализовать всю логику и чтобы она работала. а в optional надо все это отобразить в браузере. так?


turhanow [1 day ago]
я начиная  с basejava веду занимательную стсатистику времени на выполнение заданий) так вот на выполнение HW02 ушло 15 часов активного продумывания и реализации решения. то есть это время ни на что не отвлекаешься, есть только ты и монитор и java )


Maksim K [1 day ago]
:grinning: ну да. меня уже жена начинает к компу ревновать, мол, ему больше времени уделяю))) 
но об этом надо уже наверно в другом канале писать, типа flooding))


turhanow [1 day ago]
вообще осознал что эта стажировка фактически вторая работа, несколько часов в неделю - это если очень продвинутый программист, в остальном сидишь каждый день по 4 часа + выходные)


vch [10:03 PM]
commented on SergeyA’s snippet Доброй ночи. вопрос по преобразованиям с использованием стримов:
А чем плох первый вариант?
Yevhen Maksymovych [10:03 PM]
почему это не ок? если ему надо вернуть лист отсортированным, какие ещё варианты? ну, если оставить вариант реализации это силами бд
sky [10:06 PM]
collections sort вроде как быстрее робит
Yevhen Maksymovych [10:09 PM]
мне другое интересно. как отработает sorted(), если юзер не имплементирует компараблю? По дефолту, если я не ошибаюсь, используется Comparator.naturalOrder(), но какой натуральный порядок у юзеров?
Yevhen Maksymovych [10:09 PM]
а оно работает :confused:
sky [10:10 PM]
default comporatr
sky [10:10 PM]
если есть такой
sky [10:10 PM]
user lack of it, у меня вроде sorted без аргументов на meals не проканало (exception все дела) но перепроверять я это конечно не буду
sky [10:16 PM]
Ладно, уговорил Yevhen:

java.lang.ClassCastException: ru.javawebinar.topjava.model.User cannot be cast to java.lang.Comparable

у меня не работает без аргументов
Yevhen Maksymovych [10:21 PM]
не, всё тип-топ, падает, как я и ожидал :slightly_smiling_face:
Yevhen Maksymovych [10:21 PM]
это я с планшета видимо где-то не туда ткнул, что у меня эта штука отработала :slightly_smiling_face:


turhanow [Jul 11th at 10:22 PM]
in #hw2
Ребят, пользуйтесь пжл вложенными комментами (ветки) к сообщению, а не пишите по паре слов  
Потом очень неудобно искать ответы на разные вопросы, перелистывая несколько страниц чата.
:slightly_smiling_face:


2 replies
Yevhen Maksymovych [2 days ago]
это бага слаки, ответы на картинку падают в общий чат канала (edited)


SergeyA [2 days ago]
Точно, но я думал что это фича )


Maksim K [10:22 PM]
так по идее в sorted() надо же компаратор передавать и будет ок (edited)


SergeyA [Jul 11th at 10:23 PM]
in #hw2
Я еще не запускал, только пишу. :thinking_face:  столько комментов даже не ожидал  спасибо. :blush:
пустой sorted()  -  я расчитывал на компаратор по умолчанию... (edited)


1 reply
Ma3stro [2 days ago]
У нас же всё равно нигде пустой sorted не используется


Daniel [Yesterday at 1:44 AM]
in #hw2
Товарищи, подскажите дилетанту, пожалуйста. Вот мы в *MealsServlet* берем контекст Спринга, вытаскиваем оттуда бин Контроллера, и им орудуем, и все у нас хорошо получается. 
А если я в *SpringMain* беру из контекста этот же бин Контроллера и пытаюсь что-то изменить, почему эти изменения не отображаются в общей БД? Ведь, как я понимаю, по умолчанию бины синглтоны, и по логике я могу иметь доступ к одним и тем же экземплярам класса с разных мест? Непонятно...


5 replies
Tanya [1 day ago]
а из какого контекста ты его берешь?


Daniel [1 day ago]
`try(ConfigurableApplicationContext ctx = new ClassPathXmlApplicationContext("spring/spring-app.xml")) {
           restController = ctx.getBean(MealRestController.class);
       }`
Это в *MealServlet*. И если тоже самое проделать в *SpringMain*, разве  у того контроллера не тот же самый доступ должен быть к данным?:thinking_face:


Tanya [1 day ago]
*new* ClassPathXmlApplicationContext не наводит на мысли? (edited)


SergeyA [1 day ago]
Ах *"new"*! - я сначала не заметил эти буковки и ни чего не понял в ответе @Tanya  :slightly_smiling_face:
Интересно - это новый контекст - т.е. у товарища получилось 2 spring'а параллельно? (edited)


Daniel [1 day ago]
@Tanya понял. Я думал, что если в аргументе конструктора один и тот же xml-файл, значит и контекст будет один и тот же. Спасибо. (edited)


Jury Mironov [Yesterday at 5:15 PM]
in #hw2
Смотрю разбор дз2. У меня в  MealRepository поле userId. Говорится,что класс сохраняющий состояние - не потокобезопасен. А если поле сделать volatile?


14 replies
Yevhen Maksymovych [1 day ago]
тут речь немного о другом, репозиторий по своему определению должен быть stateless, потому что он - интерфейс доступа к данным


Yevhen Maksymovych [1 day ago]
если тебе надо хранить где-то userId - храни его в модели


vch [1 day ago]
`MealRepository поле userId` - именно как член класса репозитория что ли? Так действительно нельзя


Yevhen Maksymovych [1 day ago]
хранить что-то в репозитории непотокобезопасно не потому что его переменные не волатильны, а потому что он синглтон


e.pekhterev [1 day ago]
объект милрепозиторий у тебя один на всех,

e.pekhterev [1 day ago]
он не может ничего в полях хранить, если только это не что то общее для любого юзера (edited)


Yevhen Maksymovych [1 day ago]
налетели на человека :slightly_smiling_face:


Jury Mironov [1 day ago]
:face_with_rolling_eyes:


Jury Mironov [1 day ago]
вроде, понятно, но не совсем

Jury Mironov [1 day ago]
спасибо

e.pekhterev [1 day ago]
прочитай хотя 3-4 главы Spring in Action - многое встанет на своим места

vch [1 day ago]
@Jury Mironov В ТЗ ведь написано - id юзера `"чудесным образом" попадают в SecurityUtil.authUserId()`. Оттуда его и надо брать, ничего добавлять не надо. Незачем хранить в репозитории.


Jury Mironov [1 day ago]
это я проглядел как-то

Stanislav [1 day ago]
И прочитай про модель памяти Java и что делает volatile


SergeyA [Today at 11:08 AM]
in #hw2
@Grigory Kislin плохо понятно по модели. Пересматриваю "Слои приложения. Создание каркаса приложения.":
Добавляем "LoggedUser" - ок, нахожу что " - переименовал `LoggedUser` в `AuthorizedUser`"-  но и AuthorizedUser не вижу в проекте (
UPD: а еще "на контроллеры не пишут интерфейс" - *почему?*
UPD2:  И что за пакет "mock" (ложный, насмешка) - *почему у него такое имя? какой смысл?* (edited)


19 replies
Yevhen Maksymovych [12 hours ago]
Его в SecurityUtils засунули


SergeyA [12 hours ago]
@Yevhen Maksymovych Спасибо!

Victor [11 hours ago]
mock - фальшивый класс, подделка. используется для тестирования. как я понимаю

Victor [11 hours ago]
программисты вообще любят мокать все подряд))))



Yevhen Maksymovych [11 hours ago]
@SergeyA на контроллеры не пишут интерфейсы, потому что иначе уровни абстракции никогда не закончатся :slightly_smiling_face: по сути, репозиторий у тебя реализует интерфейс доступа к данным, сервис - инкапсулирует в себе бизнес-логику работы с этими данными, а контроллер - уже конечная ступенька, которая реализует механизм взаимодействия с пользователем. Ну, т.е. тебе никто не мешает сделать интерфейс для контроллера, и добавить ещё один фасад, который будет работать с ними, но это уже излишне



Yevhen Maksymovych [11 hours ago]
@SergeyA на текущий момент у нас это несколько неочевидно, потому что за контроллерами ещё сидят сервлеты, которые их дёргают, но дальше мы от них избавимся, и наружу будут торчать уже чисто контроллеры



Alexander Pilipenko [11 hours ago]
Как я понимаю, этот проект делался на базе одного из тестовых заданий Григория при смене работы.

Alexander Pilipenko [11 hours ago]
В тестирование часто используется такой фреймворк

Alexander Pilipenko [11 hours ago]
http://site.mockito.org/
site.mockito.org
Mockito framework site
A landing page for information about Mockito framework, a mocking framework for unit tests written in Java.


Alexander Pilipenko [11 hours ago]
Немного на русском


Alexander Pilipenko [11 hours ago]
https://habr.com/post/243155/
Хабр
Шесть простых примеров по Mockito (перевод)
Маленький комментарий:/* Решил ознакомиться с тем, что из себя представляет эта библиотека, и отыскал замечательную статью, прочтение которой я хотел бы... (50 kB)


Alexander Pilipenko [11 hours ago]
Часто нет смысла тестировать как работают нижележащие слои (были протестированы, или еще не написаны и т.д.) Поэтому пишется так называемая заглушка. Которая соответствует интерфейсу и возвращает определенные результаты.


sky [9 hours ago]
Еще у спринга самого есть MockMVC для тестов, но это не точно



SergeyA [8 hours ago]
1. @Alexander Pilipenko Да спасибо за пояснение, я так и хотел спросить: т.е. у нас есть интерфейс и за ним что то должно отвечать при запуске приложения. И пакет "mock" содержит временные классы заглушки. Так?  :slightly_smiling_face:


Alexander Pilipenko [8 hours ago]
Вот более подробно

Alexander Pilipenko [8 hours ago]
http://java-online.ru/junit-mockito.xhtml
java-online.ru
JUnit и фреймворк Mockito
Совместное использование фреймворка Mockito с JUnit при модульном тестировании приложений

SergeyA [7 hours ago]
@Alexander Pilipenko спасибо!


SergeyA [7 hours ago]
Хм. звучит здорово! http://java-online.ru/junit-mockito.xhtml   Интересно узнать мнение @Grigory Kislin о возможности включить в уроки эту тему.  (или будет аналог в проекте?)
java-online.ru
JUnit и фреймворк Mockito
Совместное использование фреймворка Mockito с JUnit при модульном тестировании приложений


Ma3stro [44 minutes ago]
Spring test будет


Maksim K [Today at 9:31 PM]
in #hw2
Посмотрел решение HW2. Возник вопрос по фильтрации еды. Интересно, кто как реализовал. В решении Григория в DateTimeUtil в методе isBetween только добавились дженерики и сам метод остался прежним. А сама реализация фильтрации в контроллере в методе  List<MealWithExceed> getBetween(LocalDate startDate, LocalTime startTime, LocalDate endDate, LocalTime endTime). Там время и даты проверяются на null и в зависимости от результата вызываются сначала сервис, потом  MealsUtil. 
Я сделал проверки на null в самом методе DateTimeUtil.isBetween. И там сразу сравнивал либо только дату, либо время, в зависимости от того равны они нулю или нет, либо и дату и время. Сам метод получился в 6 строк. Но зато в контроллере у меня только одна строка:
return MealsUtil.getFilteredWithExceeded(service.getAll(SecurityUtil.authUserId(), startDate, endDate), SecurityUtil.authUserCaloriesPerDay(), startTime, endTime);
То есть я везде только передаю даты и время из формы в методы без какой либо проверки, а уже в DateTimeUtil.isBetween они проверяются на null и выдают ответ. 
Вопрос: плохо ли я сделал? И в чем плюсы, минусы обоих решений?


4 replies
vch [2 hours ago]
`DateTimeUtil.isBetween они проверяются на null и выдают ответ.` - ничего криминального не вижу...

Вот меня больше напрягает `InMemoryMealRepositoryImpl.save`
Мне кажется, он не соответствует подсказке 2.3
Многопоточность - больная тема для многих... (edited)


e.pekhterev [1 hour ago]
мне кажется соотвествует, если речь про computeIfPresent, я сам делал почти в точности также)


vch [1 hour ago]
@e.pekhterev твоего кода я не вижу, поэтому вполне возможно, что `почти` - ключевое слово (edited)


Victor [1 hour ago]
Мне так тяжело понять. Ссылку на гитхаб можешь дать?


Grigory Kislin [7 days ago]
@Maksim K даты  надо преобразовывать, тк они пойдут в sql запрос и там условия будут громоздкими. а время можно как null передавать


Maksim K [5 days ago]
@Grigory Kislin То есть я так понимаю, когда мы делаем проверку на нуль в контроллере, мы тем самым потом упрощаем запросы к БД. Иначе нам надо было бы в запросе к базе данных делать эту проверку, так?


Grigory Kislin [4 days ago]
да. и в методе фильтрации еды тоже


This message was deleted.


5 replies
Alexander Pilipenko [3 days ago]
Jdbc было в 3 уроке


pchurzin [3 days ago]
`No default constructor found`


Alexander Pilipenko [3 days ago]
Что-то мне кажется, что не все патчи установились


Prodigy [3 days ago]
была похожая проблема, я даже ломанулся создавать дефолтный конструктор, но это не помогло..... вроде проблема была с датасорсом... не помню точно


Jury Mironov [3 days ago]
ошибся веткой, да HW3. Да у меня с патчами вечно хрень какая-то
